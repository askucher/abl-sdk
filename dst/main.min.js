function bind$(t,e,n){return function(){return(n||t)[e].apply(t,arguments)}}function curry$(t,e){var n,r=function(o){return t.length>1?function(){var a=o?o.concat():[];return n=e?n||this:this,a.push.apply(a,arguments)<t.length&&arguments.length?r.call(n,a):t.apply(n,a)}:t};return r()}function curry$(t,e){var n,r=function(o){return t.length>1?function(){var a=o?o.concat():[];return n=e?n||this:this,a.push.apply(a,arguments)<t.length&&arguments.length?r.call(n,a):t.apply(n,a)}:t};return r()}function bind$(t,e,n){return function(){return(n||t)[e].apply(t,arguments)}}function bind$(t,e,n){return function(){return(n||t)[e].apply(t,arguments)}}function curry$(t,e){var n,r=function(o){return t.length>1?function(){var a=o?o.concat():[];return n=e?n||this:this,a.push.apply(a,arguments)<t.length&&arguments.length?r.call(n,a):t.apply(n,a)}:t};return r()}function bind$(t,e,n){return function(){return(n||t)[e].apply(t,arguments)}}function curry$(t,e){var n,r=function(o){return t.length>1?function(){var a=o?o.concat():[];return n=e?n||this:this,a.push.apply(a,arguments)<t.length&&arguments.length?r.call(n,a):t.apply(n,a)}:t};return r()}function compose$(){var t=arguments;return function(){var e,n;for(n=t[0].apply(this,arguments),e=1;e<t.length;++e)n=t[e](n);return n}}function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}function curry$(t,e){var n,r=function(o){return t.length>1?function(){var a=o?o.concat():[];return n=e?n||this:this,a.push.apply(a,arguments)<t.length&&arguments.length?r.call(n,a):t.apply(n,a)}:t};return r()}(function(){angular.module("ablsdk",[])}).call(this),angular.module("ablsdk").service("ablsdk",["ablslot","ablbook","loader","through","p","observ","types",function(t,e,n,r,o,a,u){return a(function(a){var i,c;return i={book:null,slot:null,calc:null,activities:[],currentActivity:null,preferences:null,choose:function(t){switch(!1){case!(t instanceof u.Day):return i.slot.selectDay(t);case!(t instanceof u.Timeslot):return i.slot.chooseSlot(t);case!(t instanceof u.Activity):return c(t);default:throw"Type of object is not supported"}}},c=function(n){return i.currentActivity=n,i.book=e(n,function(t,e){return a(t,e)}),i.slot=t(n,i.book.calendar),i.calc=function(){return i.book.calendar.calc},i.slot.observe(function(t){return a(t)})},i.load=function(t){return r(function(t){return n.activities({page:0,location:""},function(e){return i.activities.length=0,o.each(bind$(i.activities,"push"))(e.activities),i.preferences=e.preferences,t(e)})})},{widget:i,destoy:function(){return i.activities.length=0}}})}]),angular.module("ablsdk").service("ablapi",["$xabl",function(t){return{timeslots:function(e){var n;return n=$.param({activity:e.activityId,"status[event]":"all",dateRange:[moment(e.startTime).clone().startOf("day").startOf("month").toISOString(),moment(e.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()],pageSize:100}),t.get("timeslots?"+n)}}}]),angular.module("ablsdk").service("ablbook",["$xabl","p","stripe","debug","prefill","safeApply",function(t,n,r,o,a,u){return function(i,c){var l,s,f,d,m,p,v,h,y,g,b,w,S,D,$,k,x,A,T,C,M,E,_,I,O,Y,N,F,j,B,q;return l={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idempotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:"",address_zip:""}},calendar:{value:null,visible:!1,currentActivity:i,closed:function(t){return o("closed-calendar",t),l.form.date.start=l.calendar.date.start,l.form.date.end=l.calendar.date.end,c("slot-chosen",t)}}},s=function(t){var e;return null!=t?(e=null!=(null!=t?t.format:void 0)?t:moment(t),parseInt(e.format("YYYYMMDD"))):null},f=function(t){return function(){switch(!1){case null!==t.start:return"none";case s(t.start)===s(t.end):return"different";default:return"same"}}()},d=function(t){return!l.loading&&t.$valid},m=function(t){var e,n;for(e in O)if(O.hasOwnProperty(e)&&(n=j(t,e),(null!=n?n.length:void 0)>0))return n;return"Please check the form"},p=function(t){return l.form.error=t},v=function(){return p("")},h=function(){var t;return l.idempotencyKey=(t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},h(),y=function(t){var e;return null!=(e=null!=t&&"function"==typeof t.filter?t.filter(function(t){return t.quantity>0}):void 0)?e:[]},g=function(t){switch(!1){case void 0!==t:case null!==typeof t:case 0!==t.length:return 0;default:return t.reduce(function(t,e){return t+e})}},b=function(){return 0===g(l.calendar.calc.attendees.map(function(t){return t.quantity}))},w=function(t,e){return function(){switch(!1){case 4!==t.length:case 9!==t.length:case 14!==t.length:case 19!==t.length:return t+" ";default:return t}}()+e},S=function(t,e){return function(){switch(!1){case 4!==t.length:case 11!==t.length:return t+" ";default:return t}}()+e},D=function(){var t;if(null==l.calendar._id)throw"Cannot get event instance id because calendar._id is not defined";if(null==(t=function(t){return null!=t?t.eventId:void 0}(n.find(function(t){return t._id===l.calendar._id})(i.timeslots))))throw"event id is not found by id "+l.calendar._id+" in ["+i.timeslots.map(function(t){return t._id}).join(",")+"]";return t+"_"+l.calendar.date.origin},$=function(r,o){var a,u,c,s,f,d,m;return a=l.form,i,u=function(t){return n.map(function(){return null})(function(){var e,n,r=[];for(e=1,n=t;e<=n;++e)r.push(e);return r}())},c=l.calendar.calc.coupon.codes.length>0,s=l.calendar.calc.agent.codes.length>0,f=0===l.calendar.calc.calcTotal(),d={isMobile:null!=(m=a.isMobile)&&m,stripeToken:r,couponId:c?l.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:function(){switch(!1){case!(f&&c):return"gift";case!f:return"cash";default:return"credit"}}(),agentCode:s?l.calendar.calc.agent.codes[0].code:void 0,eventInstanceId:D(),addons:n.pairsToObj(n.map(function(t){return[t._id,u(t.quantity)]})(l.calendar.calc.addons)),attendees:n.pairsToObj(n.map(function(t){return[t._id,u(t.quantity)]})(l.calendar.calc.attendees)),answers:n.pairsToObj(n.map(function(t){return[t._id,t.answer]})(l.calendar.questions)),adjustments:l.calendar.calc.adjustment.list,fullName:a.name,email:a.email,phoneNumber:a.phone,notes:a.notes,location:a.location,currency:"usd",operator:i.operator._id||i.operator,_customHeaders:{"Idempotency-Key":l.idempotencyKey}},t.post("bookings",d).success(function(t){var n,r;return null!=t.bookingId?(a.bookingId=t.bookingId,h(),o(t)):p(null!=(n=null!=(r=e.errors)?r[0]:void 0)?n:"Server error")}).error(function(t){var e,n;return p(null!=(e=null!=(n=t.errors)?n[0]:void 0)?e:"Server error")}).finally(function(){return l.loading=!1})},k=function(t,e){var n,o,a,u,i;return void 0===t?(l.loading=!1,p("Stripe key is not defined")):(r.setPublishableKey(t),n=l.form.creditCard,o=n.expDate.split("/"),a=l.form,u={number:n.card,cvc:n.cvv,address_zip:n.address_zip,exp_month:o[0],exp_year:"20"+o[1],fullName:null!=(i=a.fullName)?i:a.name,location:a.location,state:a.state},r.createToken(u,function(t,n){return null!=t?(l.loading=!1,p(t)):$(n,e)}))},x=function(){return t.get("payments/setup?operator="+(i.operator._id||i.operator))},A=function(t){var e;return!0!==l.loading&&(l.triedCheckout=!0,e=d(t),e||p(m(t)),e)},T=function(t){return l.booking=t,c("success",t)},C=function(t,e){if(A(t))return l.loading=!0,l.calendar.calc.calcTotal()>0?x().success(function(t){return k(t.publicKey,T)}).error(function(t){return l.loading=!1,p(t),c("error",p)}):$("",T)},M=function(){return l.form.agreed=!l.form.agreed,F()},E=function(t){return t.required||t.pattern||t.minlength||t.maxlength||t.phone},_=function(t,e){var n,r;return n=O[t].state,r=function(){switch(!1){case!l.triedCheckout:return!0;case!(!n.touched&&!l.triedCheckout):case!(n.active&&!l.triedCheckout):return!1;case!(!n.active&&n.touched):return!0;default:return!1}}(),r?I(t,e):""},I=function(t,e){var n,r,o,a,u,i;switch(!1){case!e.required:return null!=(n=null!=(r=O[t].messages)?r.required:void 0)?n:O[t].title+" is required";case!e.pattern:return null!=(n=null!=(o=O[t].messages)?o.pattern:void 0)?n:"Please enter a valid "+O[t].example;case!e.minlength:return null!=(n=null!=(a=O[t].messages)?a.minlength:void 0)?n:O[t].title+" is too short";case!e.maxlength:return null!=(n=null!=(u=O[t].messages)?u.maxlength:void 0)?n:O[t].title+" is too long";case!e.phone:return null!=(n=null!=(i=O[t].messages)?i.phone:void 0)?n:O[t].title+" is not valid phone number";default:return"please check "+O[t].title}},O={email:{title:"Email Address",pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email",state:{index:1,touched:!1,active:!1}},name:{pattern:"",title:"Full Name",example:"Your name",placeholder:"Name",state:{index:2,touched:!1,active:!1}},phone:{title:"Phone Number",pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234",state:{index:3,touched:!1,active:!1}},address:{pattern:"",title:"Address",example:"Address",placeholder:"Home address",state:{index:4,touched:!1,active:!1}},notes:{pattern:"",title:"Notes",example:"Notes",placeholder:"Notes",state:{index:5,touched:!1,active:!1}},address_zip:{pattern:"",example:"12345",title:"Postal Code",placeholder:"Postal Code",normalize:function(t){return t},state:{index:6,touched:!1,active:!1}},card:{pattern:/(^[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}$)|(^[0-9]{4} [0-9]{6} [0-9]{5}$)/i,example:"Card Number",title:"Credit Card Number",placeholder:"Credit Card Number",normalize:function(t){var e,r,a;if(void 0!==t&&(e=t.split(" ").join(""),!(e.length<15)))return r=function(t){return O.cvv.pattern=O.cvv.patterns[t],O.cvv.messages.pattern=O.cvv.messages.patterns[t]},a=function(t){return l.form.creditCard.card=function(t){return t.substr(0,19)}(n.fold(t,"")(e))},o("strip-value",e.length,e),15===e.length?(a(S),r(4)):16===e.length?(a(w),r(3)):void 0},state:{index:7,touched:!1,active:!1}},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",title:"Exp Date",placeholder:"Exp Date (MM/YY)",normalize:function(t,e){var n,r,o;return n=null!=(r=null!=t?t.replace("/",""):void 0)?r:"",o=function(t){return null!=t?t:""},l.form.creditCard.expDate=function(){switch(!1){case!(2===n.length&&8===e):return n[0]+n[1];case 2!==n.length:return n[0]+n[1]+"/";case!(n.length>2):return n[0]+n[1]+"/"+o(n[2])+o(n[3]);default:return n}}()},state:{index:8,touched:!1,active:!1}},startDate:{state:{index:11,touched:!1,active:!1}},cvv:(Y={3:/^[0-9]{3}$/i,4:/^[0-9]{4}$/i},N={3:"CVV must be 3 digits (e.g. 123)",4:"CVV must be 4 digits (e.g. 1234)"},{pattern:Y[3],patterns:Y,example:"000",title:"CVV",placeholder:"CVV",state:{index:9,touched:!1,active:!1},messages:{pattern:N[3],patterns:N}}),agreed:{title:"Confirmation",pattern:"true",messages:{required:"Please accept the terms and conditions"},state:{index:10,touched:!1,active:!1}}},F=function(){if(l.form.agreed)return l.triedCheckout=!0},j=function(t,e){var r,o,a,u;r=n.pairsToObj(n.sortBy(function(t){return t[1].state.index})(n.objToPairs(O)));for(o in r)if(O.hasOwnProperty(o)&&(a=null!=(u=t[o])?u.$error:void 0)&&E(a))return o===e?_(o,a):"";return""},B=function(t){return O[t].placeholder},a(function(){var t,e;return t=l.form,t.email="a.stegno@gmail.com",t.name="Test User",t.phone="+380665243646",t.address="664 Cypress Lane, Campbell, CA, United States",t.notes="Some test notes",e=l.form.creditCard,e.card="5105 1051 0510 5100",e.address_zip="12345",e.expDate="05/17",e.cvv="333",l.form.agreed=!0}),q=l,q.handle=function(t){return u(function(){var e,n,r,o;if(e=t.target.name,n=t.type,r=t.target.value,null!=(o=O[e]))switch(n){case"keyup":return"function"==typeof o.normalize?o.normalize(r,t.keyCode):void 0;case"focus":return o.state.active=!0,o.state.touched=!0;case"blur":return o.state.active=!1}})},q.setIndex=function(t,e){var n;return null==(n=O[t])?e:(n.state.index=e,e)},q.investigateDate=f,q.getEventInstanceId=D,q.placeholder=B,q.closeError=v,q.checkout=C,q.validate=A,q.agree=M,q.fields=O,q.few=y,q.disabledOrder=b,q.message=j,l}}]),angular.module("ablsdk").service("browser",["$window",function(t){var e;return e=function(){var e,n;t.navigator.userAgent,e={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i};for(n in e)if(e[n].test(t.navigator.userAgent))return n;return"unknown"},{name:e()}}]),angular.module("ablsdk").service("ablcalc",["$xabl","$timeout","p","debug",function(t,e,n,r){var o;return o=function(t){switch(!1){case void 0!==t:case null!==typeof t:return 0;default:return n.sum(t)}},function(a,u,i,c){var l,s,f,d,m,p,v,h,y,g,b,w,S,D,$,k,x,A,T,C,M,E,_,I,O,Y,N,F,j,B,q,P,z,H,U,R,Z,W;return l=null!=u?u:[],s=null!=(f=null!=a?a.filter(function(t){return"active"===t.status}):void 0)?f:[],d=function(t){return{name:t.name,isDefault:t.isDefault,quantity:0,amount:t.amount,_id:t._id}},m=function(t,e){return e.amount-t.amount},p=function(t){return{name:t[0].name,isDefault:t[0].isDefault,amount:t[0].amount,quantity:t.length,_ids:n.map(function(t){return t._id})(t)}},v=function(t){return n.sortWith(m)(n.map(p)(n.map(function(t){return t[1]})(n.objToPairs(n.groupBy(function(t){return t.name+t.amount})(n.filter(function(e){return e.type===t})(l))))))},h=curry$(function(t,e){var r;return r=n.find(function(t){return e.name===t.name&&e.amount===t.amount})(v(t)),null!=r&&(r.old=!0),null==r}),y=function(t){return n.sortWith(m)(n.filter(h(t))(n.map(d)(n.filter(function(e){return e.type===t})(s))))},g=function(t){var e,r,o;return e=n.sortBy(function(t){return t.amount})(n.concat(n.map(function(e){return e(t)})([v,y]))),r=n.filter(function(t){return t.isDefault})(e),o=n.sortBy(function(t){return t.amount})(n.filter(function(t){return-1===r.indexOf(t)})(e)),0===r.length?n.reverse(n.sortBy(function(t){return t.amount})(e)):r.concat(o)},b={amount:3},w={attendees:g("aap"),addons:g("addon")},S=function(){return n.sum(n.map(function(t){return t.amount})(z.list))},D=function(){return o(w.attendees.map(A))+S()+M()},$=function(t){switch(!1){case"tax"!==t.type:return D()/100*t.amount;case"fee"!==t.type:return o(w.attendees.map(function(t){return t.quantity}))*t.amount;default:return 0}},k=function(){return o(s.map($))},x=function(t){var e,n,r;return null!=(e=null!=(n=s.filter(function(e){return"aap"===e.type&&e.name===t.name}))&&null!=(r=n[0])?r.amount:void 0)?e:0},A=function(t){return x(t)*t.quantity},T=function(t){return o(w.addons.filter(function(e){return e.name===t.name}).map(function(t){return t.amount}))},C=function(t){return T(t)*t.quantity},M=function(){return o(w.addons.map(C))},E=function(){var t,e,n,r,o;return t=Z.codes[0],e=Math.abs(null!=(n=null!=t?t.amount:void 0)?n:0),r=null!=(n=null!=t?t.percentage:void 0)&&n,o=null==(n=null!=t?t.isTotal:void 0)||n?O():D(),-1*function(){switch(!1){case!(!1===r&&e<o):return e;case!1!==r:return o;default:return o/100*e}}()},_=function(t){var e,n,r,o,a,u;return null==(e=W.codes[0])?0:!1===e.settings.commission.originalExclusive?0:(n=D(),r=F(t)-n,o=e.settings.commission.type,a=e.settings.commission.amount,u=e.settings.commission.totalAsSource,"percentage"===o?(n+r*u)*(a/100):a)},I=function(t,e){var n,r,o;return n="inactive"===t.status,r=t.type,o=t.old,e=function(){switch(!1){case"aap"!==r:return"pricing level";case"addon"!==r:return"add-on"}}(),function(){switch(!1){case!(n&&"removed"===e):return"Warning: This "+e+" no longer exists. You can only reduce the quantity at this "+e+". If you wish to offer another "+e+" at this price, please create on Adjustment to currect the price.";case!(o&&"changed"===e):return"Warning: This "+e+" has changed since the booking was created. You can only reduce the quantity at this "+e+". If you wish to offer the old "+e+", please create an Adjustment.";case!((n||o)&&"mutated"===e):return!0;default:return""}}()},O=function(){return D()+k()},Y=function(){return O()+E()},N=function(t){return Y()/100*(t&&null!==t.applicationFee?t.applicationFee:b.amount)},F=function(t){return Y()+N(t)},j=function(t){return F()+_(t)},B=function(){return n.sum(n.map(function(t){return t.amount})(l))},q=n.sum(n.map(function(t){return t.amount})(null!=i?i:[])),P=function(){return-(j()-q)},z={list:n.filter(function(t){return"adjustment"===t.type})(l),name:"",amount:"",isEdit:!1,show:!1,add:function(){var t;return t={name:z.name,amount:z.amount},t.amount*=100,z.list.push(t),z.name="",z.amount="",z.show=!1,z.isEdit=!1},removable:function(t){return null==t._id},remove:function(t){var e;return e=z.list.indexOf(t),z.list.splice(e,1)},edit:function(t){return z.isEdit&&z.add(),z.name=t.name,z.amount=t.amount/100,z.show=!0,z.isEdit=!0,z.remove(t)}},H={},U=function(t,e){var n;return H[t]=null!=(n=H[t])?n:[],H[t].push(e)},R=function(t,e){var r,o;return r=null!=(o=H[t])?o:[],n.each(function(t){return t(e)})(r)},Z={codes:n.filter(function(t){return"coupon"===t.type})(l),calc:E,show:!1,edit:function(t){return Z.code=t.code,Z.remove(t),Z.show=!0},remove:function(t){var e;if((e=Z.codes.indexOf(t))>-1)return Z.codes.splice(e,1)},add:function(n){var o,a;if(0!==(null!=(o=Z.code)?o:"").length&&(Z.code=Z.code.toUpperCase(),Z.error=function(){switch(!1){case 0!==Z.code.length:return"Code is required";case!(Z.code.length<6):return"6 chars are required";default:return""}}(),!(Z.error.length>0)))return a=function(t){var o,a,u;return o=function(){return Z.codes.push(t),R("coupon-added",t),Z.code="",Z.success="Coupon "+t.couponId+" added successfully",Z.show=!1,e(function(){var t;return t=Z.success,delete Z.success,t},3e3),""},a=moment(t.startTime),u=moment(t.endTime),r({startTime:a.format(),redeemBy:u.format(),check:a.diff(moment(),"minutes"),check1:a.diff(u,"minutes"),status:t.status,redemptions:0!==t.maxRedemptions&&t.maxRedemptions<=t.redemptions,expired:moment().diff(u,"minutes"),activity:t.activities.length>0&&t.activities[0]!==n}),Z.error=function(){switch(!1){case!(a.diff(moment(),"minutes")>0):return"Coupon is not valid yet";case"inactive"!==t.status:return"Coupon is inactive";case!(0!==t.maxRedemptions&&t.maxRedemptions<=t.redemptions):return"This coupon has been fully redeemed.";case!(moment().diff(u,"minutes")>0):return"This coupon is expired";case!(t.activities.length>0&&t.activities[0]!==n):return"This coupon is not valid for this activity.";default:return o()}}()},t.get("coupons/"+Z.code).success(function(t){return a(t)}).error(function(t){var e,n;return Z.error=null!=(e=null!=t&&null!=(n=t.errors)?n[0]:void 0)?e:"Coupon not found",Z.code="",Z.show=!0})},code:""},W={codes:n.filter(function(t){return"agent_commission"===t.type})(l),calc:_,show:!1,edit:function(t){return W.code=t.code,W.remove(t),W.show=!0},remove:function(t){var e;if((e=W.codes.indexOf(t))>-1)return W.codes.splice(e,1)},add:function(n){var r,o,a;if(0!==(null!=(r=W.code)?r:"").length&&(W.error=function(){switch(!1){case 0!==W.code.length:return"Code is required";default:return""}}(),!(W.error.length>0)))return o=function(t){return W.codes.push(t),R("agent-added",t),W.code="",W.success="Agent code "+t.code+" added successfully",W.show=!1,e(function(){var t;return t=W.success,delete W.success,t},3e3),""},a=function(t){var e,n;return W.error=null!=(e=null!=t&&null!=(n=t.errors)?n[0]:void 0)?e:"Agent code not found",W.code="",W.show=!0},t.get("operators/"+c+"/agents?code="+W.code).success(function(t){return 1===t.list.length?o(t.list[0]):a(t)}).error(function(t){return a(t)})},code:""},{warning:I,on:U,handle:function(t){var e;return r("handle",t),Z.code=(null!=(e=Z.code)?e:"").toUpperCase()},handleAgent:function(t){var e;return r("handle-agent-code",t),W.code=null!=(e=W.code)?e:""},coupon:Z,agent:W,calcServiceFee:N,adjustment:z,addons:w.addons,attendees:w.attendees,showAttendees:function(){return n.join(", ")(n.map(function(t){return t.quantity+" "+t.name})(n.filter(function(t){return t.quantity>0})(w.attendees)))},showAddons:function(){return n.join(", ")(n.map(function(t){return t.quantity+" "+t.name})(n.filter(function(t){return t.quantity>0})(w.addons)))},totalWithoutTaxesfees:D,calcCoupon:E,calcAgentCommission:_,couponCode:function(){var t,e;return t=Z.codes[0],null!=(e=null!=t?t.couponId:void 0)?e:null!=(e=null!=t?t.name:void 0)?e:"UNKNOWN"},calcTaxFee:$,setServiceFee:function(t){return b.amount=t},calcTaxesFees:function(t){return k()+N(t)},showPrice:x,calcPrice:A,showAddonPrice:T,calcAddonPrice:C,totalAddons:M,calcSubtotal:D,calcTotal:j,calcPreviousTotal:B,calcBalanceDue:P}}}]),angular.module("ablsdk").filter("capitalize",function(){return function(t){return angular.isString(t)&&t.length>0?t.charAt(0).toUpperCase()+t.substr(1).toLowerCase():t}}).filter("capitalizeAll",function(){return function(t){return angular.isString(t)&&t.length>0?t.split(" ").map(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}).join(" "):t}});var toString$={}.toString;angular.module("ablsdk").service("crud",["$xabl","$rootScope","debug","$mdDialog","safeApply","watcher","p",function(t,e,n,r,o,a,u){return function(n,i){var c,l,s,f,d,m,p,v,h,y,g,b,w,S,D,$,k,x;return c=n.split("@"),n=c[0],l={loading:!1,id:"_id",frontendify:function(t,e){var n,r;return n=e.split("/"),r=n[n.length-1],function(){switch(!1){case"Array"!==toString$.call(t).slice(8,-1):return t;case"Array"!==toString$.call(t.list).slice(8,-1):return t.list;case"Array"!==toString$.call(t[r]).slice(8,-1):return t[r];case"Object"!==toString$.call(t).slice(8,-1):return[t];default:return[]}}()}},s={localStorage:{remove:function(t){},add:function(t){},update:function(t){},fetch:function(t){}},memory:{remove:function(t){return h(t)},add:function(t,e){return Array.prototype.push.call(v,t),"function"==typeof e?e(t):void 0},update:function(t,e){return"function"==typeof e?e(t):void 0},fetch:function(){return l.loading=!1}},backend:{remove:function(e,r){var o;return t.delete((null!=(o=r.url)?o:n)+"/"+e[l.id]).success(function(){var t,n;return t=function(){return h(e)},(null!=(n=r.onItemRemoved)?n:t)()})},update:function(e,r){return t.update(n+"/"+e[l.id],e).success(function(t){return l.loading=!1,"function"==typeof r?r(t):void 0})},add:function(e,r){return t.create(n,e).success(function(t){return w(t),"function"==typeof r?r(t):void 0})},fetch:function(){var e;return e=angular.copy(v.options),delete e.total,delete e.$url,t.get(m(n),{params:e}).success(function(t,e,n){var r,o;return v.length=0,r=function(t){var e,r;if(null!=n()[t]){e=document.createElement("a"),e.href=n()[t];try{return JSON.parse('{"'+decodeURI(e.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(t){return r=t,void console.error(r,e.search)}}},v.options.total=(o=r("x-last-page-url"),null!=o?parseInt(o.page)*parseInt(o.pageSize):t.length),v.options.pageSize=(o=r("x-first-page-url"),null!=o?parseInt(o.pageSize):t.length),l.loading=!1,w(t)})}}},f=s[null!=(d=c[1])?d:"backend"],m=function(t){var e,n,r;return e={url:t},n=function(t){return e.url=e.url.replace(":"+t[0],t[1])},r=v.getOptions().$url,null!=r&&u.each(n)(u.objToPairs(r)),e.url},p=e.$new(),p.items=[],v=p.items,l.loading=!1,h=function(t){var e;if((e=v.indexOf(t))>-1)return Array.prototype.splice.call(v,e,1)},y=function(t,e){return null!=t[l.id]||null!=t[l._id]?g(t,e):b(t,e)},g=function(t,e){if(!l.loading)return f.update(t,e)},b=function(t,e){if(!l.loading)return f.add(t,e)},w=function(t){var e,r;switch(e=l.frontendify(t,n),toString$.call(e).slice(8,-1)){case"Array":Array.prototype.push.apply(v,e);break;case"Object":r=function(t){return v[t[0]]=t[1]},u.each(r)(u.objToPairs(e))}return l.loading=!1},v.options={},v.converter=function(t){return l.frontendify=t.frontendify,l.backendify=t.backendify,v},v.id=function(t){return l.id=t,v},v.getOptions=function(){return v.options},S=function(t){if(!l.loading){switch(toString$.call(t).slice(8,-1)){case"Function":return v.getOptions=t,S({});case"Number":v.options.page=t;break;case"Object":v.options=angular.extend({},v.getOptions(),t)}return l.loading=!0,null!=v.options.page&&(v.options.page-=1),f.fetch()}},S(i),D=function(){var t;if(!l.loading)return t=Array.prototype.splice.apply(v,arguments),t.forEach(f.remove)},$=function(t,e,n){var o,a;if(!l.loading)return o={title:"Confirm Delete",content:"Deleting this pricing level will remove all prices associated with it in the timeslot section and on your booking widgets. This action cannot be undone, are you sure you want to delete this pricing level?",ok:"Confirm",cancel:"Cancel"},a=r.confirm({controller:"confirm2",templateUrl:"confirm",locals:{options:angular.extend({},o,n)},targetEvent:e}),r.show(a).then(function(e){if(!0===e)return f.remove(t,n)})},k=[],x=function(t){var e,n;return e=[],n=curry$(function(n,r){var o,a;return o=[],x(o),a=function(){var e;return e=Array.prototype[n].call(t,r),o.length=0,Array.prototype.push.apply(o,e)},e.push(a),a(),o}),t.loading=function(){return l.loading},t.toArray=function(){var e;return e=[],Array.prototype.push.apply(e,t),e},t.fetchOn=function(e,n){return n.$watch(e,bind$(v,"fetch"),!0),t},t.watch=function(n,r){var u;return u=function(){return o(function(){return e.forEach(function(t){return t()})})},null!=r?(k.push({array:r[n],func:u}),r.$watch(n,u,!0)):(k.push({array:n,func:u}),a.watch(n,u)),t},t.watch(t),["map","filter"].forEach(function(e){return t[e]=n(e)}),t.push=b,t.save=y,t.fetch=S,t.remove=$,t.splice=D,t.toArray=function(){return angular.copy(t)}},v.listen=function(t){return t.$on("$destroy",function(){var t,e,n,r,o=[];for(t=0,n=(e=k).length;t<n;++t)r=e[t],o.push(a.unwatch(r.array,r.func));return o}),v},x(v),v}}]),angular.module("ablsdk").filter("cut",function(){return function(t,e){switch(!1){case void 0!==t:case null!==t:return t;case!(t.length-3>e):return t.substr(0,e)+"...";default:return t}}}),angular.module("ablsdk").service("abldate",["debug",function(t){return function(t){var e,n;return e=function(t,e){var n,r;return n=bind$(moment(t),"format"),r=bind$(e,"format"),moment(n("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},n=function(e,n){return e.add(moment(n).tz(t).utcOffset()-e.utcOffset(),"minute")},{backendify:function(r){var o;return o=e(r,moment().tz(t)).tz(t),n(o),o.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(r){var o;return o=moment(r).tz(t),n(o,o),e(o,moment(r)).toDate()}}}}]);var toString$={}.toString;angular.module("ablsdk").factory("debug",["enabledDebug","$window",function(t,e){return function(e){var n,r;if(t)if((n=function(){switch(!1){case"Function"!==toString$.call(null!=e?e.match:void 0).slice(8,-1):return e.match(/<<[a-z]+>>/i);default:return null}}())&&window.catch===n[0].replace("<<","").replace(">>",""));else switch(toString$.call(e).slice(8,-1)){case"Function":return e();default:return"undefined"!=typeof console&&null!==console&&null!=(r=console.log)?r.apply(console,arguments):void 0}}}]),angular.module("ablsdk").directive("event",["p","safeApply",function(t,e){return{restrict:"A",scope:{event:"&"},link:function(n,r,o){var a,u;return a=$(r),u=function(t){return a[t](function(t){var r;return r=function(){return n.event({event:t})},e(r,n)})},t.each(u)(["blur","focus","keyup"])}}}]),angular.module("ablsdk").service("ablfacade",["ablbook","ablslot",function(t,e){return function(n,r){var o,a;return o=t(n,r),a=e(n,o.calendar),{book:o,slot:a}}}]),angular.module("ablsdk").service("formula",["p","debug",function(t,e){var n,r;return n=function(e,n){var r,o;return r=null!=(o=null!=n?n.charges:void 0)?o:[],function(t){var e;return null!=(e=null!=t?t.amount:void 0)?e:0}(t.find(function(t){return t.type===e||t.subtype===e||t.description===e})(r))},r=function(e){var n,r,o,a,u,i,c,l,s,f;return(null!=e&&null!=(n=e.timeslots)?n.length:void 0)>0?(r=function(t){return[].concat.apply([],t)},o=function(e){var n;return t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(t.filter(function(t){return t.isDefault})(null!=(n=null!=e?e.charges:void 0)?n:[])))},a=function(e){var n,r;return n="Adult",t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(t.filter(function(t){return t.type===n||t.subtype===n||t.description===n})(null!=(r=null!=e?e.charges:void 0)?r:[])))},u=function(e){var n;return t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(null!=(n=null!=e?e.charges:void 0)?n:[]))},i=r(e.timeslots.map(a)),c=r(e.timeslots.map(u)),l=r(e.timeslots.map(o)),s=function(t){return Math.max.apply(Math,t)},f=function(t){return Math.min.apply(Math,t)},function(){switch(!1){case!(l.length>0):return f(l);case!(i.length>0):return s(i);case!(c.length>0):return s(c);default:return 0}}()):"Non"},{getSlotPrice:function(t){return n("Adult",t)},getVisualPrice:r,getAdultPrice:function(t){var e;return n("Adult",null!=t&&null!=(e=t.timeslots)?e[0]:void 0)},getYouthPrice:function(t){var e;return n("Youth",null!=t&&null!=(e=t.timeslots)?e[0]:void 0)}}}]),angular.module("ablsdk").directive("hint",["$timeout","debug",function(t,e){return{restrict:"A",replace:!0,scope:{},link:function(t,n,r){var o,a;return o=$(n),a={hint:null},r.$observe("hint",function(t){return o.mouseover(function(){var n,r,u;return n=o.offset(),r=250,a.hint=$("<div>"+t+"</div>").css("position","absolute").css("background","gray").css("border-radius","5px").css("width",r).css("box-sizing","border-box").css("padding","5px").css("text-align","center").css("color","white").css("z-index","9999").css("opacity","0").css("bottom",n.bottom),a.hint.css("top",n.top-2*a.hint.height()),u=n.left-r/2,a.hint.css("left",Math.max(u,0)),a.hint.animate({opacity:1},500),e("mouseover",n),$(document.body).append(a.hint)}),o.mouseout(function(){return e("mouseout"),a.hint.remove()})})}}}]);var toString$={}.toString;angular.module("ablsdk").service("loader",["$xabl","types","p",function(t,e,n){return{activities:function(r,o){var a,u;return a=$.param({location:null!=(u=r.location)?u:"",pageSize:100,page:null!=(u=r.page)?u:0,noEmpty:!1,dateRange:[moment().startOf("day").format(),moment().clone().add(18,"months").endOf("day").format()]}),t.get("operators/"+t.options.key).error(function(){throw"An error occurred getting Operator information for key "+t.options.key}).success(function(r){return t.get("activities?"+a).success(function(t){if("Array"!==toString$.call(t.list).slice(8,-1))throw".list is not Array";if("Object"!==toString$.call(t.preferences).slice(8,-1))throw".preferences is not Object";return o({activities:n.map(e.cast(function(t){return t.Activity}))(t.list),preferences:t.preferences,info:r})})})}}}]),angular.module("ablsdk").directive("mdLongLabel",["debug",function(t){return{restrict:"C",link:function(t,e){var n;return n=$(e[0]).find("label"),setTimeout(function(){return $(e[0]).css("margin-top",function(){switch(!1){case 0!==n.height():case 20!==n.height():return 0;default:return n.height()}}())},100)}}}]),angular.module("ablsdk").filter("mdate",["debug",function(t){return function(t,e){switch(!1){case null!=t:return null;case null==t.format:return t.format(e);default:return moment(t).format(e)}}}]),angular.module("ablsdk").service("observ",function(){return function(t){var e,n,r;return e=[],n=function(t,n){var r;return r=function(t){return t[1](n)},e.filter(function(e){return e[0]===t}).forEach(r)},r=t(n),r.on=function(t,n){return e.push([t,n])},r.off=function(t){var n;return n=function(t){var n;return n=e.indexOf(t),e.splice(n,1)},e.filter(function(e){return e[1]===t}).forEach(n)},r}});var toString$={}.toString;angular.module("ablsdk").service("p",function(){var t;return t=function(e){var n;return[].concat.apply([],function(){var r,o,a,u=[];for(r=0,a=(o=e).length;r<a;++r)n=o[r],"Array"===toString$.call(n).slice(8,-1)?u.push(t(n)):u.push(n);return u}())},{take:curry$(function(t,e){return t<=0?e.slice(0,0):e.slice(0,t)}),drop:curry$(function(t,e){return t<=0?e:e.slice(t)}),head:function(t){return t[0]},each:curry$(function(t,e){var n,r,o;for(n=0,r=e.length;n<r;++n)o=e[n],t(o);return e}),isItNaN:function(t){return t!==t},all:curry$(function(t,e){var n,r,o;for(n=0,r=e.length;n<r;++n)if(o=e[n],!t(o))return!1;return!0}),map:curry$(function(t,e){return e.map(t)}),fold:curry$(function(t,e,n){var r,o,a
;for(r=0,o=n.length;r<o;++r)a=n[r],e=t(e,a);return e}),filter:curry$(function(t,e){var n,r,o,a=[];for(n=0,r=e.length;n<r;++n)o=e[n],t(o)&&a.push(o);return a}),find:curry$(function(t,e){var n,r,o;for(n=0,r=e.length;n<r;++n)if(o=e[n],t(o))return o}),pairsToObj:function(t){var e,n,r,o={};for(e=0,n=t.length;e<n;++e)r=t[e],o[r[0]]=r[1];return o},objToPairs:function(t){var e,n,r=[];for(e in t)n=t[e],r.push([e,n]);return r},values:function(t){var e,n,r=[];for(e in t)n=t[e],r.push(n);return r},any:curry$(function(t,e){var n,r,o;for(n=0,r=e.length;n<r;++n)if(o=e[n],t(o))return!0;return!1}),notAny:curry$(function(t,e){var n,r,o;for(n=0,r=e.length;n<r;++n)if(o=e[n],t(o))return!1;return!0}),sum:function(t){var e,n,r,o;for(e=0,n=0,r=t.length;n<r;++n)o=t[n],e+=o;return e},sort:function(t){return t.concat().sort(function(t,e){return t>e?1:t<e?-1:0})},concat:function(t){return[].concat.apply([],t)},concatMap:curry$(function(t,e){var n;return[].concat.apply([],function(){var r,o,a,u=[];for(r=0,a=(o=e).length;r<a;++r)n=o[r],u.push(t(n));return u}())}),flatten:t,groupBy:curry$(function(t,e){var n,r,o,a,u;for(n={},r=0,o=e.length;r<o;++r)a=e[r],u=t(a),u in n?n[u].push(a):n[u]=[a];return n}),sortWith:curry$(function(t,e){return e.concat().sort(t)}),sortBy:curry$(function(t,e){return e.concat().sort(function(e,n){return t(e)>t(n)?1:t(e)<t(n)?-1:0})}),reverse:function(t){return t.concat().reverse()},split:curry$(function(t,e){return e.split(t)}),join:curry$(function(t,e){return e.join(t)}),lines:function(t){return t.length?t.split("\n"):[]},unlines:function(t){return t.join("\n")},words:function(t){return t.length?t.split(/[ ]+/):[]},unwords:function(t){return t.join(" ")},chars:function(t){return t.split("")},unchars:function(t){return t.join("")},repeat:curry$(function(t,e){var n,r;for(n="",r=0;r<t;++r)n+=e;return n}),maximum:function(t){var e,n,r,o,a;for(e=t[0],n=0,o=(r=t.slice(1)).length;n<o;++n)(a=r[n])>e&&(e=a);return e},minimum:function(t){var e,n,r,o,a;for(e=t[0],n=0,o=(r=t.slice(1)).length;n<o;++n)(a=r[n])<e&&(e=a);return e},maximumBy:curry$(function(t,e){var n,r,o,a,u;for(n=e[0],r=0,a=(o=e.slice(1)).length;r<a;++r)u=o[r],t(u)>t(n)&&(n=u);return n}),minimumBy:curry$(function(t,e){var n,r,o,a,u;for(n=e[0],r=0,a=(o=e.slice(1)).length;r<a;++r)u=o[r],t(u)<t(n)&&(n=u);return n}),capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},camelize:function(t){return t.replace(/[-_]+(.)?/g,function(t,e){return(null!=e?e:"").toUpperCase()})},dasherize:function(t){return t.replace(/([^-A-Z])([A-Z]+)/g,function(t,e,n){return e+"-"+(n.length>1?n:n.toLowerCase())}).replace(/^([A-Z]+)/,function(t,e){return e.length>1?e+"-":e.toLowerCase()})}}}),angular.module("ablsdk").factory("prefill",["debug","safeApply",function(t,e){return function(t){}}]);var toString$={}.toString;angular.module("ablsdk").filter("price",["$filter",function(t){return function(e,n){var r;return r=function(){switch(!1){case"String"!==toString$.call(e).slice(8,-1):return parseInt(e)/100;case"Number"!==toString$.call(e).slice(8,-1):return e/100;default:return"ERR"}}(),"ERR"===r?r:function(){switch(!1){case"00.00$"!==n:return t("currency")(r).replace("$","").trim()+"$";case"$00"!==n:return"$"+Math.round(r);default:return t("currency")(r)}}()}}]),angular.module("ablsdk").service("safeApply",["$rootScope",function(t){return function(e,n){var r,o;return r=null!=n?n:t,o=r.$$phase,"$apply"===o||"$digest"===o?e():r.$apply(e)}}]);var toString$={}.toString;angular.module("ablsdk").service("ablslot",["abldate","ablcalc","ablapi","formula","p","debug","$xabl","$rootScope","types",function(abldate,ablcalc,ablapi,formula,p,debug,$xabl,$rootScope,types){return function(activity,inputModel,options){var transformCharge,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,defineDateStart,performChooseSlot,actualEvent,isEmpty,transformSlot,slotsByDayWithoutFilters,slotsByDay,skipSlots,select,isFitToSlotFull,isFitToSlot,isNotFitToAnySlot,cutoff,inPast,isTooClose,createMonth,startMonth,_eventDate,_pairs,_dateTransform,_month,setCalendars,scroll,nextMonth,calendar,statusSlot,findChosenEvent,loadEvents,isDummy,isDisabledDay,selectDayAnyway,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,chooseSlotAnyway,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,setMonth,calendarUp,calendarDown,setup,move,eventInstanceId,createEventInstanceId,model,slots,calendars,activeSlots,possibleSlots,x$,ref$,state,observer,dayHasBookableSlot,dayWithSlots;return debug(function(){if(null==activity)return console.warn("Activity is Not Defined for Ablslot ")}),transformCharge=function(t){return{_id:t._id,name:t.name,quantity:0,amount:t.amount}},getDay=function(t){var e;return null!=t?(e=null!=(null!=t?t.format:void 0)?t:moment(t).tz(activity.timeZone),parseInt(e.format("YYYYMMDD"))):null},newDate=function(){return moment.apply(null,arguments)},generateCalendar=function(t,e){var n,r,o,a,u,i,c,l;return n=newDate(t),r=n.year(),o=n.month(),a=function(t){return newDate(moment.tz([r,o,t],activity.timeZone))},u=n.endOf("month").date(),i=p.map(types.cast(function(t){return t.Day}))(p.map(a)(function(){var t,e,n=[];for(t=1,e=u;t<=e;++t)n.push(t);return n}())),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var t,e,n=[];for(t=1,e=c;t<=e;++t)n.push(t);return n}()),{time:n,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(t){return Math.ceil(getDay(t)/100)},hackDate=function(t,e){var n,r;return n=bind$(moment(t),"format"),r=bind$(e,"format"),moment(n("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(t,e){var n,r;return n=null!=t?t:hackDate(t,moment()),r=null!=e?e:hackDate(e,moment()),moment([n.year(),n.month(),n.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var correct,quantities,available,this$=this;return correct=function(t){var e,n;switch(!1){case null!==t:case void 0!==t:return!1;case"Number"!==toString$.call(t).slice(8,-1):return!0;case!("String"===toString$.call(t).slice(8,-1)&&0===t.length):return!1;case!("String"===toString$.call(t).slice(8,-1)&&(null!=(e=t.match("^[0-9]+$"))&&null!=(n=e[0])?n.length:void 0)===t.length):return!0;default:return!1}},quantities=p.filter(correct)(p.map(function(t){return t.quantity})(model.calc.attendees)),available="inactive"===slot.status?0:slot.available-eval([0].concat(quantities).join("+"))}),defineDateStart=function(t,e){var n;return n=merge(t,e.startTime),model.date.start=n},performChooseSlot=function(t){var e,n,r,o,a,u;if(debug("perform-choose-slot",t),null==t)throw"Slot is undefined";if(null==t.available)throw"Slot doesn't have required 'available' field";if(e=model.value,defineDateStart(e,t),n=abldate(activity.timeZone),model.date.origin=n.backendify(model.date.start).replace(/[\:-]/gi,""),model.date.end=t.endTime,model.title=null!=(r=t.title)?r:activity.title,model.charges=t.charges,model.calc=ablcalc(t.charges.concat(activity.charges),null,null,activity.operator._id),null==t._id)throw"Slot doesn't have required field '_id'";if(model._id=t._id,debug("slots",slots),null==(o=p.find(function(e){return e._id===t._id})(slots)))throw"Slot has not been found by id "+t._id+" in ["+activity.timeslots.map(function(t){return t._id}).join(",")+"]";if(null==(null!=o?o.eventId:void 0))throw"Event id field has not been found in timeslot "+JSON.stringify(o);return model.eventId=o.eventId,a=model.attendees,u=function(t){var e;return e=a.filter(function(e){return e.name===t.name}),{quantity:function(){switch(!1){case!(e.length>0):return e[0].quantity;case"Adult"!==t.name:return 1;default:return 0}}(),name:t.name,amount:t.amount}},model.attendees=t.charges.filter(function(t){return"aap"===t.type}).map(u),model.available=makeAvailable(t)},actualEvent=curry$(function(t,e){return getDay(e.startTime)===getDay(t)}),isEmpty=function(t){return function(t){return 0===t.length}(p.filter(isFitToSlot(t))(slots))},transformSlot=function(t){var e;return e=actualEvent(t),function(n){var r,o,a,u,i,c,l;return r=merge(t,n.startTime),o=n.endTime-n.startTime,a=p.find(e)(n.events),u=null,i=null!=a?a.title:void 0,n.events.length>0&&a?(angular.forEach(n.events,function(t,e){moment(t.startTime).format("YYYYMMDDHHmmss")===moment(r).format("YYYYMMDDHHmmss")&&(u=t.maxOcc,i=t.title)}),null===u&&(u=a?a.maxOcc:n.maxOcc)):u=n.maxOcc,c=null!=(l=null!=a?a.available:void 0)?l:u-(a?a.attendees:0),{nativeSlot:n,status:null!=(l=null!=a?a.status:void 0)?l:n.status,startTime:r,time:r.valueOf(),endTime:r.clone().add(o,"milliseconds"),charges:n.charges,price:formula.getVisualPrice({timeslots:[n]}),available:"inactive"===(null!=a?a.status:void 0)?0:c,title:i,_id:n._id,duration:moment.duration(o).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:u-c}}},slotsByDayWithoutFilters=function(t){return p.sortBy(function(t){return t.time})(p.map(types.cast(function(t){return t.Timeslot}))(p.map(transformSlot(t))(p.filter(isFitToSlotFull(!0,t))(slots))))},slotsByDay=function(t){return p.sortBy(function(t){return t.time})(p.map(types.cast(function(t){return t.Timeslot}))(p.map(transformSlot(t))(p.filter(isFitToSlot(t))(slots))))},skipSlots=function(){var t,e,n,r,o,a;return t=null!=(e=null!=(n=$rootScope.user)&&null!=(r=n.preferences)&&null!=(o=r.widget)&&null!=(a=o.display)?a.timeslot:void 0)?e:{},t.availability+t.startTime===0&&activeSlots.length>0},select=function(t){if(model.value=t,activeSlots.length=0,possibleSlots.length=0,slotsByDayWithoutFilters(t).forEach(function(t){return possibleSlots.push(t)}),slotsByDay(t).forEach(function(t){if("active"===t.status)return activeSlots.push(t)}),skipSlots())return chooseSlot(activeSlots[0])},isFitToSlotFull=curry$(function(t,e,n){var r,o,a,u,i,c;return r=0===n.daysRunning.length,activity,o=function(){switch(!1){case!r:return getDay(n.startTime)!==getDay(e);case!(getDay(n.untilTime)<getDay(e)):case!(getDay(n.startTime)>getDay(e)):return!0;default:return!1}}(),a=merge(e,n.startTime),u=a.diff(newDate(),"minutes")-cutoff,i=function(t){var e;return e=null!=t&&"function"==typeof t.day?t.day():void 0,function(){switch(!1){case null!==e:return null;case 0!==e:return 6;default:return e-1}}()},c=!r&&p.notAny(function(t){return t===i(e)})(n.daysRunning),function(){switch(!1){case!c:case!o:case!(!1===t&&u<=0):return!1;default:return!0}}()}),isFitToSlot=isFitToSlotFull(!1),isNotFitToAnySlot=function(t){switch(!1){case!p.notAny(function(t){return t.available>0})(slotsByDay(t)):case!p.notAny(isFitToSlot(t))(slots):return!0;default:return!1}},cutoff=function(){var t,e,n,r,o,a;switch(!1){case!0!==(null!=(t=$rootScope.user)&&null!=(e=t.preferences)&&null!=(n=e.widget)&&null!=(r=n.display)&&null!=(o=r.event)?o.isSiteWide:void 0):return $rootScope.user.preferences.widget.display.event.cutoff;case!((null!=(a=activity.cutoff)?a:-1)>-1):return activity.cutoff;default:return 2880}}(),inPast=function(t,e){return null!=e&&e.indexOf("include_nearest"),getDay(t)<getDay(newDate())},isTooClose=function(t){return t.isBefore(moment().add(cutoff,"minute"))},createMonth=function(t){return newDate([t.year(),t.month(),15])},-1===location.search.indexOf("event=")?startMonth=createMonth(newDate()):(_eventDate=location.search.substr(location.search.indexOf("event=")).split("="),_pairs=_eventDate[1].split("_"),_dateTransform=abldate(activity.timeZone),_month=moment(_dateTransform.frontendify(moment(_pairs[1],"YYYYMMDDHHmmssZ").toDate())),startMonth=_month),setCalendars=function(t,e,n){return calendars.length=0,calendars.push(t),calendars.push(e),loadEvents(n)},scroll={activeDate:function(){var t,e,n,r,o,a;if(scroll.activeDate=function(){},t=calendars[0],e=function(e){return generateCalendar(t.time.clone().add(e,"month"))},n=function(n){return 0===n?t:e(n)},r=function(t){var e;return e=function(){switch(!1){case"dayHasBookableSlot"!==(null!=options?options.activeDayStrategy:void 0):return dayHasBookableSlot;default:return isDisabledDay}}(),void 0!==p.find(function(t){return!e(t)})(n(t).days)},o=function(t){return function(){var e,n,r=[];for(e=1,n=t;e<=n;++e)r.push(e);return r}().forEach(bind$(calendar,"down"))},(a=p.find(r)([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))>0)return o(a)}},nextMonth=function(t,e){return date.clone().add(e,"months")},calendar={first:startMonth,second:startMonth.clone().add(12,"month"),move:function(t){return calendar.first=calendar.first.clone().add(t,"month"),calendar.second=calendar.second.clone().add(t,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},statusSlot=null,findChosenEvent=function(){var t,e,n,r,o,a,u;if(debug("find-chosen-event"),0!==(null!=(t=state.chosenEvent)?t:"").length&&0!==slots.length)return e=state.chosenEvent.split("_"),n=e[0],r=abldate(activity.timeZone),o=moment(r.frontendify(moment(e[1],"YYYYMMDDHHmmssZ").toDate())),a=p.find(function(t){return t.eventId===n})(slots),null!=a?inPast(o)?(statusSlot="not-found",observer.notify("event-not-found")):isTooClose(o)?(statusSlot="too-close",observer.notify("event-too-close")):isDisabledDay(o)?(u=p.find(function(t){return t._id===a._id})(slotsByDay(o)),null==a?observer.notify("event-not-found"):notAvailableSlot(u)?(statusSlot="sold-out",observer.notify("event-sold-out")):observer.notify("event-not-found")):(selectDay(o),a=p.find(function(t){return t._id===a._id})(activeSlots),debug("slot",a),null!=a?(debug("choose-slot",a),notAvailableSlot(a)?(debug("not-available",a),observer.notify("event-sold-out")):(debug("available",a),chooseSlot(a))):(debug("event-not-found"),observer.notify("event-not-found"))):observer.notify("event-not-found")},loadEvents=function(t){return slots.length=0,ablapi.timeslots({startTime:calendars[0].time,endTime:calendars[1].time,activityId:activity._id}).success(function(e){var n,r,o;return n=abldate(activity.timeZone),r=compose$(n.frontendify,moment),o=function(t){return t.startTime=r(t.startTime),t.endTime=r(t.endTime),t.untilTime=r(t.untilTime),t},slots.length=0,0===e.length?(debug("event-not-found"),observer.notify("event-not-found")):e.list.map(o).forEach(function(t){return debug("add-slot"),slots.push(t)}),"sold-out"!==statusSlot&&findChosenEvent(),scroll.activeDate(),observer.notify("load-slot-list-complete"),"function"==typeof t?t():void 0}).error(function(){return observer.notify("event-not-found")})},isDummy=function(t){switch(!1){case null!==t:return!0;default:return!1}},isDisabledDay=function(t,e){switch(!1){case!isDummy(t):case!isEmpty(t):case!inPast(t,e):case!isNotFitToAnySlot(t):return!0;default:return!1}},selectDayAnyway=function(t){return select(t),defineDateStart(t,slots[0])},selectDay=function(t){if(!isDisabledDay(t))return selectDayAnyway(t)},notSelected=function(){switch(!1){case null!==model.date.start:case!1!==model.chosen:return!0;default:return!1}},disabledSlot=function(t){switch(!1){case null!=t:return"Event Not Found";case 0!==t.available:return"This event is full";default:return""}},notAvailableSlot=function(t){return null==t||t.available<=0},close=function(t){var e;return e=function(t){if(0===t.quantity&&"Adult"===t.name)return t.quantity=1},model.attendees.forEach(e),model.chosen=t,model.visible=!1,"function"==typeof model.closed?model.closed(t):void 0},chooseSlot=function(t){if(!notAvailableSlot(t))return performChooseSlot(t),close(!0)},chooseSlotAnyway=function(t){return performChooseSlot(t),close(!0)},isActiveDay=function(t){return getDay(t)===getDay(model.value)},isDisabledMonth=function(t){switch(!1){case!(getDay(t)<getDay(newDate())):return!0;default:return!1}},isActiveMonth=function(t){return getMonth(t)===getMonth(model.value)},isCalendarUpDisabled=function(){return getMonth(calendars[0].time)<getMonth(newDate())},setMonth=function(t,e){var n,r,o;if(n=null!=e?e:99,!((n-=1)<0))return r=getMonth(calendars[0].time),o=getMonth(t),debug("set-month",r,o),r>o?(calendar.up(),setMonth(t,n)):r<o?(calendar.down(),setMonth(t,n)):void 0},calendarUp=function(){if(!isCalendarUpDisabled())return calendar.up()},calendarDown=function(){return calendar.down()},setup=function(){return setCalendars(generateCalendar(startMonth.clone()),generateCalendar(startMonth.clone().add(12,"month")),function(){return selectDay(model.value)})},move=function(t){return $xabl.put("bookings/"+t+"/move",{eventInstanceId:createEventInstanceId()})},eventInstanceId=function(t){var e;return e=abldate(activity.timeZone),t.eventId+"_"+e.backendify(t.date.start).replace(/[\:-]/gi,"")},createEventInstanceId=function(){return eventInstanceId(model)},model=null!=inputModel?inputModel:{},slots=[],calendars=[],activeSlots=[],possibleSlots=[],x$=model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$._id=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(t){return"addon"===t.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,setup(),state={chosenEvent:null},observer={list:[],observe:function(t){return observer.list.push(t)},notify:function(t,e){return p.each(function(n){return n(t,e)})(observer.list)}},dayHasBookableSlot=function(t){return slotsByDayWithoutFilters(t).length>0},dayWithSlots=function(t){return slotsByDayWithoutFilters(t)},{observe:observer.observe,chooseEvent:function(t){return state.chosenEvent=t,findChosenEvent()},isChosenEvent:function(){var t;return(null!=(t=state.chosenEvent)?t:"").length>0},setMonth:setMonth,model:model,activeSlots:activeSlots,possibleSlots:possibleSlots,move:move,selectDay:selectDay,selectDayAnyway:selectDayAnyway,calendars:calendars,createEventInstanceId:createEventInstanceId,calendarUp:calendarUp,calendarDown:calendarDown,close:close,isActiveMonth:isActiveMonth,isDisabledDay:isDisabledDay,dayHasBookableSlot:dayHasBookableSlot,dayWithSlots:dayWithSlots,isDisabledMonth:isDisabledMonth,isCalendarUpDisabled:isCalendarUpDisabled,isDummy:isDummy,isActiveDay:isActiveDay,notSelected:notSelected,chooseSlot:chooseSlot,chooseSlotAnyway:chooseSlotAnyway,notAvailableSlot:notAvailableSlot,disabledSlot:disabledSlot,skipSlots:skipSlots}}}]),angular.module("ablsdk").factory("stripe",["$rootScope","safeApply",function(t,e){var n,r;if(n={},r=function(){var t;return n.setPublishableKey=Stripe.setPublishableKey,t=Stripe.card,n.createToken=function(n,r){var o,a,u,i;return t.validateCardNumber(n.number)?t.validateExpiry(n.exp_month,n.exp_year)?t.validateCVC(n.cvc)?t.createToken({number:n.number,cvc:n.cvc,exp_month:n.exp_month,exp_year:n.exp_year,name:n.fullName,address_line1:null!=(o=n.location)?o.street_address:void 0,address_city:null!=(a=n.location)?a.city:void 0,address_country:null!=(u=n.location)?u.country:void 0,address_state:null!=(i=n.location)?i.state:void 0},function(t,n){return e(null!=n.id?function(){return r(null,n.id)}:function(){return r(n.error.message)})}):r("CVV is not correct. Your CVV number can be located by looking on your credit or debit card"):r("Expiration Month/Year is not correct"):r("Card number is not correct")}},void 0===window.Stripe)throw'please add <script src="https://js.stripe.com/v2/"><\/script>';return r(),n}]),angular.module("ablsdk").service("test",["debug",function(t){return function(e){return t(function(){if(!0!==e())throw"[FAILED TEST]"+e.toString()})}}]),angular.module("ablsdk").service("through",["p","$timeout",function(t,e){return function(e){var n;return n={result:null,hasResult:!1,observers:[]},e(function(e){return n.result=e,n.hasResult=!0,t.each(function(t){return t(e)})(n.observers)}),{then:function(t){return!0===n.hasResult&&t(n.result),n.observers.push(t)}}}}]);var toString$={}.toString;angular.module("ablsdk").service("typecheck",["debug","p",function(t,e){var n,r,o,a;return n=function(){function t(t){var e;if(null==(e=t[0]))throw new Error("Unexpected end of input.");return e}function e(e){var n;if(n=t(e),!f.test(n))throw new Error("Expected text, got '"+n+"' instead.");return e.shift()}function n(e,n){var r;if((r=t(e))!==n)throw new Error("Expected '"+n+"', got '"+r+"' instead.");return e.shift()}function r(t,e){var n;return n=t[0],n===e?t.shift():null}function o(e){var r;if(n(e,"["),"]"===t(e))throw new Error("Must specify type of Array - eg. [Type], got [] instead.");return r=s(e),n(e,"]"),{structure:"array",of:r}}function a(e){var o;if(o=[],n(e,"("),")"===t(e))throw new Error("Tuple must be of at least length 1 - eg. (Type), got () instead.");for(;o.push(s(e)),r(e,","),")"!==t(e););return n(e,")"),{structure:"tuple",of:o}}function u(e){var o,a,u,c,l;for(o={},n(e,"{"),a=!1;;){if(r(e,"...")){a=!0;break}if(u=i(e),c=u[0],l=u[1],o[c]=l,r(e,","),"}"===t(e))break}return n(e,"}"),{structure:"fields",of:o,subset:a}}function i(t){var r,o;return r=e(t),n(t,":"),o=s(t),[r,o]}function c(t){switch(t[0]){case"[":return o(t);case"(":return a(t);case"{":return u(t)}}function l(r){var o,a,u,i;if(o=t(r),(a="*"===o)||f.test(o))return u=a?n(r,"*"):e(r),i=c(r),i?(i.type=u,i):{type:u};if(!(i=c(r)))throw new Error("Unexpected character: "+o);return i}function s(e){var n,o,a,u,i;if("::"===t(e))throw new Error("No comment before comment separator '::' found.");for(n=e[1],null!=n&&"::"===n&&(e.shift(),e.shift()),o=[],a={},"Maybe"===t(e)&&(e.shift(),o=[{type:"Undefined"},{type:"Null"}],a={Undefined:!0,Null:!0});u=l(e),i=u.type,a[i]||o.push(u),a[i]=!0,r(e,"|"););return o}var f,d;return f=/[\$\w]+/,d=RegExp("\\.\\.\\.|::|->|"+f.source+"|\\S","g"),function(t){var e,n;if(!t.length)throw new Error("No type specified.");if(e=t.match(d)||[],in$("->",e))throw new Error("Function types are not supported. To validate that something is a function, you may use 'Function'.");try{return s(e)}catch(r){throw n=r,new Error(n.message+" - Remaining tokens: "+JSON.stringify(e)+" - Initial input: '"+t+"'")}}},r=function(){function t(t,e){return c(function(t){return u(t,e.of)},t)}function n(t,e){var n,r,o,a,i;for(n=0,r=0,a=(o=e.of).length;r<a;++r){if(i=o[r],!u(t[n],i))return!1;n++}return t.length<=n}function r(t,e){var n,r,o,a,i,c,l;n={},r=0;for(o in t)n[o]=!0,r++;a=0;for(i in c=e.of){if(l=c[i],!u(t[i],l))return!1;n[i]&&a++}return e.subset||r===a}function o(e,o){if(!(e instanceof Object))return!1;switch(o.structure){case"fields":return r(e,o);case"array":return t(e,o);case"tuple":return n(e,o)}}function a(t,e){var n,r,a,u;if(n=e.type,r=e.structure,n)return"*"===n||(a=d[n]||s[n],a?a.typeOf===toString$.call(t).slice(8,-1)&&a.validate(t):n===toString$.call(t).slice(8,-1)&&(!r||o(t,e)));if(r)return(!(u=f[r])||u===toString$.call(t).slice(8,-1))&&o(t,e);throw new Error("No type defined. Input: "+t+".")}function u(t,e){if("Array"!==toString$.call(e).slice(8,-1))throw new Error("Types must be in an array. Input: "+t+".");return i(function(e){return a(t,e)},e)}var i,c,l,s,f,d;return i=e.any,c=e.all,l=e.isItNaN,s={Number:{typeOf:"Number",validate:function(t){return!l(t)}},NaN:{typeOf:"Number",validate:l},Int:{typeOf:"Number",validate:function(t){return!l(t)&&t%1==0}},Float:{typeOf:"Number",validate:function(t){return!l(t)}},Date:{typeOf:"Date",validate:function(t){return!l(t.getTime())}}},f={array:"Array",tuple:"Array"},function(t,e,n){return null==n&&(n={}),d=n.customTypes||{},u(e,t)}},o=n(),a=r(),function(e,n,r){return t(function(){if(!a(o(e),n,r))return console.error("Type doesn't match with object",e,n)})}}]),angular.module("ablsdk").service("types",["p",function(t){var e;return e={Day:function(){function t(){}t.displayName="Day";t.prototype;return t}(),Activity:function(){function t(){}t.displayName="Activity";t.prototype;return t}(),Timeslot:function(){function t(){}t.displayName="Timeslot";t.prototype;return t}(),is:function(t,n){var r;return r=t(e),n instanceof r},cast:curry$(function(n,r){var o,a,u;return o=n(e),a=new o,u=function(t){return a[t[0]]=t[1]},t.each(u)(t.objToPairs(r)),a})}}]),angular.module("ablsdk").service("watcher",["$rootScope","browser","debug",function(t,e,n){var r;return r=function(){return{unwatch:function(t,e){return"function"==typeof e.unwatch?e.unwatch():void 0},watch:function(e,n){var r;return r=t.$new(),r.array=e,n.unwatch=r.$watch("array",n,!0)}}},function(){return{unwatch:function(t,e){return Array.unobserve(t,e)},watch:function(e,n){var r,o;return r=function(){var e;return e=t.$new(),function(t,n){return e.array=t,e.$watch("array",n)}},(null!=(o=Array.observe)?o:r())(e,n)}}},function(){switch(!1){case"firefox"!==e.name:case"unknown"!==e.name:case"safari"!==e.name:default:return r()}}()}]),angular.module("ablsdk").service("onlineBookingColors",function(){return[["Blue","blue","#2196F3"],["Teal","teal","#009688"],["Green","green","#4CAF50"],["Grey","grey","#9E9E9E"],["Blue grey","blue_grey","#607D8B"],["Yellow","yellow","#FFEB3B"],["Indigo","indigo","#3F51B5"],["Red","red","#F44336"],["Black","black","#000000"]]});
//# sourceMappingURL=./dst/main.min.js.map