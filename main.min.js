// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
function curry$(n,t){var e,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return e=t?e||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(e,o):n.apply(e,o)}:n}
return r()}function curry$(n,t){var e,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return e=t?e||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(e,o):n.apply(e,o)}:n}
return r()}function bind$(n,t,e){return function(){return(e||n)[t].apply(n,arguments)}}function bind$(n,t,e){return function(){return(e||n)[t].apply(n,arguments)}}function curry$(n,t){var e,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return e=t?e||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(e,o):n.apply(e,o)}:n}
return r()}function curry$(n,t){var e,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return e=t?e||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(e,o):n.apply(e,o)}:n}
return r()}function curry$(n,t){var e,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return e=t?e||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(e,o):n.apply(e,o)}:n}
return r()}function bind$(n,t,e){return function(){return(e||n)[t].apply(n,arguments)}}function bind$(n,t,e){return function(){return(e||n)[t].apply(n,arguments)}}function curry$(n,t){var e,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return e=t?e||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(e,o):n.apply(e,o)}:n}
return r()}angular.module("ablsdk",[]),angular.module("ablsdk").service("ablapi",function(n){return{timeslots:function(t){var e
return e=$.param({activity:t.activityId,"status[event]":"all",dateRange:[moment(t.startTime).clone().startOf("day").startOf("month").toISOString(),moment(t.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),n.get("timeslots?"+e)}}}),angular.module("ablsdk").service("ablbook",function(n,t,r,u,o){return function(a,i){var c,l,s,f,d,p,m,h,g,v,y,b,w,$,k,A,x,C,O,S,j,T,I,q,D,P,Y,_
return c={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idenpotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:""}},calendar:{value:null,visible:!1,currentActivity:a,closed:function(n){return c.form.date.start=c.calendar.date.start,c.form.date.end=c.calendar.date.end,i("slot-chosen",n)}}},l=function(n){var t
return null!=n?(t=null!=(null!=n?n.format:void 0)?n:moment(n),parseInt(t.format("YYYYMMDD"))):null},s=function(n){var t
return t=function(){switch(!1){case null!==n.start:return"none"
case l(n.start)===l(n.end):return"different"
default:return"same"}}()},f=function(n){return!c.loading&&n.$valid},d=function(n){var t,e
for(t in q)if(q.hasOwnProperty(t)&&(e=P(n,t),(null!=e?e.length:void 0)>0))return e
return"Please check the form"},p=function(n){return c.form.error=n},m=function(){return p("")},h=function(n){return c.triedCheckout=!1,c.typingInput=n},g=function(){var n
return c.idenpotencyKey=(n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n())},g(),v=function(n){var t
return null!=(t=null!=n&&"function"==typeof n.filter?n.filter(function(n){return n.quantity>0}):void 0)?t:[]},y=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
case 0!==n.length:return 0
default:return n.reduce(function(n,t){return n+t})}},b=function(){return 0===y(c.calendar.calc.attendees.map(function(n){return n.quantity}))},w=function(n,t){var e
return e=function(){switch(!1){case 4!==n.length:return n+" "
case 9!==n.length:return n+" "
case 14!==n.length:return n+" "
case 19!==n.length:return n+" "
default:return n}}(),e+t},$=function(){var n,t,e,r
return n=event.target.value,t=null!=(e=null!=n?n.replace("/",""):void 0)?e:"",r=function(n){return null!=n?n:""},c.form.creditCard.expDate=function(){switch(!1){case 2!==t.length:return t[0]+t[1]+"/"
case!(t.length>2):return t[0]+t[1]+"/"+r(t[2])+r(t[3])
default:return t}}()},k=function(){var n
return n=a.timeslots.filter(function(n){return n._id===c.calendar._id})[0].eventId,n+"_"+c.calendar.date.origin},A=function(n){var e
return e=n.target.value,"undefined"!=typeof e?c.form.creditCard.card=function(n){return n.substr(0,19)}(t.fold(w,"")(function(n){return n.split(" ").join("")}(e))):void 0},x=function(o,i){var l,s,f,d
return"undefined"==typeof o?(c.loading=!1,p("Stripe key is not defined")):(r.setPublishableKey(o),l=c.form.creditCard,s=l.expDate.split("/"),f=c.form,d={number:l.card,cvc:l.cvv,exp_month:s[0],exp_year:"20"+s[1],fullName:f.name,location:f.location,state:f.state},r.createToken(d,function(r,o){var l,s,d
return null!=r?(c.loading=!1,p(r)):(l=a,s=function(n){return t.map(function(){return null})(function(){var t,e,r=[]
for(t=1,e=n;e>=t;++t)r.push(t)
return r}())},u(c.calendar.calc.attendees),d={stripeToken:o,couponId:c.calendar.calc.coupon.codes.length>0?c.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:"credit",eventInstanceId:k(),addons:t.pairsToObj(t.map(function(n){return[n._id,s(n.quantity)]})(c.calendar.calc.addons)),attendees:t.pairsToObj(t.map(function(n){return[n._id,s(n.quantity)]})(c.calendar.calc.attendees)),answers:t.pairsToObj(t.map(function(n){return[n._id,n.answer]})(c.calendar.questions)),adjustments:c.calendar.calc.adjustment.list,fullName:f.name,email:f.email,phoneNumber:f.phone,notes:f.notes,location:f.location,currency:"usd",_customHeaders:{"Idempotency-Key":c.idenpotencyKey}},n.post("bookings",d).success(function(n){var t,r
return null!=n.bookingId?(g(),i(n)):p(null!=(t=null!=(r=e.errors)?r[0]:void 0)?t:"Server error")}).error(function(n){var t,e
return p(null!=(t=null!=(e=n.errors)?e[0]:void 0)?t:"Server error")})["finally"](function(){return c.loading=!1}))}))},C=function(){return n.get("payments/setup")},O=function(n){return u("validate"),c.loading!==!0?(c.triedCheckout=!0,f(n)?void 0:p(d(n))):void 0},S=function(n){return c.loading!==!0?(c.triedCheckout=!0,f(n)?(c.loading=!0,C().success(function(n){return x(n.publicKey,function(n){return c.booking=n,i("success",n)})}).error(function(n){return c.loading=!1,p(n),i("error",p)})):p(d(n))):void 0},j=function(){return c.form.agreed=!c.form.agreed,D()},T=function(n){return n.required||n.pattern||n.minlength||n.maxlength||n.phone},I=function(n,t){var e,r,u
switch(!1){case!t.required:return null!=(e=null!=(r=q[n])&&null!=(u=r.message)?u.required:void 0)?e:n+" is required"
case!t.pattern:return"Please follow the example "+q[n].example
case!t.minlength:return n+" is too short"
case!t.maxlength:return n+" is too long"
case!t.phone:return n+" is not valid phone number"
default:return"please check "+n}},q={email:{pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email"},name:{pattern:"",example:"Your name",placeholder:"Name"},phone:{pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234"},address:{pattern:"",example:"Address",placeholder:"Home address"},notes:{pattern:"",example:"Notes",placeholder:"Notes"},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",placeholder:"Credit Card Number"},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",placeholder:"Exp Date (MM/DD)"},startDate:{},cvv:{pattern:/[0-9]{3,4}/i,example:"000",placeholder:"CVV"},agreed:{pattern:"true",message:{required:"Please accept the terms and conditions"}}},D=function(){return c.form.agreed?c.triedCheckout=!0:void 0},P=function(n,t){var e,r,u,o,a,i,l
if(c.triedCheckout===!0){for(e in q)if(q.hasOwnProperty(e)&&(r=null!=(u=n[e])?u.$error:void 0,r&&T(r)))return e===t?I(e,r):""
return""}for(e in q)if(q.hasOwnProperty(e)&&(r=null!=(o=n[e])?o.$error:void 0,r&&T(r)&&r.maxlength))return e===t?I(e,r):""
return c.typingInput===t&&null!=(null!=(a=n[t])&&null!=(i=a.$error)?i.pattern:void 0)&&(null!=(l=q[t].example)?l.length:void 0)>0?"":void 0},Y=function(n){return c.typingInput===n?q[n].example:q[n].placeholder},o(function(){var n,t
return n=c.form,n.email="test@debug.com",n.name="Test User",n.phone="+380665243646",n.address="664 Cypress Lane, Campbell, CA, United States",n.notes="Some test notes",t=c.form.creditCard,t.card="5105 1051 0510 5100",t.expDate="05/17",t.cvv="333",c.form.agreed=!0}),_=c,_.investigateDate=s,_.getEventInstanceId=k,_.placeholder=Y,_.closeError=m,_.checkout=S,_.validate=O,_.agree=j,_.fields=q,_.few=v,_.expDateChanged=$,_.cardChanged=A,_.disabledOrder=b,_.typing=h,_.message=P,c}}),angular.module("ablsdk").service("ablcalc",function(n,t,e,r,u,o){var a
return a=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
default:return e.sum(n)}},function(o,i,c){var l,s,f,d,p,m,h,g,v,y,b,w,$,k,A,x,C,O,S,j,T,I,q,D,P,Y,_,M
return l=null!=i?i:[],s=null!=(f=null!=o?o.filter(function(n){return"active"===n.status}):void 0)?f:[],r({prevousCharges:l,newCharges:s,inputNewCharges:o,inputPrevousCharges:i}),d=function(n){return{name:n.name,quantity:0,amount:n.amount,_id:n._id}},p=function(n,t){return t.amount-n.amount},m=function(n){return{name:n[0].name,amount:n[0].amount,quantity:n.length,_ids:e.map(function(n){return n._id})(n)}},h=function(n){return e.sortWith(p)(e.map(m)(e.map(function(n){return n[1]})(e.objToPairs(e.groupBy(function(n){return n.name+n.amount})(e.filter(function(t){return t.type===n})(l))))))},g=curry$(function(n,t){var r
return r=e.find(function(n){return t.name===n.name&&t.amount===n.amount})(h(n)),null!=r&&(r.old=!0),null==r}),v=function(n){return e.sortWith(p)(e.filter(g(n))(e.map(d)(e.filter(function(t){return t.type===n})(s))))},y=function(n){return e.concat(e.map(function(t){return t(n)})([h,v]))},u(function(){return y("aap").length>0}),u(function(){var n
return n=e.head(y("app")),n?null==n.amount||null==n.quantity||null==n.name?!1:void 0:!0}),b={attendees:y("aap"),addons:y("addon")},w=function(){return e.sum(e.map(function(n){return n.amount})(_.list))},$=function(){return a(b.attendees.map(C))+w()+j()},k=function(n){switch(!1){case"tax"!==n.type:return $()/100*n.amount
case"fee"!==n.type:return a(b.attendees.map(function(n){return n.quantity}))*n.amount
default:return 0}},A=function(){return a(s.map(k))},x=function(n){var t,e,r
return null!=(t=null!=(e=s.filter(function(t){return"aap"===t.type&&t.name===n.name}))&&null!=(r=e[0])?r.amount:void 0)?t:0},C=function(n){return x(n)*n.quantity},O=function(n){return a(b.addons.filter(function(t){return t.name===n.name}).map(function(n){return n.amount}))},S=function(n){return O(n)*n.quantity},j=function(){return a(b.addons.map(S))},T=function(){var n,t,e
return n=$(),t=function(){switch(!1){case!(M.codes[0].amountOff<n):return M.codes[0].amountOff
default:return n}},e=function(){switch(!1){case 0!==M.codes.length:return 0
case null==M.codes[0].amountOff:return t()
case null==M.codes[0].percentOff:return n/100*M.codes[0].percentOff
default:return 0}}()},I=function(n,t){var e,r,u,o
return e="inactive"===n.status,r=n.type,u=n.old,t=function(){switch(!1){case"aap"!==r:return"pricing level"
case"addon"!==r:return"add-on"}}(),o=function(){switch(!1){case!(e&&"removed"===t):return"Warning: This "+t+" no longer exists. You can only reduce the quantity at this "+t+". If you wish to offer another "+t+" at this price, please create on Adjustment to currect the price."
case!(u&&"changed"===t):return"Warning: This "+t+" has changed since the booking was created. You can only reduce the quantity at this "+t+". If you wish to offer the old "+t+", please create an Adjustment."
case!((e||u)&&"mutated"===t):return!0
default:return""}}()},q=function(){return $()+A()-T()},D=function(){return e.sum(e.map(function(n){return n.amount})(l))},P=e.sum(e.map(function(n){return n.amount})(null!=c?c:[])),Y=function(){return-(q()-P)},_={list:e.filter(function(n){return"adjustment"===n.type})(l),description:"",amount:"",isEdit:!1,show:!1,add:function(){var n
return n={description:_.description,amount:_.amount},n.amount*=100,_.list.push(n),_.description="",_.amount="",_.show=!1,_.isEdit=!1},removable:function(n){return null==n._id},remove:function(n){var t
return t=_.list.indexOf(n),_.list.splice(t,1)},edit:function(n){return _.isEdit&&_.add(),_.description=n.description,_.amount=n.amount/100,_.show=!0,_.isEdit=!0,_.remove(n)}},M={codes:[],calc:T,show:!1,edit:function(n){return M.code=n.code,M.remove(n),M.show=!0},remove:function(n){var t
return t=M.codes.indexOf(n),t>-1?M.codes.splice(t,1):void 0},add:function(e){var r,u
if(0!==(null!=(r=M.code)?r:"").length&&(M.code=M.code.toUpperCase(),M.error=function(){switch(!1){case 0!==M.code.length:return"Code is required"
case!(M.code.length<6):return"6 chars are required"
default:return""}}(),!(M.error.length>0)))return u=function(n){var r
return r=function(){return M.codes.push(n),M.code="",M.success="Coupon "+n.couponId+" added successfully",M.show=!1,t(function(){var n
return n=M.success,delete M.success,n},3e3),""},M.error=function(){switch(!1){case!(0!==n.maxRedemptions&&n.maxRedemptions<=n.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(n.redeemBy),"minutes")>0):return"This coupon is expired"
case!(n.activities.length>0&&n.activities[0]!==e):return"This coupon is not valid for this activity."
default:return r()}}()},n.get("coupon/"+M.code).success(function(n){return u(n)}).error(function(n){var t,e
return M.error=null!=(t=null!=n&&null!=(e=n.errors)?e[0]:void 0)?t:"Coupon not found"})},code:""},{warning:I,coupon:M,adjustment:_,addons:b.addons,attendees:b.attendees,showAttendees:function(){return e.join(", ")(e.map(function(n){return n.quantity+" "+n.name})(b.attendees))},showAddons:function(){return e.join(", ")(e.map(function(n){return n.quantity+" "+n.name})(b.addons))},totalWithoutTaxesfees:$,calcCoupon:T,calcTaxFee:k,calcTaxesFees:A,showPrice:x,calcPrice:C,showAddonPrice:O,calcAddonPrice:S,totalAddons:j,calcSubtotal:$,calcTotal:q,calcPreviousTotal:D,calcBalanceDue:Y}}}),angular.module("ablsdk").service("browser",function(n){var t
return t=function(){var t,e,r
t=n.navigator.userAgent,e={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in e)if(e[r].test(n.navigator.userAgent))return r
return"unknown"},{name:t()}}),angular.module("ablsdk").filter("capitalize",function(){return function(n){return angular.isString(n)&&n.length>0?n.charAt(0).toUpperCase()+n.substr(1).toLowerCase():n}}).filter("capitalizeAll",function(){return function(n){return angular.isString(n)&&n.length>0?n.split(" ").map(function(n){return n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()}).join(" "):n}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(n,t,e,r,u,o,a){return function(i,c){var l,s,f,d,p,m,h,g,v,y,b,w,$,k,A,x,C,O
return l=i.split("@"),i=l[0],s={loading:!1,frontendify:function(n,t){var e,r,u
return e=t.split("/"),r=e[e.length-1],u=function(){switch(!1){case"Array"!==toString$.call(n).slice(8,-1):return n
case"Array"!==toString$.call(n.list).slice(8,-1):return n.list
case"Array"!==toString$.call(n[r]).slice(8,-1):return n[r]
case"Object"!==toString$.call(n).slice(8,-1):return[n]
default:return[]}}()}},f={localStorage:{remove:function(n){},add:function(n){},update:function(n){},fetch:function(n){}},memory:{remove:function(n){return v(n)},add:function(n,t){return Array.prototype.push.call(g,n),"function"==typeof t?t(n):void 0},update:function(n,t){return"function"==typeof t?t(n):void 0},fetch:function(){return s.loading=!1}},backend:{remove:function(t){return n["delete"](i+"/"+t._id).success(function(){return v(t)})},update:function(t,e){return n.update(i+"/"+t._id,t).success(function(n){return s.loading=!1,"function"==typeof e?e(n):void 0})},add:function(t,r){return n.create(i,t).success(function(n){return e("backend-success",n),$(n),"function"==typeof r?r(n):void 0})},fetch:function(){var t
return t=angular.copy(g.options),delete t.$url,n.get(m(i),{params:t}).success(function(n,t,e){var r,u
return g.length=0,r=function(n){var t,r,u
if(t=e()[n],null!=t){r=document.createElement("a"),r.href=e()[n]
try{return JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(o){return u=o,void console.error(u,r.search)}}},g.options.total=(u=r("x-last-page-url"),null!=u?parseInt(u.page)*parseInt(u.pageSize):n.length),g.options.pageSize=(u=r("x-first-page-url"),null!=u?parseInt(u.pageSize):n.length),s.loading=!1,$(n)})}}},d=f[null!=(p=l[1])?p:"backend"],m=function(n){var t,e,r
return t={url:n},e=function(n){return t.url=t.url.replace(":"+n[0],n[1])},r=g.getOptions().$url,null!=r&&a.each(e)(a.objToPairs(r)),t.url},h=t.$new(),h.items=[],g=h.items,s.loading=!1,v=function(n){var t
return t=g.indexOf(n),t>-1?Array.prototype.splice.call(g,t,1):void 0},y=function(n,t){return null!=n._id?b(n,t):w(n,t)},b=function(n,t){return s.loading?void 0:d.update(n,t)},w=function(n,t){return s.loading?void 0:d.add(n,t)},$=function(n){var t,e,r
switch(t=s.frontendify(n,i),e=toString$.call(t).slice(8,-1)){case"Array":Array.prototype.push.apply(g,t)
break
case"Object":r=function(n){return g[n[0]]=n[1]},a.each(r)(a.objToPairs(t))}return s.loading=!1},g.options={},g.converter=function(n){return s.frontendify=n.frontendify,s.backendify=n.backendify,g},g.getOptions=function(){return g.options},k=function(n){if(!s.loading){switch(toString$.call(n).slice(8,-1)){case"Function":return g.getOptions=n,k({})
case"Number":g.options.page=n
break
case"Object":g.options=angular.extend({},g.getOptions(),n)}return s.loading=!0,null!=g.options.page&&(1===g.options.page?delete g.options.page:g.options.page-=1),d.fetch()}},k(c),A=function(){var n
if(!s.loading)return n=Array.prototype.splice.apply(g,arguments),n.forEach(d.remove)},x=function(n,t,e){var u,o
if(!s.loading)return u={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},o=r.confirm({controller:"confirm2",templateUrl:"confirm",locals:{options:angular.extend({},u,e)},targetEvent:t}),r.show(o).then(function(t){return t===!0?d.remove(n):void 0})},C=[],O=function(n){var t,e
return t=[],e=curry$(function(e,r){var u,o
return u=[],O(u),o=function(){var t
return t=Array.prototype[e].call(n,r),u.length=0,Array.prototype.push.apply(u,t)},t.push(o),o(),u}),n.loading=function(){return s.loading},n.toArray=function(){var t
return t=[],Array.prototype.push.apply(t,n),t},n.fetchOn=function(t,e){return e.$watch(t,bind$(g,"fetch"),!0),n},n.watch=function(e,r){var a
return a=function(){return u(function(){return t.forEach(function(n){return n()})})},null!=r?(C.push({array:r[e],func:a}),r.$watch(e,a,!0)):(C.push({array:e,func:a}),o.watch(e,a)),n},n.watch(n),["map","filter"].forEach(function(t){return n[t]=e(t)}),n.push=w,n.save=y,n.fetch=k,n.remove=x,n.splice=A,n.toArray=function(){return angular.copy(n)}},g.listen=function(n){return n.$on("$destroy",function(){var n,t,e,r,u=[]
for(n=0,e=(t=C).length;e>n;++n)r=t[n],u.push(o.unwatch(r.array,r.func))
return u}),g},O(g),g}}),angular.module("ablsdk").service("abldate",function(n){return function(n){var t,e
return t=function(n,t){var e,r
return e=bind$(moment(n),"format"),r=bind$(t,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},e=function(t,e){return t.add(moment(e).tz(n).utcOffset()-t.utcOffset(),"minute")},{backendify:function(r){var u
return u=t(r,moment().tz(n)).tz(n),e(u),u.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(r){var u
return u=moment(r).tz(n),e(u,u),t(u,moment(r)).toDate()}}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(n){return function(t){var e
if(n)switch(toString$.call(t).slice(8,-1)){case"Function":return t()
default:return"undefined"!=typeof console&&null!==console&&null!=(e=console.log)?e.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("ablfacade",function(n,t){return function(e,r){var u,o
return u=n(e,r),o=t(e,u.calendar),{book:u,slot:o}}}),angular.module("ablsdk").service("formula",function(n,t){var e,r
return e=function(t,e){var r,u
return r=null!=(u=null!=e?e.charges:void 0)?u:[],function(n){var t
return null!=(t=null!=n?n.amount:void 0)?t:0}(n.find(function(n){return n.type===t||n.subtype===t||n.description===t})(r))},r=function(t){var e,r,u,o,a,i,c,l
return(null!=t&&null!=(e=t.timeslots)?e.length:void 0)>0?(r=function(n){return[].concat.apply([],n)},u=function(t){var e,r
return e="Adult",n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(n.filter(function(n){return n.type===e||n.subtype===e||n.description===e})(null!=(r=null!=t?t.charges:void 0)?r:[])))},o=function(t){var e
return n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(null!=(e=null!=t?t.charges:void 0)?e:[]))},a=r(t.timeslots.map(u)),i=r(t.timeslots.map(o)),c=function(n){return Math.max.apply(Math,n)},l=function(){switch(!1){case!(a.length>0):return c(a)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(n){return e("Adult",n)},getVisualPrice:r,getAdultPrice:function(n){var t
return e("Adult",null!=n&&null!=(t=n.timeslots)?t[0]:void 0)},getYouthPrice:function(n){var t
return e("Youth",null!=n&&null!=(t=n.timeslots)?t[0]:void 0)}}}),angular.module("ablsdk").filter("mdate",function(n){return function(n,t){return null!=n?n.format(t):null}})
var toString$={}.toString
angular.module("ablsdk").service("p",function(){var n,t
return n=function(t){var e
return[].concat.apply([],function(){var r,u,o,a=[]
for(r=0,o=(u=t).length;o>r;++r)e=u[r],"Array"===toString$.call(e).slice(8,-1)?a.push(n(e)):a.push(e)
return a}())},{head:t=function(n){return n[0]},each:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)u=t[e],n(u)
return t}),isItNaN:function(n){return n!==n},all:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)if(u=t[e],!n(u))return!1
return!0}),map:curry$(function(n,t){return t.map(n)}),fold:curry$(function(n,t,e){var r,u,o
for(r=0,u=e.length;u>r;++r)o=e[r],t=n(t,o)
return t}),filter:curry$(function(n,t){var e,r,u,o=[]
for(e=0,r=t.length;r>e;++e)u=t[e],n(u)&&o.push(u)
return o}),find:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)if(u=t[e],n(u))return u}),pairsToObj:function(n){var t,e,r,u={}
for(t=0,e=n.length;e>t;++t)r=n[t],u[r[0]]=r[1]
return u},objToPairs:function(n){var t,e,r=[]
for(t in n)e=n[t],r.push([t,e])
return r},values:function(n){var t,e,r=[]
for(t in n)e=n[t],r.push(e)
return r},any:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)if(u=t[e],n(u))return!0
return!1}),notAny:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)if(u=t[e],n(u))return!1
return!0}),sum:function(n){var t,e,r,u
for(t=0,e=0,r=n.length;r>e;++e)u=n[e],t+=u
return t},sort:function(n){return n.concat().sort(function(n,t){return n>t?1:t>n?-1:0})},concat:function(n){return[].concat.apply([],n)},concatMap:curry$(function(n,t){var e
return[].concat.apply([],function(){var r,u,o,a=[]
for(r=0,o=(u=t).length;o>r;++r)e=u[r],a.push(n(e))
return a}())}),flatten:n,groupBy:curry$(function(n,t){var e,r,u,o,a
for(e={},r=0,u=t.length;u>r;++r)o=t[r],a=n(o),a in e?e[a].push(o):e[a]=[o]
return e}),sortWith:curry$(function(n,t){return t.concat().sort(n)}),sortBy:curry$(function(n,t){return t.concat().sort(function(t,e){return n(t)>n(e)?1:n(t)<n(e)?-1:0})}),reverse:function(n){return n.concat().reverse()},split:curry$(function(n,t){return t.split(n)}),join:curry$(function(n,t){return t.join(n)}),lines:function(n){return n.length?n.split("\n"):[]},unlines:function(n){return n.join("\n")},words:function(n){return n.length?n.split(/[ ]+/):[]},unwords:function(n){return n.join(" ")},chars:function(n){return n.split("")},unchars:function(n){return n.join("")},repeat:curry$(function(n,t){var e,r
for(e="",r=0;n>r;++r)e+=t
return e}),capitalize:function(n){return n.charAt(0).toUpperCase()+n.slice(1)},camelize:function(n){return n.replace(/[-_]+(.)?/g,function(n,t){return(null!=t?t:"").toUpperCase()})},dasherize:function(n){return n.replace(/([^-A-Z])([A-Z]+)/g,function(n,t,e){return t+"-"+(e.length>1?e:e.toLowerCase())}).replace(/^([A-Z]+)/,function(n,t){return t.length>1?t+"-":t.toLowerCase()})}}}),angular.module("ablsdk").factory("prefill",function(n,t,e){return function(r){return n(function(){return e.prefill=function(){var n
return n=arguments,t(function(){return r.apply(null,n)})},null!=e.parent?e.parent.prefill=e.prefill:void 0})}}),angular.module("ablsdk").filter("price",function(n){return function(t){return n("currency")(t/100)}}),angular.module("ablsdk").service("safeApply",function(n){return function(t){var e
return e=n.$$phase,"$apply"===e||"$digest"===e?t():n.$apply(t)}}),angular.module("ablsdk",[]),angular.module("ablsdk").service("ablapi",function(n){return{timeslots:function(t){var e
return e=$.param({activity:t.activityId,"status[event]":"all",dateRange:[moment(t.startTime).clone().startOf("day").startOf("month").toISOString(),moment(t.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),n.get("timeslots?"+e)}}}),angular.module("ablsdk").service("ablbook",function(n,t,r,u,o){return function(a,i){var c,l,s,f,d,p,m,h,g,v,y,b,w,$,k,A,x,C,O,S,j,T,I,q,D,P,Y,_
return c={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idenpotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:""}},calendar:{value:null,visible:!1,currentActivity:a,closed:function(n){return c.form.date.start=c.calendar.date.start,c.form.date.end=c.calendar.date.end,i("slot-chosen",n)}}},l=function(n){var t
return null!=n?(t=null!=(null!=n?n.format:void 0)?n:moment(n),parseInt(t.format("YYYYMMDD"))):null},s=function(n){var t
return t=function(){switch(!1){case null!==n.start:return"none"
case l(n.start)===l(n.end):return"different"
default:return"same"}}()},f=function(n){return!c.loading&&n.$valid},d=function(n){var t,e
for(t in q)if(q.hasOwnProperty(t)&&(e=P(n,t),(null!=e?e.length:void 0)>0))return e
return"Please check the form"},p=function(n){return c.form.error=n},m=function(){return p("")},h=function(n){return c.triedCheckout=!1,c.typingInput=n},g=function(){var n
return c.idenpotencyKey=(n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n())},g(),v=function(n){var t
return null!=(t=null!=n&&"function"==typeof n.filter?n.filter(function(n){return n.quantity>0}):void 0)?t:[]},y=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
case 0!==n.length:return 0
default:return n.reduce(function(n,t){return n+t})}},b=function(){return 0===y(c.calendar.calc.attendees.map(function(n){return n.quantity}))},w=function(n,t){var e
return e=function(){switch(!1){case 4!==n.length:return n+" "
case 9!==n.length:return n+" "
case 14!==n.length:return n+" "
case 19!==n.length:return n+" "
default:return n}}(),e+t},$=function(){var n,t,e,r
return n=event.target.value,t=null!=(e=null!=n?n.replace("/",""):void 0)?e:"",r=function(n){return null!=n?n:""},c.form.creditCard.expDate=function(){switch(!1){case 2!==t.length:return t[0]+t[1]+"/"
case!(t.length>2):return t[0]+t[1]+"/"+r(t[2])+r(t[3])
default:return t}}()},k=function(){var n
return n=a.timeslots.filter(function(n){return n._id===c.calendar._id})[0].eventId,n+"_"+c.calendar.date.origin},A=function(n){var e
return e=n.target.value,"undefined"!=typeof e?c.form.creditCard.card=function(n){return n.substr(0,19)}(t.fold(w,"")(function(n){return n.split(" ").join("")}(e))):void 0},x=function(o,i){var l,s,f,d
return"undefined"==typeof o?(c.loading=!1,p("Stripe key is not defined")):(r.setPublishableKey(o),l=c.form.creditCard,s=l.expDate.split("/"),f=c.form,d={number:l.card,cvc:l.cvv,exp_month:s[0],exp_year:"20"+s[1],fullName:f.name,location:f.location,state:f.state},r.createToken(d,function(r,o){var l,s,d
return null!=r?(c.loading=!1,p(r)):(l=a,s=function(n){return t.map(function(){return null})(function(){var t,e,r=[]
for(t=1,e=n;e>=t;++t)r.push(t)
return r}())},u(c.calendar.calc.attendees),d={stripeToken:o,couponId:c.calendar.calc.coupon.codes.length>0?c.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:"credit",eventInstanceId:k(),addons:t.pairsToObj(t.map(function(n){return[n._id,s(n.quantity)]})(c.calendar.calc.addons)),attendees:t.pairsToObj(t.map(function(n){return[n._id,s(n.quantity)]})(c.calendar.calc.attendees)),answers:t.pairsToObj(t.map(function(n){return[n._id,n.answer]})(c.calendar.questions)),adjustments:c.calendar.calc.adjustment.list,fullName:f.name,email:f.email,phoneNumber:f.phone,notes:f.notes,location:f.location,currency:"usd",_customHeaders:{"Idempotency-Key":c.idenpotencyKey}},n.post("bookings",d).success(function(n){var t,r
return null!=n.bookingId?(g(),i(n)):p(null!=(t=null!=(r=e.errors)?r[0]:void 0)?t:"Server error")}).error(function(n){var t,e
return p(null!=(t=null!=(e=n.errors)?e[0]:void 0)?t:"Server error")})["finally"](function(){return c.loading=!1}))}))},C=function(){return n.get("payments/setup")},O=function(n){return u("validate"),c.loading!==!0?(c.triedCheckout=!0,f(n)?void 0:p(d(n))):void 0},S=function(n){return c.loading!==!0?(c.triedCheckout=!0,f(n)?(c.loading=!0,C().success(function(n){return x(n.publicKey,function(n){return c.booking=n,i("success",n)})}).error(function(n){return c.loading=!1,p(n),i("error",p)})):p(d(n))):void 0},j=function(){return c.form.agreed=!c.form.agreed,D()},T=function(n){return n.required||n.pattern||n.minlength||n.maxlength||n.phone},I=function(n,t){var e,r,u
switch(!1){case!t.required:return null!=(e=null!=(r=q[n])&&null!=(u=r.message)?u.required:void 0)?e:n+" is required"
case!t.pattern:return"Please follow the example "+q[n].example
case!t.minlength:return n+" is too short"
case!t.maxlength:return n+" is too long"
case!t.phone:return n+" is not valid phone number"
default:return"please check "+n}},q={email:{pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email"},name:{pattern:"",example:"Your name",placeholder:"Name"},phone:{pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234"},address:{pattern:"",example:"Address",placeholder:"Home address"},notes:{pattern:"",example:"Notes",placeholder:"Notes"},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",placeholder:"Credit Card Number"},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",placeholder:"Exp Date (MM/DD)"},startDate:{},cvv:{pattern:/[0-9]{3,4}/i,example:"000",placeholder:"CVV"},agreed:{pattern:"true",message:{required:"Please accept the terms and conditions"}}},D=function(){return c.form.agreed?c.triedCheckout=!0:void 0},P=function(n,t){var e,r,u,o,a,i,l
if(c.triedCheckout===!0){for(e in q)if(q.hasOwnProperty(e)&&(r=null!=(u=n[e])?u.$error:void 0,r&&T(r)))return e===t?I(e,r):""
return""}for(e in q)if(q.hasOwnProperty(e)&&(r=null!=(o=n[e])?o.$error:void 0,r&&T(r)&&r.maxlength))return e===t?I(e,r):""
return c.typingInput===t&&null!=(null!=(a=n[t])&&null!=(i=a.$error)?i.pattern:void 0)&&(null!=(l=q[t].example)?l.length:void 0)>0?"":void 0},Y=function(n){return c.typingInput===n?q[n].example:q[n].placeholder},o(function(){var n,t
return n=c.form,n.email="test@debug.com",n.name="Test User",n.phone="+380665243646",n.address="664 Cypress Lane, Campbell, CA, United States",n.notes="Some test notes",t=c.form.creditCard,t.card="5105 1051 0510 5100",t.expDate="05/17",t.cvv="333",c.form.agreed=!0}),_=c,_.investigateDate=s,_.getEventInstanceId=k,_.placeholder=Y,_.closeError=m,_.checkout=S,_.validate=O,_.agree=j,_.fields=q,_.few=v,_.expDateChanged=$,_.cardChanged=A,_.disabledOrder=b,_.typing=h,_.message=P,c}}),angular.module("ablsdk").service("ablcalc",function(n,t,e,r,u,o){var a
return a=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
default:return e.sum(n)}},function(o,i,c){var l,s,f,d,p,m,h,g,v,y,b,w,$,k,A,x,C,O,S,j,T,I,q,D,P,Y,_,M
return l=null!=i?i:[],s=null!=(f=null!=o?o.filter(function(n){return"active"===n.status}):void 0)?f:[],r({prevousCharges:l,newCharges:s,inputNewCharges:o,inputPrevousCharges:i}),d=function(n){return{name:n.name,quantity:0,amount:n.amount,_id:n._id}},p=function(n,t){return t.amount-n.amount},m=function(n){return{name:n[0].name,amount:n[0].amount,quantity:n.length,_ids:e.map(function(n){return n._id})(n)}},h=function(n){return e.sortWith(p)(e.map(m)(e.map(function(n){return n[1]})(e.objToPairs(e.groupBy(function(n){return n.name+n.amount})(e.filter(function(t){return t.type===n})(l))))))},g=curry$(function(n,t){var r
return r=e.find(function(n){return t.name===n.name&&t.amount===n.amount})(h(n)),null!=r&&(r.old=!0),null==r}),v=function(n){return e.sortWith(p)(e.filter(g(n))(e.map(d)(e.filter(function(t){return t.type===n})(s))))},y=function(n){return e.concat(e.map(function(t){return t(n)})([h,v]))},u(function(){return y("aap").length>0}),u(function(){var n
return n=e.head(y("app")),n?null==n.amount||null==n.quantity||null==n.name?!1:void 0:!0}),b={attendees:y("aap"),addons:y("addon")},w=function(){return e.sum(e.map(function(n){return n.amount})(_.list))},$=function(){return a(b.attendees.map(C))+w()+j()},k=function(n){switch(!1){case"tax"!==n.type:return $()/100*n.amount
case"fee"!==n.type:return a(b.attendees.map(function(n){return n.quantity}))*n.amount
default:return 0}},A=function(){return a(s.map(k))},x=function(n){var t,e,r
return null!=(t=null!=(e=s.filter(function(t){return"aap"===t.type&&t.name===n.name}))&&null!=(r=e[0])?r.amount:void 0)?t:0},C=function(n){return x(n)*n.quantity},O=function(n){return a(b.addons.filter(function(t){return t.name===n.name}).map(function(n){return n.amount}))},S=function(n){return O(n)*n.quantity},j=function(){return a(b.addons.map(S))},T=function(){var n,t,e
return n=$(),t=function(){switch(!1){case!(M.codes[0].amountOff<n):return M.codes[0].amountOff
default:return n}},e=function(){switch(!1){case 0!==M.codes.length:return 0
case null==M.codes[0].amountOff:return t()
case null==M.codes[0].percentOff:return n/100*M.codes[0].percentOff
default:return 0}}()},I=function(n,t){var e,r,u,o
return e="inactive"===n.status,r=n.type,u=n.old,t=function(){switch(!1){case"aap"!==r:return"pricing level"
case"addon"!==r:return"add-on"}}(),o=function(){switch(!1){case!(e&&"removed"===t):return"Warning: This "+t+" no longer exists. You can only reduce the quantity at this "+t+". If you wish to offer another "+t+" at this price, please create on Adjustment to currect the price."
case!(u&&"changed"===t):return"Warning: This "+t+" has changed since the booking was created. You can only reduce the quantity at this "+t+". If you wish to offer the old "+t+", please create an Adjustment."
case!((e||u)&&"mutated"===t):return!0
default:return""}}()},q=function(){return $()+A()-T()},D=function(){return e.sum(e.map(function(n){return n.amount})(l))},P=e.sum(e.map(function(n){return n.amount})(null!=c?c:[])),Y=function(){return-(q()-P)},_={list:e.filter(function(n){return"adjustment"===n.type})(l),description:"",amount:"",isEdit:!1,show:!1,add:function(){var n
return n={description:_.description,amount:_.amount},n.amount*=100,_.list.push(n),_.description="",_.amount="",_.show=!1,_.isEdit=!1},removable:function(n){return null==n._id},remove:function(n){var t
return t=_.list.indexOf(n),_.list.splice(t,1)},edit:function(n){return _.isEdit&&_.add(),_.description=n.description,_.amount=n.amount/100,_.show=!0,_.isEdit=!0,_.remove(n)}},M={codes:[],calc:T,show:!1,edit:function(n){return M.code=n.code,M.remove(n),M.show=!0},remove:function(n){var t
return t=M.codes.indexOf(n),t>-1?M.codes.splice(t,1):void 0},add:function(e){var r,u
if(0!==(null!=(r=M.code)?r:"").length&&(M.code=M.code.toUpperCase(),M.error=function(){switch(!1){case 0!==M.code.length:return"Code is required"
case!(M.code.length<6):return"6 chars are required"
default:return""}}(),!(M.error.length>0)))return u=function(n){var r
return r=function(){return M.codes.push(n),M.code="",M.success="Coupon "+n.couponId+" added successfully",M.show=!1,t(function(){var n
return n=M.success,delete M.success,n},3e3),""},M.error=function(){switch(!1){case!(0!==n.maxRedemptions&&n.maxRedemptions<=n.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(n.redeemBy),"minutes")>0):return"This coupon is expired"
case!(n.activities.length>0&&n.activities[0]!==e):return"This coupon is not valid for this activity."
default:return r()}}()},n.get("coupon/"+M.code).success(function(n){return u(n)}).error(function(n){var t,e
return M.error=null!=(t=null!=n&&null!=(e=n.errors)?e[0]:void 0)?t:"Coupon not found"})},code:""},{warning:I,coupon:M,adjustment:_,addons:b.addons,attendees:b.attendees,showAttendees:function(){return e.join(", ")(e.map(function(n){return n.quantity+" "+n.name})(b.attendees))},showAddons:function(){return e.join(", ")(e.map(function(n){return n.quantity+" "+n.name})(b.addons))},totalWithoutTaxesfees:$,calcCoupon:T,calcTaxFee:k,calcTaxesFees:A,showPrice:x,calcPrice:C,showAddonPrice:O,calcAddonPrice:S,totalAddons:j,calcSubtotal:$,calcTotal:q,calcPreviousTotal:D,calcBalanceDue:Y}}}),angular.module("ablsdk").service("browser",function(n){var t
return t=function(){var t,e,r
t=n.navigator.userAgent,e={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in e)if(e[r].test(n.navigator.userAgent))return r
return"unknown"},{name:t()}}),angular.module("ablsdk").filter("capitalize",function(){return function(n){return angular.isString(n)&&n.length>0?n.charAt(0).toUpperCase()+n.substr(1).toLowerCase():n}}).filter("capitalizeAll",function(){return function(n){return angular.isString(n)&&n.length>0?n.split(" ").map(function(n){return n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()}).join(" "):n}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(n,t,e,r,u,o,a){return function(i,c){var l,s,f,d,p,m,h,g,v,y,b,w,$,k,A,x,C,O
return l=i.split("@"),i=l[0],s={loading:!1,frontendify:function(n,t){var e,r,u
return e=t.split("/"),r=e[e.length-1],u=function(){switch(!1){case"Array"!==toString$.call(n).slice(8,-1):return n
case"Array"!==toString$.call(n.list).slice(8,-1):return n.list
case"Array"!==toString$.call(n[r]).slice(8,-1):return n[r]
case"Object"!==toString$.call(n).slice(8,-1):return[n]
default:return[]}}()}},f={localStorage:{remove:function(n){},add:function(n){},update:function(n){},fetch:function(n){}},memory:{remove:function(n){return v(n)},add:function(n,t){return Array.prototype.push.call(g,n),"function"==typeof t?t(n):void 0},update:function(n,t){return"function"==typeof t?t(n):void 0},fetch:function(){return s.loading=!1}},backend:{remove:function(t){return n["delete"](i+"/"+t._id).success(function(){return v(t)})},update:function(t,e){return n.update(i+"/"+t._id,t).success(function(n){return s.loading=!1,"function"==typeof e?e(n):void 0})},add:function(t,r){return n.create(i,t).success(function(n){return e("backend-success",n),$(n),"function"==typeof r?r(n):void 0})},fetch:function(){var t
return t=angular.copy(g.options),delete t.$url,n.get(m(i),{params:t}).success(function(n,t,e){var r,u
return g.length=0,r=function(n){var t,r,u
if(t=e()[n],null!=t){r=document.createElement("a"),r.href=e()[n]
try{return JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(o){return u=o,void console.error(u,r.search)}}},g.options.total=(u=r("x-last-page-url"),null!=u?parseInt(u.page)*parseInt(u.pageSize):n.length),g.options.pageSize=(u=r("x-first-page-url"),null!=u?parseInt(u.pageSize):n.length),s.loading=!1,$(n)})}}},d=f[null!=(p=l[1])?p:"backend"],m=function(n){var t,e,r
return t={url:n},e=function(n){return t.url=t.url.replace(":"+n[0],n[1])},r=g.getOptions().$url,null!=r&&a.each(e)(a.objToPairs(r)),t.url},h=t.$new(),h.items=[],g=h.items,s.loading=!1,v=function(n){var t
return t=g.indexOf(n),t>-1?Array.prototype.splice.call(g,t,1):void 0},y=function(n,t){return null!=n._id?b(n,t):w(n,t)},b=function(n,t){return s.loading?void 0:d.update(n,t)},w=function(n,t){return s.loading?void 0:d.add(n,t)},$=function(n){var t,e,r
switch(t=s.frontendify(n,i),e=toString$.call(t).slice(8,-1)){case"Array":Array.prototype.push.apply(g,t)
break
case"Object":r=function(n){return g[n[0]]=n[1]},a.each(r)(a.objToPairs(t))}return s.loading=!1},g.options={},g.converter=function(n){return s.frontendify=n.frontendify,s.backendify=n.backendify,g},g.getOptions=function(){return g.options},k=function(n){if(!s.loading){switch(toString$.call(n).slice(8,-1)){case"Function":return g.getOptions=n,k({})
case"Number":g.options.page=n
break
case"Object":g.options=angular.extend({},g.getOptions(),n)}return s.loading=!0,null!=g.options.page&&(1===g.options.page?delete g.options.page:g.options.page-=1),d.fetch()}},k(c),A=function(){var n
if(!s.loading)return n=Array.prototype.splice.apply(g,arguments),n.forEach(d.remove)},x=function(n,t,e){var u,o
if(!s.loading)return u={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},o=r.confirm({controller:"confirm2",templateUrl:"confirm",locals:{options:angular.extend({},u,e)},targetEvent:t}),r.show(o).then(function(t){return t===!0?d.remove(n):void 0})},C=[],O=function(n){var t,e
return t=[],e=curry$(function(e,r){var u,o
return u=[],O(u),o=function(){var t
return t=Array.prototype[e].call(n,r),u.length=0,Array.prototype.push.apply(u,t)},t.push(o),o(),u}),n.loading=function(){return s.loading},n.toArray=function(){var t
return t=[],Array.prototype.push.apply(t,n),t},n.fetchOn=function(t,e){return e.$watch(t,bind$(g,"fetch"),!0),n},n.watch=function(e,r){var a
return a=function(){return u(function(){return t.forEach(function(n){return n()})})},null!=r?(C.push({array:r[e],func:a}),r.$watch(e,a,!0)):(C.push({array:e,func:a}),o.watch(e,a)),n},n.watch(n),["map","filter"].forEach(function(t){return n[t]=e(t)}),n.push=w,n.save=y,n.fetch=k,n.remove=x,n.splice=A,n.toArray=function(){return angular.copy(n)}},g.listen=function(n){return n.$on("$destroy",function(){var n,t,e,r,u=[]
for(n=0,e=(t=C).length;e>n;++n)r=t[n],u.push(o.unwatch(r.array,r.func))
return u}),g},O(g),g}}),angular.module("ablsdk").service("abldate",function(n){return function(n){var t,e
return t=function(n,t){var e,r
return e=bind$(moment(n),"format"),r=bind$(t,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},e=function(t,e){return t.add(moment(e).tz(n).utcOffset()-t.utcOffset(),"minute")},{backendify:function(r){var u
return u=t(r,moment().tz(n)).tz(n),e(u),u.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(r){var u
return u=moment(r).tz(n),e(u,u),t(u,moment(r)).toDate()}}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(n){return function(t){var e
if(n)switch(toString$.call(t).slice(8,-1)){case"Function":return t()
default:return"undefined"!=typeof console&&null!==console&&null!=(e=console.log)?e.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("ablfacade",function(n,t){return function(e,r){var u,o
return u=n(e,r),o=t(e,u.calendar),{book:u,slot:o}}}),angular.module("ablsdk").service("formula",function(n,t){var e,r
return e=function(t,e){var r,u
return r=null!=(u=null!=e?e.charges:void 0)?u:[],function(n){var t
return null!=(t=null!=n?n.amount:void 0)?t:0}(n.find(function(n){return n.type===t||n.subtype===t||n.description===t})(r))},r=function(t){var e,r,u,o,a,i,c,l
return(null!=t&&null!=(e=t.timeslots)?e.length:void 0)>0?(r=function(n){return[].concat.apply([],n)},u=function(t){var e,r
return e="Adult",n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(n.filter(function(n){return n.type===e||n.subtype===e||n.description===e})(null!=(r=null!=t?t.charges:void 0)?r:[])))},o=function(t){var e
return n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(null!=(e=null!=t?t.charges:void 0)?e:[]))},a=r(t.timeslots.map(u)),i=r(t.timeslots.map(o)),c=function(n){return Math.max.apply(Math,n)},l=function(){switch(!1){case!(a.length>0):return c(a)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(n){return e("Adult",n)},getVisualPrice:r,getAdultPrice:function(n){var t
return e("Adult",null!=n&&null!=(t=n.timeslots)?t[0]:void 0)},getYouthPrice:function(n){var t
return e("Youth",null!=n&&null!=(t=n.timeslots)?t[0]:void 0)}}}),angular.module("ablsdk").filter("mdate",function(n){return function(n,t){return null!=n?n.format(t):null}})
var toString$={}.toString
angular.module("ablsdk").service("p",function(){var n,t
return n=function(t){var e
return[].concat.apply([],function(){var r,u,o,a=[]
for(r=0,o=(u=t).length;o>r;++r)e=u[r],"Array"===toString$.call(e).slice(8,-1)?a.push(n(e)):a.push(e)
return a}())},{head:t=function(n){return n[0]},each:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)u=t[e],n(u)
return t}),isItNaN:function(n){return n!==n},all:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)if(u=t[e],!n(u))return!1
return!0}),map:curry$(function(n,t){return t.map(n)}),fold:curry$(function(n,t,e){var r,u,o
for(r=0,u=e.length;u>r;++r)o=e[r],t=n(t,o)
return t}),filter:curry$(function(n,t){var e,r,u,o=[]
for(e=0,r=t.length;r>e;++e)u=t[e],n(u)&&o.push(u)
return o}),find:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)if(u=t[e],n(u))return u}),pairsToObj:function(n){var t,e,r,u={}
for(t=0,e=n.length;e>t;++t)r=n[t],u[r[0]]=r[1]
return u},objToPairs:function(n){var t,e,r=[]
for(t in n)e=n[t],r.push([t,e])
return r},values:function(n){var t,e,r=[]
for(t in n)e=n[t],r.push(e)
return r},any:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)if(u=t[e],n(u))return!0
return!1}),notAny:curry$(function(n,t){var e,r,u
for(e=0,r=t.length;r>e;++e)if(u=t[e],n(u))return!1
return!0}),sum:function(n){var t,e,r,u
for(t=0,e=0,r=n.length;r>e;++e)u=n[e],t+=u
return t},sort:function(n){return n.concat().sort(function(n,t){return n>t?1:t>n?-1:0})},concat:function(n){return[].concat.apply([],n)},concatMap:curry$(function(n,t){var e
return[].concat.apply([],function(){var r,u,o,a=[]
for(r=0,o=(u=t).length;o>r;++r)e=u[r],a.push(n(e))
return a}())}),flatten:n,groupBy:curry$(function(n,t){var e,r,u,o,a
for(e={},r=0,u=t.length;u>r;++r)o=t[r],a=n(o),a in e?e[a].push(o):e[a]=[o]
return e}),sortWith:curry$(function(n,t){return t.concat().sort(n)}),sortBy:curry$(function(n,t){return t.concat().sort(function(t,e){return n(t)>n(e)?1:n(t)<n(e)?-1:0})}),reverse:function(n){return n.concat().reverse()},split:curry$(function(n,t){return t.split(n)}),join:curry$(function(n,t){return t.join(n)}),lines:function(n){return n.length?n.split("\n"):[]},unlines:function(n){return n.join("\n")},words:function(n){return n.length?n.split(/[ ]+/):[]},unwords:function(n){return n.join(" ")},chars:function(n){return n.split("")},unchars:function(n){return n.join("")},repeat:curry$(function(n,t){var e,r
for(e="",r=0;n>r;++r)e+=t
return e}),capitalize:function(n){return n.charAt(0).toUpperCase()+n.slice(1)},camelize:function(n){return n.replace(/[-_]+(.)?/g,function(n,t){return(null!=t?t:"").toUpperCase()})},dasherize:function(n){return n.replace(/([^-A-Z])([A-Z]+)/g,function(n,t,e){return t+"-"+(e.length>1?e:e.toLowerCase())}).replace(/^([A-Z]+)/,function(n,t){return t.length>1?t+"-":t.toLowerCase()})}}}),angular.module("ablsdk").factory("prefill",function(n,t,e){return function(r){return n(function(){return e.prefill=function(){var n
return n=arguments,t(function(){return r.apply(null,n)})},null!=e.parent?e.parent.prefill=e.prefill:void 0})}}),angular.module("ablsdk").filter("price",function(n){return function(t){return n("currency")(t/100)}}),angular.module("ablsdk").service("safeApply",function(n){return function(t){var e
return e=n.$$phase,"$apply"===e||"$digest"===e?t():n.$apply(t)}})
