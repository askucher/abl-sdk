// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
function curry$(n,e){var t,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return t=e?t||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(t,o):n.apply(t,o)}:n}
return r()}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return t=e?t||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(t,o):n.apply(t,o)}:n}
return r()}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return t=e?t||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(t,o):n.apply(t,o)}:n}
return r()}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var o=u?u.concat():[]
return t=e?t||this:this,o.push.apply(o,arguments)<n.length&&arguments.length?r.call(t,o):n.apply(t,o)}:n}
return r()}angular.module("ablsdk",[]),angular.module("ablsdk").service("ablbook",function(n,e,t,r,u,o){return function(r,o){var a,i,c,l,s,f,d,p,m,h,v,g,y,b,x,$,k,w,O,A,C,S,T,Y,D
return a={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idenpotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:""}},calendar:{value:null,visible:!1,currentActivity:r,closed:function(n){return a.form.date.start=a.calendar.date.start,a.form.date.end=a.calendar.date.end,o("slot-chosen",n)}}},i=function(n){var e
return null!=n?(e=null!=(null!=n?n.format:void 0)?n:moment(n),parseInt(e.format("YYYYMMDD"))):null},c=function(n){var e
return e=function(){switch(!1){case null!==n.start:return"none"
case i(n.start)===i(n.end):return"different"
default:return"same"}}()},l=function(n){return!a.loading&&n.$valid},s=function(n){return a.form.error=n},f=function(){return s("")},d=function(n){return a.triedCheckout=!1,a.typing=n},p=function(){var n
return a.idenpotencyKey=(n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n())},p(),m=function(n){var e
return null!=(e=null!=n&&"function"==typeof n.filter?n.filter(function(n){return n.quantity>0}):void 0)?e:[]},h=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
case 0!==n.length:return 0
default:return n.reduce(function(n,e){return n+e})}},v=function(){return 0===h(a.calendar.calc.attendees.map(function(n){return n.quantity}))},g=function(n,e){var t
return t=function(){switch(!1){case 4!==n.length:return n+" "
case 9!==n.length:return n+" "
case 14!==n.length:return n+" "
case 19!==n.length:return n+" "
default:return n}}(),t+e},y=function(){var n,e,t,r
return n=event.target.value,e=null!=(t=null!=n?n.replace("/",""):void 0)?t:"",r=function(n){return null!=n?n:""},a.form.creditCard.expDate=function(){switch(!1){case!(e.length>2):return e[0]+e[1]+"/"+r(e[2])+r(e[3])
default:return e}}()},b=function(n){var t
return t=n.target.value,"undefined"!=typeof t?a.form.creditCard.card=function(n){return n.substr(0,19)}(e.fold(g,"")(function(n){return n.split(" ").join("")}(t))):void 0},x=function(u,o){var i,c,l,f
return"undefined"==typeof u?(a.loading=!1,s("Stripe key is not defined")):(t.setPublishableKey(u),i=a.form.creditCard,c=i.expDate.split("/"),l=a.form,f={number:i.card,cvc:i.cvv,exp_month:c[0],exp_year:"20"+c[1],fullName:l.name,location:l.location,state:l.state},t.createToken(f,function(t,u){var i,c,f
return null!=t?(a.loading=!1,s(t)):(i=r,c=i.timeslots.filter(function(n){return n._id===a.calendar._id})[0].eventId,f={stripeToken:u,couponId:a.calendar.calc.coupon.codes.length>0?a.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:"credit",eventInstanceId:c+"_"+a.calendar.date.origin,addons:e.pairsToObj(e.map(function(n){return[n._id,n.quantity]})(a.calendar.calc.addons)),attendees:e.pairsToObj(e.map(function(n){return[n.name,n.quantity]})(a.calendar.calc.attendees)),answers:e.pairsToObj(e.map(function(n){return[n._id,n.answer]})(a.calendar.questions)),fullName:l.name,email:l.email,phoneNumber:l.phone,notes:l.notes,location:l.location,currency:"usd",_customHeaders:{"Idempotency-Key":a.idenpotencyKey}},n.post("bookings",f).success(function(n){return null!=n.bookingId?(p(),o()):s(n.error)}).error(function(n){var e,t
return s(null!=(e=null!=(t=n.errors)?t[0]:void 0)?e:"Server error")})["finally"](function(){return a.loading=!1}))}))},$=function(){return n.get("payments/setup")},k=function(n){return a.loading!==!0?(a.triedCheckout=!0,l(n)?(a.loading=!0,$().success(function(n){return x(n.publicKey,function(){return o("success",n)})}).error(function(n){return a.loading=!1,s(n),o("error",s)})):s("Please correct the form")):void 0},w=function(){return a.form.agreed=!a.form.agreed,S()},O=function(n){return n.required||n.pattern||n.minlength||n.maxlength||n.phone},A=function(n,e){switch(!1){case!e.required:return n+" is required"
case!e.pattern:return"Please follow the example "+C[n].example
case!e.minlength:return n+" is too short"
case!e.maxlength:return n+" is too long"
case!e.phone:return n+" is not valid phone number"
default:return"please check "+n}},C={email:{pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email"},name:{pattern:"",example:"Your name",placeholder:"Name"},phone:{pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234"},address:{pattern:"",example:"Address",placeholder:"Home address"},notes:{pattern:"",example:"Notes",placeholder:"Notes"},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",placeholder:"Card #"},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",placeholder:"Exp date"},startDate:{},cvv:{pattern:/[0-9]{3,4}/i,example:"000",placeholder:"CVV"}},S=function(){return a.form.agreed?a.triedCheckout=!0:void 0},T=function(n,e){var t,r,u,o,i,c,l
if(a.triedCheckout===!0){for(t in C)if(C.hasOwnProperty(t)&&(r=null!=(u=n[t])?u.$error:void 0,r&&O(r)))return t===e?A(t,r):""
return""}for(t in C)if(C.hasOwnProperty(t)&&(r=null!=(o=n[t])?o.$error:void 0,r&&O(r)&&r.maxlength))return t===e?A(t,r):""
return a.typing===e&&null!=(null!=(i=n[e])&&null!=(c=i.$error)?c.pattern:void 0)&&(null!=(l=C[e].example)?l.length:void 0)>0?"example: "+C[e].example:void 0},Y=function(n){return a.typing===n?C[n].example:C[n].placeholder},u(function(){var n,e
return n=a.form,n.email="test@debug.com",n.name="Test User",n.phone="+380665243646",n.address="664 Cypress Lane, Campbell, CA, United States",n.notes="Some test notes",e=a.form.creditCard,e.card="5105 1051 0510 5100",e.expDate="05/17",e.cvv="333",a.form.agreed=!0}),D=a,D.investigateDate=c,D.placeholder=Y,D.closeError=f,D.checkout=k,D.agree=w,D.fields=C,D.few=m,D.expDateChanged=y,D.cardChanged=b,D.disabledOrder=v,D.typing=d,D.message=T,a}}),angular.module("ablsdk").service("ablcalc",function(n,e){var t
return t=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
case 0!==n.length:return 0
default:return n.reduce(function(n,e){return n+e})}},function(r){var u,o,a,i,c,l,s,f,d,p,m,h,v,g,y
return u=null!=r?r.filter(function(n){return"active"===n.status}):void 0,o=function(n){var e
return{name:n.name,quantity:null!=(e=n.count)?e:0,amount:n.amount,_id:n._id}},a=function(n,e){return e.amount-n.amount},i={attendees:null!=u?u.filter(function(n){return"aap"===n.type}).map(o).sort(a):void 0,addons:null!=u?u.filter(function(n){return"addon"===n.type}).map(o):void 0},c=function(){return t(i.attendees.map(d))+h()},l=function(n){switch(!1){case"tax"!==n.type:return c()/100*n.amount
case"fee"!==n.type:return t(i.attendees.map(function(n){return n.quantity}))*n.amount
default:return 0}},s=function(){return t(u.map(l))},f=function(n){var e,t,r
return null!=(e=null!=(t=u.filter(function(e){return"aap"===e.type&&e.name===n.name}))&&null!=(r=t[0])?r.amount:void 0)?e:0},d=function(n){return f(n)*n.quantity},p=function(n){return t(i.addons.filter(function(e){return e.name===n.name}).map(function(n){return n.amount}))},m=function(n){return p(n)*n.quantity},h=function(){return t(i.addons.map(m))},v=function(){var n,e,t
return n=c(),e=function(){switch(!1){case!(y.codes[0].amountOff<n):return y.codes[0].amountOff
default:return n}},t=function(){switch(!1){case 0!==y.codes.length:return 0
case null==y.codes[0].amountOff:return e()
case null==y.codes[0].percentOff:return n/100*y.codes[0].percentOff
default:return 0}}()},g=function(){return c()+s()-v()},y={codes:[],calc:v,remove:function(n){var e
return e=y.codes.indexOf(n),e>-1?y.codes.splice(e,1):void 0},add:function(t){var r,u
if(0!==(null!=(r=y.code)?r:"").length&&(y.code=y.code.toUpperCase(),y.error=function(){switch(!1){case 0!==y.code.length:return"Code is required"
case!(y.code.length<6):return"6 chars are required"
default:return""}}(),!(y.error.length>0)))return u=function(n){var r
return r=function(){return y.codes.push(n),y.code="",y.success="Coupon "+n.couponId+" added successfully",e(function(){var n
return n=y.success,delete y.success,n},3e3),""},y.error=function(){switch(!1){case!(0!==n.maxRedemptions&&n.maxRedemptions<=n.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(n.redeemBy),"minutes")>0):return"This coupon is expired"
case!(n.activities.length>0&&n.activities[0]!==t):return"This coupon is not valid for this activity."
default:return r()}}()},n.get("coupon/"+y.code).success(function(n){return u(n)}).error(function(n){var e,t
return y.error=null!=(e=null!=n&&null!=(t=n.errors)?t[0]:void 0)?e:"Coupon not found"})},code:""},{coupon:y,addons:i.addons,attendees:i.attendees,totalWithoutTaxesfees:c,calcCoupon:v,calcTaxFee:l,calcTaxesFees:s,showPrice:f,calcPrice:d,showAddonPrice:p,calcAddonPrice:m,totalAddons:h,calcSubtotal:c,calcTotal:g}}}),angular.module("ablsdk").service("ablapi",function(n){return{timeslots:function(e){var t
return t=$.param({activity:e.activityId,"status[event]":"all",dateRange:[moment(e.startTime).clone().startOf("day").startOf("month").toISOString(),moment(e.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),n.get("timeslots?"+t)}}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(n,e,t,r,u,o,a){return function(i,c){var l,s,f,d,p,m,h,v,g,y,b,x,$,k,w,O,A,C
return l=i.split("@"),i=l[0],s={loading:!1},f={localStorage:{remove:function(n){},add:function(n){},update:function(n){},fetch:function(n){}},memory:{remove:function(n){return g(n)},add:function(n,e){return Array.prototype.push.call(v,n),"function"==typeof e?e(n):void 0},update:function(n,e){return"function"==typeof e?e(n):void 0},fetch:function(){return s.loading=!1}},backend:{remove:function(e){return n["delete"](i+"/"+e._id).success(function(){return g(e)})},update:function(e,t){return n.update(i+"/"+e._id,e).success(function(n){return s.loading=!1,"function"==typeof t?t(n):void 0})},add:function(e,r){return n.create(i,e).success(function(n){return t("backend-success",n),$(n),"function"==typeof r?r(n):void 0})},fetch:function(){var e
return t("fetch",m(i),v.options),e=angular.copy(v.options),delete e.$url,n.get(m(i),{params:e}).success(function(n,e,t){var r,u
return v.length=0,r=function(n){var e,r
return e=t()[n],null!=e?(r=document.createElement("a"),r.href=t()[n],JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')):void 0},v.options.total=(u=r("x-last-page-url"),null!=u?parseInt(u.page)*parseInt(u.pageSize):n.length),v.options.pageSize=(u=r("x-first-page-url"),null!=u?parseInt(u.pageSize):n.length),s.loading=!1,$(n)})}}},d=f[null!=(p=l[1])?p:"backend"],m=function(n){var e,t,r
return e={url:n},t=function(n){return e.url=e.url.replace(":"+n[0],n[1])},r=v.getOptions().$url,null!=r&&a.each(t)(a.objToPairs(r)),e.url},h=e.$new(),h.items=[],v=h.items,s.loading=!1,g=function(n){var e
return e=v.indexOf(n),e>-1?Array.prototype.splice.call(v,e,1):void 0},y=function(n,e){return null!=n._id?b(n,e):x(n,e)},b=function(n,e){return s.loading?void 0:d.update(n,e)},x=function(n,e){return s.loading?void 0:d.add(n,e)},$=function(n){var e,t,r
return e=i.split("/"),t=e[e.length-1],r=function(){switch(!1){case"Array"!==toString$.call(n).slice(8,-1):return n
case"Array"!==toString$.call(n[t]).slice(8,-1):return n[t]
case"Object"!==toString$.call(n).slice(8,-1):return[n]
default:return[]}}(),Array.prototype.push.apply(v,r),s.loading=!1},v.options={},v.getOptions=function(){return v.options},k=function(n){if(!s.loading){switch(toString$.call(n).slice(8,-1)){case"Function":return v.getOptions=n,k({})
case"Number":v.options.page=n
break
case"Object":v.options=angular.extend({},v.getOptions(),n)}return s.loading=!0,null!=v.options.page&&(1===v.options.page?delete v.options.page:v.options.page-=1),d.fetch()}},k(c),w=function(){var n
if(!s.loading)return n=Array.prototype.splice.apply(v,arguments),n.forEach(d.remove)},O=function(n,e,t){var u,o
if(!s.loading)return u={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},r.show(r.confirm().title(null!=(o=null!=t?t.title:void 0)?o:u.title).content(null!=(o=null!=t?t.content:void 0)?o:u.content).ok(null!=(o=null!=t?t.ok:void 0)?o:u.ok).cancel(null!=(o=null!=t?t.cancel:void 0)?o:u.cancel).targetEvent(e)).then(function(){return d.remove(n)},function(){})},A=[],C=function(n){var e,t
return e=[],t=curry$(function(t,r){var u,o
return u=[],C(u),o=function(){var e
return e=Array.prototype[t].call(n,r),u.length=0,Array.prototype.push.apply(u,e)},e.push(o),o(),u}),n.loading=function(){return s.loading},n.toArray=function(){var e
return e=[],Array.prototype.push.apply(e,n),e},n.fetchOn=function(e,t){return t.$watch(e,bind$(v,"fetch"),!0),n},n.watch=function(t,r){var a
return a=function(){return u(function(){return e.forEach(function(n){return n()})})},null!=r?(A.push({array:r[t],func:a}),r.$watch(t,a,!0)):(A.push({array:t,func:a}),o.watch(t,a)),n},n.watch(n),["map","filter"].forEach(function(e){return n[e]=t(e)}),n.push=x,n.save=y,n.fetch=k,n.remove=O,n.splice=w,n.toArray=function(){return angular.copy(n)}},v.listen=function(n){return n.$on("$destroy",function(){var n,e,t,r,u=[]
for(n=0,t=(e=A).length;t>n;++n)r=e[n],u.push(o.unwatch(r.array,r.func))
return u}),v},C(v),v}}),angular.module("ablsdk").service("browser",function(n){var e
return e=function(){var e,t,r
e=n.navigator.userAgent,t={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in t)if(t[r].test(n.navigator.userAgent))return r
return"unknown"},{name:e()}}),angular.module("ablsdk").service("abldate",function(n){return function(e){var t,r
return t=function(n,e){var t,r
return t=bind$(moment(n),"format"),r=bind$(e,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},r=function(n,t){return n.add(moment(t).tz(e).utcOffset()-n.utcOffset(),"minute")},{backendify:function(u){var o
return o=t(u,moment().tz(e)).tz(e),n("timezone",e),r(o),o.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(u){var o
return o=moment(u).tz(e),n("timezone",e),r(o,o),t(o,moment(u)).toDate()}}}}),angular.module("ablsdk").service("formula",function(n,e){var t,r
return t=function(e,t){var r,u
return r=null!=(u=null!=t?t.charges:void 0)?u:[],function(n){var e
return null!=(e=null!=n?n.amount:void 0)?e:0}(n.find(function(n){return n.type===e||n.subtype===e||n.description===e})(r))},r=function(e){var t,r,u,o,a,i,c,l
return(null!=e&&null!=(t=e.timeslots)?t.length:void 0)>0?(r=function(n){return[].concat.apply([],n)},u=function(e){var t,r
return t="Adult",n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(n.filter(function(n){return n.type===t||n.subtype===t||n.description===t})(null!=(r=null!=e?e.charges:void 0)?r:[])))},o=function(e){var t
return n.map(function(n){return n.amount})(null!=(t=null!=e?e.charges:void 0)?t:[])},a=r(e.timeslots.map(u)),i=r(e.timeslots.map(o)),c=function(n){return Math.max.apply(Math,n)},l=function(){switch(!1){case!(a.length>0):return c(a)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(n){return t("Adult",n)},getVisualPrice:r,getAdultPrice:function(n){var e
return t("Adult",null!=n&&null!=(e=n.timeslots)?e[0]:void 0)},getYouthPrice:function(n){var e
return t("Youth",null!=n&&null!=(e=n.timeslots)?e[0]:void 0)}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(n){return function(e){var t
if(n)switch(toString$.call(e).slice(8,-1)){case"Function":return e()
default:return"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("p",function(){var n
return{head:n=function(n){return n[0]},each:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)u=e[t],n(u)
return e}),map:curry$(function(n,e){var t,r,u,o=[]
for(t=0,r=e.length;r>t;++t)u=e[t],o.push(n(u))
return o}),fold:curry$(function(n,e,t){var r,u,o
for(r=0,u=t.length;u>r;++r)o=t[r],e=n(e,o)
return e}),filter:curry$(function(n,e){var t,r,u,o=[]
for(t=0,r=e.length;r>t;++t)u=e[t],n(u)&&o.push(u)
return o}),find:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return u}),pairsToObj:function(n){var e,t,r,u={}
for(e=0,t=n.length;t>e;++e)r=n[e],u[r[0]]=r[1]
return u},objToPairs:function(n){var e,t,r=[]
for(e in n)t=n[e],r.push([e,t])
return r},values:function(n){var e,t,r=[]
for(e in n)t=n[e],r.push(t)
return r},any:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return!0
return!1}),notAny:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return!1
return!0}),sum:function(n){var e,t,r,u
for(e=0,t=0,r=n.length;r>t;++t)u=n[t],e+=u
return e},sort:function(n){return n.concat().sort(function(n,e){return n>e?1:e>n?-1:0})},sortWith:curry$(function(n,e){return e.concat().sort(n)}),sortBy:curry$(function(n,e){return e.concat().sort(function(e,t){return n(e)>n(t)?1:n(e)<n(t)?-1:0})}),reverse:function(n){return n.concat().reverse()}}}),angular.module("ablsdk").filter("mdate",function(n){return function(n,e){return null!=n?n.format(e):null}}),angular.module("ablsdk",[]),angular.module("ablsdk").service("ablbook",function(n,e,t,r,u,o){return function(r,o){var a,i,c,l,s,f,d,p,m,h,v,g,y,b,x,$,k,w,O,A,C,S,T,Y,D
return a={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idenpotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:""}},calendar:{value:null,visible:!1,currentActivity:r,closed:function(n){return a.form.date.start=a.calendar.date.start,a.form.date.end=a.calendar.date.end,o("slot-chosen",n)}}},i=function(n){var e
return null!=n?(e=null!=(null!=n?n.format:void 0)?n:moment(n),parseInt(e.format("YYYYMMDD"))):null},c=function(n){var e
return e=function(){switch(!1){case null!==n.start:return"none"
case i(n.start)===i(n.end):return"different"
default:return"same"}}()},l=function(n){return!a.loading&&n.$valid},s=function(n){return a.form.error=n},f=function(){return s("")},d=function(n){return a.triedCheckout=!1,a.typing=n},p=function(){var n
return a.idenpotencyKey=(n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n())},p(),m=function(n){var e
return null!=(e=null!=n&&"function"==typeof n.filter?n.filter(function(n){return n.quantity>0}):void 0)?e:[]},h=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
case 0!==n.length:return 0
default:return n.reduce(function(n,e){return n+e})}},v=function(){return 0===h(a.calendar.calc.attendees.map(function(n){return n.quantity}))},g=function(n,e){var t
return t=function(){switch(!1){case 4!==n.length:return n+" "
case 9!==n.length:return n+" "
case 14!==n.length:return n+" "
case 19!==n.length:return n+" "
default:return n}}(),t+e},y=function(){var n,e,t,r
return n=event.target.value,e=null!=(t=null!=n?n.replace("/",""):void 0)?t:"",r=function(n){return null!=n?n:""},a.form.creditCard.expDate=function(){switch(!1){case!(e.length>2):return e[0]+e[1]+"/"+r(e[2])+r(e[3])
default:return e}}()},b=function(n){var t
return t=n.target.value,"undefined"!=typeof t?a.form.creditCard.card=function(n){return n.substr(0,19)}(e.fold(g,"")(function(n){return n.split(" ").join("")}(t))):void 0},x=function(u,o){var i,c,l,f
return"undefined"==typeof u?(a.loading=!1,s("Stripe key is not defined")):(t.setPublishableKey(u),i=a.form.creditCard,c=i.expDate.split("/"),l=a.form,f={number:i.card,cvc:i.cvv,exp_month:c[0],exp_year:"20"+c[1],fullName:l.name,location:l.location,state:l.state},t.createToken(f,function(t,u){var i,c,f
return null!=t?(a.loading=!1,s(t)):(i=r,c=i.timeslots.filter(function(n){return n._id===a.calendar._id})[0].eventId,f={stripeToken:u,couponId:a.calendar.calc.coupon.codes.length>0?a.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:"credit",eventInstanceId:c+"_"+a.calendar.date.origin,addons:e.pairsToObj(e.map(function(n){return[n._id,n.quantity]})(a.calendar.calc.addons)),attendees:e.pairsToObj(e.map(function(n){return[n.name,n.quantity]})(a.calendar.calc.attendees)),answers:e.pairsToObj(e.map(function(n){return[n._id,n.answer]})(a.calendar.questions)),fullName:l.name,email:l.email,phoneNumber:l.phone,notes:l.notes,location:l.location,currency:"usd",_customHeaders:{"Idempotency-Key":a.idenpotencyKey}},n.post("bookings",f).success(function(n){return null!=n.bookingId?(p(),o()):s(n.error)}).error(function(n){var e,t
return s(null!=(e=null!=(t=n.errors)?t[0]:void 0)?e:"Server error")})["finally"](function(){return a.loading=!1}))}))},$=function(){return n.get("payments/setup")},k=function(n){return a.loading!==!0?(a.triedCheckout=!0,l(n)?(a.loading=!0,$().success(function(n){return x(n.publicKey,function(){return o("success",n)})}).error(function(n){return a.loading=!1,s(n),o("error",s)})):s("Please correct the form")):void 0},w=function(){return a.form.agreed=!a.form.agreed,S()},O=function(n){return n.required||n.pattern||n.minlength||n.maxlength||n.phone},A=function(n,e){switch(!1){case!e.required:return n+" is required"
case!e.pattern:return"Please follow the example "+C[n].example
case!e.minlength:return n+" is too short"
case!e.maxlength:return n+" is too long"
case!e.phone:return n+" is not valid phone number"
default:return"please check "+n}},C={email:{pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email"},name:{pattern:"",example:"Your name",placeholder:"Name"},phone:{pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234"},address:{pattern:"",example:"Address",placeholder:"Home address"},notes:{pattern:"",example:"Notes",placeholder:"Notes"},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",placeholder:"Card #"},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",placeholder:"Exp date"},startDate:{},cvv:{pattern:/[0-9]{3,4}/i,example:"000",placeholder:"CVV"}},S=function(){return a.form.agreed?a.triedCheckout=!0:void 0},T=function(n,e){var t,r,u,o,i,c,l
if(a.triedCheckout===!0){for(t in C)if(C.hasOwnProperty(t)&&(r=null!=(u=n[t])?u.$error:void 0,r&&O(r)))return t===e?A(t,r):""
return""}for(t in C)if(C.hasOwnProperty(t)&&(r=null!=(o=n[t])?o.$error:void 0,r&&O(r)&&r.maxlength))return t===e?A(t,r):""
return a.typing===e&&null!=(null!=(i=n[e])&&null!=(c=i.$error)?c.pattern:void 0)&&(null!=(l=C[e].example)?l.length:void 0)>0?"example: "+C[e].example:void 0},Y=function(n){return a.typing===n?C[n].example:C[n].placeholder},u(function(){var n,e
return n=a.form,n.email="test@debug.com",n.name="Test User",n.phone="+380665243646",n.address="664 Cypress Lane, Campbell, CA, United States",n.notes="Some test notes",e=a.form.creditCard,e.card="5105 1051 0510 5100",e.expDate="05/17",e.cvv="333",a.form.agreed=!0}),D=a,D.investigateDate=c,D.placeholder=Y,D.closeError=f,D.checkout=k,D.agree=w,D.fields=C,D.few=m,D.expDateChanged=y,D.cardChanged=b,D.disabledOrder=v,D.typing=d,D.message=T,a}}),angular.module("ablsdk").service("ablcalc",function(n,e){var t
return t=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
case 0!==n.length:return 0
default:return n.reduce(function(n,e){return n+e})}},function(r){var u,o,a,i,c,l,s,f,d,p,m,h,v,g,y
return u=null!=r?r.filter(function(n){return"active"===n.status}):void 0,o=function(n){var e
return{name:n.name,quantity:null!=(e=n.count)?e:0,amount:n.amount,_id:n._id}},a=function(n,e){return e.amount-n.amount},i={attendees:null!=u?u.filter(function(n){return"aap"===n.type}).map(o).sort(a):void 0,addons:null!=u?u.filter(function(n){return"addon"===n.type}).map(o):void 0},c=function(){return t(i.attendees.map(d))+h()},l=function(n){switch(!1){case"tax"!==n.type:return c()/100*n.amount
case"fee"!==n.type:return t(i.attendees.map(function(n){return n.quantity}))*n.amount
default:return 0}},s=function(){return t(u.map(l))},f=function(n){var e,t,r
return null!=(e=null!=(t=u.filter(function(e){return"aap"===e.type&&e.name===n.name}))&&null!=(r=t[0])?r.amount:void 0)?e:0},d=function(n){return f(n)*n.quantity},p=function(n){return t(i.addons.filter(function(e){return e.name===n.name}).map(function(n){return n.amount}))},m=function(n){return p(n)*n.quantity},h=function(){return t(i.addons.map(m))},v=function(){var n,e,t
return n=c(),e=function(){switch(!1){case!(y.codes[0].amountOff<n):return y.codes[0].amountOff
default:return n}},t=function(){switch(!1){case 0!==y.codes.length:return 0
case null==y.codes[0].amountOff:return e()
case null==y.codes[0].percentOff:return n/100*y.codes[0].percentOff
default:return 0}}()},g=function(){return c()+s()-v()},y={codes:[],calc:v,remove:function(n){var e
return e=y.codes.indexOf(n),e>-1?y.codes.splice(e,1):void 0},add:function(t){var r,u
if(0!==(null!=(r=y.code)?r:"").length&&(y.code=y.code.toUpperCase(),y.error=function(){switch(!1){case 0!==y.code.length:return"Code is required"
case!(y.code.length<6):return"6 chars are required"
default:return""}}(),!(y.error.length>0)))return u=function(n){var r
return r=function(){return y.codes.push(n),y.code="",y.success="Coupon "+n.couponId+" added successfully",e(function(){var n
return n=y.success,delete y.success,n},3e3),""},y.error=function(){switch(!1){case!(0!==n.maxRedemptions&&n.maxRedemptions<=n.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(n.redeemBy),"minutes")>0):return"This coupon is expired"
case!(n.activities.length>0&&n.activities[0]!==t):return"This coupon is not valid for this activity."
default:return r()}}()},n.get("coupon/"+y.code).success(function(n){return u(n)}).error(function(n){var e,t
return y.error=null!=(e=null!=n&&null!=(t=n.errors)?t[0]:void 0)?e:"Coupon not found"})},code:""},{coupon:y,addons:i.addons,attendees:i.attendees,totalWithoutTaxesfees:c,calcCoupon:v,calcTaxFee:l,calcTaxesFees:s,showPrice:f,calcPrice:d,showAddonPrice:p,calcAddonPrice:m,totalAddons:h,calcSubtotal:c,calcTotal:g}}}),angular.module("ablsdk").service("ablapi",function(n){return{timeslots:function(e){var t
return t=$.param({activity:e.activityId,"status[event]":"all",dateRange:[moment(e.startTime).clone().startOf("day").startOf("month").toISOString(),moment(e.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),n.get("timeslots?"+t)}}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(n,e,t,r,u,o,a){return function(i,c){var l,s,f,d,p,m,h,v,g,y,b,x,$,k,w,O,A,C
return l=i.split("@"),i=l[0],s={loading:!1},f={localStorage:{remove:function(n){},add:function(n){},update:function(n){},fetch:function(n){}},memory:{remove:function(n){return g(n)},add:function(n,e){return Array.prototype.push.call(v,n),"function"==typeof e?e(n):void 0},update:function(n,e){return"function"==typeof e?e(n):void 0},fetch:function(){return s.loading=!1}},backend:{remove:function(e){return n["delete"](i+"/"+e._id).success(function(){return g(e)})},update:function(e,t){return n.update(i+"/"+e._id,e).success(function(n){return s.loading=!1,"function"==typeof t?t(n):void 0})},add:function(e,r){return n.create(i,e).success(function(n){return t("backend-success",n),$(n),"function"==typeof r?r(n):void 0})},fetch:function(){var e
return t("fetch",m(i),v.options),e=angular.copy(v.options),delete e.$url,n.get(m(i),{params:e}).success(function(n,e,t){var r,u
return v.length=0,r=function(n){var e,r
return e=t()[n],null!=e?(r=document.createElement("a"),r.href=t()[n],JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')):void 0},v.options.total=(u=r("x-last-page-url"),null!=u?parseInt(u.page)*parseInt(u.pageSize):n.length),v.options.pageSize=(u=r("x-first-page-url"),null!=u?parseInt(u.pageSize):n.length),s.loading=!1,$(n)})}}},d=f[null!=(p=l[1])?p:"backend"],m=function(n){var e,t,r
return e={url:n},t=function(n){return e.url=e.url.replace(":"+n[0],n[1])},r=v.getOptions().$url,null!=r&&a.each(t)(a.objToPairs(r)),e.url},h=e.$new(),h.items=[],v=h.items,s.loading=!1,g=function(n){var e
return e=v.indexOf(n),e>-1?Array.prototype.splice.call(v,e,1):void 0},y=function(n,e){return null!=n._id?b(n,e):x(n,e)},b=function(n,e){return s.loading?void 0:d.update(n,e)},x=function(n,e){return s.loading?void 0:d.add(n,e)},$=function(n){var e,t,r
return e=i.split("/"),t=e[e.length-1],r=function(){switch(!1){case"Array"!==toString$.call(n).slice(8,-1):return n
case"Array"!==toString$.call(n[t]).slice(8,-1):return n[t]
case"Object"!==toString$.call(n).slice(8,-1):return[n]
default:return[]}}(),Array.prototype.push.apply(v,r),s.loading=!1},v.options={},v.getOptions=function(){return v.options},k=function(n){if(!s.loading){switch(toString$.call(n).slice(8,-1)){case"Function":return v.getOptions=n,k({})
case"Number":v.options.page=n
break
case"Object":v.options=angular.extend({},v.getOptions(),n)}return s.loading=!0,null!=v.options.page&&(1===v.options.page?delete v.options.page:v.options.page-=1),d.fetch()}},k(c),w=function(){var n
if(!s.loading)return n=Array.prototype.splice.apply(v,arguments),n.forEach(d.remove)},O=function(n,e,t){var u,o
if(!s.loading)return u={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},r.show(r.confirm().title(null!=(o=null!=t?t.title:void 0)?o:u.title).content(null!=(o=null!=t?t.content:void 0)?o:u.content).ok(null!=(o=null!=t?t.ok:void 0)?o:u.ok).cancel(null!=(o=null!=t?t.cancel:void 0)?o:u.cancel).targetEvent(e)).then(function(){return d.remove(n)},function(){})},A=[],C=function(n){var e,t
return e=[],t=curry$(function(t,r){var u,o
return u=[],C(u),o=function(){var e
return e=Array.prototype[t].call(n,r),u.length=0,Array.prototype.push.apply(u,e)},e.push(o),o(),u}),n.loading=function(){return s.loading},n.toArray=function(){var e
return e=[],Array.prototype.push.apply(e,n),e},n.fetchOn=function(e,t){return t.$watch(e,bind$(v,"fetch"),!0),n},n.watch=function(t,r){var a
return a=function(){return u(function(){return e.forEach(function(n){return n()})})},null!=r?(A.push({array:r[t],func:a}),r.$watch(t,a,!0)):(A.push({array:t,func:a}),o.watch(t,a)),n},n.watch(n),["map","filter"].forEach(function(e){return n[e]=t(e)}),n.push=x,n.save=y,n.fetch=k,n.remove=O,n.splice=w,n.toArray=function(){return angular.copy(n)}},v.listen=function(n){return n.$on("$destroy",function(){var n,e,t,r,u=[]
for(n=0,t=(e=A).length;t>n;++n)r=e[n],u.push(o.unwatch(r.array,r.func))
return u}),v},C(v),v}}),angular.module("ablsdk").service("browser",function(n){var e
return e=function(){var e,t,r
e=n.navigator.userAgent,t={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in t)if(t[r].test(n.navigator.userAgent))return r
return"unknown"},{name:e()}}),angular.module("ablsdk").service("abldate",function(n){return function(e){var t,r
return t=function(n,e){var t,r
return t=bind$(moment(n),"format"),r=bind$(e,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},r=function(n,t){return n.add(moment(t).tz(e).utcOffset()-n.utcOffset(),"minute")},{backendify:function(u){var o
return o=t(u,moment().tz(e)).tz(e),n("timezone",e),r(o),o.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(u){var o
return o=moment(u).tz(e),n("timezone",e),r(o,o),t(o,moment(u)).toDate()}}}}),angular.module("ablsdk").service("formula",function(n,e){var t,r
return t=function(e,t){var r,u
return r=null!=(u=null!=t?t.charges:void 0)?u:[],function(n){var e
return null!=(e=null!=n?n.amount:void 0)?e:0}(n.find(function(n){return n.type===e||n.subtype===e||n.description===e})(r))},r=function(e){var t,r,u,o,a,i,c,l
return(null!=e&&null!=(t=e.timeslots)?t.length:void 0)>0?(r=function(n){return[].concat.apply([],n)},u=function(e){var t,r
return t="Adult",n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(n.filter(function(n){return n.type===t||n.subtype===t||n.description===t})(null!=(r=null!=e?e.charges:void 0)?r:[])))},o=function(e){var t
return n.map(function(n){return n.amount})(null!=(t=null!=e?e.charges:void 0)?t:[])},a=r(e.timeslots.map(u)),i=r(e.timeslots.map(o)),c=function(n){return Math.max.apply(Math,n)},l=function(){switch(!1){case!(a.length>0):return c(a)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(n){return t("Adult",n)},getVisualPrice:r,getAdultPrice:function(n){var e
return t("Adult",null!=n&&null!=(e=n.timeslots)?e[0]:void 0)},getYouthPrice:function(n){var e
return t("Youth",null!=n&&null!=(e=n.timeslots)?e[0]:void 0)}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(n){return function(e){var t
if(n)switch(toString$.call(e).slice(8,-1)){case"Function":return e()
default:return"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("p",function(){var n
return{head:n=function(n){return n[0]},each:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)u=e[t],n(u)
return e}),map:curry$(function(n,e){var t,r,u,o=[]
for(t=0,r=e.length;r>t;++t)u=e[t],o.push(n(u))
return o}),fold:curry$(function(n,e,t){var r,u,o
for(r=0,u=t.length;u>r;++r)o=t[r],e=n(e,o)
return e}),filter:curry$(function(n,e){var t,r,u,o=[]
for(t=0,r=e.length;r>t;++t)u=e[t],n(u)&&o.push(u)
return o}),find:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return u}),pairsToObj:function(n){var e,t,r,u={}
for(e=0,t=n.length;t>e;++e)r=n[e],u[r[0]]=r[1]
return u},objToPairs:function(n){var e,t,r=[]
for(e in n)t=n[e],r.push([e,t])
return r},values:function(n){var e,t,r=[]
for(e in n)t=n[e],r.push(t)
return r},any:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return!0
return!1}),notAny:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return!1
return!0}),sum:function(n){var e,t,r,u
for(e=0,t=0,r=n.length;r>t;++t)u=n[t],e+=u
return e},sort:function(n){return n.concat().sort(function(n,e){return n>e?1:e>n?-1:0})},sortWith:curry$(function(n,e){return e.concat().sort(n)}),sortBy:curry$(function(n,e){return e.concat().sort(function(e,t){return n(e)>n(t)?1:n(e)<n(t)?-1:0})}),reverse:function(n){return n.concat().reverse()}}}),angular.module("ablsdk").filter("mdate",function(n){return function(n,e){return null!=n?n.format(e):null}})
