// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
function curry$(t,n){var e,r=function(a){return t.length>1?function(){var u=a?a.concat():[]
return e=n?e||this:this,u.push.apply(u,arguments)<t.length&&arguments.length?r.call(e,u):t.apply(e,u)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var u=a?a.concat():[]
return e=n?e||this:this,u.push.apply(u,arguments)<t.length&&arguments.length?r.call(e,u):t.apply(e,u)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var u=a?a.concat():[]
return e=n?e||this:this,u.push.apply(u,arguments)<t.length&&arguments.length?r.call(e,u):t.apply(e,u)}:t}
return r()}function compose$(){var t=arguments
return function(){var n,e
for(e=t[0].apply(this,arguments),n=1;n<t.length;++n)e=t[n](e)
return e}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var u=a?a.concat():[]
return e=n?e||this:this,u.push.apply(u,arguments)<t.length&&arguments.length?r.call(e,u):t.apply(e,u)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var u=a?a.concat():[]
return e=n?e||this:this,u.push.apply(u,arguments)<t.length&&arguments.length?r.call(e,u):t.apply(e,u)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var u=a?a.concat():[]
return e=n?e||this:this,u.push.apply(u,arguments)<t.length&&arguments.length?r.call(e,u):t.apply(e,u)}:t}
return r()}function compose$(){var t=arguments
return function(){var n,e
for(e=t[0].apply(this,arguments),n=1;n<t.length;++n)e=t[n](e)
return e}}angular.module("ablsdk",[]),angular.module("ablsdk").service("ablapi",function(t){return{timeslots:function(n){var e
return e=$.param({activity:n.activityId,dateRange:[moment(n.startTime).clone().startOf("day").startOf("month").toISOString(),moment(n.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),t.get("timeslots?"+e)}}}),angular.module("ablsdk").service("browser",function(t){var n
return n=function(){var n,e,r
n=t.navigator.userAgent,e={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in e)if(e[r].test(t.navigator.userAgent))return r
return"unknown"},{name:n()}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(t,n,e,r,a,u){return function(o,i){var c,l,s,f,d,m,v,p,y,h,g,b,D,w,S,A,M,T
return c=o.split("@"),o=c[0],l={loading:!1},s={localStorage:{remove:function(t){},add:function(t){},update:function(t){},fetch:function(t){}},memory:{remove:function(t){return y(t)},add:function(t,n){return Array.prototype.push.call(p,t),"function"==typeof n?n(t):void 0},update:function(t,n){return"function"==typeof n?n(t):void 0},fetch:function(){return l.loading=!1}},backend:{remove:function(n){return t["delete"](o+"/"+n._id).success(function(){return y(n)})},update:function(n,e){return t.update(o+"/"+n._id,n).success(function(t){return l.loading=!1,"function"==typeof e?e(t):void 0})},add:function(n,r){return t.create(o,n).success(function(t){return e("backend-success",t),D(t),"function"==typeof r?r(t):void 0})},fetch:function(){return t.get(m(o),p.options).success(function(t,n,e){var r,a
return p.length=0,r=function(t){var n,r
return n=e()[t],null!=n?(r=document.createElement("a"),r.href=e()[t],JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')):void 0},p.options.total=(a=r("x-last-page-url"),null!=a?parseInt(a.page)*parseInt(a.pageSize):t.length),p.options.pageSize=(a=r("x-first-page-url"),null!=a?parseInt(a.pageSize):t.length),l.loading=!1,D(t)})}}},f=s[null!=(d=c[1])?d:"backend"],m=function(t){var n
for(n in p.urlOptions)t=t.replace(":"+n,p.urlOptions[n])
return t},v=n.$new(),v.items=[],p=v.items,l.loading=!1,y=function(t){var n
return n=p.indexOf(t),n>-1?Array.prototype.splice.call(p,n,1):void 0},h=function(t,n){return null!=t._id?g(t,n):b(t,n)},g=function(t,n){return l.loading?void 0:f.update(t,n)},b=function(t,n){return l.loading?void 0:f.add(t,n)},D=function(t){var n
return n=function(){switch(!1){case"Array"!==toString$.call(t).slice(8,-1):return t
case"Array"!==toString$.call(t[o]).slice(8,-1):return t[o]
case"Object"!==toString$.call(t).slice(8,-1):return[t]
default:return[]}}(),Array.prototype.push.apply(p,n),l.loading=!1},p.options={},p.urlOptions={},w=function(t){if(e("fetch",l.loading),!l.loading){switch(typeof t){case"Number":p.options.page=t
break
case"Object":p.urlOptions=$.extend({},"function"==typeof t.$url?t.$url({},p.options.urlOptions):void 0),delete t.$url,p.options=$.extend({},t,p.options),p.page=1}return l.loading=!0,f.fetch()}},w(i),S=function(){var t
if(!l.loading)return t=Array.prototype.splice.apply(p,arguments),t.forEach(f.remove)},A=function(t,n,e){var a,u
if(!l.loading)return a={title:"Deletion",content:"Are you that you want to delete this item?",ok:"Confirm",cancel:"Cancel"},r.show(r.confirm().title(null!=(u=null!=e?e.title:void 0)?u:a.title).content(null!=(u=null!=e?e.content:void 0)?u:a.content).ok(null!=(u=null!=e?e.ok:void 0)?u:a.ok).cancel(null!=(u=null!=e?e.cancel:void 0)?u:a.cancel).targetEvent(n)).then(function(){return f.remove(t)},function(){})},M=[],T=function(t){var n,e
return n=[],e=curry$(function(e,r){var a,u
return a=[],T(a),u=function(){var n
return n=Array.prototype[e].call(t,r),a.length=0,Array.prototype.push.apply(a,n)},n.push(u),u(),a}),t.loading=function(){return l.loading},t.toArray=function(){var n
return n=[],Array.prototype.push.apply(n,t),n},t.watch=function(e,r){var o
return o=function(){return a(function(){return n.forEach(function(t){return t()})})},null!=r?(M.push({array:r[e],func:o}),r.$watch(e,o,!0)):(M.push({array:e,func:o}),u.watch(e,o)),t},t.watch(t),["map","filter"].forEach(function(n){return t[n]=e(n)}),t.push=b,t.save=h,t.fetch=w,t.remove=A,t.splice=S,t.toArray=function(){return angular.copy(t)}},p.listen=function(t){return t.$on("$destroy",function(){var t,n,e,r,a=[]
for(t=0,e=(n=M).length;e>t;++t)r=n[t],a.push(u.unwatch(r.array,r.func))
return a}),p},T(p),p}}),angular.module("ablsdk").service("abldate",function(t){return function(n){var e,r
return e=function(t,n){var e,r
return e=bind$(moment(t),"format"),r=bind$(n,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},r=function(t,e){return t.add(moment(e).tz(n).utcOffset()-t.utcOffset(),"minute")},{backendify:function(a){var u
return u=e(a,moment().tz(n)).tz(n),t("timezone",n),r(u),u.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(a){var u
return u=moment(a).tz(n),t("timezone",n),r(u,u),e(u,moment(a)).toDate()}}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(t){return function(n){var e
if(t)switch(toString$.call(n).slice(8,-1)){case"Function":return n()
default:return"undefined"!=typeof console&&null!==console&&null!=(e=console.log)?e.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("formula",function(t,n){var e,r
return e=function(n,e){var r,a
return r=null!=(a=null!=e?e.charges:void 0)?a:[],function(t){var n
return null!=(n=null!=t?t.amount:void 0)?n:0}(t.find(function(t){return t.type===n||t.subtype===n||t.description===n})(r))},r=function(n){var e,r,a,u,o,i,c,l
return(null!=n&&null!=(e=n.timeslots)?e.length:void 0)>0?(r=function(t){return[].concat.apply([],t)},a=function(n){var e,r
return e="Adult",t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(t.filter(function(t){return t.type===e||t.subtype===e||t.description===e})(null!=(r=null!=n?n.charges:void 0)?r:[])))},u=function(n){var e
return t.map(function(t){return t.amount})(null!=(e=null!=n?n.charges:void 0)?e:[])},o=r(n.timeslots.map(a)),i=r(n.timeslots.map(u)),c=function(t){return Math.max.apply(Math,t)},l=function(){switch(!1){case!(o.length>0):return c(o)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(t){return e("Adult",t)},getVisualPrice:r,getAdultPrice:function(t){var n
return e("Adult",null!=t&&null!=(n=t.timeslots)?n[0]:void 0)},getYouthPrice:function(t){var n
return e("Youth",null!=t&&null!=(n=t.timeslots)?n[0]:void 0)}}}),angular.module("ablsdk").filter("mdate",function(t){return function(t,n){return null!=t?t.format(n):null}}),angular.module("ablsdk").service("p",function(){var t
return{head:t=function(t){return t[0]},each:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)a=n[e],t(a)
return n}),map:curry$(function(t,n){var e,r,a,u=[]
for(e=0,r=n.length;r>e;++e)a=n[e],u.push(t(a))
return u}),filter:curry$(function(t,n){var e,r,a,u=[]
for(e=0,r=n.length;r>e;++e)a=n[e],t(a)&&u.push(a)
return u}),find:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return a}),pairsToObj:function(t){var n,e,r,a={}
for(n=0,e=t.length;e>n;++n)r=t[n],a[r[0]]=r[1]
return a},objToPairs:function(t){var n,e,r=[]
for(n in t)e=t[n],r.push([n,e])
return r},values:function(t){var n,e,r=[]
for(n in t)e=t[n],r.push(e)
return r},any:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return!0
return!1}),notAny:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return!1
return!0}),sum:function(t){var n,e,r,a
for(n=0,e=0,r=t.length;r>e;++e)a=t[e],n+=a
return n},sort:function(t){return t.concat().sort(function(t,n){return t>n?1:n>t?-1:0})},sortWith:curry$(function(t,n){return n.concat().sort(t)}),sortBy:curry$(function(t,n){return n.concat().sort(function(n,e){return t(n)>t(e)?1:t(n)<t(e)?-1:0})}),reverse:function(t){return t.concat().reverse()}}}),angular.module("ablsdk").service("safeApply",function(t){return function(n){var e
return e=t.$$phase,"$apply"===e||"$digest"===e?n():t.$apply(n)}}),angular.module("ablsdk").service("watcher",function(t,n,e){var r,a,u
return r=function(){return{unwatch:function(t,n){return"function"==typeof n.unwatch?n.unwatch():void 0},watch:function(n,e){var r
return r=t.$new(),r.array=n,e.unwatch=r.$watch("array",e,!0)}}},a=function(){return{unwatch:function(t,n){return Array.unobserve(t,n)},watch:function(n,e){var r,a,u
return r=function(){var n
return n=t.$new(),function(t,e){return n.array=t,n.$watch("array",e)}},(a=null!=(u=Array.observe)?u:r())(n,e)}}},e(n.name),u=function(){switch(!1){case"firefox"!==n.name:return r()
case"unknown"!==n.name:return r()
case"safari"!==n.name:return r()
default:return r()}}()}),angular.module("ablsdk").service("ablslot",function(abldate,ablcalc,ablapi,formula,p,debug){return function(activity,model){var transformCharge,state,x$,ref$,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,performChooseSlot,actualEvent,isEmpty,slotsByDay,select,isFitToSlot,isNotFitToAnySlot,inPast,createMonth,startMonth,setCalendars,scroll,nextMonth,calendar,loadEvents,isDummy,isDisabledDay,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,calendarUp,calendarDown,y$
return transformCharge=function(t){return{_id:t._id,name:t.name,quantity:0,amount:t.amount}},state={slots:[],model:model,calendars:[],activeSlots:[]},x$=state.model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(t){return"addon"===t.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,getDay=function(t){var n
return null!=t?(n=null!=(null!=t?t.format:void 0)?t:moment(t),parseInt(n.format("YYYYMMDD"))):null},newDate=function(){var t
return t=moment.apply(null,arguments).tz(activity.timeZone)},generateCalendar=function(t,n){var e,r,a,u,o,i,c,l
return e=newDate(t),r=e.year(),a=e.month(),u=function(t){return newDate([r,a,t])},o=e.endOf("month").date(),i=p.map(u)(function(){var t,n,e=[]
for(t=1,n=o;n>=t;++t)e.push(t)
return e}()),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var t,n,e=[]
for(t=1,n=c;n>=t;++t)e.push(t)
return e}()),{time:e,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(t){return Math.ceil(getDay(t)/100)},hackDate=function(t,n){var e,r
return e=bind$(moment(t),"format"),r=bind$(n,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(t,n){var e,r
return e=null!=t?t:hackDate(t,moment()),r=null!=n?n:hackDate(n,moment()),moment([e.year(),e.month(),e.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var available
return available=slot.available-eval([0].concat(state.model.attendees.map(function(t){return t.quantity})).join("+")),debug({available:slot.available,taken:eval([0].concat(state.model.attendees.map(function(t){return t.quantity})).join("+")),result:available}),available}),performChooseSlot=function(t){var n,e,r,a,u
if(0!==t.available)return n=state.model.value,e=merge(n,t.startTime),state.model.date.start=e,r=abldate(activity.timeZone),state.model.date.origin=r.backendify(state.model.date.start).replace(/[\:-]/gi,""),state.model.date.end=t.endTime,state.model.charges=t.charges,state.model.calc=ablcalc(t.charges.concat(activity.charges)),state.model._id=t._id,a=state.model.attendees,u=function(t){var n
return n=a.filter(function(n){return n.name===t.name}),{quantity:function(){switch(!1){case!(n.length>0):return n[0].quantity
case"Adult"!==t.name:return 1
default:return 0}}(),name:t.name,amount:t.amount}},state.model.attendees=t.charges.filter(function(t){return"aap"===t.type}).map(u),state.model.available=makeAvailable(t)},actualEvent=curry$(function(t,n){return getDay(n.startTime)===getDay(t)}),isEmpty=function(t){var n
return n=actualEvent(t),function(t){return 0===t.length}(p.filter(isFitToSlot(t))(state.slots))},slotsByDay=function(t){var n,e
return n=actualEvent(t),e=function(e){var r,a,u,o,i
return r=merge(t,e.startTime),a=e.endTime-e.startTime,u=e.events.filter(n).map(function(t){return t.available}),o=null!=(i=u[0])?i:e.maxOcc,{startTime:r,time:r.valueOf(),endTime:r.clone().add(a,"milliseconds"),charges:e.charges,price:formula.getVisualPrice({timeslots:[e]}),available:o,_id:e._id,duration:moment.duration(a).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:e.maxOcc-o}},p.sortBy(function(t){return t.time})(p.map(e)(p.filter(isFitToSlot(t))(state.slots)))},select=function(t){return state.model.value=t,state.activeSlots.length=0,slotsByDay(t).forEach(function(t){return state.activeSlots.push(t)})},isFitToSlot=curry$(function(t,n){var e,r,a,u,o,i
return e=0===n.daysRunning.length,r=activity,a=function(){switch(!1){case!(getDay(n.startTime)!==getDay(t)&&e):return!0
case!(getDay(n.startTime)>getDay(t)&&!e):return!0
case!(getDay(n.untilTime)<getDay(t)&&!e):return!0
default:return!1}}(),u=function(t){var n,e
return n=null!=t&&"function"==typeof t.day?t.day():void 0,e=function(){switch(!1){case null!==n:return null
case 0!==n:return 6
default:return n-1}}()},o=!e&&p.notAny(function(n){return n===u(t)})(n.daysRunning),i=function(){switch(!1){case!o:return!1
case!a:return!1
default:return!0}}()}),isNotFitToAnySlot=function(t){switch(!1){case!p.notAny(function(t){return t.available>0})(slotsByDay(t)):return!0
case!p.notAny(isFitToSlot(t))(state.slots):return!0
default:return!1}},inPast=function(t){return getDay(t)<getDay(newDate())||t.diff(newDate(),"hours")<24},createMonth=function(t){return newDate([t.year(),t.month(),15])},startMonth=createMonth(newDate()),setCalendars=function(t,n,e){return state.calendars.length=0,state.calendars.push(t),state.calendars.push(n),loadEvents(e)},scroll={activeDate:function(){var t,n,e,r,a,u
return scroll.activeDate=function(){},t=state.calendars[0],n=function(n){return generateCalendar(t.time.clone().add(n,"month"))},e=function(e){return 0===e?t:n(e)},r=function(t){return"undefined"!=typeof e(t).days.find(function(t){return!isDisabledDay(t)})},a=function(t){return function(){var n,e,r=[]
for(n=1,e=t;e>=n;++n)r.push(n)
return r}().forEach(bind$(calendar,"down"))},u=[0,1,2,3,4,5,6].find(r),u>0?a(u):void 0}},nextMonth=function(t,n){return date.clone().add(n,"months")},calendar={first:startMonth,second:startMonth.clone().add(1,"months"),move:function(t){return calendar.first=calendar.first.clone().add(t,"month"),calendar.second=calendar.second.clone().add(t,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},loadEvents=function(t){return ablapi.timeslots({startTime:state.calendars[0].time,endTime:state.calendars[1].time,activityId:activity._id}).success(function(n){var e,r,a
return e=abldate(activity.timeZone),r=compose$(e.frontendify,moment),a=function(t){return t.startTime=r(t.startTime),t.endTime=r(t.endTime),t.untilTime=r(t.untilTime),t},state.slots=n.timeslots.map(a),scroll.activeDate(),"function"==typeof t?t():void 0})},isDummy=function(t){switch(!1){case null!==t:return!0
default:return!1}},isDisabledDay=function(t){switch(!1){case!isDummy(t):return!0
case!isEmpty(t):return!0
case!inPast(t):return!0
case!isNotFitToAnySlot(t):return!0
default:return!1}},selectDay=function(t){return isDisabledDay(t)?void 0:(select(t),performChooseSlot(state.slots[0]))},notSelected=function(){switch(!1){case null!==state.model.date.start:return!0
case state.model.chosen!==!1:return!0
default:return!1}},disabledSlot=function(t){switch(!1){case 0!==t.available:return"This event is full"
default:return""}},notAvailableSlot=function(t){return t.available<=0},close=function(t){var n
return n=function(t){return 0===t.quantity&&"Adult"===t.name?t.quantity=1:void 0},state.model.attendees.forEach(n),state.model.chosen=t,state.model.visible=!1,state.model.closed(t)},chooseSlot=function(t){return notAvailableSlot(t)?void 0:(performChooseSlot(t),close(!0))},isActiveDay=function(t){return getDay(t)===getDay(state.model.value)},isDisabledMonth=function(t){switch(!1){case!(getDay(t)<getDay(newDate())):return!0
default:return!1}},isActiveMonth=function(t){return getMonth(t)===getMonth(state.model.value)},isCalendarUpDisabled=function(){return getMonth(state.calendars[0].time)<getMonth(newDate())},calendarUp=function(){return isCalendarUpDisabled()?void 0:calendar.up()},calendarDown=function(){return calendar.down()},y$=state,y$.startMonth=startMonth,y$.setCalendars=setCalendars,y$.selectDay=selectDay,y$.generateCalendar=generateCalendar,y$.calendarUp=calendarUp,y$.calendarDown=calendarDown,y$.close=close,y$.isActiveMonth=isActiveMonth,y$.isDisabledDay=isDisabledDay,y$.isDisabledMonth=isDisabledMonth,y$.isCalendarUpDisabled=isCalendarUpDisabled,y$.isDummy=isDummy,y$.isActiveDay=isActiveDay,y$.notSelected=notSelected,y$.chooseSlot=chooseSlot,y$.notAvailableSlot=notAvailableSlot,y$.disabledSlot=disabledSlot,state}}),angular.module("ablsdk").service("ablcalc",function(t,n){var e
return e=function(t){switch(!1){case"undefined"!=typeof t:return 0
case null!==typeof t:return 0
case 0!==t.length:return 0
default:return t.reduce(function(t,n){return t+n})}},function(r){var a,u,o,i,c,l,s,f,d,m,v,p,y,h
return a=function(t){var n
return{name:t.name,quantity:null!=(n=t.count)?n:0,amount:t.amount,_id:t._id}},u=function(t,n){return n.amount-t.amount},o={attendees:null!=r?r.filter(function(t){return"aap"===t.type}).map(a).sort(u):void 0,addons:null!=r?r.filter(function(t){return"addon"===t.type}).map(a):void 0},i=function(){return e(o.attendees.map(f))+v()},c=function(t){switch(!1){case"tax"!==t.type:return i()/100*t.amount
case"fee"!==t.type:return e(o.attendees.map(function(t){return t.quantity}))*t.amount
default:return 0}},l=function(){return e(r.map(c))},s=function(t){var n,e,a
return null!=(n=null!=(e=r.filter(function(n){return"aap"===n.type&&n.name===t.name}))&&null!=(a=e[0])?a.amount:void 0)?n:0},f=function(t){return s(t)*t.quantity},d=function(t){return e(o.addons.filter(function(n){return n.name===t.name}).map(function(t){return t.amount}))},m=function(t){return d(t)*t.quantity},v=function(){return e(o.addons.map(m))},p=function(){var t,n,e
return t=i(),n=function(){switch(!1){case!(h.codes[0].amountOff<t):return h.codes[0].amountOff
default:return t}},e=function(){switch(!1){case 0!==h.codes.length:return 0
case null==h.codes[0].amountOff:return n()
case null==h.codes[0].percentOff:return t/100*h.codes[0].percentOff
default:return 0}}()},y=function(){return i()+l()-p()},h={codes:[],calc:p,remove:function(t){var n
return n=h.codes.indexOf(t),n>-1?h.codes.splice(n,1):void 0},add:function(e){var r,a
if(0!==(null!=(r=h.code)?r:"").length)return h.error="",a=function(t){var r
return r=function(){return h.codes.push(t),h.code="",h.success=!0,n(function(){var t
return t=h.success,delete h.success,t},3e3),""},h.error=function(){switch(!1){case!(0!==t.maxRedemptions&&t.maxRedemptions<=t.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(t.redeemBy),"minutes")>0):return"This coupon is expired"
case!(t.activities.length>0&&t.activities[0]!==e):return"This coupon is not valid for this activity."
default:return r()}}()},t.get("coupon/"+h.code).success(function(t){return a(t)}).error(function(t){var n,e
return h.error=null!=(n=null!=t&&null!=(e=t.errors)?e[0]:void 0)?n:"Coupon not found"})},code:""},{coupon:h,addons:o.addons,attendees:o.attendees,totalWithoutTaxesfees:i,calcCoupon:p,calcTaxFee:c,calcTaxesFees:l,showPrice:s,calcPrice:f,showAddonPrice:d,calcAddonPrice:m,totalAddons:v,calcSubtotal:i,calcTotal:y}}}),angular.module("ablsdk",[]),angular.module("ablsdk").service("ablapi",function(t){return{timeslots:function(n){var e
return e=$.param({activity:n.activityId,dateRange:[moment(n.startTime).clone().startOf("day").startOf("month").toISOString(),moment(n.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),t.get("timeslots?"+e)}}}),angular.module("ablsdk").service("browser",function(t){var n
return n=function(){var n,e,r
n=t.navigator.userAgent,e={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in e)if(e[r].test(t.navigator.userAgent))return r
return"unknown"},{name:n()}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(t,n,e,r,a,u){return function(o,i){var c,l,s,f,d,m,v,p,y,h,g,b,D,w,S,A,M,T
return c=o.split("@"),o=c[0],l={loading:!1},s={localStorage:{remove:function(t){},add:function(t){},update:function(t){},fetch:function(t){}},memory:{remove:function(t){return y(t)},add:function(t,n){return Array.prototype.push.call(p,t),"function"==typeof n?n(t):void 0},update:function(t,n){return"function"==typeof n?n(t):void 0},fetch:function(){return l.loading=!1}},backend:{remove:function(n){return t["delete"](o+"/"+n._id).success(function(){return y(n)})},update:function(n,e){return t.update(o+"/"+n._id,n).success(function(t){return l.loading=!1,"function"==typeof e?e(t):void 0})},add:function(n,r){return t.create(o,n).success(function(t){return e("backend-success",t),D(t),"function"==typeof r?r(t):void 0})},fetch:function(){return t.get(m(o),p.options).success(function(t,n,e){var r,a
return p.length=0,r=function(t){var n,r
return n=e()[t],null!=n?(r=document.createElement("a"),r.href=e()[t],JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')):void 0},p.options.total=(a=r("x-last-page-url"),null!=a?parseInt(a.page)*parseInt(a.pageSize):t.length),p.options.pageSize=(a=r("x-first-page-url"),null!=a?parseInt(a.pageSize):t.length),l.loading=!1,D(t)})}}},f=s[null!=(d=c[1])?d:"backend"],m=function(t){var n
for(n in p.urlOptions)t=t.replace(":"+n,p.urlOptions[n])
return t},v=n.$new(),v.items=[],p=v.items,l.loading=!1,y=function(t){var n
return n=p.indexOf(t),n>-1?Array.prototype.splice.call(p,n,1):void 0},h=function(t,n){return null!=t._id?g(t,n):b(t,n)},g=function(t,n){return l.loading?void 0:f.update(t,n)},b=function(t,n){return l.loading?void 0:f.add(t,n)},D=function(t){var n
return n=function(){switch(!1){case"Array"!==toString$.call(t).slice(8,-1):return t
case"Array"!==toString$.call(t[o]).slice(8,-1):return t[o]
case"Object"!==toString$.call(t).slice(8,-1):return[t]
default:return[]}}(),Array.prototype.push.apply(p,n),l.loading=!1},p.options={},p.urlOptions={},w=function(t){if(e("fetch",l.loading),!l.loading){switch(typeof t){case"Number":p.options.page=t
break
case"Object":p.urlOptions=$.extend({},"function"==typeof t.$url?t.$url({},p.options.urlOptions):void 0),delete t.$url,p.options=$.extend({},t,p.options),p.page=1}return l.loading=!0,f.fetch()}},w(i),S=function(){var t
if(!l.loading)return t=Array.prototype.splice.apply(p,arguments),t.forEach(f.remove)},A=function(t,n,e){var a,u
if(!l.loading)return a={title:"Deletion",content:"Are you that you want to delete this item?",ok:"Confirm",cancel:"Cancel"},r.show(r.confirm().title(null!=(u=null!=e?e.title:void 0)?u:a.title).content(null!=(u=null!=e?e.content:void 0)?u:a.content).ok(null!=(u=null!=e?e.ok:void 0)?u:a.ok).cancel(null!=(u=null!=e?e.cancel:void 0)?u:a.cancel).targetEvent(n)).then(function(){return f.remove(t)},function(){})},M=[],T=function(t){var n,e
return n=[],e=curry$(function(e,r){var a,u
return a=[],T(a),u=function(){var n
return n=Array.prototype[e].call(t,r),a.length=0,Array.prototype.push.apply(a,n)},n.push(u),u(),a}),t.loading=function(){return l.loading},t.toArray=function(){var n
return n=[],Array.prototype.push.apply(n,t),n},t.watch=function(e,r){var o
return o=function(){return a(function(){return n.forEach(function(t){return t()})})},null!=r?(M.push({array:r[e],func:o}),r.$watch(e,o,!0)):(M.push({array:e,func:o}),u.watch(e,o)),t},t.watch(t),["map","filter"].forEach(function(n){return t[n]=e(n)}),t.push=b,t.save=h,t.fetch=w,t.remove=A,t.splice=S,t.toArray=function(){return angular.copy(t)}},p.listen=function(t){return t.$on("$destroy",function(){var t,n,e,r,a=[]
for(t=0,e=(n=M).length;e>t;++t)r=n[t],a.push(u.unwatch(r.array,r.func))
return a}),p},T(p),p}}),angular.module("ablsdk").service("abldate",function(t){return function(n){var e,r
return e=function(t,n){var e,r
return e=bind$(moment(t),"format"),r=bind$(n,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},r=function(t,e){return t.add(moment(e).tz(n).utcOffset()-t.utcOffset(),"minute")},{backendify:function(a){var u
return u=e(a,moment().tz(n)).tz(n),t("timezone",n),r(u),u.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(a){var u
return u=moment(a).tz(n),t("timezone",n),r(u,u),e(u,moment(a)).toDate()}}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(t){return function(n){var e
if(t)switch(toString$.call(n).slice(8,-1)){case"Function":return n()
default:return"undefined"!=typeof console&&null!==console&&null!=(e=console.log)?e.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("formula",function(t,n){var e,r
return e=function(n,e){var r,a
return r=null!=(a=null!=e?e.charges:void 0)?a:[],function(t){var n
return null!=(n=null!=t?t.amount:void 0)?n:0}(t.find(function(t){return t.type===n||t.subtype===n||t.description===n})(r))},r=function(n){var e,r,a,u,o,i,c,l
return(null!=n&&null!=(e=n.timeslots)?e.length:void 0)>0?(r=function(t){return[].concat.apply([],t)},a=function(n){var e,r
return e="Adult",t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(t.filter(function(t){return t.type===e||t.subtype===e||t.description===e})(null!=(r=null!=n?n.charges:void 0)?r:[])))},u=function(n){var e
return t.map(function(t){return t.amount})(null!=(e=null!=n?n.charges:void 0)?e:[])},o=r(n.timeslots.map(a)),i=r(n.timeslots.map(u)),c=function(t){return Math.max.apply(Math,t)},l=function(){switch(!1){case!(o.length>0):return c(o)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(t){return e("Adult",t)},getVisualPrice:r,getAdultPrice:function(t){var n
return e("Adult",null!=t&&null!=(n=t.timeslots)?n[0]:void 0)},getYouthPrice:function(t){var n
return e("Youth",null!=t&&null!=(n=t.timeslots)?n[0]:void 0)}}}),angular.module("ablsdk").filter("mdate",function(t){return function(t,n){return null!=t?t.format(n):null}}),angular.module("ablsdk").service("p",function(){var t
return{head:t=function(t){return t[0]},each:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)a=n[e],t(a)
return n}),map:curry$(function(t,n){var e,r,a,u=[]
for(e=0,r=n.length;r>e;++e)a=n[e],u.push(t(a))
return u}),filter:curry$(function(t,n){var e,r,a,u=[]
for(e=0,r=n.length;r>e;++e)a=n[e],t(a)&&u.push(a)
return u}),find:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return a}),pairsToObj:function(t){var n,e,r,a={}
for(n=0,e=t.length;e>n;++n)r=t[n],a[r[0]]=r[1]
return a},objToPairs:function(t){var n,e,r=[]
for(n in t)e=t[n],r.push([n,e])
return r},values:function(t){var n,e,r=[]
for(n in t)e=t[n],r.push(e)
return r},any:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return!0
return!1}),notAny:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return!1
return!0}),sum:function(t){var n,e,r,a
for(n=0,e=0,r=t.length;r>e;++e)a=t[e],n+=a
return n},sort:function(t){return t.concat().sort(function(t,n){return t>n?1:n>t?-1:0})},sortWith:curry$(function(t,n){return n.concat().sort(t)}),sortBy:curry$(function(t,n){return n.concat().sort(function(n,e){return t(n)>t(e)?1:t(n)<t(e)?-1:0})}),reverse:function(t){return t.concat().reverse()}}}),angular.module("ablsdk").service("safeApply",function(t){return function(n){var e
return e=t.$$phase,"$apply"===e||"$digest"===e?n():t.$apply(n)}}),angular.module("ablsdk").service("watcher",function(t,n,e){var r,a,u
return r=function(){return{unwatch:function(t,n){return"function"==typeof n.unwatch?n.unwatch():void 0},watch:function(n,e){var r
return r=t.$new(),r.array=n,e.unwatch=r.$watch("array",e,!0)}}},a=function(){return{unwatch:function(t,n){return Array.unobserve(t,n)},watch:function(n,e){var r,a,u
return r=function(){var n
return n=t.$new(),function(t,e){return n.array=t,n.$watch("array",e)}},(a=null!=(u=Array.observe)?u:r())(n,e)}}},e(n.name),u=function(){switch(!1){case"firefox"!==n.name:return r()
case"unknown"!==n.name:return r()
case"safari"!==n.name:return r()
default:return r()}}()}),angular.module("ablsdk").service("ablslot",function(abldate,ablcalc,ablapi,formula,p,debug){return function(activity,model){var transformCharge,state,x$,ref$,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,performChooseSlot,actualEvent,isEmpty,slotsByDay,select,isFitToSlot,isNotFitToAnySlot,inPast,createMonth,startMonth,setCalendars,scroll,nextMonth,calendar,loadEvents,isDummy,isDisabledDay,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,calendarUp,calendarDown,y$
return transformCharge=function(t){return{_id:t._id,name:t.name,quantity:0,amount:t.amount}},state={slots:[],model:model,calendars:[],activeSlots:[]},x$=state.model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(t){return"addon"===t.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,getDay=function(t){var n
return null!=t?(n=null!=(null!=t?t.format:void 0)?t:moment(t),parseInt(n.format("YYYYMMDD"))):null},newDate=function(){var t
return t=moment.apply(null,arguments).tz(activity.timeZone)},generateCalendar=function(t,n){var e,r,a,u,o,i,c,l
return e=newDate(t),r=e.year(),a=e.month(),u=function(t){return newDate([r,a,t])},o=e.endOf("month").date(),i=p.map(u)(function(){var t,n,e=[]
for(t=1,n=o;n>=t;++t)e.push(t)
return e}()),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var t,n,e=[]
for(t=1,n=c;n>=t;++t)e.push(t)
return e}()),{time:e,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(t){return Math.ceil(getDay(t)/100)},hackDate=function(t,n){var e,r
return e=bind$(moment(t),"format"),r=bind$(n,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(t,n){var e,r
return e=null!=t?t:hackDate(t,moment()),r=null!=n?n:hackDate(n,moment()),moment([e.year(),e.month(),e.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var available
return available=slot.available-eval([0].concat(state.model.attendees.map(function(t){return t.quantity})).join("+")),debug({available:slot.available,taken:eval([0].concat(state.model.attendees.map(function(t){return t.quantity})).join("+")),result:available}),available}),performChooseSlot=function(t){var n,e,r,a,u
if(0!==t.available)return n=state.model.value,e=merge(n,t.startTime),state.model.date.start=e,r=abldate(activity.timeZone),state.model.date.origin=r.backendify(state.model.date.start).replace(/[\:-]/gi,""),state.model.date.end=t.endTime,state.model.charges=t.charges,state.model.calc=ablcalc(t.charges.concat(activity.charges)),state.model._id=t._id,a=state.model.attendees,u=function(t){var n
return n=a.filter(function(n){return n.name===t.name}),{quantity:function(){switch(!1){case!(n.length>0):return n[0].quantity
case"Adult"!==t.name:return 1
default:return 0}}(),name:t.name,amount:t.amount}},state.model.attendees=t.charges.filter(function(t){return"aap"===t.type}).map(u),state.model.available=makeAvailable(t)},actualEvent=curry$(function(t,n){return getDay(n.startTime)===getDay(t)}),isEmpty=function(t){var n
return n=actualEvent(t),function(t){return 0===t.length}(p.filter(isFitToSlot(t))(state.slots))},slotsByDay=function(t){var n,e
return n=actualEvent(t),e=function(e){var r,a,u,o,i
return r=merge(t,e.startTime),a=e.endTime-e.startTime,u=e.events.filter(n).map(function(t){return t.available}),o=null!=(i=u[0])?i:e.maxOcc,{startTime:r,time:r.valueOf(),endTime:r.clone().add(a,"milliseconds"),charges:e.charges,price:formula.getVisualPrice({timeslots:[e]}),available:o,_id:e._id,duration:moment.duration(a).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:e.maxOcc-o}},p.sortBy(function(t){return t.time})(p.map(e)(p.filter(isFitToSlot(t))(state.slots)))},select=function(t){return state.model.value=t,state.activeSlots.length=0,slotsByDay(t).forEach(function(t){return state.activeSlots.push(t)})},isFitToSlot=curry$(function(t,n){var e,r,a,u,o,i
return e=0===n.daysRunning.length,r=activity,a=function(){switch(!1){case!(getDay(n.startTime)!==getDay(t)&&e):return!0
case!(getDay(n.startTime)>getDay(t)&&!e):return!0
case!(getDay(n.untilTime)<getDay(t)&&!e):return!0
default:return!1}}(),u=function(t){var n,e
return n=null!=t&&"function"==typeof t.day?t.day():void 0,e=function(){switch(!1){case null!==n:return null
case 0!==n:return 6
default:return n-1}}()},o=!e&&p.notAny(function(n){return n===u(t)})(n.daysRunning),i=function(){switch(!1){case!o:return!1
case!a:return!1
default:return!0}}()}),isNotFitToAnySlot=function(t){switch(!1){case!p.notAny(function(t){return t.available>0})(slotsByDay(t)):return!0
case!p.notAny(isFitToSlot(t))(state.slots):return!0
default:return!1}},inPast=function(t){return getDay(t)<getDay(newDate())||t.diff(newDate(),"hours")<24},createMonth=function(t){return newDate([t.year(),t.month(),15])},startMonth=createMonth(newDate()),setCalendars=function(t,n,e){return state.calendars.length=0,state.calendars.push(t),state.calendars.push(n),loadEvents(e)},scroll={activeDate:function(){var t,n,e,r,a,u
return scroll.activeDate=function(){},t=state.calendars[0],n=function(n){return generateCalendar(t.time.clone().add(n,"month"))},e=function(e){return 0===e?t:n(e)},r=function(t){return"undefined"!=typeof e(t).days.find(function(t){return!isDisabledDay(t)})},a=function(t){return function(){var n,e,r=[]
for(n=1,e=t;e>=n;++n)r.push(n)
return r}().forEach(bind$(calendar,"down"))},u=[0,1,2,3,4,5,6].find(r),u>0?a(u):void 0}},nextMonth=function(t,n){return date.clone().add(n,"months")},calendar={first:startMonth,second:startMonth.clone().add(1,"months"),move:function(t){return calendar.first=calendar.first.clone().add(t,"month"),calendar.second=calendar.second.clone().add(t,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},loadEvents=function(t){return ablapi.timeslots({startTime:state.calendars[0].time,endTime:state.calendars[1].time,activityId:activity._id}).success(function(n){var e,r,a
return e=abldate(activity.timeZone),r=compose$(e.frontendify,moment),a=function(t){return t.startTime=r(t.startTime),t.endTime=r(t.endTime),t.untilTime=r(t.untilTime),t},state.slots=n.timeslots.map(a),scroll.activeDate(),"function"==typeof t?t():void 0})},isDummy=function(t){switch(!1){case null!==t:return!0
default:return!1}},isDisabledDay=function(t){switch(!1){case!isDummy(t):return!0
case!isEmpty(t):return!0
case!inPast(t):return!0
case!isNotFitToAnySlot(t):return!0
default:return!1}},selectDay=function(t){return isDisabledDay(t)?void 0:(select(t),performChooseSlot(state.slots[0]))},notSelected=function(){switch(!1){case null!==state.model.date.start:return!0
case state.model.chosen!==!1:return!0
default:return!1}},disabledSlot=function(t){switch(!1){case 0!==t.available:return"This event is full"
default:return""}},notAvailableSlot=function(t){return t.available<=0},close=function(t){var n
return n=function(t){return 0===t.quantity&&"Adult"===t.name?t.quantity=1:void 0},state.model.attendees.forEach(n),state.model.chosen=t,state.model.visible=!1,state.model.closed(t)},chooseSlot=function(t){return notAvailableSlot(t)?void 0:(performChooseSlot(t),close(!0))},isActiveDay=function(t){return getDay(t)===getDay(state.model.value)},isDisabledMonth=function(t){switch(!1){case!(getDay(t)<getDay(newDate())):return!0
default:return!1}},isActiveMonth=function(t){return getMonth(t)===getMonth(state.model.value)},isCalendarUpDisabled=function(){return getMonth(state.calendars[0].time)<getMonth(newDate())},calendarUp=function(){return isCalendarUpDisabled()?void 0:calendar.up()},calendarDown=function(){return calendar.down()},y$=state,y$.startMonth=startMonth,y$.setCalendars=setCalendars,y$.selectDay=selectDay,y$.generateCalendar=generateCalendar,y$.calendarUp=calendarUp,y$.calendarDown=calendarDown,y$.close=close,y$.isActiveMonth=isActiveMonth,y$.isDisabledDay=isDisabledDay,y$.isDisabledMonth=isDisabledMonth,y$.isCalendarUpDisabled=isCalendarUpDisabled,y$.isDummy=isDummy,y$.isActiveDay=isActiveDay,y$.notSelected=notSelected,y$.chooseSlot=chooseSlot,y$.notAvailableSlot=notAvailableSlot,y$.disabledSlot=disabledSlot,state}}),angular.module("ablsdk").service("ablcalc",function(t,n){var e
return e=function(t){switch(!1){case"undefined"!=typeof t:return 0
case null!==typeof t:return 0
case 0!==t.length:return 0
default:return t.reduce(function(t,n){return t+n})}},function(r){var a,u,o,i,c,l,s,f,d,m,v,p,y,h
return a=function(t){var n
return{name:t.name,quantity:null!=(n=t.count)?n:0,amount:t.amount,_id:t._id}},u=function(t,n){return n.amount-t.amount},o={attendees:null!=r?r.filter(function(t){return"aap"===t.type}).map(a).sort(u):void 0,addons:null!=r?r.filter(function(t){return"addon"===t.type}).map(a):void 0},i=function(){return e(o.attendees.map(f))+v()},c=function(t){switch(!1){case"tax"!==t.type:return i()/100*t.amount
case"fee"!==t.type:return e(o.attendees.map(function(t){return t.quantity}))*t.amount
default:return 0}},l=function(){return e(r.map(c))},s=function(t){var n,e,a
return null!=(n=null!=(e=r.filter(function(n){return"aap"===n.type&&n.name===t.name}))&&null!=(a=e[0])?a.amount:void 0)?n:0},f=function(t){return s(t)*t.quantity},d=function(t){return e(o.addons.filter(function(n){return n.name===t.name}).map(function(t){return t.amount}))},m=function(t){return d(t)*t.quantity},v=function(){return e(o.addons.map(m))},p=function(){var t,n,e
return t=i(),n=function(){switch(!1){case!(h.codes[0].amountOff<t):return h.codes[0].amountOff
default:return t}},e=function(){switch(!1){case 0!==h.codes.length:return 0
case null==h.codes[0].amountOff:return n()
case null==h.codes[0].percentOff:return t/100*h.codes[0].percentOff
default:return 0}}()},y=function(){return i()+l()-p()},h={codes:[],calc:p,remove:function(t){var n
return n=h.codes.indexOf(t),n>-1?h.codes.splice(n,1):void 0},add:function(e){var r,a
if(0!==(null!=(r=h.code)?r:"").length)return h.error="",a=function(t){var r
return r=function(){return h.codes.push(t),h.code="",h.success=!0,n(function(){var t
return t=h.success,delete h.success,t},3e3),""},h.error=function(){switch(!1){case!(0!==t.maxRedemptions&&t.maxRedemptions<=t.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(t.redeemBy),"minutes")>0):return"This coupon is expired"
case!(t.activities.length>0&&t.activities[0]!==e):return"This coupon is not valid for this activity."
default:return r()}}()},t.get("coupon/"+h.code).success(function(t){return a(t)}).error(function(t){var n,e
return h.error=null!=(n=null!=t&&null!=(e=t.errors)?e[0]:void 0)?n:"Coupon not found"})},code:""},{coupon:h,addons:o.addons,attendees:o.attendees,totalWithoutTaxesfees:i,calcCoupon:p,calcTaxFee:c,calcTaxesFees:l,showPrice:s,calcPrice:f,showAddonPrice:d,calcAddonPrice:m,totalAddons:v,calcSubtotal:i,calcTotal:y}}})
