// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
function curry$(n,e){var t,r=function(u){return n.length>1?function(){var a=u?u.concat():[]
return t=e?t||this:this,a.push.apply(a,arguments)<n.length&&arguments.length?r.call(t,a):n.apply(t,a)}:n}
return r()}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var a=u?u.concat():[]
return t=e?t||this:this,a.push.apply(a,arguments)<n.length&&arguments.length?r.call(t,a):n.apply(t,a)}:n}
return r()}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var a=u?u.concat():[]
return t=e?t||this:this,a.push.apply(a,arguments)<n.length&&arguments.length?r.call(t,a):n.apply(t,a)}:n}
return r()}function in$(n,e){for(var t=-1,r=e.length>>>0;++t<r;)if(n===e[t])return!0
return!1}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var a=u?u.concat():[]
return t=e?t||this:this,a.push.apply(a,arguments)<n.length&&arguments.length?r.call(t,a):n.apply(t,a)}:n}
return r()}function compose$(){var n=arguments
return function(){var e,t
for(t=n[0].apply(this,arguments),e=1;e<n.length;++e)t=n[e](t)
return t}}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var a=u?u.concat():[]
return t=e?t||this:this,a.push.apply(a,arguments)<n.length&&arguments.length?r.call(t,a):n.apply(t,a)}:n}
return r()}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var a=u?u.concat():[]
return t=e?t||this:this,a.push.apply(a,arguments)<n.length&&arguments.length?r.call(t,a):n.apply(t,a)}:n}
return r()}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var a=u?u.concat():[]
return t=e?t||this:this,a.push.apply(a,arguments)<n.length&&arguments.length?r.call(t,a):n.apply(t,a)}:n}
return r()}function in$(n,e){for(var t=-1,r=e.length>>>0;++t<r;)if(n===e[t])return!0
return!1}function bind$(n,e,t){return function(){return(t||n)[e].apply(n,arguments)}}function curry$(n,e){var t,r=function(u){return n.length>1?function(){var a=u?u.concat():[]
return t=e?t||this:this,a.push.apply(a,arguments)<n.length&&arguments.length?r.call(t,a):n.apply(t,a)}:n}
return r()}function compose$(){var n=arguments
return function(){var e,t
for(t=n[0].apply(this,arguments),e=1;e<n.length;++e)t=n[e](t)
return t}}angular.module("ablsdk",[]),angular.module("ablsdk").service("ablcalc",function(n,e,t,r,u){var a
return a=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
default:return t.sum(n)}},function(r,o,i){var c,l,s,f,d,p,m,h,v,y,g,b,w,D,k,$,S,A,T,x,C,M,O,I,E,_,Y,N
return c=null!=(l=null!=o?o.filter(function(n){return"active"===n.status}):void 0)?l:[],s=null!=(l=null!=r?r.filter(function(n){return"active"===n.status}):void 0)?l:[],f=function(n){var e
return{name:n.name,quantity:null!=(e=n.count)?e:0,amount:n.amount}},d=function(n,e){return e.amount-n.amount},p=function(n){return{name:n[0].name,amount:n[0].amount,quantity:n.length,_ids:t.map(function(n){return n._id})(n)}},m=function(n){return t.sortWith(d)(t.map(p)(t.map(function(n){return n[1]})(t.objToPairs(t.groupBy(function(n){return n.name+n.amount})(t.filter(function(e){return e.type===n})(c))))))},h=curry$(function(n,e){var r
return r=t.find(function(n){return e.name===n.name&&e.amount===n.amount})(m(n)),null!=r&&(r.old=!0),null==r}),v=function(n){return t.sortWith(d)(t.filter(h(n))(t.map(f)(t.filter(function(e){return e.type===n})(s))))},y=function(n){return t.concat(t.map(function(e){return e(n)})([m,v]))},u(function(){return y("aap").length>0}),u(function(){var n
return n=t.head(y("app")),n?null==n.amount||null==n.quantity||null==n.name?!1:void 0:!0}),g={attendees:y("aap"),addons:y("addon")},b=function(){return t.sum(t.map(function(n){return n.amount})(Y.list))},w=function(){return a(g.attendees.map(S))+b()+x()},D=function(n){switch(!1){case"tax"!==n.type:return w()/100*n.amount
case"fee"!==n.type:return a(g.attendees.map(function(n){return n.quantity}))*n.amount
default:return 0}},k=function(){return a(s.map(D))},$=function(n){var e,t,r
return null!=(e=null!=(t=s.filter(function(e){return"aap"===e.type&&e.name===n.name}))&&null!=(r=t[0])?r.amount:void 0)?e:0},S=function(n){return $(n)*n.quantity},A=function(n){return a(g.addons.filter(function(e){return e.name===n.name}).map(function(n){return n.amount}))},T=function(n){return A(n)*n.quantity},x=function(){return a(g.addons.map(T))},C=function(){var n,e,t
return n=w(),e=function(){switch(!1){case!(N.codes[0].amountOff<n):return N.codes[0].amountOff
default:return n}},t=function(){switch(!1){case 0!==N.codes.length:return 0
case null==N.codes[0].amountOff:return e()
case null==N.codes[0].percentOff:return n/100*N.codes[0].percentOff
default:return 0}}()},M=function(n,e){var t,r,u,a
return t="inactive"===n.status,r=n.type,u=n.old,e=function(){switch(!1){case"aap"!==r:return"pricing level"
case"addon"!==r:return"add-on"}}(),a=function(){switch(!1){case!(t&&"removed"===e):return"Warning: This "+e+" no longer exists. You can only reduce the quantity at this "+e+". If you wish to offer another "+e+" at this price, please create on Adjustment to currect the price."
case!(u&&"changed"===e):return"Warning: This "+e+" has changed since the booking was created. You can only reduce the quantity at this "+e+". If you wish to offer the old "+e+", please create an Adjustment."
case!((t||u)&&"mutated"===e):return!0
default:return""}}()},O=function(){return w()+k()-C()},I=function(){return t.sum(t.map(function(n){return n.amount})(c))},E=t.sum(t.map(function(n){return n.amount})(null!=i?i:[])),_=function(){return-(O()-E)},Y={list:t.filter(function(n){return"adjustment"===n.type})(c),add:function(n){var e
return e=angular.copy(n),e.amount*=100,Y.list.push(e)},removable:function(n){return null==n._id},remove:function(n){var e
return e=Y.list.indexOf(n),Y.list.splice(e,1)}},N={codes:[],calc:C,remove:function(n){var e
return e=N.codes.indexOf(n),e>-1?N.codes.splice(e,1):void 0},add:function(t){var r,u
if(0!==(null!=(r=N.code)?r:"").length&&(N.code=N.code.toUpperCase(),N.error=function(){switch(!1){case 0!==N.code.length:return"Code is required"
case!(N.code.length<6):return"6 chars are required"
default:return""}}(),!(N.error.length>0)))return u=function(n){var r
return r=function(){return N.codes.push(n),N.code="",N.success="Coupon "+n.couponId+" added successfully",e(function(){var n
return n=N.success,delete N.success,n},3e3),""},N.error=function(){switch(!1){case!(0!==n.maxRedemptions&&n.maxRedemptions<=n.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(n.redeemBy),"minutes")>0):return"This coupon is expired"
case!(n.activities.length>0&&n.activities[0]!==t):return"This coupon is not valid for this activity."
default:return r()}}()},n.get("coupon/"+N.code).success(function(n){return u(n)}).error(function(n){var e,t
return N.error=null!=(e=null!=n&&null!=(t=n.errors)?t[0]:void 0)?e:"Coupon not found"})},code:""},{warning:M,coupon:N,adjustment:Y,addons:g.addons,attendees:g.attendees,totalWithoutTaxesfees:w,calcCoupon:C,calcTaxFee:D,calcTaxesFees:k,showPrice:$,calcPrice:S,showAddonPrice:A,calcAddonPrice:T,totalAddons:x,calcSubtotal:w,calcTotal:O,calcPreviousTotal:I,calcBalanceDue:_}}}),angular.module("ablsdk").service("ablapi",function(n){return{timeslots:function(e){var t
return t=$.param({activity:e.activityId,"status[event]":"all",dateRange:[moment(e.startTime).clone().startOf("day").startOf("month").toISOString(),moment(e.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),n.get("timeslots?"+t)}}}),angular.module("ablsdk").service("ablbook",function(n,t,r,u,a){return function(o,i){var c,l,s,f,d,p,m,h,v,y,g,b,w,D,k,$,S,A,T,x,C,M,O,I,E,_,Y,N
return c={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idenpotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:""}},calendar:{value:null,visible:!1,currentActivity:o,closed:function(n){return c.form.date.start=c.calendar.date.start,c.form.date.end=c.calendar.date.end,i("slot-chosen",n)}}},l=function(n){var e
return null!=n?(e=null!=(null!=n?n.format:void 0)?n:moment(n),parseInt(e.format("YYYYMMDD"))):null},s=function(n){var e
return e=function(){switch(!1){case null!==n.start:return"none"
case l(n.start)===l(n.end):return"different"
default:return"same"}}()},f=function(n){return!c.loading&&n.$valid},d=function(n){var e,t
for(e in I)if(I.hasOwnProperty(e)&&(t=_(n,e),(null!=t?t.length:void 0)>0))return t
return"Please check the form"},p=function(n){return c.form.error=n},m=function(){return p("")},h=function(n){return c.triedCheckout=!1,c.typingInput=n},v=function(){var n
return c.idenpotencyKey=(n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n())},v(),y=function(n){var e
return null!=(e=null!=n&&"function"==typeof n.filter?n.filter(function(n){return n.quantity>0}):void 0)?e:[]},g=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
case 0!==n.length:return 0
default:return n.reduce(function(n,e){return n+e})}},b=function(){return 0===g(c.calendar.calc.attendees.map(function(n){return n.quantity}))},w=function(n,e){var t
return t=function(){switch(!1){case 4!==n.length:return n+" "
case 9!==n.length:return n+" "
case 14!==n.length:return n+" "
case 19!==n.length:return n+" "
default:return n}}(),t+e},D=function(){var n,e,t,r
return n=event.target.value,e=null!=(t=null!=n?n.replace("/",""):void 0)?t:"",r=function(n){return null!=n?n:""},c.form.creditCard.expDate=function(){switch(!1){case 2!==e.length:return e[0]+e[1]+"/"
case!(e.length>2):return e[0]+e[1]+"/"+r(e[2])+r(e[3])
default:return e}}()},k=function(){var n
return n=o.timeslots.filter(function(n){return n._id===c.calendar._id})[0].eventId,n+"_"+c.calendar.date.origin},$=function(n){var e
return e=n.target.value,"undefined"!=typeof e?c.form.creditCard.card=function(n){return n.substr(0,19)}(t.fold(w,"")(function(n){return n.split(" ").join("")}(e))):void 0},S=function(u,a){var i,l,s,f
return"undefined"==typeof u?(c.loading=!1,p("Stripe key is not defined")):(r.setPublishableKey(u),i=c.form.creditCard,l=i.expDate.split("/"),s=c.form,f={number:i.card,cvc:i.cvv,exp_month:l[0],exp_year:"20"+l[1],fullName:s.name,location:s.location,state:s.state},r.createToken(f,function(r,u){var i,l
return null!=r?(c.loading=!1,p(r)):(i=o,l={stripeToken:u,couponId:c.calendar.calc.coupon.codes.length>0?c.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:"credit",eventInstanceId:k(),addons:t.pairsToObj(t.map(function(n){return[n._id,n.quantity]})(c.calendar.calc.addons)),attendees:t.pairsToObj(t.map(function(n){return[n.name,n.quantity]})(c.calendar.calc.attendees)),answers:t.pairsToObj(t.map(function(n){return[n._id,n.answer]})(c.calendar.questions)),adjustments:c.calendar.calc.adjustment.list,fullName:s.name,email:s.email,phoneNumber:s.phone,notes:s.notes,location:s.location,currency:"usd",_customHeaders:{"Idempotency-Key":c.idenpotencyKey}},n.post("bookings",l).success(function(n){var t,r
return null!=n.bookingId?(v(),a(n)):p(null!=(t=null!=(r=e.errors)?r[0]:void 0)?t:"Server error")}).error(function(n){var e,t
return p(null!=(e=null!=(t=n.errors)?t[0]:void 0)?e:"Server error")})["finally"](function(){return c.loading=!1}))}))},A=function(){return n.get("payments/setup")},T=function(n){return u("validate"),c.loading!==!0?(c.triedCheckout=!0,f(n)?void 0:p(d(n))):void 0},x=function(n){return c.loading!==!0?(c.triedCheckout=!0,f(n)?(c.loading=!0,A().success(function(n){return S(n.publicKey,function(n){return c.booking=n,i("success",n)})}).error(function(n){return c.loading=!1,p(n),i("error",p)})):p(d(n))):void 0},C=function(){return c.form.agreed=!c.form.agreed,E()},M=function(n){return n.required||n.pattern||n.minlength||n.maxlength||n.phone},O=function(n,e){var t,r,u
switch(!1){case!e.required:return null!=(t=null!=(r=I[n])&&null!=(u=r.message)?u.required:void 0)?t:n+" is required"
case!e.pattern:return"Please follow the example "+I[n].example
case!e.minlength:return n+" is too short"
case!e.maxlength:return n+" is too long"
case!e.phone:return n+" is not valid phone number"
default:return"please check "+n}},I={email:{pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email"},name:{pattern:"",example:"Your name",placeholder:"Name"},phone:{pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234"},address:{pattern:"",example:"Address",placeholder:"Home address"},notes:{pattern:"",example:"Notes",placeholder:"Notes"},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",placeholder:"Credit Card Number"},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",placeholder:"Exp Date (MM/DD)"},startDate:{},cvv:{pattern:/[0-9]{3,4}/i,example:"000",placeholder:"CVV"},agreed:{pattern:"true",message:{required:"Please accept the terms and conditions"}}},E=function(){return c.form.agreed?c.triedCheckout=!0:void 0},_=function(n,e){var t,r,u,a,o,i,l
if(c.triedCheckout===!0){for(t in I)if(I.hasOwnProperty(t)&&(r=null!=(u=n[t])?u.$error:void 0,r&&M(r)))return t===e?O(t,r):""
return""}for(t in I)if(I.hasOwnProperty(t)&&(r=null!=(a=n[t])?a.$error:void 0,r&&M(r)&&r.maxlength))return t===e?O(t,r):""
return c.typingInput===e&&null!=(null!=(o=n[e])&&null!=(i=o.$error)?i.pattern:void 0)&&(null!=(l=I[e].example)?l.length:void 0)>0?"":void 0},Y=function(n){return c.typingInput===n?I[n].example:I[n].placeholder},a(function(){var n,e
return n=c.form,n.email="test@debug.com",n.name="Test User",n.phone="+380665243646",n.address="664 Cypress Lane, Campbell, CA, United States",n.notes="Some test notes",e=c.form.creditCard,e.card="5105 1051 0510 5100",e.expDate="05/17",e.cvv="333",c.form.agreed=!0}),N=c,N.investigateDate=s,N.getEventInstanceId=k,N.placeholder=Y,N.closeError=m,N.checkout=x,N.validate=T,N.agree=C,N.fields=I,N.few=y,N.expDateChanged=D,N.cardChanged=$,N.disabledOrder=b,N.typing=h,N.message=_,c}}),angular.module("ablsdk").service("browser",function(n){var e
return e=function(){var e,t,r
e=n.navigator.userAgent,t={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in t)if(t[r].test(n.navigator.userAgent))return r
return"unknown"},{name:e()}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(n,e,t,r,u,a,o){return function(i,c){var l,s,f,d,p,m,h,v,y,g,b,w,D,k,$,S,A,T
return l=i.split("@"),i=l[0],s={loading:!1,frontendify:function(n,e){var t,r,u
return t=e.split("/"),r=t[t.length-1],u=function(){switch(!1){case"Array"!==toString$.call(n).slice(8,-1):return n
case"Array"!==toString$.call(n[r]).slice(8,-1):return n[r]
case"Object"!==toString$.call(n).slice(8,-1):return[n]
default:return[]}}()}},f={localStorage:{remove:function(n){},add:function(n){},update:function(n){},fetch:function(n){}},memory:{remove:function(n){return y(n)},add:function(n,e){return Array.prototype.push.call(v,n),"function"==typeof e?e(n):void 0},update:function(n,e){return"function"==typeof e?e(n):void 0},fetch:function(){return s.loading=!1}},backend:{remove:function(e){return n["delete"](i+"/"+e._id).success(function(){return y(e)})},update:function(e,t){return n.update(i+"/"+e._id,e).success(function(n){return s.loading=!1,"function"==typeof t?t(n):void 0})},add:function(e,r){return n.create(i,e).success(function(n){return t("backend-success",n),D(n),"function"==typeof r?r(n):void 0})},fetch:function(){var e
return t("fetch",m(i),v.options),e=angular.copy(v.options),delete e.$url,n.get(m(i),{params:e}).success(function(n,e,t){var r,u
return v.length=0,r=function(n){var e,r,u
if(e=t()[n],null!=e){r=document.createElement("a"),r.href=t()[n]
try{return JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(a){return u=a,void console.error(u,r.search)}}},v.options.total=(u=r("x-last-page-url"),null!=u?parseInt(u.page)*parseInt(u.pageSize):n.length),v.options.pageSize=(u=r("x-first-page-url"),null!=u?parseInt(u.pageSize):n.length),s.loading=!1,D(n)})}}},d=f[null!=(p=l[1])?p:"backend"],m=function(n){var e,t,r
return e={url:n},t=function(n){return e.url=e.url.replace(":"+n[0],n[1])},r=v.getOptions().$url,null!=r&&o.each(t)(o.objToPairs(r)),e.url},h=e.$new(),h.items=[],v=h.items,s.loading=!1,y=function(n){var e
return e=v.indexOf(n),e>-1?Array.prototype.splice.call(v,e,1):void 0},g=function(n,e){return null!=n._id?b(n,e):w(n,e)},b=function(n,e){return s.loading?void 0:d.update(n,e)},w=function(n,e){return s.loading?void 0:d.add(n,e)},D=function(n){var e,t,r
switch(e=s.frontendify(n,i),t=toString$.call(e).slice(8,-1)){case"Array":Array.prototype.push.apply(v,e)
break
case"Object":r=function(n){return v[n[0]]=n[1]},o.each(r)(o.objToPairs(e))}return s.loading=!1},v.options={},v.converter=function(n){return s.frontendify=n.frontendify,s.backendify=n.backendify,v},v.getOptions=function(){return v.options},k=function(n){if(!s.loading){switch(toString$.call(n).slice(8,-1)){case"Function":return v.getOptions=n,k({})
case"Number":v.options.page=n
break
case"Object":v.options=angular.extend({},v.getOptions(),n)}return s.loading=!0,null!=v.options.page&&(1===v.options.page?delete v.options.page:v.options.page-=1),d.fetch()}},k(c),$=function(){var n
if(!s.loading)return n=Array.prototype.splice.apply(v,arguments),n.forEach(d.remove)},S=function(n,e,t){var u,a
if(!s.loading)return u={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},r.show(r.confirm().title(null!=(a=null!=t?t.title:void 0)?a:u.title).content(null!=(a=null!=t?t.content:void 0)?a:u.content).ok(null!=(a=null!=t?t.ok:void 0)?a:u.ok).cancel(null!=(a=null!=t?t.cancel:void 0)?a:u.cancel).targetEvent(e)).then(function(){return d.remove(n)},function(){})},A=[],T=function(n){var e,t
return e=[],t=curry$(function(t,r){var u,a
return u=[],T(u),a=function(){var e
return e=Array.prototype[t].call(n,r),u.length=0,Array.prototype.push.apply(u,e)},e.push(a),a(),u}),n.loading=function(){return s.loading},n.toArray=function(){var e
return e=[],Array.prototype.push.apply(e,n),e},n.fetchOn=function(e,t){return t.$watch(e,bind$(v,"fetch"),!0),n},n.watch=function(t,r){var o
return o=function(){return u(function(){return e.forEach(function(n){return n()})})},null!=r?(A.push({array:r[t],func:o}),r.$watch(t,o,!0)):(A.push({array:t,func:o}),a.watch(t,o)),n},n.watch(n),["map","filter"].forEach(function(e){return n[e]=t(e)}),n.push=w,n.save=g,n.fetch=k,n.remove=S,n.splice=$,n.toArray=function(){return angular.copy(n)}},v.listen=function(n){return n.$on("$destroy",function(){var n,e,t,r,u=[]
for(n=0,t=(e=A).length;t>n;++n)r=e[n],u.push(a.unwatch(r.array,r.func))
return u}),v},T(v),v}}),angular.module("ablsdk").service("abldate",function(n){return function(n){var e,t
return e=function(n,e){var t,r
return t=bind$(moment(n),"format"),r=bind$(e,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},t=function(e,t){return e.add(moment(t).tz(n).utcOffset()-e.utcOffset(),"minute")},{backendify:function(r){var u
return u=e(r,moment().tz(n)).tz(n),t(u),u.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(r){var u
return u=moment(r).tz(n),t(u,u),e(u,moment(r)).toDate()}}}}),angular.module("ablsdk").filter("capitalize",function(){return function(n){return angular.isString(n)&&n.length>0?n.charAt(0).toUpperCase()+n.substr(1).toLowerCase():n}}).filter("capitalizeAll",function(){return function(n){return angular.isString(n)&&n.length>0?n.split(" ").map(function(n){return n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()}).join(" "):n}}),angular.module("ablsdk").service("ablfacade",function(n,e){return function(t,r){var u,a
return u=n(t,r),a=e(t,u.calendar),{book:u,slot:a}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(n){return function(e){var t
if(n)switch(toString$.call(e).slice(8,-1)){case"Function":return e()
default:return"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,arguments):void 0}}})
var toString$={}.toString
angular.module("ablsdk").service("p",function(){var n,e
return n=function(e){var t
return[].concat.apply([],function(){var r,u,a,o=[]
for(r=0,a=(u=e).length;a>r;++r)t=u[r],"Array"===toString$.call(t).slice(8,-1)?o.push(n(t)):o.push(t)
return o}())},{head:e=function(n){return n[0]},each:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)u=e[t],n(u)
return e}),isItNaN:function(n){return n!==n},all:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],!n(u))return!1
return!0}),map:curry$(function(n,e){return e.map(n)}),fold:curry$(function(n,e,t){var r,u,a
for(r=0,u=t.length;u>r;++r)a=t[r],e=n(e,a)
return e}),filter:curry$(function(n,e){var t,r,u,a=[]
for(t=0,r=e.length;r>t;++t)u=e[t],n(u)&&a.push(u)
return a}),find:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return u}),pairsToObj:function(n){var e,t,r,u={}
for(e=0,t=n.length;t>e;++e)r=n[e],u[r[0]]=r[1]
return u},objToPairs:function(n){var e,t,r=[]
for(e in n)t=n[e],r.push([e,t])
return r},values:function(n){var e,t,r=[]
for(e in n)t=n[e],r.push(t)
return r},any:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return!0
return!1}),notAny:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return!1
return!0}),sum:function(n){var e,t,r,u
for(e=0,t=0,r=n.length;r>t;++t)u=n[t],e+=u
return e},sort:function(n){return n.concat().sort(function(n,e){return n>e?1:e>n?-1:0})},concat:function(n){return[].concat.apply([],n)},concatMap:curry$(function(n,e){var t
return[].concat.apply([],function(){var r,u,a,o=[]
for(r=0,a=(u=e).length;a>r;++r)t=u[r],o.push(n(t))
return o}())}),flatten:n,groupBy:curry$(function(n,e){var t,r,u,a,o
for(t={},r=0,u=e.length;u>r;++r)a=e[r],o=n(a),o in t?t[o].push(a):t[o]=[a]
return t}),sortWith:curry$(function(n,e){return e.concat().sort(n)}),sortBy:curry$(function(n,e){return e.concat().sort(function(e,t){return n(e)>n(t)?1:n(e)<n(t)?-1:0})}),reverse:function(n){return n.concat().reverse()},split:curry$(function(n,e){return e.split(n)}),join:curry$(function(n,e){return e.join(n)}),lines:function(n){return n.length?n.split("\n"):[]},unlines:function(n){return n.join("\n")},words:function(n){return n.length?n.split(/[ ]+/):[]},unwords:function(n){return n.join(" ")},chars:function(n){return n.split("")},unchars:function(n){return n.join("")},repeat:curry$(function(n,e){var t,r
for(t="",r=0;n>r;++r)t+=e
return t}),capitalize:function(n){return n.charAt(0).toUpperCase()+n.slice(1)},camelize:function(n){return n.replace(/[-_]+(.)?/g,function(n,e){return(null!=e?e:"").toUpperCase()})},dasherize:function(n){return n.replace(/([^-A-Z])([A-Z]+)/g,function(n,e,t){return e+"-"+(t.length>1?t:t.toLowerCase())}).replace(/^([A-Z]+)/,function(n,e){return e.length>1?e+"-":e.toLowerCase()})}}}),angular.module("ablsdk").service("formula",function(n,e){var t,r
return t=function(e,t){var r,u
return r=null!=(u=null!=t?t.charges:void 0)?u:[],function(n){var e
return null!=(e=null!=n?n.amount:void 0)?e:0}(n.find(function(n){return n.type===e||n.subtype===e||n.description===e})(r))},r=function(e){var t,r,u,a,o,i,c,l
return(null!=e&&null!=(t=e.timeslots)?t.length:void 0)>0?(r=function(n){return[].concat.apply([],n)},u=function(e){var t,r
return t="Adult",n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(n.filter(function(n){return n.type===t||n.subtype===t||n.description===t})(null!=(r=null!=e?e.charges:void 0)?r:[])))},a=function(e){var t
return n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(null!=(t=null!=e?e.charges:void 0)?t:[]))},o=r(e.timeslots.map(u)),i=r(e.timeslots.map(a)),c=function(n){return Math.max.apply(Math,n)},l=function(){switch(!1){case!(o.length>0):return c(o)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(n){return t("Adult",n)},getVisualPrice:r,getAdultPrice:function(n){var e
return t("Adult",null!=n&&null!=(e=n.timeslots)?e[0]:void 0)},getYouthPrice:function(n){var e
return t("Youth",null!=n&&null!=(e=n.timeslots)?e[0]:void 0)}}}),angular.module("ablsdk").filter("mdate",function(n){return function(n,e){return null!=n?n.format(e):null}}),angular.module("ablsdk").factory("prefill",function(n,e,t){return function(r){return n(function(){return t.prefill=function(){var n
return n=arguments,e(function(){return r.apply(null,n)})},null!=t.parent?t.parent.prefill=t.prefill:void 0})}}),angular.module("ablsdk").service("safeApply",function(n){return function(e){var t
return t=n.$$phase,"$apply"===t||"$digest"===t?e():n.$apply(e)}}),angular.module("ablsdk").service("test",function(n){return function(e){return n(function(){var n
if(n=e(),n!==!0)throw"[FAILED TEST]"+e.toString()})}}),angular.module("ablsdk").filter("price",function(n){return function(e){return n("currency")(e/100)}})
var toString$={}.toString
angular.module("ablsdk").service("typecheck",function(n,e){var t,r,u,a,o,i,c,l,s,f
return r=/[\$\w]+/,function(){function n(n){var e
if(e=n[0],null==e)throw new Error("Unexpected end of input.")
return e}return n}(),function(){function n(n){var e
if(e=peek(n),!r.test(e))throw new Error("Expected text, got '"+e+"' instead.")
return n.shift()}return n}(),function(){function n(n,e){var t
if(t=peek(n),t!==e)throw new Error("Expected '"+e+"', got '"+t+"' instead.")
return n.shift()}return n}(),function(){function n(n,e){var t
return t=n[0],t===e?n.shift():null}return n}(),function(){function n(n){var e
if(consumeOp(n,"["),"]"===peek(n))throw new Error("Must specify type of Array - eg. [Type], got [] instead.")
return e=consumeTypes(n),consumeOp(n,"]"),{structure:"array",of:e}}return n}(),function(){function n(n){var e
if(e=[],consumeOp(n,"("),")"===peek(n))throw new Error("Tuple must be of at least length 1 - eg. (Type), got () instead.")
for(;e.push(consumeTypes(n)),maybeConsumeOp(n,","),")"!==peek(n););return consumeOp(n,")"),{structure:"tuple",of:e}}return n}(),function(){function n(n){var e,t,r,u,a
for(e={},consumeOp(n,"{"),t=!1;;){if(maybeConsumeOp(n,"...")){t=!0
break}if(r=consumeField(n),u=r[0],a=r[1],e[u]=a,maybeConsumeOp(n,","),"}"===peek(n))break}return consumeOp(n,"}"),{structure:"fields",of:e,subset:t}}return n}(),function(){function n(n){var e,t
return e=consumeIdent(n),consumeOp(n,":"),t=consumeTypes(n),[e,t]}return n}(),function(){function n(n){switch(n[0]){case"[":return consumeArray(n)
case"(":return consumeTuple(n)
case"{":return consumeFields(n)}}return n}(),function(){function n(n){var e,t,u,a
if(e=peek(n),t="*"===e,t||r.test(e))return u=t?consumeOp(n,"*"):consumeIdent(n),a=maybeConsumeStructure(n),a?(a.type=u,a):{type:u}
if(a=maybeConsumeStructure(n),!a)throw new Error("Unexpected character: "+e)
return a}return n}(),function(){function n(n){var e,t,r,u,a
if("::"===peek(n))throw new Error("No comment before comment separator '::' found.")
for(e=n[1],null!=e&&"::"===e&&(n.shift(),n.shift()),t=[],r={},"Maybe"===peek(n)&&(n.shift(),t=[{type:"Undefined"},{type:"Null"}],r={Undefined:!0,Null:!0});u=consumeType(n),a=u.type,r[a]||t.push(u),r[a]=!0,maybeConsumeOp(n,"|"););return t}return n}(),u=RegExp("\\.\\.\\.|::|->|"+r.source+"|\\S","g"),t=function(n){var e,t
if(!n.length)throw new Error("No type specified.")
if(e=n.match(u)||[],in$("->",e))throw new Error("Function types are not supported. To validate that something is a function, you may use 'Function'.")
try{return consumeTypes(e)}catch(r){throw t=r,new Error(t.message+" - Remaining tokens: "+JSON.stringify(e)+" - Initial input: '"+n+"'")}},o=e.any,i=e.all,c=e.isItNaN,l={Number:{typeOf:"Number",validate:function(n){return!c(n)}},NaN:{typeOf:"Number",validate:c},Int:{typeOf:"Number",validate:function(n){return!c(n)&&n%1===0}},Float:{typeOf:"Number",validate:function(n){return!c(n)}},Date:{typeOf:"Date",validate:function(n){return!c(n.getTime())}}},s={array:"Array",tuple:"Array"},function(){function n(n,e){return i(function(n){return checkMultiple(n,e.of)},n)}return n}(),function(){function n(n,e){var t,r,u,a,o
for(t=0,r=0,a=(u=e.of).length;a>r;++r){if(o=u[r],!checkMultiple(n[t],o))return!1
t++}return n.length<=t}return n}(),function(){function n(n,e){var t,r,u,a,o,i,c
t={},r=0
for(u in n)t[u]=!0,r++
a=0
for(o in i=e.of){if(c=i[o],!checkMultiple(n[o],c))return!1
t[o]&&a++}return e.subset||r===a}return n}(),function(){function n(n,e){if(!(n instanceof Object))return!1
switch(e.structure){case"fields":return checkFields(n,e)
case"array":return checkArray(n,e)
case"tuple":return checkTuple(n,e)}}return n}(),function(){function n(n,e){var t,r,u,a
if(t=e.type,r=e.structure,t)return"*"===t?!0:(u=f[t]||l[t],u?u.typeOf===toString$.call(n).slice(8,-1)&&u.validate(n):t===toString$.call(n).slice(8,-1)&&(!r||checkStructure(n,e)))
if(r)return(a=s[r])&&a!==toString$.call(n).slice(8,-1)?!1:checkStructure(n,e)
throw new Error("No type defined. Input: "+n+".")}return n}(),function(){function n(n,e){if("Array"!==toString$.call(e).slice(8,-1))throw new Error("Types must be in an array. Input: "+n+".")
return o(function(e){return check(n,e)},e)}return n}(),a=function(n,e,t){return null==t&&(t={}),f=t.customTypes||{},checkMultiple(e,n)},function(e,r,u){return n(function(){return a(t(e),r,u)})}}),angular.module("ablsdk").service("ablslot",function(abldate,ablcalc,ablapi,formula,p,debug,$xabl){return function(activity,inputModel){var transformCharge,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,performChooseSlot,actualEvent,isEmpty,slotsByDay,select,isFitToSlot,isNotFitToAnySlot,inPast,createMonth,startMonth,setCalendars,scroll,nextMonth,calendar,loadEvents,isDummy,isDisabledDay,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,calendarUp,calendarDown,setup,move,createEventInstanceId,model,slots,calendars,activeSlots,x$,ref$
return transformCharge=function(n){return{_id:n._id,name:n.name,quantity:0,amount:n.amount}},getDay=function(n){var e
return null!=n?(e=null!=(null!=n?n.format:void 0)?n:moment(n),parseInt(e.format("YYYYMMDD"))):null},newDate=function(){var n
return n=moment.apply(null,arguments).tz(activity.timeZone)},generateCalendar=function(n,e){var t,r,u,a,o,i,c,l
return t=newDate(n),r=t.year(),u=t.month(),a=function(n){return newDate([r,u,n])},o=t.endOf("month").date(),i=p.map(a)(function(){var n,e,t=[]
for(n=1,e=o;e>=n;++n)t.push(n)
return t}()),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var n,e,t=[]
for(n=1,e=c;e>=n;++n)t.push(n)
return t}()),{time:t,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(n){return Math.ceil(getDay(n)/100)},hackDate=function(n,e){var t,r
return t=bind$(moment(n),"format"),r=bind$(e,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(n,e){var t,r
return t=null!=n?n:hackDate(n,moment()),r=null!=e?e:hackDate(e,moment()),moment([t.year(),t.month(),t.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var available
return available="inactive"===slot.status?0:slot.available-eval([0].concat(model.calc.attendees.map(function(n){return n.quantity})).join("+"))}),performChooseSlot=function(n){var e,t,r,u,a,o,i
if(0!==n.available)return e=model.value,t=merge(e,n.startTime),model.date.start=t,r=abldate(activity.timeZone),model.date.origin=r.backendify(model.date.start).replace(/[\:-]/gi,""),model.date.end=n.endTime,model.charges=n.charges,model.calc=ablcalc(n.charges.concat(activity.charges)),model._id=n._id,model.eventId=null!=(u=activity.timeslots.filter(function(e){return e._id===n._id}))&&null!=(a=u[0])?a.eventId:void 0,o=model.attendees,i=function(n){var e
return e=o.filter(function(e){return e.name===n.name}),{quantity:function(){switch(!1){case!(e.length>0):return e[0].quantity
case"Adult"!==n.name:return 1
default:return 0}}(),name:n.name,amount:n.amount}},model.attendees=n.charges.filter(function(n){return"aap"===n.type}).map(i),model.available=makeAvailable(n)},actualEvent=curry$(function(n,e){return getDay(e.startTime)===getDay(n)}),isEmpty=function(n){var e
return e=actualEvent(n),function(n){return 0===n.length}(p.filter(isFitToSlot(n))(slots))},slotsByDay=function(n){var e,t
return e=actualEvent(n),t=function(t){var r,u,a,o,i
return r=merge(n,t.startTime),u=t.endTime-t.startTime,a=p.find(e)(t.events),o=null!=(i=null!=a?a.available:void 0)?i:t.maxOcc,debug(null!=a?a.status:void 0),{status:null!=a?a.status:void 0,startTime:r,time:r.valueOf(),endTime:r.clone().add(u,"milliseconds"),charges:t.charges,price:formula.getVisualPrice({timeslots:[t]}),available:"inactive"===(null!=a?a.status:void 0)?0:o,_id:t._id,duration:moment.duration(u).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:t.maxOcc-o}},p.sortBy(function(n){return n.time})(p.map(t)(p.filter(isFitToSlot(n))(slots)))},select=function(n){return model.value=n,activeSlots.length=0,slotsByDay(n).forEach(function(n){return activeSlots.push(n)})},isFitToSlot=curry$(function(n,e){var t,r,u,a,o,i
return t=0===e.daysRunning.length,r=activity,u=function(){switch(!1){case!(getDay(e.startTime)!==getDay(n)&&t):return!0
case!(getDay(e.startTime)>getDay(n)&&!t):return!0
case!(getDay(e.untilTime)<getDay(n)&&!t):return!0
default:return!1}}(),a=function(n){var e,t
return e=null!=n&&"function"==typeof n.day?n.day():void 0,t=function(){switch(!1){case null!==e:return null
case 0!==e:return 6
default:return e-1}}()},o=!t&&p.notAny(function(e){return e===a(n)})(e.daysRunning),i=function(){switch(!1){case!o:return!1
case!u:return!1
default:return!0}}()}),isNotFitToAnySlot=function(n){switch(!1){case!p.notAny(function(n){return n.available>0})(slotsByDay(n)):return!0
case!p.notAny(isFitToSlot(n))(slots):return!0
default:return!1}},inPast=function(n){return getDay(n)<getDay(newDate())||n.diff(newDate(),"hours")<24},createMonth=function(n){return newDate([n.year(),n.month(),15])},startMonth=createMonth(newDate()),setCalendars=function(n,e,t){return calendars.length=0,calendars.push(n),calendars.push(e),loadEvents(t)},scroll={activeDate:function(){var n,e,t,r,u,a
return scroll.activeDate=function(){},n=calendars[0],e=function(e){return generateCalendar(n.time.clone().add(e,"month"))},t=function(t){return 0===t?n:e(t)},r=function(n){return"undefined"!=typeof p.find(function(n){return!isDisabledDay(n)})(t(n).days)},u=function(n){return function(){var e,t,r=[]
for(e=1,t=n;t>=e;++e)r.push(e)
return r}().forEach(bind$(calendar,"down"))},a=p.find(r)([0,1,2,3,4,5,6]),a>0?u(a):void 0}},nextMonth=function(n,e){return date.clone().add(e,"months")},calendar={first:startMonth,second:startMonth.clone().add(1,"months"),move:function(n){return calendar.first=calendar.first.clone().add(n,"month"),calendar.second=calendar.second.clone().add(n,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},loadEvents=function(n){return ablapi.timeslots({startTime:calendars[0].time,endTime:calendars[1].time,activityId:activity._id}).success(function(e){var t,r,u
return t=abldate(activity.timeZone),r=compose$(t.frontendify,moment),u=function(n){return n.startTime=r(n.startTime),n.endTime=r(n.endTime),n.untilTime=r(n.untilTime),n},slots.length=0,e.timeslots.map(u).forEach(function(n){return slots.push(n)}),scroll.activeDate(),"function"==typeof n?n():void 0})},isDummy=function(n){switch(!1){case null!==n:return!0
default:return!1}},isDisabledDay=function(n){switch(!1){case!isDummy(n):return!0
case!isEmpty(n):return!0
case!inPast(n):return!0
case!isNotFitToAnySlot(n):return!0
default:return!1}},selectDay=function(n){return isDisabledDay(n)?void 0:(select(n),performChooseSlot(slots[0]))},notSelected=function(){switch(!1){case null!==model.date.start:return!0
case model.chosen!==!1:return!0
default:return!1}},disabledSlot=function(n){switch(!1){case 0!==n.available:return"This event is full"
default:return""}},notAvailableSlot=function(n){return n.available<=0},close=function(n){var e
return e=function(n){return 0===n.quantity&&"Adult"===n.name?n.quantity=1:void 0},model.attendees.forEach(e),model.chosen=n,model.visible=!1,"function"==typeof model.closed&&model.closed(n),debug("close",model)},chooseSlot=function(n){return notAvailableSlot(n)?void 0:(performChooseSlot(n),close(!0))},isActiveDay=function(n){return getDay(n)===getDay(model.value)},isDisabledMonth=function(n){switch(!1){case!(getDay(n)<getDay(newDate())):return!0
default:return!1}},isActiveMonth=function(n){return getMonth(n)===getMonth(model.value)},isCalendarUpDisabled=function(){return getMonth(calendars[0].time)<getMonth(newDate())},calendarUp=function(){return isCalendarUpDisabled()?void 0:calendar.up()},calendarDown=function(){return calendar.down()},setup=function(){return setCalendars(generateCalendar(startMonth.clone()),generateCalendar(startMonth.clone().add(1,"month")),function(){return selectDay(model.value)})},move=function(n){return $xabl.put("bookings/move/"+n,{eventInstanceId:createEventInstanceId()})},createEventInstanceId=function(){var n
return n=abldate(activity.timeZone),model.eventId+"_"+n.backendify(model.date.start).replace(/[\:-]/gi,"")},model=null!=inputModel?inputModel:{},slots=[],calendars=[],activeSlots=[],x$=model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(n){return"addon"===n.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,setup(),{model:model,activeSlots:activeSlots,move:move,selectDay:selectDay,calendars:calendars,createEventInstanceId:createEventInstanceId,calendarUp:calendarUp,calendarDown:calendarDown,close:close,isActiveMonth:isActiveMonth,isDisabledDay:isDisabledDay,isDisabledMonth:isDisabledMonth,isCalendarUpDisabled:isCalendarUpDisabled,isDummy:isDummy,isActiveDay:isActiveDay,notSelected:notSelected,chooseSlot:chooseSlot,notAvailableSlot:notAvailableSlot,disabledSlot:disabledSlot}}}),angular.module("ablsdk").service("watcher",function(n,e,t){var r,u,a
return r=function(){return{unwatch:function(n,e){return"function"==typeof e.unwatch?e.unwatch():void 0},watch:function(e,t){var r
return r=n.$new(),r.array=e,t.unwatch=r.$watch("array",t,!0)}}},u=function(){return{unwatch:function(n,e){return Array.unobserve(n,e)},watch:function(e,t){var r,u,a
return r=function(){var e
return e=n.$new(),function(n,t){return e.array=n,e.$watch("array",t)}},(u=null!=(a=Array.observe)?a:r())(e,t)}}},a=function(){switch(!1){case"firefox"!==e.name:return r()
case"unknown"!==e.name:return r()
case"safari"!==e.name:return r()
default:return r()}}()}),angular.module("ablsdk").factory("stripe",function(n,e){var t,r
if(t={},r=function(){var n
return t.setPublishableKey=Stripe.setPublishableKey,n=Stripe.card,t.createToken=function(t,r){var u,a,o,i
return n.validateCardNumber(t.number)?n.validateExpiry(t.exp_month,t.exp_year)?n.validateCVC(t.cvc)?n.createToken({number:t.number,cvc:t.cvc,exp_month:t.exp_month,exp_year:t.exp_year,name:t.fullName,address_line1:null!=(u=t.location)?u.street_address:void 0,address_city:null!=(a=t.location)?a.city:void 0,address_country:null!=(o=t.location)?o.country:void 0,state:null!=(i=t.location)?i.state:void 0},function(n,t){return e(null!=t.id?function(){return r(null,t.id)}:function(){return r(t.error.message)})}):r("CVV is not correct. Your CVV number can be located by looking on your credit or debit card"):r("Expiration Month/Year is not correct"):r("Card number is not correct")}},"undefined"==typeof window.Stripe)throw'please add <script src="https://js.stripe.com/v2/"></script>'
return r(),t}),angular.module("ablsdk",[]),angular.module("ablsdk").service("ablcalc",function(n,e,t,r,u){var a
return a=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
default:return t.sum(n)}},function(r,o,i){var c,l,s,f,d,p,m,h,v,y,g,b,w,D,k,$,S,A,T,x,C,M,O,I,E,_,Y,N
return c=null!=(l=null!=o?o.filter(function(n){return"active"===n.status}):void 0)?l:[],s=null!=(l=null!=r?r.filter(function(n){return"active"===n.status}):void 0)?l:[],f=function(n){var e
return{name:n.name,quantity:null!=(e=n.count)?e:0,amount:n.amount}},d=function(n,e){return e.amount-n.amount},p=function(n){return{name:n[0].name,amount:n[0].amount,quantity:n.length,_ids:t.map(function(n){return n._id})(n)}},m=function(n){return t.sortWith(d)(t.map(p)(t.map(function(n){return n[1]})(t.objToPairs(t.groupBy(function(n){return n.name+n.amount})(t.filter(function(e){return e.type===n})(c))))))},h=curry$(function(n,e){var r
return r=t.find(function(n){return e.name===n.name&&e.amount===n.amount})(m(n)),null!=r&&(r.old=!0),null==r}),v=function(n){return t.sortWith(d)(t.filter(h(n))(t.map(f)(t.filter(function(e){return e.type===n})(s))))},y=function(n){return t.concat(t.map(function(e){return e(n)})([m,v]))},u(function(){return y("aap").length>0}),u(function(){var n
return n=t.head(y("app")),n?null==n.amount||null==n.quantity||null==n.name?!1:void 0:!0}),g={attendees:y("aap"),addons:y("addon")},b=function(){return t.sum(t.map(function(n){return n.amount})(Y.list))},w=function(){return a(g.attendees.map(S))+b()+x()},D=function(n){switch(!1){case"tax"!==n.type:return w()/100*n.amount
case"fee"!==n.type:return a(g.attendees.map(function(n){return n.quantity}))*n.amount
default:return 0}},k=function(){return a(s.map(D))},$=function(n){var e,t,r
return null!=(e=null!=(t=s.filter(function(e){return"aap"===e.type&&e.name===n.name}))&&null!=(r=t[0])?r.amount:void 0)?e:0},S=function(n){return $(n)*n.quantity},A=function(n){return a(g.addons.filter(function(e){return e.name===n.name}).map(function(n){return n.amount}))},T=function(n){return A(n)*n.quantity},x=function(){return a(g.addons.map(T))},C=function(){var n,e,t
return n=w(),e=function(){switch(!1){case!(N.codes[0].amountOff<n):return N.codes[0].amountOff
default:return n}},t=function(){switch(!1){case 0!==N.codes.length:return 0
case null==N.codes[0].amountOff:return e()
case null==N.codes[0].percentOff:return n/100*N.codes[0].percentOff
default:return 0}}()},M=function(n,e){var t,r,u,a
return t="inactive"===n.status,r=n.type,u=n.old,e=function(){switch(!1){case"aap"!==r:return"pricing level"
case"addon"!==r:return"add-on"}}(),a=function(){switch(!1){case!(t&&"removed"===e):return"Warning: This "+e+" no longer exists. You can only reduce the quantity at this "+e+". If you wish to offer another "+e+" at this price, please create on Adjustment to currect the price."
case!(u&&"changed"===e):return"Warning: This "+e+" has changed since the booking was created. You can only reduce the quantity at this "+e+". If you wish to offer the old "+e+", please create an Adjustment."
case!((t||u)&&"mutated"===e):return!0
default:return""}}()},O=function(){return w()+k()-C()},I=function(){return t.sum(t.map(function(n){return n.amount})(c))},E=t.sum(t.map(function(n){return n.amount})(null!=i?i:[])),_=function(){return-(O()-E)},Y={list:t.filter(function(n){return"adjustment"===n.type})(c),add:function(n){var e
return e=angular.copy(n),e.amount*=100,Y.list.push(e)},removable:function(n){return null==n._id},remove:function(n){var e
return e=Y.list.indexOf(n),Y.list.splice(e,1)}},N={codes:[],calc:C,remove:function(n){var e
return e=N.codes.indexOf(n),e>-1?N.codes.splice(e,1):void 0},add:function(t){var r,u
if(0!==(null!=(r=N.code)?r:"").length&&(N.code=N.code.toUpperCase(),N.error=function(){switch(!1){case 0!==N.code.length:return"Code is required"
case!(N.code.length<6):return"6 chars are required"
default:return""}}(),!(N.error.length>0)))return u=function(n){var r
return r=function(){return N.codes.push(n),N.code="",N.success="Coupon "+n.couponId+" added successfully",e(function(){var n
return n=N.success,delete N.success,n},3e3),""},N.error=function(){switch(!1){case!(0!==n.maxRedemptions&&n.maxRedemptions<=n.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(n.redeemBy),"minutes")>0):return"This coupon is expired"
case!(n.activities.length>0&&n.activities[0]!==t):return"This coupon is not valid for this activity."
default:return r()}}()},n.get("coupon/"+N.code).success(function(n){return u(n)}).error(function(n){var e,t
return N.error=null!=(e=null!=n&&null!=(t=n.errors)?t[0]:void 0)?e:"Coupon not found"})},code:""},{warning:M,coupon:N,adjustment:Y,addons:g.addons,attendees:g.attendees,totalWithoutTaxesfees:w,calcCoupon:C,calcTaxFee:D,calcTaxesFees:k,showPrice:$,calcPrice:S,showAddonPrice:A,calcAddonPrice:T,totalAddons:x,calcSubtotal:w,calcTotal:O,calcPreviousTotal:I,calcBalanceDue:_}}}),angular.module("ablsdk").service("ablapi",function(n){return{timeslots:function(e){var t
return t=$.param({activity:e.activityId,"status[event]":"all",dateRange:[moment(e.startTime).clone().startOf("day").startOf("month").toISOString(),moment(e.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),n.get("timeslots?"+t)}}}),angular.module("ablsdk").service("ablbook",function(n,t,r,u,a){return function(o,i){var c,l,s,f,d,p,m,h,v,y,g,b,w,D,k,$,S,A,T,x,C,M,O,I,E,_,Y,N
return c={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idenpotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:""}},calendar:{value:null,visible:!1,currentActivity:o,closed:function(n){return c.form.date.start=c.calendar.date.start,c.form.date.end=c.calendar.date.end,i("slot-chosen",n)}}},l=function(n){var e
return null!=n?(e=null!=(null!=n?n.format:void 0)?n:moment(n),parseInt(e.format("YYYYMMDD"))):null},s=function(n){var e
return e=function(){switch(!1){case null!==n.start:return"none"
case l(n.start)===l(n.end):return"different"
default:return"same"}}()},f=function(n){return!c.loading&&n.$valid},d=function(n){var e,t
for(e in I)if(I.hasOwnProperty(e)&&(t=_(n,e),(null!=t?t.length:void 0)>0))return t
return"Please check the form"},p=function(n){return c.form.error=n},m=function(){return p("")},h=function(n){return c.triedCheckout=!1,c.typingInput=n},v=function(){var n
return c.idenpotencyKey=(n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n())},v(),y=function(n){var e
return null!=(e=null!=n&&"function"==typeof n.filter?n.filter(function(n){return n.quantity>0}):void 0)?e:[]},g=function(n){switch(!1){case"undefined"!=typeof n:return 0
case null!==typeof n:return 0
case 0!==n.length:return 0
default:return n.reduce(function(n,e){return n+e})}},b=function(){return 0===g(c.calendar.calc.attendees.map(function(n){return n.quantity}))},w=function(n,e){var t
return t=function(){switch(!1){case 4!==n.length:return n+" "
case 9!==n.length:return n+" "
case 14!==n.length:return n+" "
case 19!==n.length:return n+" "
default:return n}}(),t+e},D=function(){var n,e,t,r
return n=event.target.value,e=null!=(t=null!=n?n.replace("/",""):void 0)?t:"",r=function(n){return null!=n?n:""},c.form.creditCard.expDate=function(){switch(!1){case 2!==e.length:return e[0]+e[1]+"/"
case!(e.length>2):return e[0]+e[1]+"/"+r(e[2])+r(e[3])
default:return e}}()},k=function(){var n
return n=o.timeslots.filter(function(n){return n._id===c.calendar._id})[0].eventId,n+"_"+c.calendar.date.origin},$=function(n){var e
return e=n.target.value,"undefined"!=typeof e?c.form.creditCard.card=function(n){return n.substr(0,19)}(t.fold(w,"")(function(n){return n.split(" ").join("")}(e))):void 0},S=function(u,a){var i,l,s,f
return"undefined"==typeof u?(c.loading=!1,p("Stripe key is not defined")):(r.setPublishableKey(u),i=c.form.creditCard,l=i.expDate.split("/"),s=c.form,f={number:i.card,cvc:i.cvv,exp_month:l[0],exp_year:"20"+l[1],fullName:s.name,location:s.location,state:s.state},r.createToken(f,function(r,u){var i,l
return null!=r?(c.loading=!1,p(r)):(i=o,l={stripeToken:u,couponId:c.calendar.calc.coupon.codes.length>0?c.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:"credit",eventInstanceId:k(),addons:t.pairsToObj(t.map(function(n){return[n._id,n.quantity]})(c.calendar.calc.addons)),attendees:t.pairsToObj(t.map(function(n){return[n.name,n.quantity]})(c.calendar.calc.attendees)),answers:t.pairsToObj(t.map(function(n){return[n._id,n.answer]})(c.calendar.questions)),adjustments:c.calendar.calc.adjustment.list,fullName:s.name,email:s.email,phoneNumber:s.phone,notes:s.notes,location:s.location,currency:"usd",_customHeaders:{"Idempotency-Key":c.idenpotencyKey}},n.post("bookings",l).success(function(n){var t,r
return null!=n.bookingId?(v(),a(n)):p(null!=(t=null!=(r=e.errors)?r[0]:void 0)?t:"Server error")}).error(function(n){var e,t
return p(null!=(e=null!=(t=n.errors)?t[0]:void 0)?e:"Server error")})["finally"](function(){return c.loading=!1}))}))},A=function(){return n.get("payments/setup")},T=function(n){return u("validate"),c.loading!==!0?(c.triedCheckout=!0,f(n)?void 0:p(d(n))):void 0},x=function(n){return c.loading!==!0?(c.triedCheckout=!0,f(n)?(c.loading=!0,A().success(function(n){return S(n.publicKey,function(n){return c.booking=n,i("success",n)})}).error(function(n){return c.loading=!1,p(n),i("error",p)})):p(d(n))):void 0},C=function(){return c.form.agreed=!c.form.agreed,E()},M=function(n){return n.required||n.pattern||n.minlength||n.maxlength||n.phone},O=function(n,e){var t,r,u
switch(!1){case!e.required:return null!=(t=null!=(r=I[n])&&null!=(u=r.message)?u.required:void 0)?t:n+" is required"
case!e.pattern:return"Please follow the example "+I[n].example
case!e.minlength:return n+" is too short"
case!e.maxlength:return n+" is too long"
case!e.phone:return n+" is not valid phone number"
default:return"please check "+n}},I={email:{pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email"},name:{pattern:"",example:"Your name",placeholder:"Name"},phone:{pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234"},address:{pattern:"",example:"Address",placeholder:"Home address"},notes:{pattern:"",example:"Notes",placeholder:"Notes"},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",placeholder:"Credit Card Number"},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",placeholder:"Exp Date (MM/DD)"},startDate:{},cvv:{pattern:/[0-9]{3,4}/i,example:"000",placeholder:"CVV"},agreed:{pattern:"true",message:{required:"Please accept the terms and conditions"}}},E=function(){return c.form.agreed?c.triedCheckout=!0:void 0},_=function(n,e){var t,r,u,a,o,i,l
if(c.triedCheckout===!0){for(t in I)if(I.hasOwnProperty(t)&&(r=null!=(u=n[t])?u.$error:void 0,r&&M(r)))return t===e?O(t,r):""
return""}for(t in I)if(I.hasOwnProperty(t)&&(r=null!=(a=n[t])?a.$error:void 0,r&&M(r)&&r.maxlength))return t===e?O(t,r):""
return c.typingInput===e&&null!=(null!=(o=n[e])&&null!=(i=o.$error)?i.pattern:void 0)&&(null!=(l=I[e].example)?l.length:void 0)>0?"":void 0},Y=function(n){return c.typingInput===n?I[n].example:I[n].placeholder},a(function(){var n,e
return n=c.form,n.email="test@debug.com",n.name="Test User",n.phone="+380665243646",n.address="664 Cypress Lane, Campbell, CA, United States",n.notes="Some test notes",e=c.form.creditCard,e.card="5105 1051 0510 5100",e.expDate="05/17",e.cvv="333",c.form.agreed=!0}),N=c,N.investigateDate=s,N.getEventInstanceId=k,N.placeholder=Y,N.closeError=m,N.checkout=x,N.validate=T,N.agree=C,N.fields=I,N.few=y,N.expDateChanged=D,N.cardChanged=$,N.disabledOrder=b,N.typing=h,N.message=_,c}}),angular.module("ablsdk").service("browser",function(n){var e
return e=function(){var e,t,r
e=n.navigator.userAgent,t={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in t)if(t[r].test(n.navigator.userAgent))return r
return"unknown"},{name:e()}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(n,e,t,r,u,a,o){return function(i,c){var l,s,f,d,p,m,h,v,y,g,b,w,D,k,$,S,A,T
return l=i.split("@"),i=l[0],s={loading:!1,frontendify:function(n,e){var t,r,u
return t=e.split("/"),r=t[t.length-1],u=function(){switch(!1){case"Array"!==toString$.call(n).slice(8,-1):return n
case"Array"!==toString$.call(n[r]).slice(8,-1):return n[r]
case"Object"!==toString$.call(n).slice(8,-1):return[n]
default:return[]}}()}},f={localStorage:{remove:function(n){},add:function(n){},update:function(n){},fetch:function(n){}},memory:{remove:function(n){return y(n)},add:function(n,e){return Array.prototype.push.call(v,n),"function"==typeof e?e(n):void 0},update:function(n,e){return"function"==typeof e?e(n):void 0},fetch:function(){return s.loading=!1}},backend:{remove:function(e){return n["delete"](i+"/"+e._id).success(function(){return y(e)})},update:function(e,t){return n.update(i+"/"+e._id,e).success(function(n){return s.loading=!1,"function"==typeof t?t(n):void 0})},add:function(e,r){return n.create(i,e).success(function(n){return t("backend-success",n),D(n),"function"==typeof r?r(n):void 0})},fetch:function(){var e
return t("fetch",m(i),v.options),e=angular.copy(v.options),delete e.$url,n.get(m(i),{params:e}).success(function(n,e,t){var r,u
return v.length=0,r=function(n){var e,r,u
if(e=t()[n],null!=e){r=document.createElement("a"),r.href=t()[n]
try{return JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(a){return u=a,void console.error(u,r.search)}}},v.options.total=(u=r("x-last-page-url"),null!=u?parseInt(u.page)*parseInt(u.pageSize):n.length),v.options.pageSize=(u=r("x-first-page-url"),null!=u?parseInt(u.pageSize):n.length),s.loading=!1,D(n)})}}},d=f[null!=(p=l[1])?p:"backend"],m=function(n){var e,t,r
return e={url:n},t=function(n){return e.url=e.url.replace(":"+n[0],n[1])},r=v.getOptions().$url,null!=r&&o.each(t)(o.objToPairs(r)),e.url},h=e.$new(),h.items=[],v=h.items,s.loading=!1,y=function(n){var e
return e=v.indexOf(n),e>-1?Array.prototype.splice.call(v,e,1):void 0},g=function(n,e){return null!=n._id?b(n,e):w(n,e)},b=function(n,e){return s.loading?void 0:d.update(n,e)},w=function(n,e){return s.loading?void 0:d.add(n,e)},D=function(n){var e,t,r
switch(e=s.frontendify(n,i),t=toString$.call(e).slice(8,-1)){case"Array":Array.prototype.push.apply(v,e)
break
case"Object":r=function(n){return v[n[0]]=n[1]},o.each(r)(o.objToPairs(e))}return s.loading=!1},v.options={},v.converter=function(n){return s.frontendify=n.frontendify,s.backendify=n.backendify,v},v.getOptions=function(){return v.options},k=function(n){if(!s.loading){switch(toString$.call(n).slice(8,-1)){case"Function":return v.getOptions=n,k({})
case"Number":v.options.page=n
break
case"Object":v.options=angular.extend({},v.getOptions(),n)}return s.loading=!0,null!=v.options.page&&(1===v.options.page?delete v.options.page:v.options.page-=1),d.fetch()}},k(c),$=function(){var n
if(!s.loading)return n=Array.prototype.splice.apply(v,arguments),n.forEach(d.remove)},S=function(n,e,t){var u,a
if(!s.loading)return u={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},r.show(r.confirm().title(null!=(a=null!=t?t.title:void 0)?a:u.title).content(null!=(a=null!=t?t.content:void 0)?a:u.content).ok(null!=(a=null!=t?t.ok:void 0)?a:u.ok).cancel(null!=(a=null!=t?t.cancel:void 0)?a:u.cancel).targetEvent(e)).then(function(){return d.remove(n)},function(){})},A=[],T=function(n){var e,t
return e=[],t=curry$(function(t,r){var u,a
return u=[],T(u),a=function(){var e
return e=Array.prototype[t].call(n,r),u.length=0,Array.prototype.push.apply(u,e)},e.push(a),a(),u}),n.loading=function(){return s.loading},n.toArray=function(){var e
return e=[],Array.prototype.push.apply(e,n),e},n.fetchOn=function(e,t){return t.$watch(e,bind$(v,"fetch"),!0),n},n.watch=function(t,r){var o
return o=function(){return u(function(){return e.forEach(function(n){return n()})})},null!=r?(A.push({array:r[t],func:o}),r.$watch(t,o,!0)):(A.push({array:t,func:o}),a.watch(t,o)),n},n.watch(n),["map","filter"].forEach(function(e){return n[e]=t(e)}),n.push=w,n.save=g,n.fetch=k,n.remove=S,n.splice=$,n.toArray=function(){return angular.copy(n)}},v.listen=function(n){return n.$on("$destroy",function(){var n,e,t,r,u=[]
for(n=0,t=(e=A).length;t>n;++n)r=e[n],u.push(a.unwatch(r.array,r.func))
return u}),v},T(v),v}}),angular.module("ablsdk").service("abldate",function(n){return function(n){var e,t
return e=function(n,e){var t,r
return t=bind$(moment(n),"format"),r=bind$(e,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},t=function(e,t){return e.add(moment(t).tz(n).utcOffset()-e.utcOffset(),"minute")},{backendify:function(r){var u
return u=e(r,moment().tz(n)).tz(n),t(u),u.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(r){var u
return u=moment(r).tz(n),t(u,u),e(u,moment(r)).toDate()}}}}),angular.module("ablsdk").filter("capitalize",function(){return function(n){return angular.isString(n)&&n.length>0?n.charAt(0).toUpperCase()+n.substr(1).toLowerCase():n}}).filter("capitalizeAll",function(){return function(n){return angular.isString(n)&&n.length>0?n.split(" ").map(function(n){return n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()}).join(" "):n}}),angular.module("ablsdk").service("ablfacade",function(n,e){return function(t,r){var u,a
return u=n(t,r),a=e(t,u.calendar),{book:u,slot:a}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(n){return function(e){var t
if(n)switch(toString$.call(e).slice(8,-1)){case"Function":return e()
default:return"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,arguments):void 0}}})
var toString$={}.toString
angular.module("ablsdk").service("p",function(){var n,e
return n=function(e){var t
return[].concat.apply([],function(){var r,u,a,o=[]
for(r=0,a=(u=e).length;a>r;++r)t=u[r],"Array"===toString$.call(t).slice(8,-1)?o.push(n(t)):o.push(t)
return o}())},{head:e=function(n){return n[0]},each:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)u=e[t],n(u)
return e}),isItNaN:function(n){return n!==n},all:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],!n(u))return!1
return!0}),map:curry$(function(n,e){return e.map(n)}),fold:curry$(function(n,e,t){var r,u,a
for(r=0,u=t.length;u>r;++r)a=t[r],e=n(e,a)
return e}),filter:curry$(function(n,e){var t,r,u,a=[]
for(t=0,r=e.length;r>t;++t)u=e[t],n(u)&&a.push(u)
return a}),find:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return u}),pairsToObj:function(n){var e,t,r,u={}
for(e=0,t=n.length;t>e;++e)r=n[e],u[r[0]]=r[1]
return u},objToPairs:function(n){var e,t,r=[]
for(e in n)t=n[e],r.push([e,t])
return r},values:function(n){var e,t,r=[]
for(e in n)t=n[e],r.push(t)
return r},any:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return!0
return!1}),notAny:curry$(function(n,e){var t,r,u
for(t=0,r=e.length;r>t;++t)if(u=e[t],n(u))return!1
return!0}),sum:function(n){var e,t,r,u
for(e=0,t=0,r=n.length;r>t;++t)u=n[t],e+=u
return e},sort:function(n){return n.concat().sort(function(n,e){return n>e?1:e>n?-1:0})},concat:function(n){return[].concat.apply([],n)},concatMap:curry$(function(n,e){var t
return[].concat.apply([],function(){var r,u,a,o=[]
for(r=0,a=(u=e).length;a>r;++r)t=u[r],o.push(n(t))
return o}())}),flatten:n,groupBy:curry$(function(n,e){var t,r,u,a,o
for(t={},r=0,u=e.length;u>r;++r)a=e[r],o=n(a),o in t?t[o].push(a):t[o]=[a]
return t}),sortWith:curry$(function(n,e){return e.concat().sort(n)}),sortBy:curry$(function(n,e){return e.concat().sort(function(e,t){return n(e)>n(t)?1:n(e)<n(t)?-1:0})}),reverse:function(n){return n.concat().reverse()},split:curry$(function(n,e){return e.split(n)}),join:curry$(function(n,e){return e.join(n)}),lines:function(n){return n.length?n.split("\n"):[]},unlines:function(n){return n.join("\n")},words:function(n){return n.length?n.split(/[ ]+/):[]},unwords:function(n){return n.join(" ")},chars:function(n){return n.split("")},unchars:function(n){return n.join("")},repeat:curry$(function(n,e){var t,r
for(t="",r=0;n>r;++r)t+=e
return t}),capitalize:function(n){return n.charAt(0).toUpperCase()+n.slice(1)},camelize:function(n){return n.replace(/[-_]+(.)?/g,function(n,e){return(null!=e?e:"").toUpperCase()})},dasherize:function(n){return n.replace(/([^-A-Z])([A-Z]+)/g,function(n,e,t){return e+"-"+(t.length>1?t:t.toLowerCase())}).replace(/^([A-Z]+)/,function(n,e){return e.length>1?e+"-":e.toLowerCase()})}}}),angular.module("ablsdk").service("formula",function(n,e){var t,r
return t=function(e,t){var r,u
return r=null!=(u=null!=t?t.charges:void 0)?u:[],function(n){var e
return null!=(e=null!=n?n.amount:void 0)?e:0}(n.find(function(n){return n.type===e||n.subtype===e||n.description===e})(r))},r=function(e){var t,r,u,a,o,i,c,l
return(null!=e&&null!=(t=e.timeslots)?t.length:void 0)>0?(r=function(n){return[].concat.apply([],n)},u=function(e){var t,r
return t="Adult",n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(n.filter(function(n){return n.type===t||n.subtype===t||n.description===t})(null!=(r=null!=e?e.charges:void 0)?r:[])))},a=function(e){var t
return n.map(function(n){return n.amount})(n.filter(function(n){return"active"===n.status})(null!=(t=null!=e?e.charges:void 0)?t:[]))},o=r(e.timeslots.map(u)),i=r(e.timeslots.map(a)),c=function(n){return Math.max.apply(Math,n)},l=function(){switch(!1){case!(o.length>0):return c(o)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(n){return t("Adult",n)},getVisualPrice:r,getAdultPrice:function(n){var e
return t("Adult",null!=n&&null!=(e=n.timeslots)?e[0]:void 0)},getYouthPrice:function(n){var e
return t("Youth",null!=n&&null!=(e=n.timeslots)?e[0]:void 0)}}}),angular.module("ablsdk").filter("mdate",function(n){return function(n,e){return null!=n?n.format(e):null}}),angular.module("ablsdk").factory("prefill",function(n,e,t){return function(r){return n(function(){return t.prefill=function(){var n
return n=arguments,e(function(){return r.apply(null,n)})},null!=t.parent?t.parent.prefill=t.prefill:void 0})}}),angular.module("ablsdk").service("safeApply",function(n){return function(e){var t
return t=n.$$phase,"$apply"===t||"$digest"===t?e():n.$apply(e)}}),angular.module("ablsdk").service("test",function(n){return function(e){return n(function(){var n
if(n=e(),n!==!0)throw"[FAILED TEST]"+e.toString()})}}),angular.module("ablsdk").filter("price",function(n){return function(e){return n("currency")(e/100)}})
var toString$={}.toString
angular.module("ablsdk").service("typecheck",function(n,e){var t,r,u,a,o,i,c,l,s,f
return r=/[\$\w]+/,function(){function n(n){var e
if(e=n[0],null==e)throw new Error("Unexpected end of input.")
return e}return n}(),function(){function n(n){var e
if(e=peek(n),!r.test(e))throw new Error("Expected text, got '"+e+"' instead.")
return n.shift()}return n}(),function(){function n(n,e){var t
if(t=peek(n),t!==e)throw new Error("Expected '"+e+"', got '"+t+"' instead.")
return n.shift()}return n}(),function(){function n(n,e){var t
return t=n[0],t===e?n.shift():null}return n}(),function(){function n(n){var e
if(consumeOp(n,"["),"]"===peek(n))throw new Error("Must specify type of Array - eg. [Type], got [] instead.")
return e=consumeTypes(n),consumeOp(n,"]"),{structure:"array",of:e}}return n}(),function(){function n(n){var e
if(e=[],consumeOp(n,"("),")"===peek(n))throw new Error("Tuple must be of at least length 1 - eg. (Type), got () instead.")
for(;e.push(consumeTypes(n)),maybeConsumeOp(n,","),")"!==peek(n););return consumeOp(n,")"),{structure:"tuple",of:e}}return n}(),function(){function n(n){var e,t,r,u,a
for(e={},consumeOp(n,"{"),t=!1;;){if(maybeConsumeOp(n,"...")){t=!0
break}if(r=consumeField(n),u=r[0],a=r[1],e[u]=a,maybeConsumeOp(n,","),"}"===peek(n))break}return consumeOp(n,"}"),{structure:"fields",of:e,subset:t}}return n}(),function(){function n(n){var e,t
return e=consumeIdent(n),consumeOp(n,":"),t=consumeTypes(n),[e,t]}return n}(),function(){function n(n){switch(n[0]){case"[":return consumeArray(n)
case"(":return consumeTuple(n)
case"{":return consumeFields(n)}}return n}(),function(){function n(n){var e,t,u,a
if(e=peek(n),t="*"===e,t||r.test(e))return u=t?consumeOp(n,"*"):consumeIdent(n),a=maybeConsumeStructure(n),a?(a.type=u,a):{type:u}
if(a=maybeConsumeStructure(n),!a)throw new Error("Unexpected character: "+e)
return a}return n}(),function(){function n(n){var e,t,r,u,a
if("::"===peek(n))throw new Error("No comment before comment separator '::' found.")
for(e=n[1],null!=e&&"::"===e&&(n.shift(),n.shift()),t=[],r={},"Maybe"===peek(n)&&(n.shift(),t=[{type:"Undefined"},{type:"Null"}],r={Undefined:!0,Null:!0});u=consumeType(n),a=u.type,r[a]||t.push(u),r[a]=!0,maybeConsumeOp(n,"|"););return t}return n}(),u=RegExp("\\.\\.\\.|::|->|"+r.source+"|\\S","g"),t=function(n){var e,t
if(!n.length)throw new Error("No type specified.")
if(e=n.match(u)||[],in$("->",e))throw new Error("Function types are not supported. To validate that something is a function, you may use 'Function'.")
try{return consumeTypes(e)}catch(r){throw t=r,new Error(t.message+" - Remaining tokens: "+JSON.stringify(e)+" - Initial input: '"+n+"'")}},o=e.any,i=e.all,c=e.isItNaN,l={Number:{typeOf:"Number",validate:function(n){return!c(n)}},NaN:{typeOf:"Number",validate:c},Int:{typeOf:"Number",validate:function(n){return!c(n)&&n%1===0}},Float:{typeOf:"Number",validate:function(n){return!c(n)}},Date:{typeOf:"Date",validate:function(n){return!c(n.getTime())}}},s={array:"Array",tuple:"Array"},function(){function n(n,e){return i(function(n){return checkMultiple(n,e.of)},n)}return n}(),function(){function n(n,e){var t,r,u,a,o
for(t=0,r=0,a=(u=e.of).length;a>r;++r){if(o=u[r],!checkMultiple(n[t],o))return!1
t++}return n.length<=t}return n}(),function(){function n(n,e){var t,r,u,a,o,i,c
t={},r=0
for(u in n)t[u]=!0,r++
a=0
for(o in i=e.of){if(c=i[o],!checkMultiple(n[o],c))return!1
t[o]&&a++}return e.subset||r===a}return n}(),function(){function n(n,e){if(!(n instanceof Object))return!1
switch(e.structure){case"fields":return checkFields(n,e)
case"array":return checkArray(n,e)
case"tuple":return checkTuple(n,e)}}return n}(),function(){function n(n,e){var t,r,u,a
if(t=e.type,r=e.structure,t)return"*"===t?!0:(u=f[t]||l[t],u?u.typeOf===toString$.call(n).slice(8,-1)&&u.validate(n):t===toString$.call(n).slice(8,-1)&&(!r||checkStructure(n,e)))
if(r)return(a=s[r])&&a!==toString$.call(n).slice(8,-1)?!1:checkStructure(n,e)
throw new Error("No type defined. Input: "+n+".")}return n}(),function(){function n(n,e){if("Array"!==toString$.call(e).slice(8,-1))throw new Error("Types must be in an array. Input: "+n+".")
return o(function(e){return check(n,e)},e)}return n}(),a=function(n,e,t){return null==t&&(t={}),f=t.customTypes||{},checkMultiple(e,n)},function(e,r,u){return n(function(){return a(t(e),r,u)})}}),angular.module("ablsdk").service("ablslot",function(abldate,ablcalc,ablapi,formula,p,debug,$xabl){return function(activity,inputModel){var transformCharge,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,performChooseSlot,actualEvent,isEmpty,slotsByDay,select,isFitToSlot,isNotFitToAnySlot,inPast,createMonth,startMonth,setCalendars,scroll,nextMonth,calendar,loadEvents,isDummy,isDisabledDay,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,calendarUp,calendarDown,setup,move,createEventInstanceId,model,slots,calendars,activeSlots,x$,ref$
return transformCharge=function(n){return{_id:n._id,name:n.name,quantity:0,amount:n.amount}},getDay=function(n){var e
return null!=n?(e=null!=(null!=n?n.format:void 0)?n:moment(n),parseInt(e.format("YYYYMMDD"))):null},newDate=function(){var n
return n=moment.apply(null,arguments).tz(activity.timeZone)},generateCalendar=function(n,e){var t,r,u,a,o,i,c,l
return t=newDate(n),r=t.year(),u=t.month(),a=function(n){return newDate([r,u,n])},o=t.endOf("month").date(),i=p.map(a)(function(){var n,e,t=[]
for(n=1,e=o;e>=n;++n)t.push(n)
return t}()),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var n,e,t=[]
for(n=1,e=c;e>=n;++n)t.push(n)
return t}()),{time:t,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(n){return Math.ceil(getDay(n)/100)},hackDate=function(n,e){var t,r
return t=bind$(moment(n),"format"),r=bind$(e,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(n,e){var t,r
return t=null!=n?n:hackDate(n,moment()),r=null!=e?e:hackDate(e,moment()),moment([t.year(),t.month(),t.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var available
return available="inactive"===slot.status?0:slot.available-eval([0].concat(model.calc.attendees.map(function(n){return n.quantity})).join("+"))}),performChooseSlot=function(n){var e,t,r,u,a,o,i
if(0!==n.available)return e=model.value,t=merge(e,n.startTime),model.date.start=t,r=abldate(activity.timeZone),model.date.origin=r.backendify(model.date.start).replace(/[\:-]/gi,""),model.date.end=n.endTime,model.charges=n.charges,model.calc=ablcalc(n.charges.concat(activity.charges)),model._id=n._id,model.eventId=null!=(u=activity.timeslots.filter(function(e){return e._id===n._id}))&&null!=(a=u[0])?a.eventId:void 0,o=model.attendees,i=function(n){var e
return e=o.filter(function(e){return e.name===n.name}),{quantity:function(){switch(!1){case!(e.length>0):return e[0].quantity
case"Adult"!==n.name:return 1
default:return 0}}(),name:n.name,amount:n.amount}},model.attendees=n.charges.filter(function(n){return"aap"===n.type}).map(i),model.available=makeAvailable(n)},actualEvent=curry$(function(n,e){return getDay(e.startTime)===getDay(n)}),isEmpty=function(n){var e
return e=actualEvent(n),function(n){return 0===n.length}(p.filter(isFitToSlot(n))(slots))},slotsByDay=function(n){var e,t
return e=actualEvent(n),t=function(t){var r,u,a,o,i
return r=merge(n,t.startTime),u=t.endTime-t.startTime,a=p.find(e)(t.events),o=null!=(i=null!=a?a.available:void 0)?i:t.maxOcc,debug(null!=a?a.status:void 0),{status:null!=a?a.status:void 0,startTime:r,time:r.valueOf(),endTime:r.clone().add(u,"milliseconds"),charges:t.charges,price:formula.getVisualPrice({timeslots:[t]}),available:"inactive"===(null!=a?a.status:void 0)?0:o,_id:t._id,duration:moment.duration(u).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:t.maxOcc-o}},p.sortBy(function(n){return n.time})(p.map(t)(p.filter(isFitToSlot(n))(slots)))},select=function(n){return model.value=n,activeSlots.length=0,slotsByDay(n).forEach(function(n){return activeSlots.push(n)})},isFitToSlot=curry$(function(n,e){var t,r,u,a,o,i
return t=0===e.daysRunning.length,r=activity,u=function(){switch(!1){case!(getDay(e.startTime)!==getDay(n)&&t):return!0
case!(getDay(e.startTime)>getDay(n)&&!t):return!0
case!(getDay(e.untilTime)<getDay(n)&&!t):return!0
default:return!1}}(),a=function(n){var e,t
return e=null!=n&&"function"==typeof n.day?n.day():void 0,t=function(){switch(!1){case null!==e:return null
case 0!==e:return 6
default:return e-1}}()},o=!t&&p.notAny(function(e){return e===a(n)})(e.daysRunning),i=function(){switch(!1){case!o:return!1
case!u:return!1
default:return!0}}()}),isNotFitToAnySlot=function(n){switch(!1){case!p.notAny(function(n){return n.available>0})(slotsByDay(n)):return!0
case!p.notAny(isFitToSlot(n))(slots):return!0
default:return!1}},inPast=function(n){return getDay(n)<getDay(newDate())||n.diff(newDate(),"hours")<24},createMonth=function(n){return newDate([n.year(),n.month(),15])},startMonth=createMonth(newDate()),setCalendars=function(n,e,t){return calendars.length=0,calendars.push(n),calendars.push(e),loadEvents(t)},scroll={activeDate:function(){var n,e,t,r,u,a
return scroll.activeDate=function(){},n=calendars[0],e=function(e){return generateCalendar(n.time.clone().add(e,"month"))},t=function(t){return 0===t?n:e(t)},r=function(n){return"undefined"!=typeof p.find(function(n){return!isDisabledDay(n)})(t(n).days)},u=function(n){return function(){var e,t,r=[]
for(e=1,t=n;t>=e;++e)r.push(e)
return r}().forEach(bind$(calendar,"down"))},a=p.find(r)([0,1,2,3,4,5,6]),a>0?u(a):void 0}},nextMonth=function(n,e){return date.clone().add(e,"months")},calendar={first:startMonth,second:startMonth.clone().add(1,"months"),move:function(n){return calendar.first=calendar.first.clone().add(n,"month"),calendar.second=calendar.second.clone().add(n,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},loadEvents=function(n){return ablapi.timeslots({startTime:calendars[0].time,endTime:calendars[1].time,activityId:activity._id}).success(function(e){var t,r,u
return t=abldate(activity.timeZone),r=compose$(t.frontendify,moment),u=function(n){return n.startTime=r(n.startTime),n.endTime=r(n.endTime),n.untilTime=r(n.untilTime),n},slots.length=0,e.timeslots.map(u).forEach(function(n){return slots.push(n)}),scroll.activeDate(),"function"==typeof n?n():void 0})},isDummy=function(n){switch(!1){case null!==n:return!0
default:return!1}},isDisabledDay=function(n){switch(!1){case!isDummy(n):return!0
case!isEmpty(n):return!0
case!inPast(n):return!0
case!isNotFitToAnySlot(n):return!0
default:return!1}},selectDay=function(n){return isDisabledDay(n)?void 0:(select(n),performChooseSlot(slots[0]))},notSelected=function(){switch(!1){case null!==model.date.start:return!0
case model.chosen!==!1:return!0
default:return!1}},disabledSlot=function(n){switch(!1){case 0!==n.available:return"This event is full"
default:return""}},notAvailableSlot=function(n){return n.available<=0},close=function(n){var e
return e=function(n){return 0===n.quantity&&"Adult"===n.name?n.quantity=1:void 0},model.attendees.forEach(e),model.chosen=n,model.visible=!1,"function"==typeof model.closed&&model.closed(n),debug("close",model)},chooseSlot=function(n){return notAvailableSlot(n)?void 0:(performChooseSlot(n),close(!0))},isActiveDay=function(n){return getDay(n)===getDay(model.value)},isDisabledMonth=function(n){switch(!1){case!(getDay(n)<getDay(newDate())):return!0
default:return!1}},isActiveMonth=function(n){return getMonth(n)===getMonth(model.value)},isCalendarUpDisabled=function(){return getMonth(calendars[0].time)<getMonth(newDate())},calendarUp=function(){return isCalendarUpDisabled()?void 0:calendar.up()},calendarDown=function(){return calendar.down()},setup=function(){return setCalendars(generateCalendar(startMonth.clone()),generateCalendar(startMonth.clone().add(1,"month")),function(){return selectDay(model.value)})},move=function(n){return $xabl.put("bookings/move/"+n,{eventInstanceId:createEventInstanceId()})},createEventInstanceId=function(){var n
return n=abldate(activity.timeZone),model.eventId+"_"+n.backendify(model.date.start).replace(/[\:-]/gi,"")},model=null!=inputModel?inputModel:{},slots=[],calendars=[],activeSlots=[],x$=model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(n){return"addon"===n.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,setup(),{model:model,activeSlots:activeSlots,move:move,selectDay:selectDay,calendars:calendars,createEventInstanceId:createEventInstanceId,calendarUp:calendarUp,calendarDown:calendarDown,close:close,isActiveMonth:isActiveMonth,isDisabledDay:isDisabledDay,isDisabledMonth:isDisabledMonth,isCalendarUpDisabled:isCalendarUpDisabled,isDummy:isDummy,isActiveDay:isActiveDay,notSelected:notSelected,chooseSlot:chooseSlot,notAvailableSlot:notAvailableSlot,disabledSlot:disabledSlot}}}),angular.module("ablsdk").service("watcher",function(n,e,t){var r,u,a
return r=function(){return{unwatch:function(n,e){return"function"==typeof e.unwatch?e.unwatch():void 0},watch:function(e,t){var r
return r=n.$new(),r.array=e,t.unwatch=r.$watch("array",t,!0)}}},u=function(){return{unwatch:function(n,e){return Array.unobserve(n,e)},watch:function(e,t){var r,u,a
return r=function(){var e
return e=n.$new(),function(n,t){return e.array=n,e.$watch("array",t)}},(u=null!=(a=Array.observe)?a:r())(e,t)}}},a=function(){switch(!1){case"firefox"!==e.name:return r()
case"unknown"!==e.name:return r()
case"safari"!==e.name:return r()
default:return r()}}()}),angular.module("ablsdk").factory("stripe",function(n,e){var t,r
if(t={},r=function(){var n
return t.setPublishableKey=Stripe.setPublishableKey,n=Stripe.card,t.createToken=function(t,r){var u,a,o,i
return n.validateCardNumber(t.number)?n.validateExpiry(t.exp_month,t.exp_year)?n.validateCVC(t.cvc)?n.createToken({number:t.number,cvc:t.cvc,exp_month:t.exp_month,exp_year:t.exp_year,name:t.fullName,address_line1:null!=(u=t.location)?u.street_address:void 0,address_city:null!=(a=t.location)?a.city:void 0,address_country:null!=(o=t.location)?o.country:void 0,state:null!=(i=t.location)?i.state:void 0},function(n,t){return e(null!=t.id?function(){return r(null,t.id)}:function(){return r(t.error.message)})}):r("CVV is not correct. Your CVV number can be located by looking on your credit or debit card"):r("Expiration Month/Year is not correct"):r("Card number is not correct")}},"undefined"==typeof window.Stripe)throw'please add <script src="https://js.stripe.com/v2/"></script>'
return r(),t})
