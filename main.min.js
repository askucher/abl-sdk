// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
// Generated by LiveScript 1.3.1
function curry$(e,n){var t,r=function(a){return e.length>1?function(){var o=a?a.concat():[]
return t=n?t||this:this,o.push.apply(o,arguments)<e.length&&arguments.length?r.call(t,o):e.apply(t,o)}:e}
return r()}function bind$(e,n,t){return function(){return(t||e)[n].apply(e,arguments)}}function curry$(e,n){var t,r=function(a){return e.length>1?function(){var o=a?a.concat():[]
return t=n?t||this:this,o.push.apply(o,arguments)<e.length&&arguments.length?r.call(t,o):e.apply(t,o)}:e}
return r()}function bind$(e,n,t){return function(){return(t||e)[n].apply(e,arguments)}}function bind$(e,n,t){return function(){return(t||e)[n].apply(e,arguments)}}function curry$(e,n){var t,r=function(a){return e.length>1?function(){var o=a?a.concat():[]
return t=n?t||this:this,o.push.apply(o,arguments)<e.length&&arguments.length?r.call(t,o):e.apply(t,o)}:e}
return r()}function compose$(){var e=arguments
return function(){var n,t
for(t=e[0].apply(this,arguments),n=1;n<e.length;++n)t=e[n](t)
return t}}function curry$(e,n){var t,r=function(a){return e.length>1?function(){var o=a?a.concat():[]
return t=n?t||this:this,o.push.apply(o,arguments)<e.length&&arguments.length?r.call(t,o):e.apply(t,o)}:e}
return r()}function bind$(e,n,t){return function(){return(t||e)[n].apply(e,arguments)}}function curry$(e,n){var t,r=function(a){return e.length>1?function(){var o=a?a.concat():[]
return t=n?t||this:this,o.push.apply(o,arguments)<e.length&&arguments.length?r.call(t,o):e.apply(t,o)}:e}
return r()}function bind$(e,n,t){return function(){return(t||e)[n].apply(e,arguments)}}function bind$(e,n,t){return function(){return(t||e)[n].apply(e,arguments)}}function curry$(e,n){var t,r=function(a){return e.length>1?function(){var o=a?a.concat():[]
return t=n?t||this:this,o.push.apply(o,arguments)<e.length&&arguments.length?r.call(t,o):e.apply(t,o)}:e}
return r()}function compose$(){var e=arguments
return function(){var n,t
for(t=e[0].apply(this,arguments),n=1;n<e.length;++n)t=e[n](t)
return t}}angular.module("ablsdk",[]),angular.module("ablsdk").service("ablbook",function(e,n,t,r,a,o){return function(r,o){var u,i,c,l,s,d,f,m,p,v,h,y,g,b,D,w,$,x,S,C,k,A,M,T,I
return u={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idenpotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:""}},calendar:{value:null,visible:!1,currentActivity:r,closed:function(e){return u.form.date.start=u.calendar.date.start,u.form.date.end=u.calendar.date.end,o("slot-chosen",e)}}},i=function(e){var n
return null!=e?(n=null!=(null!=e?e.format:void 0)?e:moment(e),parseInt(n.format("YYYYMMDD"))):null},c=function(e){var n
return n=function(){switch(!1){case null!==e.start:return"none"
case i(e.start)===i(e.end):return"different"
default:return"same"}}()},l=function(e){return!u.loading&&e.$valid},s=function(e){return u.form.error=e},d=function(){return s("")},f=function(e){return u.triedCheckout=!1,u.typingInput=e},m=function(){var e
return u.idenpotencyKey=(e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e())},m(),p=function(e){var n
return null!=(n=null!=e&&"function"==typeof e.filter?e.filter(function(e){return e.quantity>0}):void 0)?n:[]},v=function(e){switch(!1){case"undefined"!=typeof e:return 0
case null!==typeof e:return 0
case 0!==e.length:return 0
default:return e.reduce(function(e,n){return e+n})}},h=function(){return 0===v(u.calendar.calc.attendees.map(function(e){return e.quantity}))},y=function(e,n){var t
return t=function(){switch(!1){case 4!==e.length:return e+" "
case 9!==e.length:return e+" "
case 14!==e.length:return e+" "
case 19!==e.length:return e+" "
default:return e}}(),t+n},g=function(){var e,n,t,r
return e=event.target.value,n=null!=(t=null!=e?e.replace("/",""):void 0)?t:"",r=function(e){return null!=e?e:""},u.form.creditCard.expDate=function(){switch(!1){case!(n.length>2):return n[0]+n[1]+"/"+r(n[2])+r(n[3])
default:return n}}()},b=function(e){var t
return t=e.target.value,"undefined"!=typeof t?u.form.creditCard.card=function(e){return e.substr(0,19)}(n.fold(y,"")(function(e){return e.split(" ").join("")}(t))):void 0},D=function(a,o){var i,c,l,d
return"undefined"==typeof a?(u.loading=!1,s("Stripe key is not defined")):(t.setPublishableKey(a),i=u.form.creditCard,c=i.expDate.split("/"),l=u.form,d={number:i.card,cvc:i.cvv,exp_month:c[0],exp_year:"20"+c[1],fullName:l.name,location:l.location,state:l.state},t.createToken(d,function(t,a){var i,c,d
return null!=t?(u.loading=!1,s(t)):(i=r,c=i.timeslots.filter(function(e){return e._id===u.calendar._id})[0].eventId,d={stripeToken:a,couponId:u.calendar.calc.coupon.codes.length>0?u.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:"credit",eventInstanceId:c+"_"+u.calendar.date.origin,addons:n.pairsToObj(n.map(function(e){return[e._id,e.quantity]})(u.calendar.calc.addons)),attendees:n.pairsToObj(n.map(function(e){return[e.name,e.quantity]})(u.calendar.calc.attendees)),answers:n.pairsToObj(n.map(function(e){return[e._id,e.answer]})(u.calendar.questions)),fullName:l.name,email:l.email,phoneNumber:l.phone,notes:l.notes,location:l.location,currency:"usd",_customHeaders:{"Idempotency-Key":u.idenpotencyKey}},e.post("bookings",d).success(function(e){return null!=e.bookingId?(m(),o()):s(e.error)}).error(function(e){var n,t
return s(null!=(n=null!=(t=e.errors)?t[0]:void 0)?n:"Server error")})["finally"](function(){return u.loading=!1}))}))},w=function(){return e.get("payments/setup")},$=function(e){return u.loading!==!0?(u.triedCheckout=!0,l(e)?(u.loading=!0,w().success(function(e){return D(e.publicKey,function(){return o("success",e)})}).error(function(e){return u.loading=!1,s(e),o("error",s)})):s("Please correct the form")):void 0},x=function(){return u.form.agreed=!u.form.agreed,A()},S=function(e){return e.required||e.pattern||e.minlength||e.maxlength||e.phone},C=function(e,n){switch(!1){case!n.required:return e+" is required"
case!n.pattern:return"Please follow the example "+k[e].example
case!n.minlength:return e+" is too short"
case!n.maxlength:return e+" is too long"
case!n.phone:return e+" is not valid phone number"
default:return"please check "+e}},k={email:{pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email"},name:{pattern:"",example:"Your name",placeholder:"Name"},phone:{pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234"},address:{pattern:"",example:"Address",placeholder:"Home address"},notes:{pattern:"",example:"Notes",placeholder:"Notes"},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",placeholder:"Card #"},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",placeholder:"Exp date"},startDate:{},cvv:{pattern:/[0-9]{3,4}/i,example:"000",placeholder:"CVV"}},A=function(){return u.form.agreed?u.triedCheckout=!0:void 0},M=function(e,n){var t,r,a,o,i,c,l
if(u.triedCheckout===!0){for(t in k)if(k.hasOwnProperty(t)&&(r=null!=(a=e[t])?a.$error:void 0,r&&S(r)))return t===n?C(t,r):""
return""}for(t in k)if(k.hasOwnProperty(t)&&(r=null!=(o=e[t])?o.$error:void 0,r&&S(r)&&r.maxlength))return t===n?C(t,r):""
return u.typingInput===n&&null!=(null!=(i=e[n])&&null!=(c=i.$error)?c.pattern:void 0)&&(null!=(l=k[n].example)?l.length:void 0)>0?"example: "+k[n].example:void 0},T=function(e){return u.typingInput===e?k[e].example:k[e].placeholder},a(function(){var e,n
return e=u.form,e.email="test@debug.com",e.name="Test User",e.phone="+380665243646",e.address="664 Cypress Lane, Campbell, CA, United States",e.notes="Some test notes",n=u.form.creditCard,n.card="5105 1051 0510 5100",n.expDate="05/17",n.cvv="333",u.form.agreed=!0}),I=u,I.investigateDate=c,I.placeholder=T,I.closeError=d,I.checkout=$,I.agree=x,I.fields=k,I.few=p,I.expDateChanged=g,I.cardChanged=b,I.disabledOrder=h,I.typing=f,I.message=M,u}}),angular.module("ablsdk").service("ablapi",function(e){return{timeslots:function(n){var t
return t=$.param({activity:n.activityId,"status[event]":"all",dateRange:[moment(n.startTime).clone().startOf("day").startOf("month").toISOString(),moment(n.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),e.get("timeslots?"+t)}}}),angular.module("ablsdk").service("browser",function(e){var n
return n=function(){var n,t,r
n=e.navigator.userAgent,t={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in t)if(t[r].test(e.navigator.userAgent))return r
return"unknown"},{name:n()}}),angular.module("ablsdk").service("ablcalc",function(e,n){var t
return t=function(e){switch(!1){case"undefined"!=typeof e:return 0
case null!==typeof e:return 0
case 0!==e.length:return 0
default:return e.reduce(function(e,n){return e+n})}},function(r){var a,o,u,i,c,l,s,d,f,m,p,v,h,y,g
return a=null!=r?r.filter(function(e){return"active"===e.status}):void 0,o=function(e){var n
return{name:e.name,quantity:null!=(n=e.count)?n:0,amount:e.amount,_id:e._id}},u=function(e,n){return n.amount-e.amount},i={attendees:null!=a?a.filter(function(e){return"aap"===e.type}).map(o).sort(u):void 0,addons:null!=a?a.filter(function(e){return"addon"===e.type}).map(o):void 0},c=function(){return t(i.attendees.map(f))+v()},l=function(e){switch(!1){case"tax"!==e.type:return c()/100*e.amount
case"fee"!==e.type:return t(i.attendees.map(function(e){return e.quantity}))*e.amount
default:return 0}},s=function(){return t(a.map(l))},d=function(e){var n,t,r
return null!=(n=null!=(t=a.filter(function(n){return"aap"===n.type&&n.name===e.name}))&&null!=(r=t[0])?r.amount:void 0)?n:0},f=function(e){return d(e)*e.quantity},m=function(e){return t(i.addons.filter(function(n){return n.name===e.name}).map(function(e){return e.amount}))},p=function(e){return m(e)*e.quantity},v=function(){return t(i.addons.map(p))},h=function(){var e,n,t
return e=c(),n=function(){switch(!1){case!(g.codes[0].amountOff<e):return g.codes[0].amountOff
default:return e}},t=function(){switch(!1){case 0!==g.codes.length:return 0
case null==g.codes[0].amountOff:return n()
case null==g.codes[0].percentOff:return e/100*g.codes[0].percentOff
default:return 0}}()},y=function(){return c()+s()-h()},g={codes:[],calc:h,remove:function(e){var n
return n=g.codes.indexOf(e),n>-1?g.codes.splice(n,1):void 0},add:function(t){var r,a
if(0!==(null!=(r=g.code)?r:"").length&&(g.code=g.code.toUpperCase(),g.error=function(){switch(!1){case 0!==g.code.length:return"Code is required"
case!(g.code.length<6):return"6 chars are required"
default:return""}}(),!(g.error.length>0)))return a=function(e){var r
return r=function(){return g.codes.push(e),g.code="",g.success="Coupon "+e.couponId+" added successfully",n(function(){var e
return e=g.success,delete g.success,e},3e3),""},g.error=function(){switch(!1){case!(0!==e.maxRedemptions&&e.maxRedemptions<=e.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(e.redeemBy),"minutes")>0):return"This coupon is expired"
case!(e.activities.length>0&&e.activities[0]!==t):return"This coupon is not valid for this activity."
default:return r()}}()},e.get("coupon/"+g.code).success(function(e){return a(e)}).error(function(e){var n,t
return g.error=null!=(n=null!=e&&null!=(t=e.errors)?t[0]:void 0)?n:"Coupon not found"})},code:""},{coupon:g,addons:i.addons,attendees:i.attendees,totalWithoutTaxesfees:c,calcCoupon:h,calcTaxFee:l,calcTaxesFees:s,showPrice:d,calcPrice:f,showAddonPrice:m,calcAddonPrice:p,totalAddons:v,calcSubtotal:c,calcTotal:y}}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(e,n,t,r,a,o,u){return function(i,c){var l,s,d,f,m,p,v,h,y,g,b,D,w,$,x,S,C,k
return l=i.split("@"),i=l[0],s={loading:!1},d={localStorage:{remove:function(e){},add:function(e){},update:function(e){},fetch:function(e){}},memory:{remove:function(e){return y(e)},add:function(e,n){return Array.prototype.push.call(h,e),"function"==typeof n?n(e):void 0},update:function(e,n){return"function"==typeof n?n(e):void 0},fetch:function(){return s.loading=!1}},backend:{remove:function(n){return e["delete"](i+"/"+n._id).success(function(){return y(n)})},update:function(n,t){return e.update(i+"/"+n._id,n).success(function(e){return s.loading=!1,"function"==typeof t?t(e):void 0})},add:function(n,r){return e.create(i,n).success(function(e){return t("backend-success",e),w(e),"function"==typeof r?r(e):void 0})},fetch:function(){var n
return t("fetch",p(i),h.options),n=angular.copy(h.options),delete n.$url,e.get(p(i),{params:n}).success(function(e,n,t){var r,a
return h.length=0,r=function(e){var n,r
return n=t()[e],null!=n?(r=document.createElement("a"),r.href=t()[e],JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')):void 0},h.options.total=(a=r("x-last-page-url"),null!=a?parseInt(a.page)*parseInt(a.pageSize):e.length),h.options.pageSize=(a=r("x-first-page-url"),null!=a?parseInt(a.pageSize):e.length),s.loading=!1,w(e)})}}},f=d[null!=(m=l[1])?m:"backend"],p=function(e){var n,t,r
return n={url:e},t=function(e){return n.url=n.url.replace(":"+e[0],e[1])},r=h.getOptions().$url,null!=r&&u.each(t)(u.objToPairs(r)),n.url},v=n.$new(),v.items=[],h=v.items,s.loading=!1,y=function(e){var n
return n=h.indexOf(e),n>-1?Array.prototype.splice.call(h,n,1):void 0},g=function(e,n){return null!=e._id?b(e,n):D(e,n)},b=function(e,n){return s.loading?void 0:f.update(e,n)},D=function(e,n){return s.loading?void 0:f.add(e,n)},w=function(e){var n,t,r
return n=i.split("/"),t=n[n.length-1],r=function(){switch(!1){case"Array"!==toString$.call(e).slice(8,-1):return e
case"Array"!==toString$.call(e[t]).slice(8,-1):return e[t]
case"Object"!==toString$.call(e).slice(8,-1):return[e]
default:return[]}}(),Array.prototype.push.apply(h,r),s.loading=!1},h.options={},h.getOptions=function(){return h.options},$=function(e){if(!s.loading){switch(toString$.call(e).slice(8,-1)){case"Function":return h.getOptions=e,$({})
case"Number":h.options.page=e
break
case"Object":h.options=angular.extend({},h.getOptions(),e)}return s.loading=!0,null!=h.options.page&&(1===h.options.page?delete h.options.page:h.options.page-=1),f.fetch()}},$(c),x=function(){var e
if(!s.loading)return e=Array.prototype.splice.apply(h,arguments),e.forEach(f.remove)},S=function(e,n,t){var a,o
if(!s.loading)return a={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},r.show(r.confirm().title(null!=(o=null!=t?t.title:void 0)?o:a.title).content(null!=(o=null!=t?t.content:void 0)?o:a.content).ok(null!=(o=null!=t?t.ok:void 0)?o:a.ok).cancel(null!=(o=null!=t?t.cancel:void 0)?o:a.cancel).targetEvent(n)).then(function(){return f.remove(e)},function(){})},C=[],k=function(e){var n,t
return n=[],t=curry$(function(t,r){var a,o
return a=[],k(a),o=function(){var n
return n=Array.prototype[t].call(e,r),a.length=0,Array.prototype.push.apply(a,n)},n.push(o),o(),a}),e.loading=function(){return s.loading},e.toArray=function(){var n
return n=[],Array.prototype.push.apply(n,e),n},e.fetchOn=function(n,t){return t.$watch(n,bind$(h,"fetch"),!0),e},e.watch=function(t,r){var u
return u=function(){return a(function(){return n.forEach(function(e){return e()})})},null!=r?(C.push({array:r[t],func:u}),r.$watch(t,u,!0)):(C.push({array:t,func:u}),o.watch(t,u)),e},e.watch(e),["map","filter"].forEach(function(n){return e[n]=t(n)}),e.push=D,e.save=g,e.fetch=$,e.remove=S,e.splice=x,e.toArray=function(){return angular.copy(e)}},h.listen=function(e){return e.$on("$destroy",function(){var e,n,t,r,a=[]
for(e=0,t=(n=C).length;t>e;++e)r=n[e],a.push(o.unwatch(r.array,r.func))
return a}),h},k(h),h}}),angular.module("ablsdk").service("p",function(){var e
return{head:e=function(e){return e[0]},each:curry$(function(e,n){var t,r,a
for(t=0,r=n.length;r>t;++t)a=n[t],e(a)
return n}),map:curry$(function(e,n){var t,r,a,o=[]
for(t=0,r=n.length;r>t;++t)a=n[t],o.push(e(a))
return o}),fold:curry$(function(e,n,t){var r,a,o
for(r=0,a=t.length;a>r;++r)o=t[r],n=e(n,o)
return n}),filter:curry$(function(e,n){var t,r,a,o=[]
for(t=0,r=n.length;r>t;++t)a=n[t],e(a)&&o.push(a)
return o}),find:curry$(function(e,n){var t,r,a
for(t=0,r=n.length;r>t;++t)if(a=n[t],e(a))return a}),pairsToObj:function(e){var n,t,r,a={}
for(n=0,t=e.length;t>n;++n)r=e[n],a[r[0]]=r[1]
return a},objToPairs:function(e){var n,t,r=[]
for(n in e)t=e[n],r.push([n,t])
return r},values:function(e){var n,t,r=[]
for(n in e)t=e[n],r.push(t)
return r},any:curry$(function(e,n){var t,r,a
for(t=0,r=n.length;r>t;++t)if(a=n[t],e(a))return!0
return!1}),notAny:curry$(function(e,n){var t,r,a
for(t=0,r=n.length;r>t;++t)if(a=n[t],e(a))return!1
return!0}),sum:function(e){var n,t,r,a
for(n=0,t=0,r=e.length;r>t;++t)a=e[t],n+=a
return n},sort:function(e){return e.concat().sort(function(e,n){return e>n?1:n>e?-1:0})},sortWith:curry$(function(e,n){return n.concat().sort(e)}),sortBy:curry$(function(e,n){return n.concat().sort(function(n,t){return e(n)>e(t)?1:e(n)<e(t)?-1:0})}),reverse:function(e){return e.concat().reverse()}}}),angular.module("ablsdk").service("abldate",function(e){return function(n){var t,r
return t=function(e,n){var t,r
return t=bind$(moment(e),"format"),r=bind$(n,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},r=function(e,t){return e.add(moment(t).tz(n).utcOffset()-e.utcOffset(),"minute")},{backendify:function(a){var o
return o=t(a,moment().tz(n)).tz(n),e("timezone",n),r(o),o.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(a){var o
return o=moment(a).tz(n),e("timezone",n),r(o,o),t(o,moment(a)).toDate()}}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(e){return function(n){var t
if(e)switch(toString$.call(n).slice(8,-1)){case"Function":return n()
default:return"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("formula",function(e,n){var t,r
return t=function(n,t){var r,a
return r=null!=(a=null!=t?t.charges:void 0)?a:[],function(e){var n
return null!=(n=null!=e?e.amount:void 0)?n:0}(e.find(function(e){return e.type===n||e.subtype===n||e.description===n})(r))},r=function(n){var t,r,a,o,u,i,c,l
return(null!=n&&null!=(t=n.timeslots)?t.length:void 0)>0?(r=function(e){return[].concat.apply([],e)},a=function(n){var t,r
return t="Adult",e.map(function(e){return e.amount})(e.filter(function(e){return"active"===e.status})(e.filter(function(e){return e.type===t||e.subtype===t||e.description===t})(null!=(r=null!=n?n.charges:void 0)?r:[])))},o=function(n){var t
return e.map(function(e){return e.amount})(null!=(t=null!=n?n.charges:void 0)?t:[])},u=r(n.timeslots.map(a)),i=r(n.timeslots.map(o)),c=function(e){return Math.max.apply(Math,e)},l=function(){switch(!1){case!(u.length>0):return c(u)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(e){return t("Adult",e)},getVisualPrice:r,getAdultPrice:function(e){var n
return t("Adult",null!=e&&null!=(n=e.timeslots)?n[0]:void 0)},getYouthPrice:function(e){var n
return t("Youth",null!=e&&null!=(n=e.timeslots)?n[0]:void 0)}}}),angular.module("ablsdk").filter("mdate",function(e){return function(e,n){return null!=e?e.format(n):null}}),angular.module("ablsdk").factory("prefill",function(e,n,t){return function(r){return e(function(){return t.prefill=function(){var e
return e=arguments,n(function(){return r.apply(null,e)})},null!=t.parent?t.parent.prefill=t.prefill:void 0})}}),angular.module("ablsdk").service("safeApply",function(e){return function(n){var t
return t=e.$$phase,"$apply"===t||"$digest"===t?n():e.$apply(n)}}),angular.module("ablsdk").service("ablslot",function(abldate,ablcalc,ablapi,formula,p,debug,$xabl){return function(activity,inputModel){var transformCharge,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,performChooseSlot,actualEvent,isEmpty,slotsByDay,select,isFitToSlot,isNotFitToAnySlot,inPast,createMonth,startMonth,setCalendars,scroll,nextMonth,calendar,loadEvents,isDummy,isDisabledDay,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,calendarUp,calendarDown,setup,move,createEventInstanceId,model,slots,calendars,activeSlots,x$,ref$
return transformCharge=function(e){return{_id:e._id,name:e.name,quantity:0,amount:e.amount}},getDay=function(e){var n
return null!=e?(n=null!=(null!=e?e.format:void 0)?e:moment(e),parseInt(n.format("YYYYMMDD"))):null},newDate=function(){var e
return e=moment.apply(null,arguments).tz(activity.timeZone)},generateCalendar=function(e,n){var t,r,a,o,u,i,c,l
return t=newDate(e),r=t.year(),a=t.month(),o=function(e){return newDate([r,a,e])},u=t.endOf("month").date(),i=p.map(o)(function(){var e,n,t=[]
for(e=1,n=u;n>=e;++e)t.push(e)
return t}()),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var e,n,t=[]
for(e=1,n=c;n>=e;++e)t.push(e)
return t}()),{time:t,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(e){return Math.ceil(getDay(e)/100)},hackDate=function(e,n){var t,r
return t=bind$(moment(e),"format"),r=bind$(n,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(e,n){var t,r
return t=null!=e?e:hackDate(e,moment()),r=null!=n?n:hackDate(n,moment()),moment([t.year(),t.month(),t.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var available
return available="inactive"===slot.status?0:slot.available-eval([0].concat(model.calc.attendees.map(function(e){return e.quantity})).join("+"))}),performChooseSlot=function(e){var n,t,r,a,o,u,i
if(0!==e.available)return n=model.value,t=merge(n,e.startTime),model.date.start=t,r=abldate(activity.timeZone),model.date.origin=r.backendify(model.date.start).replace(/[\:-]/gi,""),model.date.end=e.endTime,model.charges=e.charges,model.calc=ablcalc(e.charges.concat(activity.charges)),model._id=e._id,model.eventId=null!=(a=activity.timeslots.filter(function(n){return n._id===e._id}))&&null!=(o=a[0])?o.eventId:void 0,u=model.attendees,i=function(e){var n
return n=u.filter(function(n){return n.name===e.name}),{quantity:function(){switch(!1){case!(n.length>0):return n[0].quantity
case"Adult"!==e.name:return 1
default:return 0}}(),name:e.name,amount:e.amount}},model.attendees=e.charges.filter(function(e){return"aap"===e.type}).map(i),model.available=makeAvailable(e)},actualEvent=curry$(function(e,n){return getDay(n.startTime)===getDay(e)}),isEmpty=function(e){var n
return n=actualEvent(e),function(e){return 0===e.length}(p.filter(isFitToSlot(e))(slots))},slotsByDay=function(e){var n,t
return n=actualEvent(e),t=function(t){var r,a,o,u,i
return r=merge(e,t.startTime),a=t.endTime-t.startTime,o=t.events.find(n),u=null!=(i=null!=o?o.available:void 0)?i:t.maxOcc,debug(null!=o?o.status:void 0),{status:null!=o?o.status:void 0,startTime:r,time:r.valueOf(),endTime:r.clone().add(a,"milliseconds"),charges:t.charges,price:formula.getVisualPrice({timeslots:[t]}),available:"inactive"===(null!=o?o.status:void 0)?0:u,_id:t._id,duration:moment.duration(a).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:t.maxOcc-u}},p.sortBy(function(e){return e.time})(p.map(t)(p.filter(isFitToSlot(e))(slots)))},select=function(e){return model.value=e,activeSlots.length=0,slotsByDay(e).forEach(function(e){return activeSlots.push(e)})},isFitToSlot=curry$(function(e,n){var t,r,a,o,u,i
return t=0===n.daysRunning.length,r=activity,a=function(){switch(!1){case!(getDay(n.startTime)!==getDay(e)&&t):return!0
case!(getDay(n.startTime)>getDay(e)&&!t):return!0
case!(getDay(n.untilTime)<getDay(e)&&!t):return!0
default:return!1}}(),o=function(e){var n,t
return n=null!=e&&"function"==typeof e.day?e.day():void 0,t=function(){switch(!1){case null!==n:return null
case 0!==n:return 6
default:return n-1}}()},u=!t&&p.notAny(function(n){return n===o(e)})(n.daysRunning),i=function(){switch(!1){case!u:return!1
case!a:return!1
default:return!0}}()}),isNotFitToAnySlot=function(e){switch(!1){case!p.notAny(function(e){return e.available>0})(slotsByDay(e)):return!0
case!p.notAny(isFitToSlot(e))(slots):return!0
default:return!1}},inPast=function(e){return getDay(e)<getDay(newDate())||e.diff(newDate(),"hours")<24},createMonth=function(e){return newDate([e.year(),e.month(),15])},startMonth=createMonth(newDate()),setCalendars=function(e,n,t){return calendars.length=0,calendars.push(e),calendars.push(n),loadEvents(t)},scroll={activeDate:function(){var e,n,t,r,a,o
return scroll.activeDate=function(){},e=calendars[0],n=function(n){return generateCalendar(e.time.clone().add(n,"month"))},t=function(t){return 0===t?e:n(t)},r=function(e){return"undefined"!=typeof t(e).days.find(function(e){return!isDisabledDay(e)})},a=function(e){return function(){var n,t,r=[]
for(n=1,t=e;t>=n;++n)r.push(n)
return r}().forEach(bind$(calendar,"down"))},o=[0,1,2,3,4,5,6].find(r),o>0?a(o):void 0}},nextMonth=function(e,n){return date.clone().add(n,"months")},calendar={first:startMonth,second:startMonth.clone().add(1,"months"),move:function(e){return calendar.first=calendar.first.clone().add(e,"month"),calendar.second=calendar.second.clone().add(e,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},loadEvents=function(e){return ablapi.timeslots({startTime:calendars[0].time,endTime:calendars[1].time,activityId:activity._id}).success(function(n){var t,r,a
return t=abldate(activity.timeZone),r=compose$(t.frontendify,moment),a=function(e){return e.startTime=r(e.startTime),e.endTime=r(e.endTime),e.untilTime=r(e.untilTime),e},slots.length=0,n.timeslots.map(a).forEach(function(e){return slots.push(e)}),scroll.activeDate(),"function"==typeof e?e():void 0})},isDummy=function(e){switch(!1){case null!==e:return!0
default:return!1}},isDisabledDay=function(e){switch(!1){case!isDummy(e):return!0
case!isEmpty(e):return!0
case!inPast(e):return!0
case!isNotFitToAnySlot(e):return!0
default:return!1}},selectDay=function(e){return isDisabledDay(e)?void 0:(select(e),performChooseSlot(slots[0]))},notSelected=function(){switch(!1){case null!==model.date.start:return!0
case model.chosen!==!1:return!0
default:return!1}},disabledSlot=function(e){switch(!1){case 0!==e.available:return"This event is full"
default:return""}},notAvailableSlot=function(e){return e.available<=0},close=function(e){var n
return n=function(e){return 0===e.quantity&&"Adult"===e.name?e.quantity=1:void 0},model.attendees.forEach(n),model.chosen=e,model.visible=!1,"function"==typeof model.closed&&model.closed(e),debug("close",model)},chooseSlot=function(e){return notAvailableSlot(e)?void 0:(performChooseSlot(e),close(!0))},isActiveDay=function(e){return getDay(e)===getDay(model.value)},isDisabledMonth=function(e){switch(!1){case!(getDay(e)<getDay(newDate())):return!0
default:return!1}},isActiveMonth=function(e){return getMonth(e)===getMonth(model.value)},isCalendarUpDisabled=function(){return getMonth(calendars[0].time)<getMonth(newDate())},calendarUp=function(){return isCalendarUpDisabled()?void 0:calendar.up()},calendarDown=function(){return calendar.down()},setup=function(){return setCalendars(generateCalendar(startMonth.clone()),generateCalendar(startMonth.clone().add(1,"month")),function(){return selectDay(model.value)})},move=function(e){return $xabl.put("bookings/move/"+e,{eventInstanceId:createEventInstanceId()})},createEventInstanceId=function(){var e
return e=abldate(activity.timeZone),model.eventId+"_"+e.backendify(model.date.start).replace(/[\:-]/gi,"")},model=null!=inputModel?inputModel:{},slots=[],calendars=[],activeSlots=[],x$=model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(e){return"addon"===e.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,setup(),{model:model,activeSlots:activeSlots,move:move,selectDay:selectDay,calendars:calendars,createEventInstanceId:createEventInstanceId,calendarUp:calendarUp,calendarDown:calendarDown,close:close,isActiveMonth:isActiveMonth,isDisabledDay:isDisabledDay,isDisabledMonth:isDisabledMonth,isCalendarUpDisabled:isCalendarUpDisabled,isDummy:isDummy,isActiveDay:isActiveDay,notSelected:notSelected,chooseSlot:chooseSlot,notAvailableSlot:notAvailableSlot,disabledSlot:disabledSlot}}}),angular.module("ablsdk").factory("stripe",function(e,n){var t,r
if(t={},r=function(){var e
return t.setPublishableKey=Stripe.setPublishableKey,e=Stripe.card,t.createToken=function(t,r){var a,o,u,i
return e.validateCardNumber(t.number)?e.validateExpiry(t.exp_month,t.exp_year)?e.validateCVC(t.cvc)?e.createToken({number:t.number,cvc:t.cvc,exp_month:t.exp_month,exp_year:t.exp_year,name:t.fullName,address_line1:null!=(a=t.location)?a.street_address:void 0,address_city:null!=(o=t.location)?o.city:void 0,address_country:null!=(u=t.location)?u.country:void 0,state:null!=(i=t.location)?i.state:void 0},function(e,t){return n(null!=t.id?function(){return r(null,t.id)}:function(){return r(t.error.message)})}):r("CVV is not correct. Your CVV number can be located by looking on your credit or debit card"):r("Expiration Month/Year is not correct"):r("Card number is not correct")}},"undefined"==typeof window.Stripe)throw'please add <script src="https://js.stripe.com/v2/"></script>'
return r(),t}),angular.module("ablsdk").service("watcher",function(e,n,t){var r,a,o
return r=function(){return{unwatch:function(e,n){return"function"==typeof n.unwatch?n.unwatch():void 0},watch:function(n,t){var r
return r=e.$new(),r.array=n,t.unwatch=r.$watch("array",t,!0)}}},a=function(){return{unwatch:function(e,n){return Array.unobserve(e,n)},watch:function(n,t){var r,a,o
return r=function(){var n
return n=e.$new(),function(e,t){return n.array=e,n.$watch("array",t)}},(a=null!=(o=Array.observe)?o:r())(n,t)}}},o=function(){switch(!1){case"firefox"!==n.name:return r()
case"unknown"!==n.name:return r()
case"safari"!==n.name:return r()
default:return r()}}()}),angular.module("ablsdk",[]),angular.module("ablsdk").service("ablbook",function(e,n,t,r,a,o){return function(r,o){var u,i,c,l,s,d,f,m,p,v,h,y,g,b,D,w,$,x,S,C,k,A,M,T,I
return u={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idenpotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:""}},calendar:{value:null,visible:!1,currentActivity:r,closed:function(e){return u.form.date.start=u.calendar.date.start,u.form.date.end=u.calendar.date.end,o("slot-chosen",e)}}},i=function(e){var n
return null!=e?(n=null!=(null!=e?e.format:void 0)?e:moment(e),parseInt(n.format("YYYYMMDD"))):null},c=function(e){var n
return n=function(){switch(!1){case null!==e.start:return"none"
case i(e.start)===i(e.end):return"different"
default:return"same"}}()},l=function(e){return!u.loading&&e.$valid},s=function(e){return u.form.error=e},d=function(){return s("")},f=function(e){return u.triedCheckout=!1,u.typingInput=e},m=function(){var e
return u.idenpotencyKey=(e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e())},m(),p=function(e){var n
return null!=(n=null!=e&&"function"==typeof e.filter?e.filter(function(e){return e.quantity>0}):void 0)?n:[]},v=function(e){switch(!1){case"undefined"!=typeof e:return 0
case null!==typeof e:return 0
case 0!==e.length:return 0
default:return e.reduce(function(e,n){return e+n})}},h=function(){return 0===v(u.calendar.calc.attendees.map(function(e){return e.quantity}))},y=function(e,n){var t
return t=function(){switch(!1){case 4!==e.length:return e+" "
case 9!==e.length:return e+" "
case 14!==e.length:return e+" "
case 19!==e.length:return e+" "
default:return e}}(),t+n},g=function(){var e,n,t,r
return e=event.target.value,n=null!=(t=null!=e?e.replace("/",""):void 0)?t:"",r=function(e){return null!=e?e:""},u.form.creditCard.expDate=function(){switch(!1){case!(n.length>2):return n[0]+n[1]+"/"+r(n[2])+r(n[3])
default:return n}}()},b=function(e){var t
return t=e.target.value,"undefined"!=typeof t?u.form.creditCard.card=function(e){return e.substr(0,19)}(n.fold(y,"")(function(e){return e.split(" ").join("")}(t))):void 0},D=function(a,o){var i,c,l,d
return"undefined"==typeof a?(u.loading=!1,s("Stripe key is not defined")):(t.setPublishableKey(a),i=u.form.creditCard,c=i.expDate.split("/"),l=u.form,d={number:i.card,cvc:i.cvv,exp_month:c[0],exp_year:"20"+c[1],fullName:l.name,location:l.location,state:l.state},t.createToken(d,function(t,a){var i,c,d
return null!=t?(u.loading=!1,s(t)):(i=r,c=i.timeslots.filter(function(e){return e._id===u.calendar._id})[0].eventId,d={stripeToken:a,couponId:u.calendar.calc.coupon.codes.length>0?u.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:"credit",eventInstanceId:c+"_"+u.calendar.date.origin,addons:n.pairsToObj(n.map(function(e){return[e._id,e.quantity]})(u.calendar.calc.addons)),attendees:n.pairsToObj(n.map(function(e){return[e.name,e.quantity]})(u.calendar.calc.attendees)),answers:n.pairsToObj(n.map(function(e){return[e._id,e.answer]})(u.calendar.questions)),fullName:l.name,email:l.email,phoneNumber:l.phone,notes:l.notes,location:l.location,currency:"usd",_customHeaders:{"Idempotency-Key":u.idenpotencyKey}},e.post("bookings",d).success(function(e){return null!=e.bookingId?(m(),o()):s(e.error)}).error(function(e){var n,t
return s(null!=(n=null!=(t=e.errors)?t[0]:void 0)?n:"Server error")})["finally"](function(){return u.loading=!1}))}))},w=function(){return e.get("payments/setup")},$=function(e){return u.loading!==!0?(u.triedCheckout=!0,l(e)?(u.loading=!0,w().success(function(e){return D(e.publicKey,function(){return o("success",e)})}).error(function(e){return u.loading=!1,s(e),o("error",s)})):s("Please correct the form")):void 0},x=function(){return u.form.agreed=!u.form.agreed,A()},S=function(e){return e.required||e.pattern||e.minlength||e.maxlength||e.phone},C=function(e,n){switch(!1){case!n.required:return e+" is required"
case!n.pattern:return"Please follow the example "+k[e].example
case!n.minlength:return e+" is too short"
case!n.maxlength:return e+" is too long"
case!n.phone:return e+" is not valid phone number"
default:return"please check "+e}},k={email:{pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email"},name:{pattern:"",example:"Your name",placeholder:"Name"},phone:{pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234"},address:{pattern:"",example:"Address",placeholder:"Home address"},notes:{pattern:"",example:"Notes",placeholder:"Notes"},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",placeholder:"Card #"},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",placeholder:"Exp date"},startDate:{},cvv:{pattern:/[0-9]{3,4}/i,example:"000",placeholder:"CVV"}},A=function(){return u.form.agreed?u.triedCheckout=!0:void 0},M=function(e,n){var t,r,a,o,i,c,l
if(u.triedCheckout===!0){for(t in k)if(k.hasOwnProperty(t)&&(r=null!=(a=e[t])?a.$error:void 0,r&&S(r)))return t===n?C(t,r):""
return""}for(t in k)if(k.hasOwnProperty(t)&&(r=null!=(o=e[t])?o.$error:void 0,r&&S(r)&&r.maxlength))return t===n?C(t,r):""
return u.typingInput===n&&null!=(null!=(i=e[n])&&null!=(c=i.$error)?c.pattern:void 0)&&(null!=(l=k[n].example)?l.length:void 0)>0?"example: "+k[n].example:void 0},T=function(e){return u.typingInput===e?k[e].example:k[e].placeholder},a(function(){var e,n
return e=u.form,e.email="test@debug.com",e.name="Test User",e.phone="+380665243646",e.address="664 Cypress Lane, Campbell, CA, United States",e.notes="Some test notes",n=u.form.creditCard,n.card="5105 1051 0510 5100",n.expDate="05/17",n.cvv="333",u.form.agreed=!0}),I=u,I.investigateDate=c,I.placeholder=T,I.closeError=d,I.checkout=$,I.agree=x,I.fields=k,I.few=p,I.expDateChanged=g,I.cardChanged=b,I.disabledOrder=h,I.typing=f,I.message=M,u}}),angular.module("ablsdk").service("ablapi",function(e){return{timeslots:function(n){var t
return t=$.param({activity:n.activityId,"status[event]":"all",dateRange:[moment(n.startTime).clone().startOf("day").startOf("month").toISOString(),moment(n.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),e.get("timeslots?"+t)}}}),angular.module("ablsdk").service("browser",function(e){var n
return n=function(){var n,t,r
n=e.navigator.userAgent,t={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in t)if(t[r].test(e.navigator.userAgent))return r
return"unknown"},{name:n()}}),angular.module("ablsdk").service("ablcalc",function(e,n){var t
return t=function(e){switch(!1){case"undefined"!=typeof e:return 0
case null!==typeof e:return 0
case 0!==e.length:return 0
default:return e.reduce(function(e,n){return e+n})}},function(r){var a,o,u,i,c,l,s,d,f,m,p,v,h,y,g
return a=null!=r?r.filter(function(e){return"active"===e.status}):void 0,o=function(e){var n
return{name:e.name,quantity:null!=(n=e.count)?n:0,amount:e.amount,_id:e._id}},u=function(e,n){return n.amount-e.amount},i={attendees:null!=a?a.filter(function(e){return"aap"===e.type}).map(o).sort(u):void 0,addons:null!=a?a.filter(function(e){return"addon"===e.type}).map(o):void 0},c=function(){return t(i.attendees.map(f))+v()},l=function(e){switch(!1){case"tax"!==e.type:return c()/100*e.amount
case"fee"!==e.type:return t(i.attendees.map(function(e){return e.quantity}))*e.amount
default:return 0}},s=function(){return t(a.map(l))},d=function(e){var n,t,r
return null!=(n=null!=(t=a.filter(function(n){return"aap"===n.type&&n.name===e.name}))&&null!=(r=t[0])?r.amount:void 0)?n:0},f=function(e){return d(e)*e.quantity},m=function(e){return t(i.addons.filter(function(n){return n.name===e.name}).map(function(e){return e.amount}))},p=function(e){return m(e)*e.quantity},v=function(){return t(i.addons.map(p))},h=function(){var e,n,t
return e=c(),n=function(){switch(!1){case!(g.codes[0].amountOff<e):return g.codes[0].amountOff
default:return e}},t=function(){switch(!1){case 0!==g.codes.length:return 0
case null==g.codes[0].amountOff:return n()
case null==g.codes[0].percentOff:return e/100*g.codes[0].percentOff
default:return 0}}()},y=function(){return c()+s()-h()},g={codes:[],calc:h,remove:function(e){var n
return n=g.codes.indexOf(e),n>-1?g.codes.splice(n,1):void 0},add:function(t){var r,a
if(0!==(null!=(r=g.code)?r:"").length&&(g.code=g.code.toUpperCase(),g.error=function(){switch(!1){case 0!==g.code.length:return"Code is required"
case!(g.code.length<6):return"6 chars are required"
default:return""}}(),!(g.error.length>0)))return a=function(e){var r
return r=function(){return g.codes.push(e),g.code="",g.success="Coupon "+e.couponId+" added successfully",n(function(){var e
return e=g.success,delete g.success,e},3e3),""},g.error=function(){switch(!1){case!(0!==e.maxRedemptions&&e.maxRedemptions<=e.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(moment(e.redeemBy),"minutes")>0):return"This coupon is expired"
case!(e.activities.length>0&&e.activities[0]!==t):return"This coupon is not valid for this activity."
default:return r()}}()},e.get("coupon/"+g.code).success(function(e){return a(e)}).error(function(e){var n,t
return g.error=null!=(n=null!=e&&null!=(t=e.errors)?t[0]:void 0)?n:"Coupon not found"})},code:""},{coupon:g,addons:i.addons,attendees:i.attendees,totalWithoutTaxesfees:c,calcCoupon:h,calcTaxFee:l,calcTaxesFees:s,showPrice:d,calcPrice:f,showAddonPrice:m,calcAddonPrice:p,totalAddons:v,calcSubtotal:c,calcTotal:y}}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(e,n,t,r,a,o,u){return function(i,c){var l,s,d,f,m,p,v,h,y,g,b,D,w,$,x,S,C,k
return l=i.split("@"),i=l[0],s={loading:!1},d={localStorage:{remove:function(e){},add:function(e){},update:function(e){},fetch:function(e){}},memory:{remove:function(e){return y(e)},add:function(e,n){return Array.prototype.push.call(h,e),"function"==typeof n?n(e):void 0},update:function(e,n){return"function"==typeof n?n(e):void 0},fetch:function(){return s.loading=!1}},backend:{remove:function(n){return e["delete"](i+"/"+n._id).success(function(){return y(n)})},update:function(n,t){return e.update(i+"/"+n._id,n).success(function(e){return s.loading=!1,"function"==typeof t?t(e):void 0})},add:function(n,r){return e.create(i,n).success(function(e){return t("backend-success",e),w(e),"function"==typeof r?r(e):void 0})},fetch:function(){var n
return t("fetch",p(i),h.options),n=angular.copy(h.options),delete n.$url,e.get(p(i),{params:n}).success(function(e,n,t){var r,a
return h.length=0,r=function(e){var n,r
return n=t()[e],null!=n?(r=document.createElement("a"),r.href=t()[e],JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')):void 0},h.options.total=(a=r("x-last-page-url"),null!=a?parseInt(a.page)*parseInt(a.pageSize):e.length),h.options.pageSize=(a=r("x-first-page-url"),null!=a?parseInt(a.pageSize):e.length),s.loading=!1,w(e)})}}},f=d[null!=(m=l[1])?m:"backend"],p=function(e){var n,t,r
return n={url:e},t=function(e){return n.url=n.url.replace(":"+e[0],e[1])},r=h.getOptions().$url,null!=r&&u.each(t)(u.objToPairs(r)),n.url},v=n.$new(),v.items=[],h=v.items,s.loading=!1,y=function(e){var n
return n=h.indexOf(e),n>-1?Array.prototype.splice.call(h,n,1):void 0},g=function(e,n){return null!=e._id?b(e,n):D(e,n)},b=function(e,n){return s.loading?void 0:f.update(e,n)},D=function(e,n){return s.loading?void 0:f.add(e,n)},w=function(e){var n,t,r
return n=i.split("/"),t=n[n.length-1],r=function(){switch(!1){case"Array"!==toString$.call(e).slice(8,-1):return e
case"Array"!==toString$.call(e[t]).slice(8,-1):return e[t]
case"Object"!==toString$.call(e).slice(8,-1):return[e]
default:return[]}}(),Array.prototype.push.apply(h,r),s.loading=!1},h.options={},h.getOptions=function(){return h.options},$=function(e){if(!s.loading){switch(toString$.call(e).slice(8,-1)){case"Function":return h.getOptions=e,$({})
case"Number":h.options.page=e
break
case"Object":h.options=angular.extend({},h.getOptions(),e)}return s.loading=!0,null!=h.options.page&&(1===h.options.page?delete h.options.page:h.options.page-=1),f.fetch()}},$(c),x=function(){var e
if(!s.loading)return e=Array.prototype.splice.apply(h,arguments),e.forEach(f.remove)},S=function(e,n,t){var a,o
if(!s.loading)return a={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},r.show(r.confirm().title(null!=(o=null!=t?t.title:void 0)?o:a.title).content(null!=(o=null!=t?t.content:void 0)?o:a.content).ok(null!=(o=null!=t?t.ok:void 0)?o:a.ok).cancel(null!=(o=null!=t?t.cancel:void 0)?o:a.cancel).targetEvent(n)).then(function(){return f.remove(e)},function(){})},C=[],k=function(e){var n,t
return n=[],t=curry$(function(t,r){var a,o
return a=[],k(a),o=function(){var n
return n=Array.prototype[t].call(e,r),a.length=0,Array.prototype.push.apply(a,n)},n.push(o),o(),a}),e.loading=function(){return s.loading},e.toArray=function(){var n
return n=[],Array.prototype.push.apply(n,e),n},e.fetchOn=function(n,t){return t.$watch(n,bind$(h,"fetch"),!0),e},e.watch=function(t,r){var u
return u=function(){return a(function(){return n.forEach(function(e){return e()})})},null!=r?(C.push({array:r[t],func:u}),r.$watch(t,u,!0)):(C.push({array:t,func:u}),o.watch(t,u)),e},e.watch(e),["map","filter"].forEach(function(n){return e[n]=t(n)}),e.push=D,e.save=g,e.fetch=$,e.remove=S,e.splice=x,e.toArray=function(){return angular.copy(e)}},h.listen=function(e){return e.$on("$destroy",function(){var e,n,t,r,a=[]
for(e=0,t=(n=C).length;t>e;++e)r=n[e],a.push(o.unwatch(r.array,r.func))
return a}),h},k(h),h}}),angular.module("ablsdk").service("p",function(){var e
return{head:e=function(e){return e[0]},each:curry$(function(e,n){var t,r,a
for(t=0,r=n.length;r>t;++t)a=n[t],e(a)
return n}),map:curry$(function(e,n){var t,r,a,o=[]
for(t=0,r=n.length;r>t;++t)a=n[t],o.push(e(a))
return o}),fold:curry$(function(e,n,t){var r,a,o
for(r=0,a=t.length;a>r;++r)o=t[r],n=e(n,o)
return n}),filter:curry$(function(e,n){var t,r,a,o=[]
for(t=0,r=n.length;r>t;++t)a=n[t],e(a)&&o.push(a)
return o}),find:curry$(function(e,n){var t,r,a
for(t=0,r=n.length;r>t;++t)if(a=n[t],e(a))return a}),pairsToObj:function(e){var n,t,r,a={}
for(n=0,t=e.length;t>n;++n)r=e[n],a[r[0]]=r[1]
return a},objToPairs:function(e){var n,t,r=[]
for(n in e)t=e[n],r.push([n,t])
return r},values:function(e){var n,t,r=[]
for(n in e)t=e[n],r.push(t)
return r},any:curry$(function(e,n){var t,r,a
for(t=0,r=n.length;r>t;++t)if(a=n[t],e(a))return!0
return!1}),notAny:curry$(function(e,n){var t,r,a
for(t=0,r=n.length;r>t;++t)if(a=n[t],e(a))return!1
return!0}),sum:function(e){var n,t,r,a
for(n=0,t=0,r=e.length;r>t;++t)a=e[t],n+=a
return n},sort:function(e){return e.concat().sort(function(e,n){return e>n?1:n>e?-1:0})},sortWith:curry$(function(e,n){return n.concat().sort(e)}),sortBy:curry$(function(e,n){return n.concat().sort(function(n,t){return e(n)>e(t)?1:e(n)<e(t)?-1:0})}),reverse:function(e){return e.concat().reverse()}}}),angular.module("ablsdk").service("abldate",function(e){return function(n){var t,r
return t=function(e,n){var t,r
return t=bind$(moment(e),"format"),r=bind$(n,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},r=function(e,t){return e.add(moment(t).tz(n).utcOffset()-e.utcOffset(),"minute")},{backendify:function(a){var o
return o=t(a,moment().tz(n)).tz(n),e("timezone",n),r(o),o.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(a){var o
return o=moment(a).tz(n),e("timezone",n),r(o,o),t(o,moment(a)).toDate()}}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(e){return function(n){var t
if(e)switch(toString$.call(n).slice(8,-1)){case"Function":return n()
default:return"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("formula",function(e,n){var t,r
return t=function(n,t){var r,a
return r=null!=(a=null!=t?t.charges:void 0)?a:[],function(e){var n
return null!=(n=null!=e?e.amount:void 0)?n:0}(e.find(function(e){return e.type===n||e.subtype===n||e.description===n})(r))},r=function(n){var t,r,a,o,u,i,c,l
return(null!=n&&null!=(t=n.timeslots)?t.length:void 0)>0?(r=function(e){return[].concat.apply([],e)},a=function(n){var t,r
return t="Adult",e.map(function(e){return e.amount})(e.filter(function(e){return"active"===e.status})(e.filter(function(e){return e.type===t||e.subtype===t||e.description===t})(null!=(r=null!=n?n.charges:void 0)?r:[])))},o=function(n){var t
return e.map(function(e){return e.amount})(null!=(t=null!=n?n.charges:void 0)?t:[])},u=r(n.timeslots.map(a)),i=r(n.timeslots.map(o)),c=function(e){return Math.max.apply(Math,e)},l=function(){switch(!1){case!(u.length>0):return c(u)
case!(i.length>0):return c(i)
default:return 0}}()):"Non"},{getSlotPrice:function(e){return t("Adult",e)},getVisualPrice:r,getAdultPrice:function(e){var n
return t("Adult",null!=e&&null!=(n=e.timeslots)?n[0]:void 0)},getYouthPrice:function(e){var n
return t("Youth",null!=e&&null!=(n=e.timeslots)?n[0]:void 0)}}}),angular.module("ablsdk").filter("mdate",function(e){return function(e,n){return null!=e?e.format(n):null}}),angular.module("ablsdk").factory("prefill",function(e,n,t){return function(r){return e(function(){return t.prefill=function(){var e
return e=arguments,n(function(){return r.apply(null,e)})},null!=t.parent?t.parent.prefill=t.prefill:void 0})}}),angular.module("ablsdk").service("safeApply",function(e){return function(n){var t
return t=e.$$phase,"$apply"===t||"$digest"===t?n():e.$apply(n)}}),angular.module("ablsdk").service("ablslot",function(abldate,ablcalc,ablapi,formula,p,debug,$xabl){return function(activity,inputModel){var transformCharge,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,performChooseSlot,actualEvent,isEmpty,slotsByDay,select,isFitToSlot,isNotFitToAnySlot,inPast,createMonth,startMonth,setCalendars,scroll,nextMonth,calendar,loadEvents,isDummy,isDisabledDay,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,calendarUp,calendarDown,setup,move,createEventInstanceId,model,slots,calendars,activeSlots,x$,ref$
return transformCharge=function(e){return{_id:e._id,name:e.name,quantity:0,amount:e.amount}},getDay=function(e){var n
return null!=e?(n=null!=(null!=e?e.format:void 0)?e:moment(e),parseInt(n.format("YYYYMMDD"))):null},newDate=function(){var e
return e=moment.apply(null,arguments).tz(activity.timeZone)},generateCalendar=function(e,n){var t,r,a,o,u,i,c,l
return t=newDate(e),r=t.year(),a=t.month(),o=function(e){return newDate([r,a,e])},u=t.endOf("month").date(),i=p.map(o)(function(){var e,n,t=[]
for(e=1,n=u;n>=e;++e)t.push(e)
return t}()),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var e,n,t=[]
for(e=1,n=c;n>=e;++e)t.push(e)
return t}()),{time:t,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(e){return Math.ceil(getDay(e)/100)},hackDate=function(e,n){var t,r
return t=bind$(moment(e),"format"),r=bind$(n,"format"),moment(t("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(e,n){var t,r
return t=null!=e?e:hackDate(e,moment()),r=null!=n?n:hackDate(n,moment()),moment([t.year(),t.month(),t.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var available
return available="inactive"===slot.status?0:slot.available-eval([0].concat(model.calc.attendees.map(function(e){return e.quantity})).join("+"))}),performChooseSlot=function(e){var n,t,r,a,o,u,i
if(0!==e.available)return n=model.value,t=merge(n,e.startTime),model.date.start=t,r=abldate(activity.timeZone),model.date.origin=r.backendify(model.date.start).replace(/[\:-]/gi,""),model.date.end=e.endTime,model.charges=e.charges,model.calc=ablcalc(e.charges.concat(activity.charges)),model._id=e._id,model.eventId=null!=(a=activity.timeslots.filter(function(n){return n._id===e._id}))&&null!=(o=a[0])?o.eventId:void 0,u=model.attendees,i=function(e){var n
return n=u.filter(function(n){return n.name===e.name}),{quantity:function(){switch(!1){case!(n.length>0):return n[0].quantity
case"Adult"!==e.name:return 1
default:return 0}}(),name:e.name,amount:e.amount}},model.attendees=e.charges.filter(function(e){return"aap"===e.type}).map(i),model.available=makeAvailable(e)},actualEvent=curry$(function(e,n){return getDay(n.startTime)===getDay(e)}),isEmpty=function(e){var n
return n=actualEvent(e),function(e){return 0===e.length}(p.filter(isFitToSlot(e))(slots))},slotsByDay=function(e){var n,t
return n=actualEvent(e),t=function(t){var r,a,o,u,i
return r=merge(e,t.startTime),a=t.endTime-t.startTime,o=t.events.find(n),u=null!=(i=null!=o?o.available:void 0)?i:t.maxOcc,debug(null!=o?o.status:void 0),{status:null!=o?o.status:void 0,startTime:r,time:r.valueOf(),endTime:r.clone().add(a,"milliseconds"),charges:t.charges,price:formula.getVisualPrice({timeslots:[t]}),available:"inactive"===(null!=o?o.status:void 0)?0:u,_id:t._id,duration:moment.duration(a).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:t.maxOcc-u}},p.sortBy(function(e){return e.time})(p.map(t)(p.filter(isFitToSlot(e))(slots)))},select=function(e){return model.value=e,activeSlots.length=0,slotsByDay(e).forEach(function(e){return activeSlots.push(e)})},isFitToSlot=curry$(function(e,n){var t,r,a,o,u,i
return t=0===n.daysRunning.length,r=activity,a=function(){switch(!1){case!(getDay(n.startTime)!==getDay(e)&&t):return!0
case!(getDay(n.startTime)>getDay(e)&&!t):return!0
case!(getDay(n.untilTime)<getDay(e)&&!t):return!0
default:return!1}}(),o=function(e){var n,t
return n=null!=e&&"function"==typeof e.day?e.day():void 0,t=function(){switch(!1){case null!==n:return null
case 0!==n:return 6
default:return n-1}}()},u=!t&&p.notAny(function(n){return n===o(e)})(n.daysRunning),i=function(){switch(!1){case!u:return!1
case!a:return!1
default:return!0}}()}),isNotFitToAnySlot=function(e){switch(!1){case!p.notAny(function(e){return e.available>0})(slotsByDay(e)):return!0
case!p.notAny(isFitToSlot(e))(slots):return!0
default:return!1}},inPast=function(e){return getDay(e)<getDay(newDate())||e.diff(newDate(),"hours")<24},createMonth=function(e){return newDate([e.year(),e.month(),15])},startMonth=createMonth(newDate()),setCalendars=function(e,n,t){return calendars.length=0,calendars.push(e),calendars.push(n),loadEvents(t)},scroll={activeDate:function(){var e,n,t,r,a,o
return scroll.activeDate=function(){},e=calendars[0],n=function(n){return generateCalendar(e.time.clone().add(n,"month"))},t=function(t){return 0===t?e:n(t)},r=function(e){return"undefined"!=typeof t(e).days.find(function(e){return!isDisabledDay(e)})},a=function(e){return function(){var n,t,r=[]
for(n=1,t=e;t>=n;++n)r.push(n)
return r}().forEach(bind$(calendar,"down"))},o=[0,1,2,3,4,5,6].find(r),o>0?a(o):void 0}},nextMonth=function(e,n){return date.clone().add(n,"months")},calendar={first:startMonth,second:startMonth.clone().add(1,"months"),move:function(e){return calendar.first=calendar.first.clone().add(e,"month"),calendar.second=calendar.second.clone().add(e,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},loadEvents=function(e){return ablapi.timeslots({startTime:calendars[0].time,endTime:calendars[1].time,activityId:activity._id}).success(function(n){var t,r,a
return t=abldate(activity.timeZone),r=compose$(t.frontendify,moment),a=function(e){return e.startTime=r(e.startTime),e.endTime=r(e.endTime),e.untilTime=r(e.untilTime),e},slots.length=0,n.timeslots.map(a).forEach(function(e){return slots.push(e)}),scroll.activeDate(),"function"==typeof e?e():void 0})},isDummy=function(e){switch(!1){case null!==e:return!0
default:return!1}},isDisabledDay=function(e){switch(!1){case!isDummy(e):return!0
case!isEmpty(e):return!0
case!inPast(e):return!0
case!isNotFitToAnySlot(e):return!0
default:return!1}},selectDay=function(e){return isDisabledDay(e)?void 0:(select(e),performChooseSlot(slots[0]))},notSelected=function(){switch(!1){case null!==model.date.start:return!0
case model.chosen!==!1:return!0
default:return!1}},disabledSlot=function(e){switch(!1){case 0!==e.available:return"This event is full"
default:return""}},notAvailableSlot=function(e){return e.available<=0},close=function(e){var n
return n=function(e){return 0===e.quantity&&"Adult"===e.name?e.quantity=1:void 0},model.attendees.forEach(n),model.chosen=e,model.visible=!1,"function"==typeof model.closed&&model.closed(e),debug("close",model)},chooseSlot=function(e){return notAvailableSlot(e)?void 0:(performChooseSlot(e),close(!0))},isActiveDay=function(e){return getDay(e)===getDay(model.value)},isDisabledMonth=function(e){switch(!1){case!(getDay(e)<getDay(newDate())):return!0
default:return!1}},isActiveMonth=function(e){return getMonth(e)===getMonth(model.value)},isCalendarUpDisabled=function(){return getMonth(calendars[0].time)<getMonth(newDate())},calendarUp=function(){return isCalendarUpDisabled()?void 0:calendar.up()},calendarDown=function(){return calendar.down()},setup=function(){return setCalendars(generateCalendar(startMonth.clone()),generateCalendar(startMonth.clone().add(1,"month")),function(){return selectDay(model.value)})},move=function(e){return $xabl.put("bookings/move/"+e,{eventInstanceId:createEventInstanceId()})},createEventInstanceId=function(){var e
return e=abldate(activity.timeZone),model.eventId+"_"+e.backendify(model.date.start).replace(/[\:-]/gi,"")},model=null!=inputModel?inputModel:{},slots=[],calendars=[],activeSlots=[],x$=model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(e){return"addon"===e.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,setup(),{model:model,activeSlots:activeSlots,move:move,selectDay:selectDay,calendars:calendars,createEventInstanceId:createEventInstanceId,calendarUp:calendarUp,calendarDown:calendarDown,close:close,isActiveMonth:isActiveMonth,isDisabledDay:isDisabledDay,isDisabledMonth:isDisabledMonth,isCalendarUpDisabled:isCalendarUpDisabled,isDummy:isDummy,isActiveDay:isActiveDay,notSelected:notSelected,chooseSlot:chooseSlot,notAvailableSlot:notAvailableSlot,disabledSlot:disabledSlot}}}),angular.module("ablsdk").factory("stripe",function(e,n){var t,r
if(t={},r=function(){var e
return t.setPublishableKey=Stripe.setPublishableKey,e=Stripe.card,t.createToken=function(t,r){var a,o,u,i
return e.validateCardNumber(t.number)?e.validateExpiry(t.exp_month,t.exp_year)?e.validateCVC(t.cvc)?e.createToken({number:t.number,cvc:t.cvc,exp_month:t.exp_month,exp_year:t.exp_year,name:t.fullName,address_line1:null!=(a=t.location)?a.street_address:void 0,address_city:null!=(o=t.location)?o.city:void 0,address_country:null!=(u=t.location)?u.country:void 0,state:null!=(i=t.location)?i.state:void 0},function(e,t){return n(null!=t.id?function(){return r(null,t.id)}:function(){return r(t.error.message)})}):r("CVV is not correct. Your CVV number can be located by looking on your credit or debit card"):r("Expiration Month/Year is not correct"):r("Card number is not correct")}},"undefined"==typeof window.Stripe)throw'please add <script src="https://js.stripe.com/v2/"></script>'
return r(),t}),angular.module("ablsdk").service("watcher",function(e,n,t){var r,a,o
return r=function(){return{unwatch:function(e,n){return"function"==typeof n.unwatch?n.unwatch():void 0},watch:function(n,t){var r
return r=e.$new(),r.array=n,t.unwatch=r.$watch("array",t,!0)}}},a=function(){return{unwatch:function(e,n){return Array.unobserve(e,n)},watch:function(n,t){var r,a,o
return r=function(){var n
return n=e.$new(),function(e,t){return n.array=e,n.$watch("array",t)}},(a=null!=(o=Array.observe)?o:r())(n,t)}}},o=function(){switch(!1){case"firefox"!==n.name:return r()
case"unknown"!==n.name:return r()
case"safari"!==n.name:return r()
default:return r()}}()})
