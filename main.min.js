// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
// Generated by LiveScript 1.4.0
function curry$(t,n){var e,r=function(a){return t.length>1?function(){var o=a?a.concat():[]
return e=n?e||this:this,o.push.apply(o,arguments)<t.length&&arguments.length?r.call(e,o):t.apply(e,o)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var o=a?a.concat():[]
return e=n?e||this:this,o.push.apply(o,arguments)<t.length&&arguments.length?r.call(e,o):t.apply(e,o)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var o=a?a.concat():[]
return e=n?e||this:this,o.push.apply(o,arguments)<t.length&&arguments.length?r.call(e,o):t.apply(e,o)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var o=a?a.concat():[]
return e=n?e||this:this,o.push.apply(o,arguments)<t.length&&arguments.length?r.call(e,o):t.apply(e,o)}:t}
return r()}function compose$(){var t=arguments
return function(){var n,e
for(e=t[0].apply(this,arguments),n=1;n<t.length;++n)e=t[n](e)
return e}}function in$(t,n){for(var e=-1,r=n.length>>>0;++e<r;)if(t===n[e])return!0
return!1}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var o=a?a.concat():[]
return e=n?e||this:this,o.push.apply(o,arguments)<t.length&&arguments.length?r.call(e,o):t.apply(e,o)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var o=a?a.concat():[]
return e=n?e||this:this,o.push.apply(o,arguments)<t.length&&arguments.length?r.call(e,o):t.apply(e,o)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var o=a?a.concat():[]
return e=n?e||this:this,o.push.apply(o,arguments)<t.length&&arguments.length?r.call(e,o):t.apply(e,o)}:t}
return r()}function bind$(t,n,e){return function(){return(e||t)[n].apply(t,arguments)}}function curry$(t,n){var e,r=function(a){return t.length>1?function(){var o=a?a.concat():[]
return e=n?e||this:this,o.push.apply(o,arguments)<t.length&&arguments.length?r.call(e,o):t.apply(e,o)}:t}
return r()}function compose$(){var t=arguments
return function(){var n,e
for(e=t[0].apply(this,arguments),n=1;n<t.length;++n)e=t[n](e)
return e}}function in$(t,n){for(var e=-1,r=n.length>>>0;++e<r;)if(t===n[e])return!0
return!1}angular.module("ablsdk",[]),angular.module("ablsdk").service("ablapi",function(t){return{timeslots:function(n){var e
return e=$.param({activity:n.activityId,"status[event]":"all",dateRange:[moment(n.startTime).clone().startOf("day").startOf("month").toISOString(),moment(n.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),t.get("timeslots?"+e)}}}),angular.module("ablsdk").service("browser",function(t){var n
return n=function(){var n,e,r
n=t.navigator.userAgent,e={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in e)if(e[r].test(t.navigator.userAgent))return r
return"unknown"},{name:n()}}),angular.module("ablsdk").service("ablbook",function(t,n,r,a,o,u){return function(i,c){var l,s,f,d,m,p,v,h,y,g,b,w,D,S,$,x,A,T,C,k,M,E,_,I,O,Y,N,q
return l={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idempotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:"",address_zip:""}},calendar:{value:null,visible:!1,currentActivity:i,closed:function(t){return a("closed-calendar",t),l.form.date.start=l.calendar.date.start,l.form.date.end=l.calendar.date.end,c("slot-chosen",t)}}},s=function(t){var n
return null!=t?(n=null!=(null!=t?t.format:void 0)?t:moment(t),parseInt(n.format("YYYYMMDD"))):null},f=function(t){var n
return n=function(){switch(!1){case null!==t.start:return"none"
case s(t.start)===s(t.end):return"different"
default:return"same"}}()},d=function(t){return!l.loading&&t.$valid},m=function(t){var n,e
for(n in I)if(I.hasOwnProperty(n)&&(e=Y(t,n),(null!=e?e.length:void 0)>0))return e
return"Please check the form"},p=function(t){return l.form.error=t},v=function(){return p("")},h=function(){var t
return l.idempotencyKey=(t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t())},h(),y=function(t){var n
return null!=(n=null!=t&&"function"==typeof t.filter?t.filter(function(t){return t.quantity>0}):void 0)?n:[]},g=function(t){switch(!1){case"undefined"!=typeof t:return 0
case null!==typeof t:return 0
case 0!==t.length:return 0
default:return t.reduce(function(t,n){return t+n})}},b=function(){return 0===g(l.calendar.calc.attendees.map(function(t){return t.quantity}))},w=function(t,n){var e
return e=function(){switch(!1){case 4!==t.length:return t+" "
case 9!==t.length:return t+" "
case 14!==t.length:return t+" "
case 19!==t.length:return t+" "
default:return t}}(),e+n},D=function(){var t
if(null==l.calendar._id)throw"Cannot get event instance id because calendar._id is not defined"
if(t=function(t){return null!=t?t.eventId:void 0}(n.find(function(t){return t._id===l.calendar._id})(i.timeslots)),null==t)throw"event id is not found by id "+l.calendar._id+" in ["+i.timeslots.map(function(t){return t._id}).join(",")+"]"
return t+"_"+l.calendar.date.origin},S=function(r,a){var o,u,c,s,f,d,m
return o=l.form,u=i,c=function(t){return n.map(function(){return null})(function(){var n,e,r=[]
for(n=1,e=t;e>=n;++n)r.push(n)
return r}())},s=l.calendar.calc.coupon.codes.length>0,f=0===l.calendar.calc.calcTotal(),d={isMobile:null!=(m=o.isMobile)?m:!1,stripeToken:r,couponId:s?l.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:function(){switch(!1){case!(f&&s):return"gift"
case!f:return"cash"
default:return"credit"}}(),eventInstanceId:D(),addons:n.pairsToObj(n.map(function(t){return[t._id,c(t.quantity)]})(l.calendar.calc.addons)),attendees:n.pairsToObj(n.map(function(t){return[t._id,c(t.quantity)]})(l.calendar.calc.attendees)),answers:n.pairsToObj(n.map(function(t){return[t._id,t.answer]})(l.calendar.questions)),adjustments:l.calendar.calc.adjustment.list,fullName:o.name,email:o.email,phoneNumber:o.phone,notes:o.notes,location:o.location,currency:"usd",_customHeaders:{"Idempotency-Key":l.idempotencyKey}},t.post("bookings",d).success(function(t){var n,r
return null!=t.bookingId?(o.bookingId=t.bookingId,h(),a(t)):p(null!=(n=null!=(r=e.errors)?r[0]:void 0)?n:"Server error")}).error(function(t){var n,e
return p(null!=(n=null!=(e=t.errors)?e[0]:void 0)?n:"Server error")})["finally"](function(){return l.loading=!1})},$=function(t,n){var e,a,o,u,i
return"undefined"==typeof t?(l.loading=!1,p("Stripe key is not defined")):(r.setPublishableKey(t),e=l.form.creditCard,a=e.expDate.split("/"),o=l.form,u={number:e.card,cvc:e.cvv,address_zip:e.address_zip,exp_month:a[0],exp_year:"20"+a[1],fullName:null!=(i=o.fullName)?i:o.name,location:o.location,state:o.state},r.createToken(u,function(t,e){return null!=t?(l.loading=!1,p(t)):S(e,n)}))},x=function(){return t.get("payments/setup")},A=function(t){var n
return l.loading===!0?!1:(l.triedCheckout=!0,n=d(t),n||p(m(t)),n)},T=function(t){return l.booking=t,c("success",t)},C=function(t,n){return A(t)?(l.loading=!0,l.calendar.calc.calcTotal()>0?x().success(function(t){return $(t.publicKey,T)}).error(function(t){return l.loading=!1,p(t),c("error",p)}):S("",T)):void 0},k=function(){return l.form.agreed=!l.form.agreed,O()},M=function(t){return t.required||t.pattern||t.minlength||t.maxlength||t.phone},E=function(t,n){var e,r
return e=I[t].state,r=function(){switch(!1){case!l.triedCheckout:return!0
case!(!e.touched&&!l.triedCheckout):return!1
case!(e.active&&!l.triedCheckout):return!1
case!(!e.active&&e.touched):return!0
default:return!1}}(),r?_(t,n):""},_=function(t,n){switch(!1){case!n.required:return I[t].title+" is required"
case!n.pattern:return"Please follow the example "+I[t].example
case!n.minlength:return I[t].title+" is too short"
case!n.maxlength:return I[t].title+" is too long"
case!n.phone:return I[t].title+" is not valid phone number"
default:return"please check "+I[t].title}},I={email:{title:"Email",pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email",state:{index:1,touched:!1,active:!1}},name:{pattern:"",title:"Name",example:"Your name",placeholder:"Name",state:{index:2,touched:!1,active:!1}},phone:{title:"Phone",pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234",state:{index:3,touched:!1,active:!1}},address:{pattern:"",title:"Address",example:"Address",placeholder:"Home address",state:{index:4,touched:!1,active:!1}},notes:{pattern:"",title:"Notes",example:"Notes",placeholder:"Notes",state:{index:5,touched:!1,active:!1}},address_zip:{pattern:"",example:"12345",title:"Postal Code",placeholder:"Postal Code",normalize:function(t){return t},state:{index:6,touched:!1,active:!1}},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",title:"Credit Card",placeholder:"Credit Card Number",normalize:function(t){return"undefined"!=typeof t?l.form.creditCard.card=function(t){return t.substr(0,19)}(n.fold(w,"")(function(t){return t.split(" ").join("")}(t))):void 0},state:{index:7,touched:!1,active:!1}},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",title:"Exp Date",placeholder:"Exp Date (MM/YY)",normalize:function(t){var n,e,r
return n=null!=(e=null!=t?t.replace("/",""):void 0)?e:"",r=function(t){return null!=t?t:""},l.form.creditCard.expDate=function(){switch(!1){case 2!==n.length:return n[0]+n[1]+"/"
case!(n.length>2):return n[0]+n[1]+"/"+r(n[2])+r(n[3])
default:return n}}()},state:{index:8,touched:!1,active:!1}},startDate:{state:{index:11,touched:!1,active:!1}},cvv:{pattern:/[0-9]{3,4}/i,example:"000",title:"CVV",placeholder:"CVV",state:{index:9,touched:!1,active:!1}},agreed:{title:"Confirmation",pattern:"true",message:{required:"Please accept the terms and conditions"},state:{index:10,touched:!1,active:!1}}},O=function(){return l.form.agreed?l.triedCheckout=!0:void 0},Y=function(t,e){var r,a,o,u
r=n.pairsToObj(n.sortBy(function(t){return t[1].state.index})(n.objToPairs(I)))
for(a in r)if(I.hasOwnProperty(a)&&(o=null!=(u=t[a])?u.$error:void 0,o&&M(o)))return a===e?E(a,o):""
return""},N=function(t){return I[t].placeholder},o(function(){var t,n
return t=l.form,t.email="a.stegno@gmail.com",t.name="Test User",t.phone="+380665243646",t.address="664 Cypress Lane, Campbell, CA, United States",t.notes="Some test notes",n=l.form.creditCard,n.card="5105 1051 0510 5100",n.address_zip="12345",n.expDate="05/17",n.cvv="333",l.form.agreed=!0}),q=l,q.handle=function(t){return u(function(){var n,e,r,a
if(n=t.target.name,e=t.type,r=t.target.value,a=I[n],null!=a)switch(e){case"keyup":return"function"==typeof a.normalize?a.normalize(r):void 0
case"focus":return a.state.active=!0,a.state.touched=!0
case"blur":return a.state.active=!1}})},q.setIndex=function(t,n){var e
return e=I[t],null==e?n:(e.state.index=n,n)},q.investigateDate=f,q.getEventInstanceId=D,q.placeholder=N,q.closeError=v,q.checkout=C,q.validate=A,q.agree=k,q.fields=I,q.few=y,q.disabledOrder=b,q.message=Y,l}}),angular.module("ablsdk").filter("capitalize",function(){return function(t){return angular.isString(t)&&t.length>0?t.charAt(0).toUpperCase()+t.substr(1).toLowerCase():t}}).filter("capitalizeAll",function(){return function(t){return angular.isString(t)&&t.length>0?t.split(" ").map(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}).join(" "):t}}),angular.module("ablsdk").service("ablcalc",function(t,n,e,r,a){var o
return o=function(t){switch(!1){case"undefined"!=typeof t:return 0
case null!==typeof t:return 0
default:return e.sum(t)}},function(u,i,c){var l,s,f,d,m,p,v,h,y,g,b,w,D,S,$,x,A,T,C,k,M,E,_,I,O,Y,N,q,j,P,F,z
return l=null!=i?i:[],s=null!=(f=null!=u?u.filter(function(t){return"active"===t.status}):void 0)?f:[],d=function(t){return{name:t.name,isDefault:t.isDefault,quantity:0,amount:t.amount,_id:t._id}},m=function(t,n){return n.amount-t.amount},p=function(t){return{name:t[0].name,isDefault:t[0].isDefault,amount:t[0].amount,quantity:t.length,_ids:e.map(function(t){return t._id})(t)}},v=function(t){return e.sortWith(m)(e.map(p)(e.map(function(t){return t[1]})(e.objToPairs(e.groupBy(function(t){return t.name+t.amount})(e.filter(function(n){return n.type===t})(l))))))},h=curry$(function(t,n){var r
return r=e.find(function(t){return n.name===t.name&&n.amount===t.amount})(v(t)),null!=r&&(r.old=!0),null==r}),y=function(t){return e.sortWith(m)(e.filter(h(t))(e.map(d)(e.filter(function(n){return n.type===t})(s))))},g=function(t){var n,r,a
return n=e.sortBy(function(t){return t.amount})(e.concat(e.map(function(n){return n(t)})([v,y]))),r=e.filter(function(t){return t.isDefault})(n),a=e.sortBy(function(t){return t.amount})(e.filter(function(t){return-1===r.indexOf(t)})(n)),0===r.length?e.reverse(e.sortBy(function(t){return t.amount})(n)):r.concat(a)},a(function(){return g("aap").length>0}),a(function(){var t
return t=e.head(g("app")),t?null==t.amount||null==t.quantity||null==t.name?!1:void 0:!0}),b={attendees:g("aap"),addons:g("addon")},w=function(){return e.sum(e.map(function(t){return t.amount})(q.list))},D=function(){return o(b.attendees.map(A))+w()+k()},S=function(t){switch(!1){case"tax"!==t.type:return D()/100*t.amount
case"fee"!==t.type:return o(b.attendees.map(function(t){return t.quantity}))*t.amount
default:return 0}},$=function(){return o(s.map(S))},x=function(t){var n,e,r
return null!=(n=null!=(e=s.filter(function(n){return"aap"===n.type&&n.name===t.name}))&&null!=(r=e[0])?r.amount:void 0)?n:0},A=function(t){return x(t)*t.quantity},T=function(t){return o(b.addons.filter(function(n){return n.name===t.name}).map(function(t){return t.amount}))},C=function(t){return T(t)*t.quantity},k=function(){return o(b.addons.map(C))},M=function(){var t,n,e,r,a,o
return t=z.codes[0],n=Math.abs(null!=(e=null!=t?t.amount:void 0)?e:0),r=null!=(e=null!=t?t.percentage:void 0)?e:!1,a=(null!=(e=null!=t?t.isTotal:void 0)?e:!0)?_():D(),o=function(){switch(!1){case!(r===!1&&a>n):return n
case r!==!1:return a
default:return a/100*n}}(),-1*o},E=function(t,n){var e,r,a,o
return e="inactive"===t.status,r=t.type,a=t.old,n=function(){switch(!1){case"aap"!==r:return"pricing level"
case"addon"!==r:return"add-on"}}(),o=function(){switch(!1){case!(e&&"removed"===n):return"Warning: This "+n+" no longer exists. You can only reduce the quantity at this "+n+". If you wish to offer another "+n+" at this price, please create on Adjustment to currect the price."
case!(a&&"changed"===n):return"Warning: This "+n+" has changed since the booking was created. You can only reduce the quantity at this "+n+". If you wish to offer the old "+n+", please create an Adjustment."
case!((e||a)&&"mutated"===n):return!0
default:return""}}()},_=function(){return D()+$()},I=function(){return _()+M()},O=function(){return e.sum(e.map(function(t){return t.amount})(l))},Y=e.sum(e.map(function(t){return t.amount})(null!=c?c:[])),N=function(){return-(I()-Y)},q={list:e.filter(function(t){return"adjustment"===t.type})(l),name:"",amount:"",isEdit:!1,show:!1,add:function(){var t
return t={name:q.name,amount:q.amount},t.amount*=100,q.list.push(t),q.name="",q.amount="",q.show=!1,q.isEdit=!1},removable:function(t){return null==t._id},remove:function(t){var n
return n=q.list.indexOf(t),q.list.splice(n,1)},edit:function(t){return q.isEdit&&q.add(),q.name=t.name,q.amount=t.amount/100,q.show=!0,q.isEdit=!0,q.remove(t)}},j={},P=function(t,n){var e
return j[t]=null!=(e=j[t])?e:[],j[t].push(n)},F=function(t,n){var r,a
return r=null!=(a=j[t])?a:[],e.each(function(t){return t(n)})(r)},z={codes:e.filter(function(t){return"coupon"===t.type})(l),calc:M,show:!1,edit:function(t){return z.code=t.code,z.remove(t),z.show=!0},remove:function(t){var n
return n=z.codes.indexOf(t),n>-1?z.codes.splice(n,1):void 0},add:function(e){var a,o
if(0!==(null!=(a=z.code)?a:"").length&&(z.code=z.code.toUpperCase(),z.error=function(){switch(!1){case 0!==z.code.length:return"Code is required"
case!(z.code.length<6):return"6 chars are required"
default:return""}}(),!(z.error.length>0)))return o=function(t){var a,o,u
return a=function(){return z.codes.push(t),F("coupon-added",t),z.code="",z.success="Coupon "+t.couponId+" added successfully",z.show=!1,n(function(){var t
return t=z.success,delete z.success,t},3e3),""},o=moment(t.startTime),u=moment(t.endTime),r({startTime:o.format(),redeemBy:u.format(),check:o.diff(moment(),"minutes"),check1:o.diff(u,"minutes"),status:t.status,redemptions:0!==t.maxRedemptions&&t.maxRedemptions<=t.redemptions,expired:moment().diff(u,"minutes"),activity:t.activities.length>0&&t.activities[0]!==e}),z.error=function(){switch(!1){case!(o.diff(moment(),"minutes")>0):return"Coupon is not valid yet"
case"inactive"!==t.status:return"Coupon is inactive"
case!(0!==t.maxRedemptions&&t.maxRedemptions<=t.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(u,"minutes")>0):return"This coupon is expired"
case!(t.activities.length>0&&t.activities[0]!==e):return"This coupon is not valid for this activity."
default:return a()}}()},t.get("coupon/"+z.code).success(function(t){return o(t)}).error(function(t){var n,e
return z.error=null!=(n=null!=t&&null!=(e=t.errors)?e[0]:void 0)?n:"Coupon not found",z.code="",z.show=!0})},code:""},{warning:E,on:P,handle:function(t){var n
return r("handle",t),z.code=(null!=(n=z.code)?n:"").toUpperCase()},coupon:z,adjustment:q,addons:b.addons,attendees:b.attendees,showAttendees:function(){return e.join(", ")(e.map(function(t){return t.quantity+" "+t.name})(e.filter(function(t){return t.quantity>0})(b.attendees)))},showAddons:function(){return e.join(", ")(e.map(function(t){return t.quantity+" "+t.name})(e.filter(function(t){return t.quantity>0})(b.addons)))},totalWithoutTaxesfees:D,calcCoupon:M,couponCode:function(){var t,n
return t=z.codes[0],null!=(n=null!=t?t.couponId:void 0)?n:null!=(n=null!=t?t.name:void 0)?n:"UNKNOWN"},calcTaxFee:S,calcTaxesFees:$,showPrice:x,calcPrice:A,showAddonPrice:T,calcAddonPrice:C,totalAddons:k,calcSubtotal:D,calcTotal:I,calcPreviousTotal:O,calcBalanceDue:N}}}),angular.module("ablsdk").service("abldate",function(t){return function(t){var n,e
return n=function(t,n){var e,r
return e=bind$(moment(t),"format"),r=bind$(n,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},e=function(n,e){return n.add(moment(e).tz(t).utcOffset()-n.utcOffset(),"minute")},{backendify:function(r){var a
return a=n(r,moment().tz(t)).tz(t),e(a),a.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(r){var a
return a=moment(r).tz(t),e(a,a),n(a,moment(r)).toDate()}}}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(t,n,e,r,a,o,u){return function(e,i){var c,l,s,f,d,m,p,v,h,y,g,b,w,D,S,$,x,A
return c=e.split("@"),e=c[0],l={loading:!1,frontendify:function(t,n){var e,r,a
return e=n.split("/"),r=e[e.length-1],a=function(){switch(!1){case"Array"!==toString$.call(t).slice(8,-1):return t
case"Array"!==toString$.call(t.list).slice(8,-1):return t.list
case"Array"!==toString$.call(t[r]).slice(8,-1):return t[r]
case"Object"!==toString$.call(t).slice(8,-1):return[t]
default:return[]}}()}},s={localStorage:{remove:function(t){},add:function(t){},update:function(t){},fetch:function(t){}},memory:{remove:function(t){return h(t)},add:function(t,n){return Array.prototype.push.call(v,t),"function"==typeof n?n(t):void 0},update:function(t,n){return"function"==typeof n?n(t):void 0},fetch:function(){return l.loading=!1}},backend:{remove:function(n){return t["delete"](e+"/"+n._id).success(function(){return h(n)})},update:function(n,r){return t.update(e+"/"+n._id,n).success(function(t){return l.loading=!1,"function"==typeof r?r(t):void 0})},add:function(n,r){return t.create(e,n).success(function(t){return w(t),"function"==typeof r?r(t):void 0})},fetch:function(){var n
return n=angular.copy(v.options),delete n.total,delete n.$url,t.get(m(e),{params:n}).success(function(t,n,e){var r,a
return v.length=0,r=function(t){var n,r,a
if(n=e()[t],null!=n){r=document.createElement("a"),r.href=e()[t]
try{return JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(o){return a=o,void console.error(a,r.search)}}},v.options.total=(a=r("x-last-page-url"),null!=a?parseInt(a.page)*parseInt(a.pageSize):t.length),v.options.pageSize=(a=r("x-first-page-url"),null!=a?parseInt(a.pageSize):t.length),l.loading=!1,w(t)})}}},f=s[null!=(d=c[1])?d:"backend"],m=function(t){var n,e,r
return n={url:t},e=function(t){return n.url=n.url.replace(":"+t[0],t[1])},r=v.getOptions().$url,null!=r&&u.each(e)(u.objToPairs(r)),n.url},p=n.$new(),p.items=[],v=p.items,l.loading=!1,h=function(t){var n
return n=v.indexOf(t),n>-1?Array.prototype.splice.call(v,n,1):void 0},y=function(t,n){return null!=t._id?g(t,n):b(t,n)},g=function(t,n){return l.loading?void 0:f.update(t,n)},b=function(t,n){return l.loading?void 0:f.add(t,n)},w=function(t){var n,r,a
switch(n=l.frontendify(t,e),r=toString$.call(n).slice(8,-1)){case"Array":Array.prototype.push.apply(v,n)
break
case"Object":a=function(t){return v[t[0]]=t[1]},u.each(a)(u.objToPairs(n))}return l.loading=!1},v.options={},v.converter=function(t){return l.frontendify=t.frontendify,l.backendify=t.backendify,v},v.getOptions=function(){return v.options},D=function(t){if(!l.loading){switch(toString$.call(t).slice(8,-1)){case"Function":return v.getOptions=t,D({})
case"Number":v.options.page=t
break
case"Object":v.options=angular.extend({},v.getOptions(),t)}return l.loading=!0,null!=v.options.page&&(v.options.page-=1),f.fetch()}},D(i),S=function(){var t
if(!l.loading)return t=Array.prototype.splice.apply(v,arguments),t.forEach(f.remove)},$=function(t,n,e){var a,o
if(!l.loading)return a={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},o=r.confirm({controller:"confirm2",templateUrl:"confirm",locals:{options:angular.extend({},a,e)},targetEvent:n}),r.show(o).then(function(n){return n===!0?f.remove(t):void 0})},x=[],A=function(t){var n,e
return n=[],e=curry$(function(e,r){var a,o
return a=[],A(a),o=function(){var n
return n=Array.prototype[e].call(t,r),a.length=0,Array.prototype.push.apply(a,n)},n.push(o),o(),a}),t.loading=function(){return l.loading},t.toArray=function(){var n
return n=[],Array.prototype.push.apply(n,t),n},t.fetchOn=function(n,e){return e.$watch(n,bind$(v,"fetch"),!0),t},t.watch=function(e,r){var u
return u=function(){return a(function(){return n.forEach(function(t){return t()})})},null!=r?(x.push({array:r[e],func:u}),r.$watch(e,u,!0)):(x.push({array:e,func:u}),o.watch(e,u)),t},t.watch(t),["map","filter"].forEach(function(n){return t[n]=e(n)}),t.push=b,t.save=y,t.fetch=D,t.remove=$,t.splice=S,t.toArray=function(){return angular.copy(t)}},v.listen=function(t){return t.$on("$destroy",function(){var t,n,e,r,a=[]
for(t=0,e=(n=x).length;e>t;++t)r=n[t],a.push(o.unwatch(r.array,r.func))
return a}),v},A(v),v}}),angular.module("ablsdk").directive("event",function(t,n){return{restrict:"A",scope:{event:"&"},link:function(e,r,a){var o,u
return o=$(r),u=function(t){return o[t](function(t){var r
return r=function(){return e.event({event:t})},n(r,e)})},t.each(u)(["blur","focus","keyup"])}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(t){return function(n){var e,r
if(t)if(e=function(){switch(!1){case"Function"!==toString$.call(null!=n?n.match:void 0).slice(8,-1):return n.match(/<<[a-z]+>>/i)
default:return null}}(),e&&window["catch"]===e[0].replace("<<","").replace(">>",""));else switch(toString$.call(n).slice(8,-1)){case"Function":return n()
default:return"undefined"!=typeof console&&null!==console&&null!=(r=console.log)?r.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("ablfacade",function(t,n){return function(e,r){var a,o
return a=t(e,r),o=n(e,a.calendar),{book:a,slot:o}}}),angular.module("ablsdk").filter("mdate",function(t){return function(t,n){return null!=t?t.format(n):null}}),angular.module("ablsdk").service("formula",function(t,n){var e,r
return e=function(n,e){var r,a
return r=null!=(a=null!=e?e.charges:void 0)?a:[],function(t){var n
return null!=(n=null!=t?t.amount:void 0)?n:0}(t.find(function(t){return t.type===n||t.subtype===n||t.description===n})(r))},r=function(n){var e,r,a,o,u,i,c,l,s,f,d
return(null!=n&&null!=(e=n.timeslots)?e.length:void 0)>0?(r=function(t){return[].concat.apply([],t)},a=function(n){var e
return t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(t.filter(function(t){return t.isDefault})(null!=(e=null!=n?n.charges:void 0)?e:[])))},o=function(n){var e,r
return e="Adult",t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(t.filter(function(t){return t.type===e||t.subtype===e||t.description===e})(null!=(r=null!=n?n.charges:void 0)?r:[])))},u=function(n){var e
return t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(null!=(e=null!=n?n.charges:void 0)?e:[]))},i=r(n.timeslots.map(o)),c=r(n.timeslots.map(u)),l=r(n.timeslots.map(a)),s=function(t){return Math.max.apply(Math,t)},f=function(t){return Math.min.apply(Math,t)},d=function(){switch(!1){case!(l.length>0):return f(l)
case!(i.length>0):return s(i)
case!(c.length>0):return s(c)
default:return 0}}()):"Non"},{getSlotPrice:function(t){return e("Adult",t)},getVisualPrice:r,getAdultPrice:function(t){var n
return e("Adult",null!=t&&null!=(n=t.timeslots)?n[0]:void 0)},getYouthPrice:function(t){var n
return e("Youth",null!=t&&null!=(n=t.timeslots)?n[0]:void 0)}}})
var toString$={}.toString
angular.module("ablsdk").service("p",function(){var t,n
return t=function(n){var e
return[].concat.apply([],function(){var r,a,o,u=[]
for(r=0,o=(a=n).length;o>r;++r)e=a[r],"Array"===toString$.call(e).slice(8,-1)?u.push(t(e)):u.push(e)
return u}())},{head:n=function(t){return t[0]},each:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)a=n[e],t(a)
return n}),isItNaN:function(t){return t!==t},all:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],!t(a))return!1
return!0}),map:curry$(function(t,n){return n.map(t)}),fold:curry$(function(t,n,e){var r,a,o
for(r=0,a=e.length;a>r;++r)o=e[r],n=t(n,o)
return n}),filter:curry$(function(t,n){var e,r,a,o=[]
for(e=0,r=n.length;r>e;++e)a=n[e],t(a)&&o.push(a)
return o}),find:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return a}),pairsToObj:function(t){var n,e,r,a={}
for(n=0,e=t.length;e>n;++n)r=t[n],a[r[0]]=r[1]
return a},objToPairs:function(t){var n,e,r=[]
for(n in t)e=t[n],r.push([n,e])
return r},values:function(t){var n,e,r=[]
for(n in t)e=t[n],r.push(e)
return r},any:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return!0
return!1}),notAny:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return!1
return!0}),sum:function(t){var n,e,r,a
for(n=0,e=0,r=t.length;r>e;++e)a=t[e],n+=a
return n},sort:function(t){return t.concat().sort(function(t,n){return t>n?1:n>t?-1:0})},concat:function(t){return[].concat.apply([],t)},concatMap:curry$(function(t,n){var e
return[].concat.apply([],function(){var r,a,o,u=[]
for(r=0,o=(a=n).length;o>r;++r)e=a[r],u.push(t(e))
return u}())}),flatten:t,groupBy:curry$(function(t,n){var e,r,a,o,u
for(e={},r=0,a=n.length;a>r;++r)o=n[r],u=t(o),u in e?e[u].push(o):e[u]=[o]
return e}),sortWith:curry$(function(t,n){return n.concat().sort(t)}),sortBy:curry$(function(t,n){return n.concat().sort(function(n,e){return t(n)>t(e)?1:t(n)<t(e)?-1:0})}),reverse:function(t){return t.concat().reverse()},split:curry$(function(t,n){return n.split(t)}),join:curry$(function(t,n){return n.join(t)}),lines:function(t){return t.length?t.split("\n"):[]},unlines:function(t){return t.join("\n")},words:function(t){return t.length?t.split(/[ ]+/):[]},unwords:function(t){return t.join(" ")},chars:function(t){return t.split("")},unchars:function(t){return t.join("")},repeat:curry$(function(t,n){var e,r
for(e="",r=0;t>r;++r)e+=n
return e}),maximum:function(t){var n,e,r,a,o
for(n=t[0],e=0,a=(r=t.slice(1)).length;a>e;++e)o=r[e],o>n&&(n=o)
return n},minimum:function(t){var n,e,r,a,o
for(n=t[0],e=0,a=(r=t.slice(1)).length;a>e;++e)o=r[e],n>o&&(n=o)
return n},maximumBy:curry$(function(t,n){var e,r,a,o,u
for(e=n[0],r=0,o=(a=n.slice(1)).length;o>r;++r)u=a[r],t(u)>t(e)&&(e=u)
return e}),minimumBy:curry$(function(t,n){var e,r,a,o,u
for(e=n[0],r=0,o=(a=n.slice(1)).length;o>r;++r)u=a[r],t(u)<t(e)&&(e=u)
return e}),capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},camelize:function(t){return t.replace(/[-_]+(.)?/g,function(t,n){return(null!=n?n:"").toUpperCase()})},dasherize:function(t){return t.replace(/([^-A-Z])([A-Z]+)/g,function(t,n,e){return n+"-"+(e.length>1?e:e.toLowerCase())}).replace(/^([A-Z]+)/,function(t,n){return n.length>1?n+"-":n.toLowerCase()})}}}),angular.module("ablsdk").factory("prefill",function(t,n,e){return function(r){return t(function(){return e.prefill=function(){var t
return t=arguments,n(function(){return r.apply(null,t)})},null!=e.parent?e.parent.prefill=e.prefill:void 0})}}),angular.module("ablsdk").filter("price",function(t){return function(n,e){var r,a
return r=n/100,a=function(){switch(!1){case"00.00$"!==e:return t("currency")(r).replace("$","").trim()+"$"
case"$00"!==e:return"$"+Math.round(r)
default:return t("currency")(r)}}()}}),angular.module("ablsdk").service("safeApply",function(t){return function(n,e){var r,a
return r=null!=e?e:t,a=r.$$phase,"$apply"===a||"$digest"===a?n():r.$apply(n)}})
var toString$={}.toString
angular.module("ablsdk").service("ablslot",function(abldate,ablcalc,ablapi,formula,p,debug,$xabl,$rootScope){return function(activity,inputModel){var transformCharge,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,defineDateStart,performChooseSlot,actualEvent,isEmpty,transformSlot,slotsByDayWithoutFilters,slotsByDay,select,isFitToSlotFull,isFitToSlot,isNotFitToAnySlot,cutoff,inPast,createMonth,startMonth,setCalendars,scroll,nextMonth,calendar,findChosenEvent,loadEvents,isDummy,isDisabledDay,selectDayAnyway,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,chooseSlotAnyway,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,calendarUp,calendarDown,setup,move,eventInstanceId,createEventInstanceId,model,slots,calendars,activeSlots,possibleSlots,x$,ref$,state,observer
return transformCharge=function(t){return{_id:t._id,name:t.name,quantity:0,amount:t.amount}},getDay=function(t){var n
return null!=t?(n=null!=(null!=t?t.format:void 0)?t:moment(t),parseInt(n.format("YYYYMMDD"))):null},newDate=function(){var t
return t=moment.apply(null,arguments)},generateCalendar=function(t,n){var e,r,a,o,u,i,c,l
return e=newDate(t),r=e.year(),a=e.month(),o=function(t){return newDate(moment.tz([r,a,t],activity.timeZone))},u=e.endOf("month").date(),i=p.map(o)(function(){var t,n,e=[]
for(t=1,n=u;n>=t;++t)e.push(t)
return e}()),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var t,n,e=[]
for(t=1,n=c;n>=t;++t)e.push(t)
return e}()),{time:e,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(t){return Math.ceil(getDay(t)/100)},hackDate=function(t,n){var e,r
return e=bind$(moment(t),"format"),r=bind$(n,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(t,n){var e,r
return e=null!=t?t:hackDate(t,moment()),r=null!=n?n:hackDate(n,moment()),moment([e.year(),e.month(),e.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var correct,quantities,available
return correct=function(t){var n,e
switch(!1){case null!==t:return!1
case"undefined"!=typeof t:return!1
case"Number"!==toString$.call(t).slice(8,-1):return!0
case!("String"===toString$.call(t).slice(8,-1)&&0===t.length):return!1
case!("String"===toString$.call(t).slice(8,-1)&&(null!=(n=t.match("^[0-9]+$"))&&null!=(e=n[0])?e.length:void 0)===t.length):return!0
default:return!1}},quantities=p.filter(correct)(p.map(function(t){return t.quantity})(model.calc.attendees)),available="inactive"===slot.status?0:slot.available-eval([0].concat(quantities).join("+"))}),defineDateStart=function(t,n){var e
return e=merge(t,n.startTime),model.date.start=e},performChooseSlot=function(t){var n,e,r,a,o,u
if(debug("perform-choose-slot",t),null==t)throw"Slot is undefined"
if(null==t.available)throw"Slot doesn't have required 'available' field"
if(0!==t.available){if(n=model.value,defineDateStart(n,t),e=abldate(activity.timeZone),model.date.origin=e.backendify(model.date.start).replace(/[\:-]/gi,""),model.date.end=t.endTime,model.title=null!=(r=t.title)?r:activity.title,model.charges=t.charges,model.calc=ablcalc(t.charges.concat(activity.charges)),null==t._id)throw"Slot doesn't have required field '_id'"
if(model._id=t._id,a=p.find(function(n){return n._id===t._id})(activity.timeslots),null==a)throw"Slot has not been found by id "+t._id+" in ["+activity.timeslots.map(function(t){return t._id}).join(",")+"]"
if(null==(null!=a?a.eventId:void 0))throw"Event id field has not been found in timeslot "+JSON.stringify(a)
return model.eventId=a.eventId,o=model.attendees,u=function(t){var n
return n=o.filter(function(n){return n.name===t.name}),{quantity:function(){switch(!1){case!(n.length>0):return n[0].quantity
case"Adult"!==t.name:return 1
default:return 0}}(),name:t.name,amount:t.amount}},model.attendees=t.charges.filter(function(t){return"aap"===t.type}).map(u),model.available=makeAvailable(t)}},actualEvent=curry$(function(t,n){return getDay(n.startTime)===getDay(t)}),isEmpty=function(t){var n
return n=actualEvent(t),function(t){return 0===t.length}(p.filter(isFitToSlot(t))(slots))},transformSlot=function(t){var n
return n=actualEvent(t),function(e){var r,a,o,u,i
return r=merge(t,e.startTime),a=e.endTime-e.startTime,o=p.find(n)(e.events),u=null!=(i=null!=o?o.available:void 0)?i:e.maxOcc,debug(null!=o?o.status:void 0),{nativeSlot:e,status:null!=o?o.status:void 0,startTime:r,time:r.valueOf(),endTime:r.clone().add(a,"milliseconds"),charges:e.charges,price:formula.getVisualPrice({timeslots:[e]}),available:"inactive"===(null!=o?o.status:void 0)?0:u,title:null!=o?o.title:void 0,_id:e._id,duration:moment.duration(a).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:e.maxOcc-u}}},slotsByDayWithoutFilters=function(t){return p.sortBy(function(t){return t.time})(p.map(transformSlot(t))(p.filter(isFitToSlotFull(!0,t))(slots)))},slotsByDay=function(t){return p.sortBy(function(t){return t.time})(p.map(transformSlot(t))(p.filter(isFitToSlot(t))(slots)))},select=function(t){var n,e,r,a,o,u
return model.value=t,activeSlots.length=0,possibleSlots.length=0,slotsByDayWithoutFilters(t).forEach(function(t){return possibleSlots.push(t)}),slotsByDay(t).forEach(function(t){return activeSlots.push(t)}),n=null!=(e=null!=(r=$rootScope.user)&&null!=(a=r.preferences)&&null!=(o=a.widget)&&null!=(u=o.display)?u.timeslot:void 0)?e:{},n.duration+n.price+n.availability+n.startTime===0&&activeSlots.length>0?chooseSlot(activeSlots[0]):void 0},isFitToSlotFull=curry$(function(t,n,e){var r,a,o,u,i,c
return r=0===e.daysRunning.length,a=activity,o=function(){switch(!1){case!r:return getDay(e.startTime)!==getDay(n)
case!(getDay(e.untilTime)<getDay(n)):return!0
case!(getDay(e.startTime)>getDay(n)):return!0
default:return!1}}(),u=function(t){var n,e
return n=null!=t&&"function"==typeof t.day?t.day():void 0,e=function(){switch(!1){case null!==n:return null
case 0!==n:return 6
default:return n-1}}()},i=!r&&p.notAny(function(t){return t===u(n)})(e.daysRunning),c=function(){switch(!1){case!i:return!1
case!o:return!1
default:return!0}}()}),isFitToSlot=isFitToSlotFull(!1),isNotFitToAnySlot=function(t){switch(!1){case!p.notAny(function(t){return t.available>0})(slotsByDay(t)):return!0
case!p.notAny(isFitToSlot(t))(slots):return!0
default:return!1}},cutoff=function(){var t,n,e,r,a,o
switch(!1){case(null!=(t=$rootScope.user)&&null!=(n=t.preferences)&&null!=(e=n.widget)&&null!=(r=e.display)&&null!=(a=r.event)?a.isSiteWide:void 0)!==!0:return $rootScope.user.preferences.widget.display.event.cutoff
case!((null!=(o=activity.cutoff)?o:-1)>-1):return activity.cutoff
default:return 2880}}(),inPast=function(t,n){return null!=n&&n.indexOf("include_nearest")>-1?getDay(t)<getDay(newDate()):getDay(t)<getDay(newDate())||t.diff(newDate(),"minutes")<cutoff},createMonth=function(t){return newDate([t.year(),t.month(),15])},startMonth=createMonth(newDate()),setCalendars=function(t,n,e){return calendars.length=0,calendars.push(t),calendars.push(n),loadEvents(e)},scroll={activeDate:function(){var t,n,e,r,a,o
return scroll.activeDate=function(){},t=calendars[0],n=function(n){return generateCalendar(t.time.clone().add(n,"month"))},e=function(e){return 0===e?t:n(e)},r=function(t){return"undefined"!=typeof p.find(function(t){return!isDisabledDay(t)})(e(t).days)},a=function(t){return function(){var n,e,r=[]
for(n=1,e=t;e>=n;++n)r.push(n)
return r}().forEach(bind$(calendar,"down"))},o=p.find(r)([0,1,2,3,4,5,6]),o>0?a(o):void 0}},nextMonth=function(t,n){return date.clone().add(n,"months")},calendar={first:startMonth,second:startMonth.clone().add(1,"months"),move:function(t){return calendar.first=calendar.first.clone().add(t,"month"),calendar.second=calendar.second.clone().add(t,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},findChosenEvent=function(){var t,n,e,r,a,o,u
if(0!==(null!=(t=state.chosenEvent)?t:"").length&&0!==slots.length)return n=state.chosenEvent.split("_"),e=n[0],r=abldate(activity.timeZone),a=moment(r.frontendify(moment(n[1],"YYYYMMDDHHmmssZ").toDate())),o=p.find(function(t){return t.eventId===e})(slots),null!=o?isDisabledDay(a)?(u=p.find(function(t){return t._id===o._id})(slotsByDay(a)),null==o&&observer.notify("event-not-found"),notAvailableSlot(u)?observer.notify("event-sold-out"):inPast(a)?observer.notify("event-too-close"):observer.notify("event-not-found")):(selectDay(a),debug({activeSlots:activeSlots,possibleSlots:possibleSlots,currentSlot:o._id}),o=p.find(function(t){return t._id===o._id})(activeSlots),null!=o?chooseSlot(o):observer.notify("event-not-found")):observer.notify("event-not-found")},loadEvents=function(t){return ablapi.timeslots({startTime:calendars[0].time,endTime:calendars[1].time,activityId:activity._id}).success(function(n){var e,r,a
return e=abldate(activity.timeZone),r=compose$(e.frontendify,moment),a=function(t){return t.startTime=r(t.startTime),t.endTime=r(t.endTime),t.untilTime=r(t.untilTime),t},slots.length=0,n.list.map(a).forEach(function(t){return slots.push(t)}),findChosenEvent(),scroll.activeDate(),"function"==typeof t?t():void 0})},isDummy=function(t){switch(!1){case null!==t:return!0
default:return!1}},isDisabledDay=function(t,n){switch(!1){case!isDummy(t):return!0
case!isEmpty(t):return!0
case!inPast(t,n):return!0
case!isNotFitToAnySlot(t):return!0
default:return!1}},selectDayAnyway=function(t){return select(t),defineDateStart(t,slots[0])},selectDay=function(t){return isDisabledDay(t)?void 0:selectDayAnyway(t)},notSelected=function(){switch(!1){case null!==model.date.start:return!0
case model.chosen!==!1:return!0
default:return!1}},disabledSlot=function(t){switch(!1){case 0!==t.available:return"This event is full"
default:return""}},notAvailableSlot=function(t){return t.available<=0},close=function(t){var n
return n=function(t){return 0===t.quantity&&"Adult"===t.name?t.quantity=1:void 0},model.attendees.forEach(n),model.chosen=t,model.visible=!1,"function"==typeof model.closed?model.closed(t):void 0},chooseSlot=function(t){return notAvailableSlot(t)?void 0:(performChooseSlot(t),close(!0))},chooseSlotAnyway=function(t){return performChooseSlot(t),close(!0)},isActiveDay=function(t){return getDay(t)===getDay(model.value)},isDisabledMonth=function(t){switch(!1){case!(getDay(t)<getDay(newDate())):return!0
default:return!1}},isActiveMonth=function(t){return getMonth(t)===getMonth(model.value)},isCalendarUpDisabled=function(){return getMonth(calendars[0].time)<getMonth(newDate())},calendarUp=function(){return isCalendarUpDisabled()?void 0:calendar.up()},calendarDown=function(){return calendar.down()},setup=function(){return setCalendars(generateCalendar(startMonth.clone()),generateCalendar(startMonth.clone().add(1,"month")),function(){return selectDay(model.value)})},move=function(t){return $xabl.put("bookings/"+t+"/move",{eventInstanceId:createEventInstanceId()})},eventInstanceId=function(t){var n
return n=abldate(activity.timeZone),t.eventId+"_"+n.backendify(t.date.start).replace(/[\:-]/gi,"")},createEventInstanceId=function(){return eventInstanceId(model)},model=null!=inputModel?inputModel:{},slots=[],calendars=[],activeSlots=[],possibleSlots=[],x$=model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$._id=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(t){return"addon"===t.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,setup(),state={chosenEvent:null},observer={list:[],observe:function(t){return observer.list.push(t)},notify:function(t,n){return p.each(function(e){return e(t,n)})(observer.list)}},{observe:observer.observe,chooseEvent:function(t){return state.chosenEvent=t,findChosenEvent()},model:model,activeSlots:activeSlots,possibleSlots:possibleSlots,move:move,selectDay:selectDay,selectDayAnyway:selectDayAnyway,calendars:calendars,createEventInstanceId:createEventInstanceId,calendarUp:calendarUp,calendarDown:calendarDown,close:close,isActiveMonth:isActiveMonth,isDisabledDay:isDisabledDay,isDisabledMonth:isDisabledMonth,isCalendarUpDisabled:isCalendarUpDisabled,isDummy:isDummy,isActiveDay:isActiveDay,notSelected:notSelected,chooseSlot:chooseSlot,chooseSlotAnyway:chooseSlotAnyway,notAvailableSlot:notAvailableSlot,disabledSlot:disabledSlot}}}),angular.module("ablsdk").factory("stripe",function(t,n){var e,r
if(e={},r=function(){var t
return e.setPublishableKey=Stripe.setPublishableKey,t=Stripe.card,e.createToken=function(e,r){var a,o,u,i
return t.validateCardNumber(e.number)?t.validateExpiry(e.exp_month,e.exp_year)?t.validateCVC(e.cvc)?t.createToken({number:e.number,cvc:e.cvc,exp_month:e.exp_month,exp_year:e.exp_year,name:e.fullName,address_line1:null!=(a=e.location)?a.street_address:void 0,address_city:null!=(o=e.location)?o.city:void 0,address_country:null!=(u=e.location)?u.country:void 0,address_state:null!=(i=e.location)?i.state:void 0},function(t,e){return n(null!=e.id?function(){return r(null,e.id)}:function(){return r(e.error.message)})}):r("CVV is not correct. Your CVV number can be located by looking on your credit or debit card"):r("Expiration Month/Year is not correct"):r("Card number is not correct")}},"undefined"==typeof window.Stripe)throw'please add <script src="https://js.stripe.com/v2/"></script>'
return r(),e}),angular.module("ablsdk").service("test",function(t){return function(n){return t(function(){var t
if(t=n(),t!==!0)throw"[FAILED TEST]"+n.toString()})}})
var toString$={}.toString
angular.module("ablsdk").service("typecheck",function(t,n){var e,r,a,o
return e=function(){function t(t){var n
if(n=t[0],null==n)throw new Error("Unexpected end of input.")
return n}function n(n){var e
if(e=t(n),!f.test(e))throw new Error("Expected text, got '"+e+"' instead.")
return n.shift()}function e(n,e){var r
if(r=t(n),r!==e)throw new Error("Expected '"+e+"', got '"+r+"' instead.")
return n.shift()}function r(t,n){var e
return e=t[0],e===n?t.shift():null}function a(n){var r
if(e(n,"["),"]"===t(n))throw new Error("Must specify type of Array - eg. [Type], got [] instead.")
return r=s(n),e(n,"]"),{structure:"array",of:r}}function o(n){var a
if(a=[],e(n,"("),")"===t(n))throw new Error("Tuple must be of at least length 1 - eg. (Type), got () instead.")
for(;a.push(s(n)),r(n,","),")"!==t(n););return e(n,")"),{structure:"tuple",of:a}}function u(n){var a,o,u,c,l
for(a={},e(n,"{"),o=!1;;){if(r(n,"...")){o=!0
break}if(u=i(n),c=u[0],l=u[1],a[c]=l,r(n,","),"}"===t(n))break}return e(n,"}"),{structure:"fields",of:a,subset:o}}function i(t){var r,a
return r=n(t),e(t,":"),a=s(t),[r,a]}function c(t){switch(t[0]){case"[":return a(t)
case"(":return o(t)
case"{":return u(t)}}function l(r){var a,o,u,i
if(a=t(r),o="*"===a,o||f.test(a))return u=o?e(r,"*"):n(r),i=c(r),i?(i.type=u,i):{type:u}
if(i=c(r),!i)throw new Error("Unexpected character: "+a)
return i}function s(n){var e,a,o,u,i
if("::"===t(n))throw new Error("No comment before comment separator '::' found.")
for(e=n[1],null!=e&&"::"===e&&(n.shift(),n.shift()),a=[],o={},"Maybe"===t(n)&&(n.shift(),a=[{type:"Undefined"},{type:"Null"}],o={Undefined:!0,Null:!0});u=l(n),i=u.type,o[i]||a.push(u),o[i]=!0,r(n,"|"););return a}var f,d
return f=/[\$\w]+/,d=RegExp("\\.\\.\\.|::|->|"+f.source+"|\\S","g"),function(t){var n,e
if(!t.length)throw new Error("No type specified.")
if(n=t.match(d)||[],in$("->",n))throw new Error("Function types are not supported. To validate that something is a function, you may use 'Function'.")
try{return s(n)}catch(r){throw e=r,new Error(e.message+" - Remaining tokens: "+JSON.stringify(n)+" - Initial input: '"+t+"'")}}},r=function(){function t(t,n){return c(function(t){return u(t,n.of)},t)}function e(t,n){var e,r,a,o,i
for(e=0,r=0,o=(a=n.of).length;o>r;++r){if(i=a[r],!u(t[e],i))return!1
e++}return t.length<=e}function r(t,n){var e,r,a,o,i,c,l
e={},r=0
for(a in t)e[a]=!0,r++
o=0
for(i in c=n.of){if(l=c[i],!u(t[i],l))return!1
e[i]&&o++}return n.subset||r===o}function a(n,a){if(!(n instanceof Object))return!1
switch(a.structure){case"fields":return r(n,a)
case"array":return t(n,a)
case"tuple":return e(n,a)}}function o(t,n){var e,r,o,u
if(e=n.type,r=n.structure,e)return"*"===e?!0:(o=d[e]||s[e],o?o.typeOf===toString$.call(t).slice(8,-1)&&o.validate(t):e===toString$.call(t).slice(8,-1)&&(!r||a(t,n)))
if(r)return(u=f[r])&&u!==toString$.call(t).slice(8,-1)?!1:a(t,n)
throw new Error("No type defined. Input: "+t+".")}function u(t,n){if("Array"!==toString$.call(n).slice(8,-1))throw new Error("Types must be in an array. Input: "+t+".")
return i(function(n){return o(t,n)},n)}var i,c,l,s,f,d
return i=n.any,c=n.all,l=n.isItNaN,s={Number:{typeOf:"Number",validate:function(t){return!l(t)}},NaN:{typeOf:"Number",validate:l},Int:{typeOf:"Number",validate:function(t){return!l(t)&&t%1===0}},Float:{typeOf:"Number",validate:function(t){return!l(t)}},Date:{typeOf:"Date",validate:function(t){return!l(t.getTime())}}},f={array:"Array",tuple:"Array"},function(t,n,e){return null==e&&(e={}),d=e.customTypes||{},u(n,t)}},a=e(),o=r(),function(n,e,r){return t(function(){var t
return t=o(a(n),e,r),t?void 0:console.error("Type doesn't match with object",n,e)})}}),angular.module("ablsdk").service("watcher",function(t,n,e){var r,a,o
return r=function(){return{unwatch:function(t,n){return"function"==typeof n.unwatch?n.unwatch():void 0},watch:function(n,e){var r
return r=t.$new(),r.array=n,e.unwatch=r.$watch("array",e,!0)}}},a=function(){return{unwatch:function(t,n){return Array.unobserve(t,n)},watch:function(n,e){var r,a,o
return r=function(){var n
return n=t.$new(),function(t,e){return n.array=t,n.$watch("array",e)}},(a=null!=(o=Array.observe)?o:r())(n,e)}}},o=function(){switch(!1){case"firefox"!==n.name:return r()
case"unknown"!==n.name:return r()
case"safari"!==n.name:return r()
default:return r()}}()}),angular.module("ablsdk",[]),angular.module("ablsdk").service("ablapi",function(t){return{timeslots:function(n){var e
return e=$.param({activity:n.activityId,"status[event]":"all",dateRange:[moment(n.startTime).clone().startOf("day").startOf("month").toISOString(),moment(n.endTime).clone().startOf("day").endOf("month").endOf("day").toISOString()]}),t.get("timeslots?"+e)}}}),angular.module("ablsdk").service("browser",function(t){var n
return n=function(){var n,e,r
n=t.navigator.userAgent,e={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie/i}
for(r in e)if(e[r].test(t.navigator.userAgent))return r
return"unknown"},{name:n()}}),angular.module("ablsdk").service("ablbook",function(t,n,r,a,o,u){return function(i,c){var l,s,f,d,m,p,v,h,y,g,b,w,D,S,$,x,A,T,C,k,M,E,_,I,O,Y,N,q
return l={triedCheckout:!1,typing:"",braintreeClient:null,loading:!1,idempotencyKey:null,form:{error:"",agreed:!1,email:"",name:"",phone:"",address:"",location:{},notes:"",date:{start:null,end:null},creditCard:{card:"",expDate:"",cvv:"",address_zip:""}},calendar:{value:null,visible:!1,currentActivity:i,closed:function(t){return a("closed-calendar",t),l.form.date.start=l.calendar.date.start,l.form.date.end=l.calendar.date.end,c("slot-chosen",t)}}},s=function(t){var n
return null!=t?(n=null!=(null!=t?t.format:void 0)?t:moment(t),parseInt(n.format("YYYYMMDD"))):null},f=function(t){var n
return n=function(){switch(!1){case null!==t.start:return"none"
case s(t.start)===s(t.end):return"different"
default:return"same"}}()},d=function(t){return!l.loading&&t.$valid},m=function(t){var n,e
for(n in I)if(I.hasOwnProperty(n)&&(e=Y(t,n),(null!=e?e.length:void 0)>0))return e
return"Please check the form"},p=function(t){return l.form.error=t},v=function(){return p("")},h=function(){var t
return l.idempotencyKey=(t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t())},h(),y=function(t){var n
return null!=(n=null!=t&&"function"==typeof t.filter?t.filter(function(t){return t.quantity>0}):void 0)?n:[]},g=function(t){switch(!1){case"undefined"!=typeof t:return 0
case null!==typeof t:return 0
case 0!==t.length:return 0
default:return t.reduce(function(t,n){return t+n})}},b=function(){return 0===g(l.calendar.calc.attendees.map(function(t){return t.quantity}))},w=function(t,n){var e
return e=function(){switch(!1){case 4!==t.length:return t+" "
case 9!==t.length:return t+" "
case 14!==t.length:return t+" "
case 19!==t.length:return t+" "
default:return t}}(),e+n},D=function(){var t
if(null==l.calendar._id)throw"Cannot get event instance id because calendar._id is not defined"
if(t=function(t){return null!=t?t.eventId:void 0}(n.find(function(t){return t._id===l.calendar._id})(i.timeslots)),null==t)throw"event id is not found by id "+l.calendar._id+" in ["+i.timeslots.map(function(t){return t._id}).join(",")+"]"
return t+"_"+l.calendar.date.origin},S=function(r,a){var o,u,c,s,f,d,m
return o=l.form,u=i,c=function(t){return n.map(function(){return null})(function(){var n,e,r=[]
for(n=1,e=t;e>=n;++n)r.push(n)
return r}())},s=l.calendar.calc.coupon.codes.length>0,f=0===l.calendar.calc.calcTotal(),d={isMobile:null!=(m=o.isMobile)?m:!1,stripeToken:r,couponId:s?l.calendar.calc.coupon.codes[0].couponId:void 0,paymentMethod:function(){switch(!1){case!(f&&s):return"gift"
case!f:return"cash"
default:return"credit"}}(),eventInstanceId:D(),addons:n.pairsToObj(n.map(function(t){return[t._id,c(t.quantity)]})(l.calendar.calc.addons)),attendees:n.pairsToObj(n.map(function(t){return[t._id,c(t.quantity)]})(l.calendar.calc.attendees)),answers:n.pairsToObj(n.map(function(t){return[t._id,t.answer]})(l.calendar.questions)),adjustments:l.calendar.calc.adjustment.list,fullName:o.name,email:o.email,phoneNumber:o.phone,notes:o.notes,location:o.location,currency:"usd",_customHeaders:{"Idempotency-Key":l.idempotencyKey}},t.post("bookings",d).success(function(t){var n,r
return null!=t.bookingId?(o.bookingId=t.bookingId,h(),a(t)):p(null!=(n=null!=(r=e.errors)?r[0]:void 0)?n:"Server error")}).error(function(t){var n,e
return p(null!=(n=null!=(e=t.errors)?e[0]:void 0)?n:"Server error")})["finally"](function(){return l.loading=!1})},$=function(t,n){var e,a,o,u,i
return"undefined"==typeof t?(l.loading=!1,p("Stripe key is not defined")):(r.setPublishableKey(t),e=l.form.creditCard,a=e.expDate.split("/"),o=l.form,u={number:e.card,cvc:e.cvv,address_zip:e.address_zip,exp_month:a[0],exp_year:"20"+a[1],fullName:null!=(i=o.fullName)?i:o.name,location:o.location,state:o.state},r.createToken(u,function(t,e){return null!=t?(l.loading=!1,p(t)):S(e,n)}))},x=function(){return t.get("payments/setup")},A=function(t){var n
return l.loading===!0?!1:(l.triedCheckout=!0,n=d(t),n||p(m(t)),n)},T=function(t){return l.booking=t,c("success",t)},C=function(t,n){return A(t)?(l.loading=!0,l.calendar.calc.calcTotal()>0?x().success(function(t){return $(t.publicKey,T)}).error(function(t){return l.loading=!1,p(t),c("error",p)}):S("",T)):void 0},k=function(){return l.form.agreed=!l.form.agreed,O()},M=function(t){return t.required||t.pattern||t.minlength||t.maxlength||t.phone},E=function(t,n){var e,r
return e=I[t].state,r=function(){switch(!1){case!l.triedCheckout:return!0
case!(!e.touched&&!l.triedCheckout):return!1
case!(e.active&&!l.triedCheckout):return!1
case!(!e.active&&e.touched):return!0
default:return!1}}(),r?_(t,n):""},_=function(t,n){switch(!1){case!n.required:return I[t].title+" is required"
case!n.pattern:return"Please follow the example "+I[t].example
case!n.minlength:return I[t].title+" is too short"
case!n.maxlength:return I[t].title+" is too long"
case!n.phone:return I[t].title+" is not valid phone number"
default:return"please check "+I[t].title}},I={email:{title:"Email",pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,example:"nickname@email.com",placeholder:"Email",state:{index:1,touched:!1,active:!1}},name:{pattern:"",title:"Name",example:"Your name",placeholder:"Name",state:{index:2,touched:!1,active:!1}},phone:{title:"Phone",pattern:/^[0-9]{3}[-][0-9]{3}[-][0-9]{3,5}$/i,placeholder:"Phone +1 123-456-1234",example:"+1 123-456-1234",state:{index:3,touched:!1,active:!1}},address:{pattern:"",title:"Address",example:"Address",placeholder:"Home address",state:{index:4,touched:!1,active:!1}},notes:{pattern:"",title:"Notes",example:"Notes",placeholder:"Notes",state:{index:5,touched:!1,active:!1}},address_zip:{pattern:"",example:"12345",title:"Postal Code",placeholder:"Postal Code",normalize:function(t){return t},state:{index:6,touched:!1,active:!1}},card:{pattern:/[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}/i,example:"0000 0000 0000 0000",title:"Credit Card",placeholder:"Credit Card Number",normalize:function(t){return"undefined"!=typeof t?l.form.creditCard.card=function(t){return t.substr(0,19)}(n.fold(w,"")(function(t){return t.split(" ").join("")}(t))):void 0},state:{index:7,touched:!1,active:!1}},expDate:{pattern:/[0-9]{2}\/[0-9]{2}/i,example:"05/15",title:"Exp Date",placeholder:"Exp Date (MM/YY)",normalize:function(t){var n,e,r
return n=null!=(e=null!=t?t.replace("/",""):void 0)?e:"",r=function(t){return null!=t?t:""},l.form.creditCard.expDate=function(){switch(!1){case 2!==n.length:return n[0]+n[1]+"/"
case!(n.length>2):return n[0]+n[1]+"/"+r(n[2])+r(n[3])
default:return n}}()},state:{index:8,touched:!1,active:!1}},startDate:{state:{index:11,touched:!1,active:!1}},cvv:{pattern:/[0-9]{3,4}/i,example:"000",title:"CVV",placeholder:"CVV",state:{index:9,touched:!1,active:!1}},agreed:{title:"Confirmation",pattern:"true",message:{required:"Please accept the terms and conditions"},state:{index:10,touched:!1,active:!1}}},O=function(){return l.form.agreed?l.triedCheckout=!0:void 0},Y=function(t,e){var r,a,o,u
r=n.pairsToObj(n.sortBy(function(t){return t[1].state.index})(n.objToPairs(I)))
for(a in r)if(I.hasOwnProperty(a)&&(o=null!=(u=t[a])?u.$error:void 0,o&&M(o)))return a===e?E(a,o):""
return""},N=function(t){return I[t].placeholder},o(function(){var t,n
return t=l.form,t.email="a.stegno@gmail.com",t.name="Test User",t.phone="+380665243646",t.address="664 Cypress Lane, Campbell, CA, United States",t.notes="Some test notes",n=l.form.creditCard,n.card="5105 1051 0510 5100",n.address_zip="12345",n.expDate="05/17",n.cvv="333",l.form.agreed=!0}),q=l,q.handle=function(t){return u(function(){var n,e,r,a
if(n=t.target.name,e=t.type,r=t.target.value,a=I[n],null!=a)switch(e){case"keyup":return"function"==typeof a.normalize?a.normalize(r):void 0
case"focus":return a.state.active=!0,a.state.touched=!0
case"blur":return a.state.active=!1}})},q.setIndex=function(t,n){var e
return e=I[t],null==e?n:(e.state.index=n,n)},q.investigateDate=f,q.getEventInstanceId=D,q.placeholder=N,q.closeError=v,q.checkout=C,q.validate=A,q.agree=k,q.fields=I,q.few=y,q.disabledOrder=b,q.message=Y,l}}),angular.module("ablsdk").filter("capitalize",function(){return function(t){return angular.isString(t)&&t.length>0?t.charAt(0).toUpperCase()+t.substr(1).toLowerCase():t}}).filter("capitalizeAll",function(){return function(t){return angular.isString(t)&&t.length>0?t.split(" ").map(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}).join(" "):t}}),angular.module("ablsdk").service("ablcalc",function(t,n,e,r,a){var o
return o=function(t){switch(!1){case"undefined"!=typeof t:return 0
case null!==typeof t:return 0
default:return e.sum(t)}},function(u,i,c){var l,s,f,d,m,p,v,h,y,g,b,w,D,S,$,x,A,T,C,k,M,E,_,I,O,Y,N,q,j,P,F,z
return l=null!=i?i:[],s=null!=(f=null!=u?u.filter(function(t){return"active"===t.status}):void 0)?f:[],d=function(t){return{name:t.name,isDefault:t.isDefault,quantity:0,amount:t.amount,_id:t._id}},m=function(t,n){return n.amount-t.amount},p=function(t){return{name:t[0].name,isDefault:t[0].isDefault,amount:t[0].amount,quantity:t.length,_ids:e.map(function(t){return t._id})(t)}},v=function(t){return e.sortWith(m)(e.map(p)(e.map(function(t){return t[1]})(e.objToPairs(e.groupBy(function(t){return t.name+t.amount})(e.filter(function(n){return n.type===t})(l))))))},h=curry$(function(t,n){var r
return r=e.find(function(t){return n.name===t.name&&n.amount===t.amount})(v(t)),null!=r&&(r.old=!0),null==r}),y=function(t){return e.sortWith(m)(e.filter(h(t))(e.map(d)(e.filter(function(n){return n.type===t})(s))))},g=function(t){var n,r,a
return n=e.sortBy(function(t){return t.amount})(e.concat(e.map(function(n){return n(t)})([v,y]))),r=e.filter(function(t){return t.isDefault})(n),a=e.sortBy(function(t){return t.amount})(e.filter(function(t){return-1===r.indexOf(t)})(n)),0===r.length?e.reverse(e.sortBy(function(t){return t.amount})(n)):r.concat(a)},a(function(){return g("aap").length>0}),a(function(){var t
return t=e.head(g("app")),t?null==t.amount||null==t.quantity||null==t.name?!1:void 0:!0}),b={attendees:g("aap"),addons:g("addon")},w=function(){return e.sum(e.map(function(t){return t.amount})(q.list))},D=function(){return o(b.attendees.map(A))+w()+k()},S=function(t){switch(!1){case"tax"!==t.type:return D()/100*t.amount
case"fee"!==t.type:return o(b.attendees.map(function(t){return t.quantity}))*t.amount
default:return 0}},$=function(){return o(s.map(S))},x=function(t){var n,e,r
return null!=(n=null!=(e=s.filter(function(n){return"aap"===n.type&&n.name===t.name}))&&null!=(r=e[0])?r.amount:void 0)?n:0},A=function(t){return x(t)*t.quantity},T=function(t){return o(b.addons.filter(function(n){return n.name===t.name}).map(function(t){return t.amount}))},C=function(t){return T(t)*t.quantity},k=function(){return o(b.addons.map(C))},M=function(){var t,n,e,r,a,o
return t=z.codes[0],n=Math.abs(null!=(e=null!=t?t.amount:void 0)?e:0),r=null!=(e=null!=t?t.percentage:void 0)?e:!1,a=(null!=(e=null!=t?t.isTotal:void 0)?e:!0)?_():D(),o=function(){switch(!1){case!(r===!1&&a>n):return n
case r!==!1:return a
default:return a/100*n}}(),-1*o},E=function(t,n){var e,r,a,o
return e="inactive"===t.status,r=t.type,a=t.old,n=function(){switch(!1){case"aap"!==r:return"pricing level"
case"addon"!==r:return"add-on"}}(),o=function(){switch(!1){case!(e&&"removed"===n):return"Warning: This "+n+" no longer exists. You can only reduce the quantity at this "+n+". If you wish to offer another "+n+" at this price, please create on Adjustment to currect the price."
case!(a&&"changed"===n):return"Warning: This "+n+" has changed since the booking was created. You can only reduce the quantity at this "+n+". If you wish to offer the old "+n+", please create an Adjustment."
case!((e||a)&&"mutated"===n):return!0
default:return""}}()},_=function(){return D()+$()},I=function(){return _()+M()},O=function(){return e.sum(e.map(function(t){return t.amount})(l))},Y=e.sum(e.map(function(t){return t.amount})(null!=c?c:[])),N=function(){return-(I()-Y)},q={list:e.filter(function(t){return"adjustment"===t.type})(l),name:"",amount:"",isEdit:!1,show:!1,add:function(){var t
return t={name:q.name,amount:q.amount},t.amount*=100,q.list.push(t),q.name="",q.amount="",q.show=!1,q.isEdit=!1},removable:function(t){return null==t._id},remove:function(t){var n
return n=q.list.indexOf(t),q.list.splice(n,1)},edit:function(t){return q.isEdit&&q.add(),q.name=t.name,q.amount=t.amount/100,q.show=!0,q.isEdit=!0,q.remove(t)}},j={},P=function(t,n){var e
return j[t]=null!=(e=j[t])?e:[],j[t].push(n)},F=function(t,n){var r,a
return r=null!=(a=j[t])?a:[],e.each(function(t){return t(n)})(r)},z={codes:e.filter(function(t){return"coupon"===t.type})(l),calc:M,show:!1,edit:function(t){return z.code=t.code,z.remove(t),z.show=!0},remove:function(t){var n
return n=z.codes.indexOf(t),n>-1?z.codes.splice(n,1):void 0},add:function(e){var a,o
if(0!==(null!=(a=z.code)?a:"").length&&(z.code=z.code.toUpperCase(),z.error=function(){switch(!1){case 0!==z.code.length:return"Code is required"
case!(z.code.length<6):return"6 chars are required"
default:return""}}(),!(z.error.length>0)))return o=function(t){var a,o,u
return a=function(){return z.codes.push(t),F("coupon-added",t),z.code="",z.success="Coupon "+t.couponId+" added successfully",z.show=!1,n(function(){var t
return t=z.success,delete z.success,t},3e3),""},o=moment(t.startTime),u=moment(t.endTime),r({startTime:o.format(),redeemBy:u.format(),check:o.diff(moment(),"minutes"),check1:o.diff(u,"minutes"),status:t.status,redemptions:0!==t.maxRedemptions&&t.maxRedemptions<=t.redemptions,expired:moment().diff(u,"minutes"),activity:t.activities.length>0&&t.activities[0]!==e}),z.error=function(){switch(!1){case!(o.diff(moment(),"minutes")>0):return"Coupon is not valid yet"
case"inactive"!==t.status:return"Coupon is inactive"
case!(0!==t.maxRedemptions&&t.maxRedemptions<=t.redemptions):return"This coupon has been fully redeemed."
case!(moment().diff(u,"minutes")>0):return"This coupon is expired"
case!(t.activities.length>0&&t.activities[0]!==e):return"This coupon is not valid for this activity."
default:return a()}}()},t.get("coupon/"+z.code).success(function(t){return o(t)}).error(function(t){var n,e
return z.error=null!=(n=null!=t&&null!=(e=t.errors)?e[0]:void 0)?n:"Coupon not found",z.code="",z.show=!0})},code:""},{warning:E,on:P,handle:function(t){var n
return r("handle",t),z.code=(null!=(n=z.code)?n:"").toUpperCase()},coupon:z,adjustment:q,addons:b.addons,attendees:b.attendees,showAttendees:function(){return e.join(", ")(e.map(function(t){return t.quantity+" "+t.name})(e.filter(function(t){return t.quantity>0})(b.attendees)))},showAddons:function(){return e.join(", ")(e.map(function(t){return t.quantity+" "+t.name})(e.filter(function(t){return t.quantity>0})(b.addons)))},totalWithoutTaxesfees:D,calcCoupon:M,couponCode:function(){var t,n
return t=z.codes[0],null!=(n=null!=t?t.couponId:void 0)?n:null!=(n=null!=t?t.name:void 0)?n:"UNKNOWN"},calcTaxFee:S,calcTaxesFees:$,showPrice:x,calcPrice:A,showAddonPrice:T,calcAddonPrice:C,totalAddons:k,calcSubtotal:D,calcTotal:I,calcPreviousTotal:O,calcBalanceDue:N}}}),angular.module("ablsdk").service("abldate",function(t){return function(t){var n,e
return n=function(t,n){var e,r
return e=bind$(moment(t),"format"),r=bind$(n,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},e=function(n,e){return n.add(moment(e).tz(t).utcOffset()-n.utcOffset(),"minute")},{backendify:function(r){var a
return a=n(r,moment().tz(t)).tz(t),e(a),a.tz("UTC").format("YYYY-MM-DD\\THH:mm:ss\\Z")},frontendify:function(r){var a
return a=moment(r).tz(t),e(a,a),n(a,moment(r)).toDate()}}}})
var toString$={}.toString
angular.module("ablsdk").service("crud",function(t,n,e,r,a,o,u){return function(e,i){var c,l,s,f,d,m,p,v,h,y,g,b,w,D,S,$,x,A
return c=e.split("@"),e=c[0],l={loading:!1,frontendify:function(t,n){var e,r,a
return e=n.split("/"),r=e[e.length-1],a=function(){switch(!1){case"Array"!==toString$.call(t).slice(8,-1):return t
case"Array"!==toString$.call(t.list).slice(8,-1):return t.list
case"Array"!==toString$.call(t[r]).slice(8,-1):return t[r]
case"Object"!==toString$.call(t).slice(8,-1):return[t]
default:return[]}}()}},s={localStorage:{remove:function(t){},add:function(t){},update:function(t){},fetch:function(t){}},memory:{remove:function(t){return h(t)},add:function(t,n){return Array.prototype.push.call(v,t),"function"==typeof n?n(t):void 0},update:function(t,n){return"function"==typeof n?n(t):void 0},fetch:function(){return l.loading=!1}},backend:{remove:function(n){return t["delete"](e+"/"+n._id).success(function(){return h(n)})},update:function(n,r){return t.update(e+"/"+n._id,n).success(function(t){return l.loading=!1,"function"==typeof r?r(t):void 0})},add:function(n,r){return t.create(e,n).success(function(t){return w(t),"function"==typeof r?r(t):void 0})},fetch:function(){var n
return n=angular.copy(v.options),delete n.total,delete n.$url,t.get(m(e),{params:n}).success(function(t,n,e){var r,a
return v.length=0,r=function(t){var n,r,a
if(n=e()[t],null!=n){r=document.createElement("a"),r.href=e()[t]
try{return JSON.parse('{"'+decodeURI(r.search.substr(1,2e3)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(o){return a=o,void console.error(a,r.search)}}},v.options.total=(a=r("x-last-page-url"),null!=a?parseInt(a.page)*parseInt(a.pageSize):t.length),v.options.pageSize=(a=r("x-first-page-url"),null!=a?parseInt(a.pageSize):t.length),l.loading=!1,w(t)})}}},f=s[null!=(d=c[1])?d:"backend"],m=function(t){var n,e,r
return n={url:t},e=function(t){return n.url=n.url.replace(":"+t[0],t[1])},r=v.getOptions().$url,null!=r&&u.each(e)(u.objToPairs(r)),n.url},p=n.$new(),p.items=[],v=p.items,l.loading=!1,h=function(t){var n
return n=v.indexOf(t),n>-1?Array.prototype.splice.call(v,n,1):void 0},y=function(t,n){return null!=t._id?g(t,n):b(t,n)},g=function(t,n){return l.loading?void 0:f.update(t,n)},b=function(t,n){return l.loading?void 0:f.add(t,n)},w=function(t){var n,r,a
switch(n=l.frontendify(t,e),r=toString$.call(n).slice(8,-1)){case"Array":Array.prototype.push.apply(v,n)
break
case"Object":a=function(t){return v[t[0]]=t[1]},u.each(a)(u.objToPairs(n))}return l.loading=!1},v.options={},v.converter=function(t){return l.frontendify=t.frontendify,l.backendify=t.backendify,v},v.getOptions=function(){return v.options},D=function(t){if(!l.loading){switch(toString$.call(t).slice(8,-1)){case"Function":return v.getOptions=t,D({})
case"Number":v.options.page=t
break
case"Object":v.options=angular.extend({},v.getOptions(),t)}return l.loading=!0,null!=v.options.page&&(v.options.page-=1),f.fetch()}},D(i),S=function(){var t
if(!l.loading)return t=Array.prototype.splice.apply(v,arguments),t.forEach(f.remove)},$=function(t,n,e){var a,o
if(!l.loading)return a={title:"Confirm Delete",content:"Are you sure you want to delete this item?",ok:"Confirm",cancel:"Cancel"},o=r.confirm({controller:"confirm2",templateUrl:"confirm",locals:{options:angular.extend({},a,e)},targetEvent:n}),r.show(o).then(function(n){return n===!0?f.remove(t):void 0})},x=[],A=function(t){var n,e
return n=[],e=curry$(function(e,r){var a,o
return a=[],A(a),o=function(){var n
return n=Array.prototype[e].call(t,r),a.length=0,Array.prototype.push.apply(a,n)},n.push(o),o(),a}),t.loading=function(){return l.loading},t.toArray=function(){var n
return n=[],Array.prototype.push.apply(n,t),n},t.fetchOn=function(n,e){return e.$watch(n,bind$(v,"fetch"),!0),t},t.watch=function(e,r){var u
return u=function(){return a(function(){return n.forEach(function(t){return t()})})},null!=r?(x.push({array:r[e],func:u}),r.$watch(e,u,!0)):(x.push({array:e,func:u}),o.watch(e,u)),t},t.watch(t),["map","filter"].forEach(function(n){return t[n]=e(n)}),t.push=b,t.save=y,t.fetch=D,t.remove=$,t.splice=S,t.toArray=function(){return angular.copy(t)}},v.listen=function(t){return t.$on("$destroy",function(){var t,n,e,r,a=[]
for(t=0,e=(n=x).length;e>t;++t)r=n[t],a.push(o.unwatch(r.array,r.func))
return a}),v},A(v),v}}),angular.module("ablsdk").directive("event",function(t,n){return{restrict:"A",scope:{event:"&"},link:function(e,r,a){var o,u
return o=$(r),u=function(t){return o[t](function(t){var r
return r=function(){return e.event({event:t})},n(r,e)})},t.each(u)(["blur","focus","keyup"])}}})
var toString$={}.toString
angular.module("ablsdk").factory("debug",function(t){return function(n){var e,r
if(t)if(e=function(){switch(!1){case"Function"!==toString$.call(null!=n?n.match:void 0).slice(8,-1):return n.match(/<<[a-z]+>>/i)
default:return null}}(),e&&window["catch"]===e[0].replace("<<","").replace(">>",""));else switch(toString$.call(n).slice(8,-1)){case"Function":return n()
default:return"undefined"!=typeof console&&null!==console&&null!=(r=console.log)?r.apply(console,arguments):void 0}}}),angular.module("ablsdk").service("ablfacade",function(t,n){return function(e,r){var a,o
return a=t(e,r),o=n(e,a.calendar),{book:a,slot:o}}}),angular.module("ablsdk").filter("mdate",function(t){return function(t,n){return null!=t?t.format(n):null}}),angular.module("ablsdk").service("formula",function(t,n){var e,r
return e=function(n,e){var r,a
return r=null!=(a=null!=e?e.charges:void 0)?a:[],function(t){var n
return null!=(n=null!=t?t.amount:void 0)?n:0}(t.find(function(t){return t.type===n||t.subtype===n||t.description===n})(r))},r=function(n){var e,r,a,o,u,i,c,l,s,f,d
return(null!=n&&null!=(e=n.timeslots)?e.length:void 0)>0?(r=function(t){return[].concat.apply([],t)},a=function(n){var e
return t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(t.filter(function(t){return t.isDefault})(null!=(e=null!=n?n.charges:void 0)?e:[])))},o=function(n){var e,r
return e="Adult",t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(t.filter(function(t){return t.type===e||t.subtype===e||t.description===e})(null!=(r=null!=n?n.charges:void 0)?r:[])))},u=function(n){var e
return t.map(function(t){return t.amount})(t.filter(function(t){return"active"===t.status})(null!=(e=null!=n?n.charges:void 0)?e:[]))},i=r(n.timeslots.map(o)),c=r(n.timeslots.map(u)),l=r(n.timeslots.map(a)),s=function(t){return Math.max.apply(Math,t)},f=function(t){return Math.min.apply(Math,t)},d=function(){switch(!1){case!(l.length>0):return f(l)
case!(i.length>0):return s(i)
case!(c.length>0):return s(c)
default:return 0}}()):"Non"},{getSlotPrice:function(t){return e("Adult",t)},getVisualPrice:r,getAdultPrice:function(t){var n
return e("Adult",null!=t&&null!=(n=t.timeslots)?n[0]:void 0)},getYouthPrice:function(t){var n
return e("Youth",null!=t&&null!=(n=t.timeslots)?n[0]:void 0)}}})
var toString$={}.toString
angular.module("ablsdk").service("p",function(){var t,n
return t=function(n){var e
return[].concat.apply([],function(){var r,a,o,u=[]
for(r=0,o=(a=n).length;o>r;++r)e=a[r],"Array"===toString$.call(e).slice(8,-1)?u.push(t(e)):u.push(e)
return u}())},{head:n=function(t){return t[0]},each:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)a=n[e],t(a)
return n}),isItNaN:function(t){return t!==t},all:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],!t(a))return!1
return!0}),map:curry$(function(t,n){return n.map(t)}),fold:curry$(function(t,n,e){var r,a,o
for(r=0,a=e.length;a>r;++r)o=e[r],n=t(n,o)
return n}),filter:curry$(function(t,n){var e,r,a,o=[]
for(e=0,r=n.length;r>e;++e)a=n[e],t(a)&&o.push(a)
return o}),find:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return a}),pairsToObj:function(t){var n,e,r,a={}
for(n=0,e=t.length;e>n;++n)r=t[n],a[r[0]]=r[1]
return a},objToPairs:function(t){var n,e,r=[]
for(n in t)e=t[n],r.push([n,e])
return r},values:function(t){var n,e,r=[]
for(n in t)e=t[n],r.push(e)
return r},any:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return!0
return!1}),notAny:curry$(function(t,n){var e,r,a
for(e=0,r=n.length;r>e;++e)if(a=n[e],t(a))return!1
return!0}),sum:function(t){var n,e,r,a
for(n=0,e=0,r=t.length;r>e;++e)a=t[e],n+=a
return n},sort:function(t){return t.concat().sort(function(t,n){return t>n?1:n>t?-1:0})},concat:function(t){return[].concat.apply([],t)},concatMap:curry$(function(t,n){var e
return[].concat.apply([],function(){var r,a,o,u=[]
for(r=0,o=(a=n).length;o>r;++r)e=a[r],u.push(t(e))
return u}())}),flatten:t,groupBy:curry$(function(t,n){var e,r,a,o,u
for(e={},r=0,a=n.length;a>r;++r)o=n[r],u=t(o),u in e?e[u].push(o):e[u]=[o]
return e}),sortWith:curry$(function(t,n){return n.concat().sort(t)}),sortBy:curry$(function(t,n){return n.concat().sort(function(n,e){return t(n)>t(e)?1:t(n)<t(e)?-1:0})}),reverse:function(t){return t.concat().reverse()},split:curry$(function(t,n){return n.split(t)}),join:curry$(function(t,n){return n.join(t)}),lines:function(t){return t.length?t.split("\n"):[]},unlines:function(t){return t.join("\n")},words:function(t){return t.length?t.split(/[ ]+/):[]},unwords:function(t){return t.join(" ")},chars:function(t){return t.split("")},unchars:function(t){return t.join("")},repeat:curry$(function(t,n){var e,r
for(e="",r=0;t>r;++r)e+=n
return e}),maximum:function(t){var n,e,r,a,o
for(n=t[0],e=0,a=(r=t.slice(1)).length;a>e;++e)o=r[e],o>n&&(n=o)
return n},minimum:function(t){var n,e,r,a,o
for(n=t[0],e=0,a=(r=t.slice(1)).length;a>e;++e)o=r[e],n>o&&(n=o)
return n},maximumBy:curry$(function(t,n){var e,r,a,o,u
for(e=n[0],r=0,o=(a=n.slice(1)).length;o>r;++r)u=a[r],t(u)>t(e)&&(e=u)
return e}),minimumBy:curry$(function(t,n){var e,r,a,o,u
for(e=n[0],r=0,o=(a=n.slice(1)).length;o>r;++r)u=a[r],t(u)<t(e)&&(e=u)
return e}),capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},camelize:function(t){return t.replace(/[-_]+(.)?/g,function(t,n){return(null!=n?n:"").toUpperCase()})},dasherize:function(t){return t.replace(/([^-A-Z])([A-Z]+)/g,function(t,n,e){return n+"-"+(e.length>1?e:e.toLowerCase())}).replace(/^([A-Z]+)/,function(t,n){return n.length>1?n+"-":n.toLowerCase()})}}}),angular.module("ablsdk").factory("prefill",function(t,n,e){return function(r){return t(function(){return e.prefill=function(){var t
return t=arguments,n(function(){return r.apply(null,t)})},null!=e.parent?e.parent.prefill=e.prefill:void 0})}}),angular.module("ablsdk").filter("price",function(t){return function(n,e){var r,a
return r=n/100,a=function(){switch(!1){case"00.00$"!==e:return t("currency")(r).replace("$","").trim()+"$"
case"$00"!==e:return"$"+Math.round(r)
default:return t("currency")(r)}}()}}),angular.module("ablsdk").service("safeApply",function(t){return function(n,e){var r,a
return r=null!=e?e:t,a=r.$$phase,"$apply"===a||"$digest"===a?n():r.$apply(n)}})
var toString$={}.toString
angular.module("ablsdk").service("ablslot",function(abldate,ablcalc,ablapi,formula,p,debug,$xabl,$rootScope){return function(activity,inputModel){var transformCharge,getDay,newDate,generateCalendar,getMonth,hackDate,merge,makeAvailable,defineDateStart,performChooseSlot,actualEvent,isEmpty,transformSlot,slotsByDayWithoutFilters,slotsByDay,select,isFitToSlotFull,isFitToSlot,isNotFitToAnySlot,cutoff,inPast,createMonth,startMonth,setCalendars,scroll,nextMonth,calendar,findChosenEvent,loadEvents,isDummy,isDisabledDay,selectDayAnyway,selectDay,notSelected,disabledSlot,notAvailableSlot,close,chooseSlot,chooseSlotAnyway,isActiveDay,isDisabledMonth,isActiveMonth,isCalendarUpDisabled,calendarUp,calendarDown,setup,move,eventInstanceId,createEventInstanceId,model,slots,calendars,activeSlots,possibleSlots,x$,ref$,state,observer
return transformCharge=function(t){return{_id:t._id,name:t.name,quantity:0,amount:t.amount}},getDay=function(t){var n
return null!=t?(n=null!=(null!=t?t.format:void 0)?t:moment(t),parseInt(n.format("YYYYMMDD"))):null},newDate=function(){var t
return t=moment.apply(null,arguments)},generateCalendar=function(t,n){var e,r,a,o,u,i,c,l
return e=newDate(t),r=e.year(),a=e.month(),o=function(t){return newDate(moment.tz([r,a,t],activity.timeZone))},u=e.endOf("month").date(),i=p.map(o)(function(){var t,n,e=[]
for(t=1,n=u;n>=t;++t)e.push(t)
return e}()),c=newDate(i[0]).day(),l=p.map(function(){return null})(function(){var t,n,e=[]
for(t=1,n=c;n>=t;++t)e.push(t)
return e}()),{time:e,days:l.concat(i),headers:["Su","M","Tu","W","Th","F","Sa"]}},getMonth=function(t){return Math.ceil(getDay(t)/100)},hackDate=function(t,n){var e,r
return e=bind$(moment(t),"format"),r=bind$(n,"format"),moment(e("YYYY-MM-DD HH:mm ")+r("Z"),"YYYY-MM-DD HH:mm Z")},merge=function(t,n){var e,r
return e=null!=t?t:hackDate(t,moment()),r=null!=n?n:hackDate(n,moment()),moment([e.year(),e.month(),e.date(),r.hours(),r.minutes(),0])},makeAvailable=curry$(function(slot,arg){var correct,quantities,available
return correct=function(t){var n,e
switch(!1){case null!==t:return!1
case"undefined"!=typeof t:return!1
case"Number"!==toString$.call(t).slice(8,-1):return!0
case!("String"===toString$.call(t).slice(8,-1)&&0===t.length):return!1
case!("String"===toString$.call(t).slice(8,-1)&&(null!=(n=t.match("^[0-9]+$"))&&null!=(e=n[0])?e.length:void 0)===t.length):return!0
default:return!1}},quantities=p.filter(correct)(p.map(function(t){return t.quantity})(model.calc.attendees)),available="inactive"===slot.status?0:slot.available-eval([0].concat(quantities).join("+"))}),defineDateStart=function(t,n){var e
return e=merge(t,n.startTime),model.date.start=e},performChooseSlot=function(t){var n,e,r,a,o,u
if(debug("perform-choose-slot",t),null==t)throw"Slot is undefined"
if(null==t.available)throw"Slot doesn't have required 'available' field"
if(0!==t.available){if(n=model.value,defineDateStart(n,t),e=abldate(activity.timeZone),model.date.origin=e.backendify(model.date.start).replace(/[\:-]/gi,""),model.date.end=t.endTime,model.title=null!=(r=t.title)?r:activity.title,model.charges=t.charges,model.calc=ablcalc(t.charges.concat(activity.charges)),null==t._id)throw"Slot doesn't have required field '_id'"
if(model._id=t._id,a=p.find(function(n){return n._id===t._id})(activity.timeslots),null==a)throw"Slot has not been found by id "+t._id+" in ["+activity.timeslots.map(function(t){return t._id}).join(",")+"]"
if(null==(null!=a?a.eventId:void 0))throw"Event id field has not been found in timeslot "+JSON.stringify(a)
return model.eventId=a.eventId,o=model.attendees,u=function(t){var n
return n=o.filter(function(n){return n.name===t.name}),{quantity:function(){switch(!1){case!(n.length>0):return n[0].quantity
case"Adult"!==t.name:return 1
default:return 0}}(),name:t.name,amount:t.amount}},model.attendees=t.charges.filter(function(t){return"aap"===t.type}).map(u),model.available=makeAvailable(t)}},actualEvent=curry$(function(t,n){return getDay(n.startTime)===getDay(t)}),isEmpty=function(t){var n
return n=actualEvent(t),function(t){return 0===t.length}(p.filter(isFitToSlot(t))(slots))},transformSlot=function(t){var n
return n=actualEvent(t),function(e){var r,a,o,u,i
return r=merge(t,e.startTime),a=e.endTime-e.startTime,o=p.find(n)(e.events),u=null!=(i=null!=o?o.available:void 0)?i:e.maxOcc,debug(null!=o?o.status:void 0),{nativeSlot:e,status:null!=o?o.status:void 0,startTime:r,time:r.valueOf(),endTime:r.clone().add(a,"milliseconds"),charges:e.charges,price:formula.getVisualPrice({timeslots:[e]}),available:"inactive"===(null!=o?o.status:void 0)?0:u,title:null!=o?o.title:void 0,_id:e._id,duration:moment.duration(a).format("M[M] d[d] h[h] m[m]").replace(/((^| )0[a-z])|[ ]/gi,""),taken:e.maxOcc-u}}},slotsByDayWithoutFilters=function(t){return p.sortBy(function(t){return t.time})(p.map(transformSlot(t))(p.filter(isFitToSlotFull(!0,t))(slots)))},slotsByDay=function(t){return p.sortBy(function(t){return t.time})(p.map(transformSlot(t))(p.filter(isFitToSlot(t))(slots)))},select=function(t){var n,e,r,a,o,u
return model.value=t,activeSlots.length=0,possibleSlots.length=0,slotsByDayWithoutFilters(t).forEach(function(t){return possibleSlots.push(t)}),slotsByDay(t).forEach(function(t){return activeSlots.push(t)}),n=null!=(e=null!=(r=$rootScope.user)&&null!=(a=r.preferences)&&null!=(o=a.widget)&&null!=(u=o.display)?u.timeslot:void 0)?e:{},n.duration+n.price+n.availability+n.startTime===0&&activeSlots.length>0?chooseSlot(activeSlots[0]):void 0},isFitToSlotFull=curry$(function(t,n,e){var r,a,o,u,i,c
return r=0===e.daysRunning.length,a=activity,o=function(){switch(!1){case!r:return getDay(e.startTime)!==getDay(n)
case!(getDay(e.untilTime)<getDay(n)):return!0
case!(getDay(e.startTime)>getDay(n)):return!0
default:return!1}}(),u=function(t){var n,e
return n=null!=t&&"function"==typeof t.day?t.day():void 0,e=function(){switch(!1){case null!==n:return null
case 0!==n:return 6
default:return n-1}}()},i=!r&&p.notAny(function(t){return t===u(n)})(e.daysRunning),c=function(){switch(!1){case!i:return!1
case!o:return!1
default:return!0}}()}),isFitToSlot=isFitToSlotFull(!1),isNotFitToAnySlot=function(t){switch(!1){case!p.notAny(function(t){return t.available>0})(slotsByDay(t)):return!0
case!p.notAny(isFitToSlot(t))(slots):return!0
default:return!1}},cutoff=function(){var t,n,e,r,a,o
switch(!1){case(null!=(t=$rootScope.user)&&null!=(n=t.preferences)&&null!=(e=n.widget)&&null!=(r=e.display)&&null!=(a=r.event)?a.isSiteWide:void 0)!==!0:return $rootScope.user.preferences.widget.display.event.cutoff
case!((null!=(o=activity.cutoff)?o:-1)>-1):return activity.cutoff
default:return 2880}}(),inPast=function(t,n){return null!=n&&n.indexOf("include_nearest")>-1?getDay(t)<getDay(newDate()):getDay(t)<getDay(newDate())||t.diff(newDate(),"minutes")<cutoff},createMonth=function(t){return newDate([t.year(),t.month(),15])},startMonth=createMonth(newDate()),setCalendars=function(t,n,e){return calendars.length=0,calendars.push(t),calendars.push(n),loadEvents(e)},scroll={activeDate:function(){var t,n,e,r,a,o
return scroll.activeDate=function(){},t=calendars[0],n=function(n){return generateCalendar(t.time.clone().add(n,"month"))},e=function(e){return 0===e?t:n(e)},r=function(t){return"undefined"!=typeof p.find(function(t){return!isDisabledDay(t)})(e(t).days)},a=function(t){return function(){var n,e,r=[]
for(n=1,e=t;e>=n;++n)r.push(n)
return r}().forEach(bind$(calendar,"down"))},o=p.find(r)([0,1,2,3,4,5,6]),o>0?a(o):void 0}},nextMonth=function(t,n){return date.clone().add(n,"months")},calendar={first:startMonth,second:startMonth.clone().add(1,"months"),move:function(t){return calendar.first=calendar.first.clone().add(t,"month"),calendar.second=calendar.second.clone().add(t,"month"),setCalendars(generateCalendar(calendar.first),generateCalendar(calendar.second))},down:function(){return calendar.move(1)},up:function(){return calendar.move(-1)}},findChosenEvent=function(){var t,n,e,r,a,o,u
if(0!==(null!=(t=state.chosenEvent)?t:"").length&&0!==slots.length)return n=state.chosenEvent.split("_"),e=n[0],r=abldate(activity.timeZone),a=moment(r.frontendify(moment(n[1],"YYYYMMDDHHmmssZ").toDate())),o=p.find(function(t){return t.eventId===e})(slots),null!=o?isDisabledDay(a)?(u=p.find(function(t){return t._id===o._id})(slotsByDay(a)),null==o&&observer.notify("event-not-found"),notAvailableSlot(u)?observer.notify("event-sold-out"):inPast(a)?observer.notify("event-too-close"):observer.notify("event-not-found")):(selectDay(a),debug({activeSlots:activeSlots,possibleSlots:possibleSlots,currentSlot:o._id}),o=p.find(function(t){return t._id===o._id})(activeSlots),null!=o?chooseSlot(o):observer.notify("event-not-found")):observer.notify("event-not-found")},loadEvents=function(t){return ablapi.timeslots({startTime:calendars[0].time,endTime:calendars[1].time,activityId:activity._id}).success(function(n){var e,r,a
return e=abldate(activity.timeZone),r=compose$(e.frontendify,moment),a=function(t){return t.startTime=r(t.startTime),t.endTime=r(t.endTime),t.untilTime=r(t.untilTime),t},slots.length=0,n.list.map(a).forEach(function(t){return slots.push(t)}),findChosenEvent(),scroll.activeDate(),"function"==typeof t?t():void 0})},isDummy=function(t){switch(!1){case null!==t:return!0
default:return!1}},isDisabledDay=function(t,n){switch(!1){case!isDummy(t):return!0
case!isEmpty(t):return!0
case!inPast(t,n):return!0
case!isNotFitToAnySlot(t):return!0
default:return!1}},selectDayAnyway=function(t){return select(t),defineDateStart(t,slots[0])},selectDay=function(t){return isDisabledDay(t)?void 0:selectDayAnyway(t)},notSelected=function(){switch(!1){case null!==model.date.start:return!0
case model.chosen!==!1:return!0
default:return!1}},disabledSlot=function(t){switch(!1){case 0!==t.available:return"This event is full"
default:return""}},notAvailableSlot=function(t){return t.available<=0},close=function(t){var n
return n=function(t){return 0===t.quantity&&"Adult"===t.name?t.quantity=1:void 0},model.attendees.forEach(n),model.chosen=t,model.visible=!1,"function"==typeof model.closed?model.closed(t):void 0},chooseSlot=function(t){return notAvailableSlot(t)?void 0:(performChooseSlot(t),close(!0))},chooseSlotAnyway=function(t){return performChooseSlot(t),close(!0)},isActiveDay=function(t){return getDay(t)===getDay(model.value)},isDisabledMonth=function(t){switch(!1){case!(getDay(t)<getDay(newDate())):return!0
default:return!1}},isActiveMonth=function(t){return getMonth(t)===getMonth(model.value)},isCalendarUpDisabled=function(){return getMonth(calendars[0].time)<getMonth(newDate())},calendarUp=function(){return isCalendarUpDisabled()?void 0:calendar.up()},calendarDown=function(){return calendar.down()},setup=function(){return setCalendars(generateCalendar(startMonth.clone()),generateCalendar(startMonth.clone().add(1,"month")),function(){return selectDay(model.value)})},move=function(t){return $xabl.put("bookings/"+t+"/move",{eventInstanceId:createEventInstanceId()})},eventInstanceId=function(t){var n
return n=abldate(activity.timeZone),t.eventId+"_"+n.backendify(t.date.start).replace(/[\:-]/gi,"")},createEventInstanceId=function(){return eventInstanceId(model)},model=null!=inputModel?inputModel:{},slots=[],calendars=[],activeSlots=[],possibleSlots=[],x$=model,x$.date={start:null,end:null},x$.value=null,x$.eventId=null,x$._id=null,x$.charges=[],x$.attendees=[],x$.addons=activity.charges.filter(function(t){return"addon"===t.type}).map(transformCharge),x$.questions=null!=(ref$=activity.questions)?ref$:[],x$.bg=activity.image,setup(),state={chosenEvent:null},observer={list:[],observe:function(t){return observer.list.push(t)},notify:function(t,n){return p.each(function(e){return e(t,n)})(observer.list)}},{observe:observer.observe,chooseEvent:function(t){return state.chosenEvent=t,findChosenEvent()},model:model,activeSlots:activeSlots,possibleSlots:possibleSlots,move:move,selectDay:selectDay,selectDayAnyway:selectDayAnyway,calendars:calendars,createEventInstanceId:createEventInstanceId,calendarUp:calendarUp,calendarDown:calendarDown,close:close,isActiveMonth:isActiveMonth,isDisabledDay:isDisabledDay,isDisabledMonth:isDisabledMonth,isCalendarUpDisabled:isCalendarUpDisabled,isDummy:isDummy,isActiveDay:isActiveDay,notSelected:notSelected,chooseSlot:chooseSlot,chooseSlotAnyway:chooseSlotAnyway,notAvailableSlot:notAvailableSlot,disabledSlot:disabledSlot}}}),angular.module("ablsdk").factory("stripe",function(t,n){var e,r
if(e={},r=function(){var t
return e.setPublishableKey=Stripe.setPublishableKey,t=Stripe.card,e.createToken=function(e,r){var a,o,u,i
return t.validateCardNumber(e.number)?t.validateExpiry(e.exp_month,e.exp_year)?t.validateCVC(e.cvc)?t.createToken({number:e.number,cvc:e.cvc,exp_month:e.exp_month,exp_year:e.exp_year,name:e.fullName,address_line1:null!=(a=e.location)?a.street_address:void 0,address_city:null!=(o=e.location)?o.city:void 0,address_country:null!=(u=e.location)?u.country:void 0,address_state:null!=(i=e.location)?i.state:void 0},function(t,e){return n(null!=e.id?function(){return r(null,e.id)}:function(){return r(e.error.message)})}):r("CVV is not correct. Your CVV number can be located by looking on your credit or debit card"):r("Expiration Month/Year is not correct"):r("Card number is not correct")}},"undefined"==typeof window.Stripe)throw'please add <script src="https://js.stripe.com/v2/"></script>'
return r(),e}),angular.module("ablsdk").service("test",function(t){return function(n){return t(function(){var t
if(t=n(),t!==!0)throw"[FAILED TEST]"+n.toString()})}})
var toString$={}.toString
angular.module("ablsdk").service("typecheck",function(t,n){var e,r,a,o
return e=function(){function t(t){var n
if(n=t[0],null==n)throw new Error("Unexpected end of input.")
return n}function n(n){var e
if(e=t(n),!f.test(e))throw new Error("Expected text, got '"+e+"' instead.")
return n.shift()}function e(n,e){var r
if(r=t(n),r!==e)throw new Error("Expected '"+e+"', got '"+r+"' instead.")
return n.shift()}function r(t,n){var e
return e=t[0],e===n?t.shift():null}function a(n){var r
if(e(n,"["),"]"===t(n))throw new Error("Must specify type of Array - eg. [Type], got [] instead.")
return r=s(n),e(n,"]"),{structure:"array",of:r}}function o(n){var a
if(a=[],e(n,"("),")"===t(n))throw new Error("Tuple must be of at least length 1 - eg. (Type), got () instead.")
for(;a.push(s(n)),r(n,","),")"!==t(n););return e(n,")"),{structure:"tuple",of:a}}function u(n){var a,o,u,c,l
for(a={},e(n,"{"),o=!1;;){if(r(n,"...")){o=!0
break}if(u=i(n),c=u[0],l=u[1],a[c]=l,r(n,","),"}"===t(n))break}return e(n,"}"),{structure:"fields",of:a,subset:o}}function i(t){var r,a
return r=n(t),e(t,":"),a=s(t),[r,a]}function c(t){switch(t[0]){case"[":return a(t)
case"(":return o(t)
case"{":return u(t)}}function l(r){var a,o,u,i
if(a=t(r),o="*"===a,o||f.test(a))return u=o?e(r,"*"):n(r),i=c(r),i?(i.type=u,i):{type:u}
if(i=c(r),!i)throw new Error("Unexpected character: "+a)
return i}function s(n){var e,a,o,u,i
if("::"===t(n))throw new Error("No comment before comment separator '::' found.")
for(e=n[1],null!=e&&"::"===e&&(n.shift(),n.shift()),a=[],o={},"Maybe"===t(n)&&(n.shift(),a=[{type:"Undefined"},{type:"Null"}],o={Undefined:!0,Null:!0});u=l(n),i=u.type,o[i]||a.push(u),o[i]=!0,r(n,"|"););return a}var f,d
return f=/[\$\w]+/,d=RegExp("\\.\\.\\.|::|->|"+f.source+"|\\S","g"),function(t){var n,e
if(!t.length)throw new Error("No type specified.")
if(n=t.match(d)||[],in$("->",n))throw new Error("Function types are not supported. To validate that something is a function, you may use 'Function'.")
try{return s(n)}catch(r){throw e=r,new Error(e.message+" - Remaining tokens: "+JSON.stringify(n)+" - Initial input: '"+t+"'")}}},r=function(){function t(t,n){return c(function(t){return u(t,n.of)},t)}function e(t,n){var e,r,a,o,i
for(e=0,r=0,o=(a=n.of).length;o>r;++r){if(i=a[r],!u(t[e],i))return!1
e++}return t.length<=e}function r(t,n){var e,r,a,o,i,c,l
e={},r=0
for(a in t)e[a]=!0,r++
o=0
for(i in c=n.of){if(l=c[i],!u(t[i],l))return!1
e[i]&&o++}return n.subset||r===o}function a(n,a){if(!(n instanceof Object))return!1
switch(a.structure){case"fields":return r(n,a)
case"array":return t(n,a)
case"tuple":return e(n,a)}}function o(t,n){var e,r,o,u
if(e=n.type,r=n.structure,e)return"*"===e?!0:(o=d[e]||s[e],o?o.typeOf===toString$.call(t).slice(8,-1)&&o.validate(t):e===toString$.call(t).slice(8,-1)&&(!r||a(t,n)))
if(r)return(u=f[r])&&u!==toString$.call(t).slice(8,-1)?!1:a(t,n)
throw new Error("No type defined. Input: "+t+".")}function u(t,n){if("Array"!==toString$.call(n).slice(8,-1))throw new Error("Types must be in an array. Input: "+t+".")
return i(function(n){return o(t,n)},n)}var i,c,l,s,f,d
return i=n.any,c=n.all,l=n.isItNaN,s={Number:{typeOf:"Number",validate:function(t){return!l(t)}},NaN:{typeOf:"Number",validate:l},Int:{typeOf:"Number",validate:function(t){return!l(t)&&t%1===0}},Float:{typeOf:"Number",validate:function(t){return!l(t)}},Date:{typeOf:"Date",validate:function(t){return!l(t.getTime())}}},f={array:"Array",tuple:"Array"},function(t,n,e){return null==e&&(e={}),d=e.customTypes||{},u(n,t)}},a=e(),o=r(),function(n,e,r){return t(function(){var t
return t=o(a(n),e,r),t?void 0:console.error("Type doesn't match with object",n,e)})}}),angular.module("ablsdk").service("watcher",function(t,n,e){var r,a,o
return r=function(){return{unwatch:function(t,n){return"function"==typeof n.unwatch?n.unwatch():void 0},watch:function(n,e){var r
return r=t.$new(),r.array=n,e.unwatch=r.$watch("array",e,!0)}}},a=function(){return{unwatch:function(t,n){return Array.unobserve(t,n)},watch:function(n,e){var r,a,o
return r=function(){var n
return n=t.$new(),function(t,e){return n.array=t,n.$watch("array",e)}},(a=null!=(o=Array.observe)?o:r())(n,e)}}},o=function(){switch(!1){case"firefox"!==n.name:return r()
case"unknown"!==n.name:return r()
case"safari"!==n.name:return r()
default:return r()}}()})
